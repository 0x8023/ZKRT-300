C51 COMPILER V9.01   8023                                                                  05/15/2015 12:50:09 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE 8023
OBJECT MODULE PLACED IN .\output\8023.obj
COMPILER INVOKED BY: H:\Program\keil\C51\BIN\C51.EXE program\8023.c DEBUG OBJECTEXTEND PRINT(.\8023.lst) OBJECT(.\output
                    -\8023.obj)

line level    source

   1          #include "./output/8023.h"
   2          xdata struct str_state str_begin,str_now,str_next;//åˆ†åˆ«ä¸º:èµ·å§‹çŠ¶æ€/å½“å‰çŠ¶æ€/ç›®æ ‡çŠ¶æ€
   3          xdata struct str_parameter str_cod={
   4              /*ui str_cod.mlinerqd*/25000,//é»˜è®¤ä¸»å‡½æ•°å·¡çº¿è½¯èµ·åŠ¨è·¯ç¨‹ä¸º25000
   5              /*ui str_cod.mlineqc*/200,//é»˜è®¤ä¸»å‡½æ•°å·¡çº¿å‰å†²æ—¶é—´ä¸º500æ¯«ç§’
   6          
   7              /*ui str_cod.sj1bzw*/58,//å‡é™æ ‡å‡†ä½å»¶æ—¶
   8              /*ui str_cod.sj1zjw*/800,//å‡é™ä¸­é—´ä½å»¶æ—¶
   9          
  10              /*ui str_cod.py1qkq*/666,
  11              /*ui str_cod.py1kqz*/684,
  12              /*ui str_cod.py1zkh*/684,
  13              /*ui str_cod.py1khh*/666,
  14              /*ui str_cod.py1qz*/500,
  15              /*ui str_cod.py1zh*/500,
  16              /*ui str_cod.py1kqkh*/1480,
  17              /*ui str_cod.py1qkh*/2122,
  18              /*ui str_cod.py1kqh*/2122
  19          };
  20          ul var_timer0=0;
  21          bit var_online=0;
  22          
  23          void fun_delay(ui par_value,enum varENU_del par_model){
  24   1          ui loc_con=par_value;
  25   1          switch(par_model){
  26   2              case del_us://å¾®ç§’çº§å»¶æ—¶
  27   2                  while(loc_con-->0){
  28   3                      _nop_();
  29   3                      _nop_();
  30   3                  }
  31   2                  return;
  32   2              case del_ms://æ¯«ç§’çº§å»¶æ—¶
  33   2                  while(loc_con-->0){
  34   3                      uc loc_i, loc_j;
  35   3                      _nop_();
  36   3                      _nop_();
  37   3                      loc_i=12;
  38   3                      loc_j=168;
  39   3                      do{
  40   4                          while(--loc_j);
  41   4                      }while(--loc_i);
  42   3                  }
  43   2                  return;
  44   2              case del_s://ç§’çº§å»¶æ—¶
  45   2                  while(loc_con-->0){
  46   3                      uc loc_i, loc_j, loc_k;
  47   3                      loc_i=46;
  48   3                      loc_j=153;
  49   3                      loc_k=245;
  50   3                      do{
  51   4                          do{
  52   5                              while(--loc_k);
  53   5                          }while(--loc_j);
  54   4                      }while(--loc_i);
C51 COMPILER V9.01   8023                                                                  05/15/2015 12:50:09 PAGE 2   

  55   3                  }
  56   2                  return;
  57   2              default:return;
  58   2          }
  59   1      }//å»¶æ—¶
  60          void fun_timer0init(){
  61   1          AUXR|=0x80;       //å®šæ—¶å™¨æ—¶é’Ÿ1Tæ¨¡å¼
  62   1          TMOD&=0xF0;       //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
  63   1          TMOD|=0x01;       //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
  64   1          TL0=0x20;     //è®¾ç½®å®šæ—¶åˆå€¼
  65   1          TH0=0xD1;     //è®¾ç½®å®šæ—¶åˆå€¼
  66   1          TF0=0;        //æ¸…é™¤TF0æ ‡å¿—
  67   1          ET0=1;
  68   1          EA=1;
  69   1      }//1æ¯«ç§’å®šæ—¶å™¨0åˆå§‹åŒ–
  70          void fun_timer1init(){
  71   1          AUXR&=0xBF;
  72   1          TMOD&=0x0F;
  73   1          TMOD|=0x10;
  74   1          TL1=0xE0;
  75   1          TH1=0xB1;
  76   1          TF1=0;
  77   1          ET1=1;
  78   1          EA=1;
  79   1      }//20æ¯«ç§’å®šæ—¶å™¨1åˆå§‹åŒ–
  80          void fun_timer0(){
  81   1          TL0=0x20;
  82   1          TH0=0xD1;
  83   1          _nop_();
  84   1          var_timer0++;
  85   1      
  86   1              
  87   1      }//1æ¯«ç§’å®šæ—¶å™¨0å¤„ç†å‡½æ•°
  88          void fun_timer1(){
  89   1      
  90   1          TL1=0xE0;
  91   1          TH1=0xB1;
  92   1          _nop_();
  93   1      
  94   1      
  95   1      
  96   1      }//20æ¯«ç§’å®šæ—¶å™¨1å¤„ç†å‡½æ•°
  97          void fun_wait(){
  98   1          while(in_start==1);
  99   1          fun_delay(20,del_ms);
 100   1          while(in_start==0);
 101   1          fun_delay(256,del_ms);
 102   1      }//ç­‰å¾…æŒ‰é”®
 103          void fun_initialization(){
 104   1          CLK_DIV=0x00;//ä¸åˆ†é¢‘
 105   1      
 106   1          P0M1=0xff;//P0ç”¨äºè¾“å…¥
 107   1          P0M0=0x00;//P0ä¸èƒ½è¾“å‡º
 108   1          
 109   1          P1M1=0x00;//P1å£0-1åŒå‘ï¼Œ2ä¸­æ–­è¾“å…¥ï¼Œ3-6è¾“å…¥ï¼Œ7è¾“å‡º
 110   1          P1M0=0xfc;//P1å£2-7è¾“å‡º
 111   1      
 112   1          P2M1=0xf0;//P2å£4-7è¾“å…¥
 113   1          P2M0=0x0f;//P2å£0-3è¾“å‡º
 114   1      
 115   1          //PS_2=1;//æ‰‹æŠ“æ¾ä¼ æ„Ÿå™¨ç½®1 $?$
 116   1          //PS_11=1;//å‡é™ä½ç½®3ä¼ æ„Ÿå™¨ç½®1 $?$
C51 COMPILER V9.01   8023                                                                  05/15/2015 12:50:09 PAGE 3   

 117   1      
 118   1          out_en1=1;//ç”µæœº1/3ä½¿èƒ½ $?$
 119   1          out_en2=1;//ç”µæœº2/4ä½¿èƒ½ $?$
 120   1          //out_motorselect=1;//ç”µæœºç‰‡é€‰ä¸º1 $?$
 121   1          //fun_delay(del_ms,1);//å»¶æ—¶1æ¯«ç§’ $?$
 122   1          out_motorselect=0;//ç”µæœºç‰‡é€‰ä¸º0 $?$
 123   1          //PS_5=PS_1;// $?$
 124   1      
 125   1          fun_pwminit();//PWMçš„åˆå§‹åŒ–è®¾ç½®
 126   1          fun_timer0init();//åˆå§‹åŒ–å®šæ—¶å™¨0
 127   1          fun_timer1init();//åˆå§‹åŒ–å®šæ—¶å™¨1
 128   1          fun_port();//åˆå§‹åŒ–ä¸²å£
 129   1          in_start=1;//æŒ‰é”®ç½®1
 130   1      
 131   1          fun_wait();
 132   1      }//åˆå§‹åŒ–
 133          void fun_pwminit(){
 134   1          CCON=0x00;
 135   1          CH=0;
 136   1          CL=0;
 137   1          CMOD=0x00;
 138   1      }//PWMåˆå§‹åŒ–
 139          void fun_pwmr(uc par_value){
 140   1          CCAP0H=CCAP0L=par_value*2.5;//æ§åˆ¶è¾“å‡ºçš„å ç©ºæ¯”
 141   1          CCAPM0=0X42;//8ä½PWMè¾“å‡ºï¼Œæ— ä¸­æ–­
 142   1          PCA_PWM0=0x00;
 143   1      }//å³è·¯PWMè¾“å‡º
 144          void fun_pwml(uc par_value){
 145   1          CCAP1H=CCAP1L=par_value*2.5;//æ§åˆ¶è¾“å‡ºçš„å ç©ºæ¯”
 146   1          CCAPM1=0X42;//8ä½PWMè¾“å‡ºï¼Œæ— ä¸­æ–­
 147   1          PCA_PWM1=0x00;
 148   1      }//å·¦è·¯PWMè¾“å‡º
 149          void fun_motors(enum varENU_mot par_model,char par_speed){
 150   1          if(par_speed>100)
 151   1              par_speed=100;
 152   1          else if(par_speed<-100)
 153   1              par_speed=-100;
 154   1          switch(par_model){
 155   2              case mot_l://å·¦è½®ç”µæœº
 156   2                  if(par_speed==0){
 157   3                      fun_pwml(0);out_pwml=0;
 158   3                  }
 159   2                  else if(par_speed>0){
 160   3                      CR=1;fun_pwml(par_speed);out_pwml=0;
 161   3                  }
 162   2                  else if(par_speed<0){
 163   3                      CR=1;fun_pwml(cabs(par_speed));out_pwml=1;
 164   3                  }
 165   2                  break;
 166   2              case mot_r://å³è½®ç”µæœº
 167   2                  if(par_speed==0){
 168   3                      fun_pwmr(0);out_pwmr=0;
 169   3                  }
 170   2                  else if(par_speed>0){
 171   3                      CR=1;fun_pwmr(par_speed);out_pwmr=0;
 172   3                  }
 173   2                  else if(par_speed<0){
 174   3                      CR=1;fun_pwmr(cabs(par_speed));out_pwmr=1;
 175   3                  }
 176   2                  break;
 177   2              case mot_rl://å·¦å³è½®åŒæ­¥
 178   2                  if(par_speed==0){
C51 COMPILER V9.01   8023                                                                  05/15/2015 12:50:09 PAGE 4   

 179   3                      CR=0;
 180   3                      fun_pwmr(0);out_pwmr=0;
 181   3                      fun_pwml(0);out_pwml=0;
 182   3                  }
 183   2                  else if(par_speed>0){
 184   3                      CR=1;
 185   3                      fun_pwml(par_speed);out_pwml=0;
 186   3                      fun_pwmr(par_speed);out_pwmr=0;
 187   3                  }
 188   2                  else if(par_speed<0){
 189   3                      CR=1;
 190   3                      fun_pwml(cabs(par_speed));out_pwml=1;
 191   3                      fun_pwmr(cabs(par_speed));out_pwmr=1;
 192   3                  }
 193   2                  break;
 194   2              case mot_dj1://æ­£è½¬ä¸ºæŠ“ç´§ï¼Œåè½¬ä¸ºæ¾å¼€
 195   2                  if(par_speed==0){
 196   3                      out_motorselect=1;out_dir1=0;out_en1=1;
 197   3                  }
 198   2                  else if(par_speed>0){
 199   3                      out_motorselect=1;out_dir1=1;out_en1=0;
 200   3                  }
 201   2                  else if(par_speed<0){
 202   3                      out_motorselect=1;out_dir1=0;out_en1=0;
 203   3                  }
 204   2                  break;
 205   2              case mot_dj2://æ­£è½¬æ˜¯å‘æ— ç”µæœºä¸€æ–¹è½¬,åè½¬ä¸ºå‘æœ‰ç”µæœºä¸€æ–¹è½¬
 206   2                  if(par_speed==0){
 207   3                      out_motorselect=1;out_dir2=0;out_en2=1;
 208   3                  }
 209   2                  else if(par_speed>0){
 210   3                      out_motorselect=1;out_dir2=1;out_en2=0;
 211   3                  }
 212   2                  else if(par_speed<0){
 213   3                      out_motorselect=1;out_dir2=0;out_en2=0;
 214   3                  }
 215   2                  break;
 216   2              case mot_dj3://å‘ä¸Šä¸ºæ­£è½¬,å‘ä¸‹ä¸ºåè½¬
 217   2                  if(par_speed==0){
 218   3                      out_motorselect=0;out_dir1=0;out_en1=1;
 219   3                  }
 220   2                  else if(par_speed>0){
 221   3                      out_motorselect=0;out_dir1=0;out_en1=0;
 222   3                  }
 223   2                  else if(par_speed<0){
 224   3                      out_motorselect=0;out_dir1=1;out_en1=0;
 225   3                  }
 226   2                  break;
 227   2              case mot_dj4://é¡ºæ—¶é’ˆä¸ºæ­£è½¬,é€†æ—¶é’ˆä¸ºåè½¬
 228   2                  if(par_speed==0){
 229   3                      out_motorselect=0;out_dir2=0;out_en2=1;
 230   3                  }
 231   2                  else if(par_speed>0){
 232   3                      out_motorselect=0;out_dir2=0;out_en2=0;
 233   3                  }
 234   2                  else if(par_speed<0){
 235   3                      out_motorselect=0;out_dir2=1;out_en2=0;
 236   3                  }
 237   2                  break;
 238   2              default:
 239   2                  break;
 240   2          }
C51 COMPILER V9.01   8023                                                                  05/15/2015 12:50:09 PAGE 5   

 241   1      }//æ“ä½œç”µmotorsæœº
 242          void fun_sz1(enum varENU_han par_model){
 243   1          if(str_begin.szzt==par_model)
 244   1              return;
 245   1          if(par_model==han_s){//æ‰‹æŠ“æ¾
 246   2              fun_motors(mot_dj1,-100);
 247   2              while(in_s==1);
 248   2          }
 249   1          else{//æ‰‹æŠ“ç´§
 250   2              fun_motors(mot_dj1,100);
 251   2              while(in_j==1);
 252   2          }
 253   1          fun_delay(20,del_ms);
 254   1          fun_motors(mot_dj1,0);
 255   1          str_begin.szzt=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 256   1      }//æ‰‹æŠ“å•æ­¥è¿åŠ¨
 257          void fun_sj1(enum varENU_sjp par_model){
 258   1          if(par_model==str_begin.sjwz)
 259   1             return;
 260   1          switch(par_model){
 261   2              case sjp_wz1://å‡é™ä½ç½®1(æœ€ä¸Šä½)
 262   2                  fun_motors(mot_dj3,100);
 263   2                  def_select(sel_58);
 264   2                  while(in_wz1==1);
 265   2                  fun_delay(str_cod.sj1bzw,del_ms);
 266   2                  break;
 267   2              case sjp_wz12:
 268   2                  if(par_model>str_begin.sjwz){
 269   3                      fun_motors(mot_dj3,-100);
 270   3                      fun_delay(str_cod.sj1zjw,del_ms);
 271   3                  }
 272   2                  else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 273   3                      fun_sj1(sjp_wz2);
 274   3                      fun_motors(mot_dj3,100);
 275   3                      fun_delay(str_cod.sj1zjw,del_ms);
 276   3                  }
 277   2                  break;
 278   2              case sjp_wz2://å‡é™ä½ç½®2
 279   2                  fun_motors(mot_dj3,par_model<str_begin.sjwz?100:-100);
 280   2                  def_select(sel_58);
 281   2                  while(in_wz2==1);
 282   2                  fun_delay(str_cod.sj1bzw,del_ms);
 283   2                  break;
 284   2              case sjp_wz23:
 285   2                  if(par_model>str_begin.sjwz){
 286   3                      fun_sj1(sjp_wz2);
 287   3                      fun_motors(mot_dj3,-100);
 288   3                      fun_delay(str_cod.sj1zjw,del_ms);
 289   3                  }
 290   2                  else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 291   3                      fun_sj1(sjp_wz3);
 292   3                      fun_motors(mot_dj3,100);
 293   3                      fun_delay(str_cod.sj1zjw,del_ms);
 294   3                  }
 295   2                  break;
 296   2              case sjp_wz3://å‡é™ä½ç½®3
 297   2                  fun_motors(mot_dj3,par_model<str_begin.sjwz?100:-100);
 298   2                  def_select(sel_58);
 299   2                  while(in_wz3==1);
 300   2                  fun_delay(str_cod.sj1bzw,del_ms);
 301   2                  break;
 302   2              case sjp_wz34:
C51 COMPILER V9.01   8023                                                                  05/15/2015 12:50:09 PAGE 6   

 303   2                  if(par_model>str_begin.sjwz){
 304   3                      fun_sj1(sjp_wz3);
 305   3                      fun_motors(mot_dj3,-100);
 306   3                      fun_delay(str_cod.sj1zjw,del_ms);
 307   3                  }
 308   2                  else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 309   3                      fun_sj1(sjp_wz4);
 310   3                      fun_motors(mot_dj3,100);
 311   3                      fun_delay(str_cod.sj1zjw,del_ms);
 312   3                  }
 313   2                  break;
 314   2              case sjp_wz4://å‡é™ä½ç½®4
 315   2                  fun_motors(mot_dj3,par_model<str_begin.sjwz?100:-100);
 316   2                  def_select(sel_58);
 317   2                  while(in_wz4==1);
 318   2                  fun_delay(str_cod.sj1bzw,del_ms);
 319   2                  break;
 320   2              case sjp_wz45:
 321   2                  if(par_model>str_begin.sjwz){
 322   3                      fun_sj1(sjp_wz4);
 323   3                      fun_motors(mot_dj3,-100);
 324   3                      fun_delay(str_cod.sj1zjw,del_ms);
 325   3                  }
 326   2                  else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 327   3                      fun_motors(mot_dj3,100);
 328   3                      fun_delay(str_cod.sj1zjw,del_ms);
 329   3                  }
 330   2                  break;
 331   2              case sjp_wz5://å‡é™ä½ç½®5
 332   2                  fun_motors(mot_dj3,-100);
 333   2                  def_select(sel_912);
 334   2                  while(in_wz5==1);
 335   2                  fun_delay(str_cod.sj1bzw,del_ms);
 336   2                  break;
 337   2              default:
 338   2                  break;
 339   2          }
 340   1          fun_motors(mot_dj3,0);
 341   1          str_begin.sjwz=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 342   1      }//å‡é™å•æ­¥è¿åŠ¨
 343          void fun_py1(enum varENU_tra par_model){
 344   1          if(str_begin.pywz==par_model)
 345   1              return;
 346   1          switch(par_model){
 347   2              case tra_q://å‰å¹³ç§»(æ²¡æœ‰ç”µæœºçš„å‘¢ä¸ªæ–¹å‘)
 348   2                  fun_motors(mot_dj2,100);
 349   2                  while(in_qpy==1);
 350   2                  fun_delay(str_cod.py1bz,del_ms);
 351   2                  break;
 352   2              case tra_kq:
 353   2                  switch(str_begin.pywz){
 354   3                      case tra_q:
 355   3                          fun_motors(mot_dj2,-100);
 356   3                          fun_delay(str_cod.py1qkq,del_ms);
 357   3                          break;
 358   3                      case tra_z:
 359   3                          fun_motors(mot_dj2,100);
 360   3                          fun_delay(str_cod.py1kqz,del_ms);
 361   3                          break;
 362   3                      case tra_kh:
 363   3                          fun_motors(mot_dj2,100);
 364   3                          fun_delay(str_cod.py1kqkh,del_ms);
C51 COMPILER V9.01   8023                                                                  05/15/2015 12:50:09 PAGE 7   

 365   3                          break;
 366   3                      case tra_h:
 367   3                          fun_motors(mot_dj2,100);
 368   3                          fun_delay(str_cod.py1kqh,del_ms);
 369   3                          break;
 370   3                  }
 371   2                  break;
 372   2              case tra_z:
 373   2                  switch(str_begin.pywz){
 374   3                      case tra_q:
 375   3                          fun_motors(mot_dj2,-100);
 376   3                          fun_delay(str_cod.py1qz,del_ms);
 377   3                          break;
 378   3                      case tra_kq:
 379   3                          fun_motors(mot_dj2,-100);
 380   3                          fun_delay(str_cod.py1kqz,del_ms);
 381   3                          break;
 382   3                      case tra_kh:
 383   3                          fun_motors(mot_dj2,100);
 384   3                          fun_delay(str_cod.py1zkh,del_ms);
 385   3                          break;
 386   3                      case tra_h:
 387   3                          fun_motors(mot_dj2,100);
 388   3                          fun_delay(str_cod.py1zh,del_ms);
 389   3                          break;
 390   3                  }
 391   2                  break;
 392   2              case tra_kh:
 393   2                  switch(str_begin.pywz){
 394   3                      case tra_q:
 395   3                          fun_motors(mot_dj2,-100);
 396   3                          fun_delay(str_cod.py1qkh,del_ms);
 397   3                          break;
 398   3                      case tra_kq:
 399   3                          fun_motors(mot_dj2,-100);
 400   3                          fun_delay(str_cod.py1kqkh,del_ms);
 401   3                          break;
 402   3                      case tra_z:
 403   3                          fun_motors(mot_dj2,-100);
 404   3                          fun_delay(str_cod.py1zkh,del_ms);
 405   3                          break;
 406   3                      case tra_h:
 407   3                          fun_motors(mot_dj2,100);
 408   3                          fun_delay(str_cod.py1khh,del_ms);
 409   3                          break;
 410   3                  }
 411   2                  break;
 412   2              case tra_h://åå¹³ç§»(æœ‰ç”µæœºçš„å‘¢ä¸ªæ–¹å‘)
 413   2                  fun_motors(mot_dj2,-100);
 414   2                  while(in_hpy==1);
 415   2                  fun_delay(str_cod.py1bz,del_ms);
 416   2                  break;
 417   2              default:
 418   2                  break;
 419   2          }
 420   1          fun_motors(mot_dj2,0);
 421   1          str_begin.pywz=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 422   1      }//å¹³ç§»å•æ­¥è¿åŠ¨
 423          void fun_hz1(enum varENU_dir par_model){
 424   1          def_select(sel_912);
 425   1          switch(par_model){
 426   2              case dir_up://å›è½¬è‡³å‰æ–¹
C51 COMPILER V9.01   8023                                                                  05/15/2015 12:50:09 PAGE 8   

 427   2                  switch(str_begin.hzfx){
 428   3                      case dir_down://ç°åœ¨åœ¨ä¸‹æ–¹
 429   3                          fun_motors(mot_dj4,-100);
 430   3                          fun_delay(1,del_s);
 431   3                          while(in_hz==1);
 432   3                          while(in_hz==0);
 433   3                          while(in_hz==1);
 434   3                          fun_delay(str_cod.hz1bz,del_ms);
 435   3                          break;
 436   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 437   3                          fun_motors(mot_dj4,100);
 438   3                          fun_delay(1,del_s);
 439   3                          while(in_hz==1);
 440   3                          fun_delay(str_cod.hz1bz,del_ms);
 441   3                          break;
 442   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 443   3                          fun_motors(mot_dj4,-100);
 444   3                          fun_delay(1,del_s);
 445   3                          while(in_hz==1);
 446   3                          fun_delay(str_cod.hz1bz,del_ms);
 447   3                          break;
 448   3                      default:
 449   3                          break;
 450   3                  }
 451   2                  break;
 452   2              case dir_down://è¦å»ä¸‹é¢
 453   2                  switch(str_begin.hzfx){
 454   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 455   3                          fun_motors(mot_dj4,100);
 456   3                          fun_delay(1,del_s);
 457   3                          while(in_hz==1);
 458   3                          while(in_hz==0);
 459   3                          while(in_hz==1);
 460   3                          fun_delay(str_cod.hz1bz,del_ms);
 461   3                          break;
 462   3                      case dir_left://ç°åœ¨åœ¨å·¦é¢
 463   3                          fun_motors(mot_dj4,-100);
 464   3                          fun_delay(1,del_s);
 465   3                          while(in_hz==1);
 466   3                          fun_delay(str_cod.hz1bz,del_ms);
 467   3                          break;
 468   3                          break;
 469   3                      case dir_right://ç°åœ¨åœ¨å³é¢
 470   3                          fun_motors(mot_dj4,100);
 471   3                          fun_delay(1,del_s);
 472   3                          while(in_hz==1);
 473   3                          fun_delay(str_cod.hz1bz,del_ms);
 474   3                          break;
 475   3                      default:
 476   3                          break;
 477   3                  }
 478   2                  break;
 479   2              case dir_left://è¦å»å·¦è¾¹
 480   2                  switch(str_begin.hzfx){
 481   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 482   3                          fun_motors(mot_dj4,-100);
 483   3                          fun_delay(1,del_s);
 484   3                          while(in_hz==1);
 485   3                          fun_delay(str_cod.hz1bz,del_ms);
 486   3                          break;
 487   3                          break;
 488   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
C51 COMPILER V9.01   8023                                                                  05/15/2015 12:50:09 PAGE 9   

 489   3                          fun_motors(mot_dj4,100);
 490   3                          fun_delay(1,del_s);
 491   3                          while(in_hz==1);
 492   3                          fun_delay(str_cod.hz1bz,del_ms);
 493   3                          break;
 494   3                          break;
 495   3                      case dir_right://ç°åœ¨åœ¨å³é¢
 496   3                          fun_motors(mot_dj4,-100);
 497   3                          fun_delay(1,del_s);
 498   3                          while(in_hz==1);
 499   3                          while(in_hz==0);
 500   3                          while(in_hz==1);
 501   3                          fun_delay(str_cod.hz1bz,del_ms);
 502   3                          break;
 503   3                      default:
 504   3                          break;
 505   3                  }
 506   2                  break;
 507   2              case dir_right://è¦å»å³é¢
 508   2                  switch(str_begin.hzfx){
 509   3                      case dir_up://ç°åœ¨åœ¨å‰é¢
 510   3                          fun_motors(mot_dj4,100);
 511   3                          fun_delay(1,del_s);
 512   3                          while(in_hz==1);
 513   3                          fun_delay(str_cod.hz1bz,del_ms);
 514   3                          break;
 515   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 516   3                          fun_motors(mot_dj4,-100);
 517   3                          fun_delay(1,del_s);
 518   3                          while(in_hz==1);
 519   3                          fun_delay(str_cod.hz1bz,del_ms);
 520   3                          break;
 521   3                      case dir_left://ç°åœ¨åœ¨å·¦é¢
 522   3                          fun_motors(mot_dj4,100);
 523   3                          fun_delay(1,del_s);
 524   3                          while(in_hz==1);
 525   3                          while(in_hz==0);
 526   3                          while(in_hz==1);
 527   3                          fun_delay(str_cod.hz1bz,del_ms);
 528   3                          break;
 529   3                      default:
 530   3                          break;
 531   3                  }
 532   2                  break;
 533   2              default:
 534   2                  break;
 535   2          }
 536   1          fun_motors(mot_dj4,0);
 537   1          str_begin.hzfx=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 538   1      }//å›è½¬å•æ­¥è¿åŠ¨
 539          void fun_timerfl(){
 540   1          if((in_ls1||in_ls8)&&(in_ls2&&in_ls3&&in_ls4&&in_ls5&in_ls6&&in_ls7))
 541   1          var_online=1;
 542   1          else if(var_online==1){
 543   2              ;
 544   2              //èµ°äº†ä¸€æ¡çº¿
 545   2          }
 546   1      }//å®šæ—¶å™¨å·¡çº¿
 547          void fun_timercorner(){
 548   1          ;
 549   1      }//å®šæ—¶å™¨è½¬å¼¯
 550          void fun_stope2prom(){
C51 COMPILER V9.01   8023                                                                  05/15/2015 12:50:09 PAGE 10  

 551   1          IAP_CONTR = 0;                  //å…³é—­IAPåŠŸèƒ½
 552   1          IAP_CMD = 0;                    //æ¸…é™¤å‘½ä»¤
 553   1          IAP_TRIG = 0;                   //æ¸…é™¤è§¦å‘å¯„å­˜å™¨
 554   1          IAP_ADDRH = 0x80;               //æ•°æ®æŒ‡é’ˆæŒ‡å‘éEEPROMåŒº
 555   1          IAP_ADDRL = 0;                  //æ¸…é™¤IAPåœ°å€
 556   1      }//å…³é—­EEPROMåŠŸèƒ½(IapIdle)
 557          uc fun_reade2prom(ui par_add){
 558   1          uc loc_dat;                     //æ•°æ®ç¼“å†²åŒº
 559   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
 560   1          IAP_CMD = 1;                    //è®¾ç½®EEPROMè¯»å‘½ä»¤
 561   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
 562   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
 563   1          IAP_TRIG = 0x5a;                //è§¦å‘
 564   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
 565   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
 566   1          loc_dat = IAP_DATA;             //è¯»å‡ºEEPROMä¸­çš„æ•°æ®
 567   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
 568   1          return loc_dat;                 //è¿”å›è¯»å–ç»“æœ
 569   1      }//è¯»å–EEPROMæ•°æ®
 570          void fun_writee2prom(ui par_add,uc par_dat){
 571   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
 572   1          IAP_CMD = 2;                    //è®¾ç½®EEPROMå†™å…¥å‘½ä»¤
 573   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
 574   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
 575   1          IAP_DATA = par_dat;             //å†™å…¥æ•°æ®
 576   1          IAP_TRIG = 0x5a;                //è§¦å‘
 577   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
 578   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
 579   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
 580   1      }//å†™EEPROMæ•°æ®
 581          void fun_cleane2prom(ui par_add){
 582   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
 583   1          IAP_CMD = 3;                    //è®¾ç½®EEPROMæ“¦é™¤å‘½ä»¤
 584   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
 585   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
 586   1          IAP_TRIG = 0x5a;                //è§¦å‘
 587   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
 588   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
 589   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
 590   1      }//æ¸…é™¤EEPROMæ•°æ®
 591          void fun_calibration(){
 592   1          // fun_sj1(sjp_wz1);//å‡åˆ°æœ€ä¸Šä½
 593   1          ul loc_time;
 594   1          fun_py1(tra_q);//ç§»åŠ¨åˆ°æœ€å‰ç«¯
 595   1          fun_py1(tra_h);//ç§»åŠ¨åˆ°æœ€åç«¯
 596   1          loc_time=var_timer0;
 597   1          fun_py1(tra_q);//ç§»åŠ¨åˆ°å‰ç«¯å¹¶è®¡æ—¶
 598   1          fun_py1(tra_h);//ç§»åŠ¨åˆ°åç«¯
 599   1          loc_time=var_timer0-loc_time;
 600   1          loc_time*=0.39;
 601   1          str_cod.py1zh=str_cod.py1qz=loc_time*0.5;
 602   1          str_cod.py1qkh=str_cod.py1kqh=loc_time*0.75;
 603   1          str_cod.py1qkq=str_cod.py1khh=loc_time*0.25;
 604   1          str_cod.py1kqz=str_cod.py1zkh=loc_time*0.25;
 605   1          str_cod.py1kqkh=loc_time*0.5;
 606   1      }//è‡ªåŠ¨æ ¡å‡†å¹³ç§»å‚æ•°
 607          void fun_port(){
 608   1          PCON|=0x80;       //ä½¿èƒ½æ³¢ç‰¹ç‡å€é€Ÿä½SMOD
 609   1          SCON=0x50;        //8ä½æ•°æ®,å¯å˜æ³¢ç‰¹ç‡
 610   1          AUXR|=0x04;       //ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨æ—¶é’Ÿä¸ºFosc,å³1T
 611   1          BRT=0xD9;     //è®¾å®šç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨é‡è£…å€¼
 612   1          AUXR|=0x01;       //ä¸²å£1é€‰æ‹©ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨ä¸ºæ³¢ç‰¹ç‡å‘ç”Ÿå™¨
C51 COMPILER V9.01   8023                                                                  05/15/2015 12:50:09 PAGE 11  

 613   1          AUXR|=0x10;       //å¯åŠ¨ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨
 614   1          TI=1;//æ‰“å¼€ä¸²å£ä¼ è¾“åŠŸèƒ½
 615   1      }//ä¸²å£åˆå§‹åŒ–
 616          void fun_test(){
 617   1          fun_sz1(han_j);
 618   1          fun_delay(1,del_s);
 619   1          fun_sz1(han_s);
 620   1          fun_delay(1,del_s);
 621   1          fun_sz1(han_j);
 622   1          fun_delay(1,del_s);
 623   1          fun_sz1(han_s);
 624   1          fun_delay(1,del_s);
 625   1      
 626   1          str_begin.pywz=tra_h;
 627   1          fun_py1(tra_q);
 628   1          fun_delay(1,del_s);
 629   1          fun_py1(tra_h);
 630   1          fun_delay(1,del_s);
 631   1          fun_py1(tra_q);
 632   1          fun_delay(1,del_s);
 633   1          fun_py1(tra_h);
 634   1          fun_delay(1,del_s);
 635   1      
 636   1          fun_sj1(sjp_wz1);
 637   1          fun_delay(1,del_s);
 638   1          fun_sj1(sjp_wz2);
 639   1          fun_delay(1,del_s);
 640   1          fun_sj1(sjp_wz3);
 641   1          fun_delay(1,del_s);
 642   1          fun_sj1(sjp_wz4);
 643   1          fun_delay(1,del_s);
 644   1          fun_sj1(sjp_wz5);
 645   1          fun_delay(1,del_s);
 646   1          fun_sj1(sjp_wz4);
 647   1          fun_delay(1,del_s);
 648   1          fun_sj1(sjp_wz3);
 649   1          fun_delay(1,del_s);
 650   1          fun_sj1(sjp_wz2);
 651   1          fun_delay(1,del_s);
 652   1          fun_sj1(sjp_wz1);
 653   1      
 654   1          str_now.hzfx=str_begin.hzfx;
 655   1          str_begin.hzfx=dir_up;
 656   1          fun_hz1(dir_right);
 657   1          fun_delay(1,del_s);
 658   1          fun_hz1(dir_up);
 659   1          fun_delay(1,del_s);
 660   1          fun_hz1(dir_right);
 661   1          fun_delay(1,del_s);
 662   1          fun_hz1(dir_up);
 663   1          fun_delay(1,del_s);
 664   1          str_begin.hzfx=str_now.hzfx;
 665   1      
 666   1          fun_motors(mot_rl,60);
 667   1          fun_delay(1,del_s);
 668   1          fun_motors(mot_rl,0);
 669   1          fun_delay(1,del_s);
 670   1      
 671   1          fun_motors(mot_rl,-60);
 672   1          fun_delay(1,del_s);
 673   1          fun_motors(mot_rl,0);
 674   1          fun_delay(1,del_s);
C51 COMPILER V9.01   8023                                                                  05/15/2015 12:50:09 PAGE 12  

 675   1      
 676   1          fun_motors(mot_r,40);
 677   1          fun_motors(mot_l,-40);
 678   1          fun_delay(1,del_s);
 679   1          fun_motors(mot_rl,0);
 680   1          fun_delay(1,del_s);
 681   1      
 682   1          fun_motors(mot_r,-40);
 683   1          fun_motors(mot_l,40);
 684   1          fun_delay(1,del_s);
 685   1          fun_motors(mot_rl,0);
 686   1      }//æµ‹è¯•ç¨‹åº
 687          uc fun_min(uc par_num,...){
 688   1          va_list loc_argp;//ä¿å­˜å‚æ•°ç»“æ„
 689   1          uc loc_xh;//å¾ªç¯
 690   1          uc loc_shu;//å½“å‰å‚æ•°
 691   1          uc loc_min;//æœ€å°å€¼
 692   1          va_start(loc_argp,par_num);//loc_argpæŒ‡å‘ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œpar_numæ˜¯æœ€åä¸€ä¸ªç¡®å
             -®šçš„å‚æ•°
 693   1          loc_min=va_arg(loc_argp,uc);//ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥
 694   1          for(loc_xh=1;loc_xh<par_num;loc_xh++){//æŒ‡å®šå¾ªç¯æ¬¡æ•°
 695   2              loc_shu=va_arg(loc_argp,uc);//å–å‡ºä¸€ä¸ªå‚æ•°
 696   2              if(loc_shu<loc_min)
 697   2                  loc_min=loc_shu;
 698   2          }
 699   1          va_end(loc_argp);//ç»“æŸ
 700   1          return loc_min;//é€€å‡º
 701   1      }//æ±‚æœ€å°å€¼


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2436    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     50    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4      31
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
