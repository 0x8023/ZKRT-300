C51 COMPILER V9.01   8023                                                                  03/01/2015 23:51:06 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE 8023
OBJECT MODULE PLACED IN .\output\8023.obj
COMPILER INVOKED BY: H:\Program\keil\C51\BIN\C51.EXE program\8023.c DEBUG OBJECTEXTEND PRINT(.\8023.lst) OBJECT(.\output
                    -\8023.obj)

line level    source

   1          #include "./output/8023.h"
   2          xdata struct str_state str_begin,str_now,str_next;//分别为:起始状态/当前状态/目标状态
   3          xdata ui cod_mlinerqd=500,//默认主函数巡线软起动时间为500毫秒
   4                   cod_mlineqc=300;//默认主函数巡线前冲时间为500毫秒
   5          void fun_delay(ui par_value,enum varENU_del par_model){
   6   1          ui loc_con=par_value;
   7   1          switch(par_model){
   8   2              case del_us://微秒级延时
   9   2                  while(loc_con-->0){
  10   3                      _nop_();
  11   3                      _nop_();
  12   3                  }
  13   2                  return;
  14   2              case del_ms://毫秒级延时
  15   2                  while(loc_con-->0){
  16   3                      uc loc_i, loc_j;
  17   3                      _nop_();
  18   3                      _nop_();
  19   3                      loc_i=12;
  20   3                      loc_j=168;
  21   3                      do{
  22   4                          while(--loc_j);
  23   4                      }while(--loc_i);
  24   3                  }
  25   2                  return;
  26   2              case del_s://秒级延时
  27   2                  while(loc_con-->0){
  28   3                      uc loc_i, loc_j, loc_k;
  29   3                      loc_i=46;
  30   3                      loc_j=153;
  31   3                      loc_k=245;
  32   3                      do{
  33   4                          do{
  34   5                              while(--loc_k);
  35   5                          }while(--loc_j);
  36   4                      }while(--loc_i);
  37   3                  }
  38   2                  return;
  39   2              default:return;
  40   2          }
  41   1      }//延时
  42          void fun_timer0init(){
  43   1          AUXR&=0x7F;
  44   1          TMOD&=0xF0;
  45   1          TMOD|=0x01;
  46   1          TL0=0xB0;
  47   1          TH0=0x3C;
  48   1          TF0=0;
  49   1      }//50毫秒定时器0初始化
  50          void fun_timer1init(){
  51   1          AUXR&=0xBF;
  52   1          TMOD&=0x0F;
  53   1          TMOD|=0x10;
  54   1          TL1=0xE0;
C51 COMPILER V9.01   8023                                                                  03/01/2015 23:51:06 PAGE 2   

  55   1          TH1=0xB1;
  56   1          TF1=0;
  57   1      }//20毫秒定时器1初始化
  58          void fun_timer0(){
  59   1          TL0=0xB0;
  60   1          TH0=0x3C;
  61   1          _nop_();
  62   1      }//50毫秒定时器0处理函数
  63          void fun_timer1(){
  64   1          TL1=0xE0;
  65   1          TH1=0xB1;
  66   1          _nop_();
  67   1      }//20毫秒定时器1处理函数
  68          void fun_wait(){
  69   1          while(in_start==1);
  70   1          fun_delay(20,del_ms);
  71   1          while(in_start==0);
  72   1          fun_delay(256,del_ms);
  73   1      }//等待按键
  74          void fun_select(enum varENU_sel par_model){
  75   1          if(par_model==sel_58)
  76   1              out_switchselect=0;
  77   1          else if(par_model==sel_912)
  78   1              out_switchselect=1;
  79   1      }//传感器片选
  80          void fun_initialization(){
  81   1          CLK_DIV=0x00;//不分频
  82   1      
  83   1          P0M1=0xff;//P0用于输入
  84   1          P0M0=0x00;//P0不能输出
  85   1          
  86   1          P1M1=0x00;//P1口0-1双向，2中断输入，3-6输入，7输出
  87   1          P1M0=0xfc;//P1口2-7输出
  88   1      
  89   1          P2M1=0xf0;//P2口4-7输入
  90   1          P2M0=0x0f;//P2口0-3输出
  91   1      
  92   1          //PS_2=1;//手抓松传感器置1 $?$
  93   1          //PS_11=1;//升降位置3传感器置1 $?$
  94   1      
  95   1          out_en1=1;//电机1/3使能 $?$
  96   1          out_en2=1;//电机2/4使能 $?$
  97   1          //out_motorselect=1;//电机片选为1 $?$
  98   1          //fun_delay(del_ms,1);//延时1毫秒 $?$
  99   1          out_motorselect=0;//电机片选为0 $?$
 100   1          //PS_5=PS_1;// $?$
 101   1      
 102   1          fun_pwminit();//PWM的初始化设置
 103   1          fun_timer0init();//初始化定时器0
 104   1          fun_timer1init();//初始化定时器1
 105   1          in_start=1;//按键置1
 106   1      
 107   1          fun_wait();
 108   1      }//初始化
 109          void fun_pwminit(){
 110   1          CCON=0x00;
 111   1          CH=0;
 112   1          CL=0;
 113   1          CMOD=0x00;
 114   1      }//PWM初始化
 115          void fun_pwmr(uc par_value){
 116   1          CCAP0H=CCAP0L=par_value*2.5;//控制输出的占空比
C51 COMPILER V9.01   8023                                                                  03/01/2015 23:51:06 PAGE 3   

 117   1          CCAPM0=0X42;//8位PWM输出，无中断
 118   1          PCA_PWM0=0x00;
 119   1      }//右路PWM输出
 120          void fun_pwml(uc par_value){
 121   1          CCAP1H=CCAP1L=par_value*2.5;//控制输出的占空比
 122   1          CCAPM1=0X42;//8位PWM输出，无中断
 123   1          PCA_PWM1=0x00;
 124   1      }//左路PWM输出
 125          void fun_startdj(enum varENU_mot par_model,char par_speed){
 126   1          if(par_speed==0)
 127   1              return;
 128   1          else if(par_speed>100)
 129   1              par_speed=100;
 130   1          else if(par_speed<-100)
 131   1              par_speed=-100;
 132   1          switch(par_model){
 133   2              case mot_l://左轮电机
 134   2                  CR=1;
 135   2                  if(par_speed>0){
 136   3                      fun_pwml(par_speed);out_pwml=0;
 137   3                  }
 138   2                  else if(par_speed<0){
 139   3                      fun_pwml(cabs(par_speed));out_pwml=1;
 140   3                  }
 141   2                  break;
 142   2              case mot_r://右轮电机
 143   2                  CR=1;
 144   2                  if(par_speed>0){
 145   3                      fun_pwmr(par_speed);out_pwmr=0;
 146   3                  }
 147   2                  else if(par_speed<0){
 148   3                      fun_pwmr(cabs(par_speed));out_pwmr=1;
 149   3                  }
 150   2                  break;
 151   2              case mot_rl://左右轮同步
 152   2                  CR=1;
 153   2                  if(par_speed>0){
 154   3                      fun_pwml(par_speed);out_pwml=0;
 155   3                      fun_pwmr(par_speed);out_pwmr=0;
 156   3                  }
 157   2                  else if(par_speed<0){
 158   3                      fun_pwml(cabs(par_speed));out_pwml=1;
 159   3                      fun_pwmr(cabs(par_speed));out_pwmr=1;
 160   3                  }
 161   2                  break;
 162   2              case mot_dj1://正转为抓紧，反转为松开
 163   2                  out_motorselect=1;
 164   2                  if(par_speed>0)
 165   2                      out_dir1=1;
 166   2                  else if(par_speed<0)
 167   2                      out_dir1=0;
 168   2                  out_en1=0;
 169   2                  break;
 170   2              case mot_dj2://正转是向无电机一方转,反转为向有电机一方转
 171   2                  out_motorselect=1;
 172   2                  if(par_speed>0)
 173   2                      out_dir2=1;
 174   2                  else if(par_speed<0)
 175   2                      out_dir2=0;
 176   2                  out_en2=0;
 177   2                  break;
 178   2              case mot_dj3://向上为正转,向下为反转
C51 COMPILER V9.01   8023                                                                  03/01/2015 23:51:06 PAGE 4   

 179   2                  out_motorselect=0;
 180   2                  if(par_speed>0)
 181   2                      out_dir1=0;
 182   2                  else if(par_speed<0)
 183   2                      out_dir1=1;
 184   2                  out_en1=0;
 185   2                  break;
 186   2              case mot_dj4://顺时针为正转,逆时针为反转
 187   2                  out_motorselect=0;
 188   2                  if(par_speed>0)
 189   2                      out_dir2=0;
 190   2                  else if(par_speed<0)
 191   2                      out_dir2=1;
 192   2                  out_en2=0;
 193   2                  break;
 194   2              default:
 195   2                  break;
 196   2          }
 197   1      }//启动电机
 198          void fun_stop(enum varENU_mot par_model){
 199   1          switch(par_model){
 200   2              case mot_l:
 201   2                  fun_pwml(0);out_pwml=0;break;
 202   2              case mot_r:
 203   2                  fun_pwmr(0);out_pwmr=0;break;
 204   2              case mot_rl:
 205   2                  CR=0;
 206   2                  fun_pwmr(0);out_pwmr=0;
 207   2                  fun_pwml(0);out_pwml=0;
 208   2                  break;
 209   2              case mot_dj1:
 210   2                  out_motorselect=1;out_dir1=0;out_en1=1;break;
 211   2              case mot_dj2:
 212   2                  out_motorselect=1;out_dir2=0;out_en2=1;break;
 213   2              case mot_dj3:
 214   2                  out_motorselect=0;out_dir1=0;out_en1=1;break;
 215   2              case mot_dj4:
 216   2                  out_motorselect=0;out_dir2=0;out_en2=1;break;
 217   2              default:
 218   2                  break;
 219   2          }
 220   1      }//停止电机
 221          void fun_sz1(enum varENU_han par_model){
 222   1          if(par_model==han_s){//手抓松
 223   2              while(1){
 224   3                  fun_startdj(mot_dj1,-100);
 225   3                  while(in_s==1);
 226   3                  fun_delay(20,del_ms);
 227   3                  if(in_s==0)
 228   3                      break;
 229   3              }
 230   2          }
 231   1          else{//手抓紧
 232   2              while(1){
 233   3                  fun_startdj(mot_dj1,100);
 234   3                  while(in_j==1);
 235   3                  fun_delay(20,del_ms);
 236   3                  if(in_j==0)
 237   3                      break;
 238   3              }
 239   2          }
 240   1          fun_stop(mot_dj1);
C51 COMPILER V9.01   8023                                                                  03/01/2015 23:51:06 PAGE 5   

 241   1          str_begin.szzt=par_model;//存储运行结果
 242   1      }//手抓单步运动
 243          void fun_sj1(enum varENU_sjp par_model){
 244   1          switch(par_model){
 245   2              case sjp_wz1://升降位置1(最上位)
 246   2                  while(1){//只有向上
 247   3                      fun_startdj(mot_dj3,100);
 248   3                      fun_select(sel_58);
 249   3                      fun_delay(50,del_ms);
 250   3                      while(in_wz1==1);
 251   3                      fun_delay(50,del_ms);
 252   3                      if(in_wz1==0)
 253   3                          break;
 254   3                  }
 255   2                  break;
 256   2              case sjp_wz2://升降位置2
 257   2                  if(par_model>str_begin.sjwz){
 258   3                      while(1){//要去的地方比较靠下,向下走
 259   4                          fun_startdj(mot_dj3,-100);
 260   4                          fun_select(sel_58);
 261   4                          fun_delay(50,del_ms);
 262   4                          while(in_wz2==1);
 263   4                          fun_delay(50,del_ms);
 264   4                          if(in_wz2==0)
 265   4                              break;
 266   4                      }
 267   3                  }
 268   2                  else{//要去的地方在上面，向上走
 269   3                      while(1){
 270   4                          fun_startdj(mot_dj3,100);
 271   4                          fun_select(sel_58);
 272   4                          fun_delay(50,del_ms);
 273   4                          while(in_wz2==1);
 274   4                          fun_delay(50,del_ms);
 275   4                          if(in_wz2==0)
 276   4                              break;
 277   4                      }
 278   3                  }
 279   2                  break;
 280   2              case sjp_wz3://升降位置3
 281   2                  if(par_model>str_begin.sjwz){
 282   3                      while(1){//要去的地方比较靠下,向下走
 283   4                          fun_startdj(mot_dj3,-100);
 284   4                          fun_select(sel_58);
 285   4                          fun_delay(50,del_ms);
 286   4                          while(in_wz3==1);
 287   4                          fun_delay(50,del_ms);
 288   4                          if(in_wz3==0)
 289   4                              break;
 290   4                      }
 291   3                  }
 292   2                  else{//要去的地方在上面，向上走
 293   3                      while(1){
 294   4                          fun_startdj(mot_dj3,100);
 295   4                          fun_select(sel_58);
 296   4                          fun_delay(50,del_ms);
 297   4                          while(in_wz3==1);
 298   4                          fun_delay(50,del_ms);
 299   4                          if(in_wz3==0)
 300   4                              break;
 301   4                      }
 302   3                  }
C51 COMPILER V9.01   8023                                                                  03/01/2015 23:51:06 PAGE 6   

 303   2                  break;
 304   2              case sjp_wz4://升降位置4
 305   2                  if(par_model>str_begin.sjwz){
 306   3                      while(1){//要去的地方比较靠下,向下走
 307   4                          fun_startdj(mot_dj3,-100);
 308   4                          fun_select(sel_58);
 309   4                          fun_delay(50,del_ms);
 310   4                          while(in_wz4==1);
 311   4                          fun_delay(50,del_ms);
 312   4                          if(in_wz4==0)
 313   4                              break;
 314   4                      }
 315   3                  }
 316   2                  else{//要去的地方在上面，向上走
 317   3                      while(1){
 318   4                          fun_startdj(mot_dj3,100);
 319   4                          fun_select(sel_58);
 320   4                          fun_delay(50,del_ms);
 321   4                          while(in_wz4==1);
 322   4                          fun_delay(50,del_ms);
 323   4                          if(in_wz4==0)
 324   4                              break;
 325   4                      }
 326   3                  }
 327   2                  break;
 328   2              case sjp_wz5://升降位置5
 329   2                  while(1){//要去的地方比较靠下,向下走
 330   3                      fun_startdj(mot_dj3,-100);
 331   3                      fun_select(sel_912);
 332   3                      fun_delay(50,del_ms);
 333   3                      while(in_wz5==1);
 334   3                      fun_delay(50,del_ms);
 335   3                      if(in_wz5==0){
 336   4                          break;
 337   4                      }
 338   3                  }
 339   2                  break;
 340   2              default:
 341   2                  break;
 342   2          }
 343   1          fun_stop(mot_dj3);
 344   1          str_begin.sjwz=par_model;//存储运行结果
 345   1      }//升降单步运动
 346          void fun_py1(enum varENU_tra par_model){
 347   1          switch(par_model){
 348   2              case tra_q://前平移(没有电机的呢个方向)
 349   2                  while(1){
 350   3                      fun_startdj(mot_dj2,100);
 351   3                      while(in_qpy==1);
 352   3                      fun_delay(20,del_ms);
 353   3                      if(in_qpy==0)
 354   3                          break;
 355   3                  }
 356   2                  break;
 357   2              case tra_h://后平移(有电机的呢个方向)
 358   2                  while(1){
 359   3                      fun_startdj(mot_dj2,-100);
 360   3                      while(in_hpy==1);
 361   3                      fun_delay(20,del_ms);
 362   3                      if(in_hpy==0)
 363   3                          break;
 364   3                  }
C51 COMPILER V9.01   8023                                                                  03/01/2015 23:51:06 PAGE 7   

 365   2                  break;
 366   2              default:
 367   2                  break;
 368   2          }
 369   1          fun_stop(mot_dj2);
 370   1          str_begin.pywz=par_model;//存储运行结果
 371   1      }//平移单步运动
 372          void fun_hz1(enum varENU_dir par_model){
 373   1          switch(par_model){
 374   2              case dir_up://回转至前方
 375   2                  switch(str_begin.hzfx){
 376   3                      case dir_down://现在在下方
 377   3                          fun_startdj(mot_dj4,-100);
 378   3                          fun_select(sel_912);
 379   3                          fun_delay(1,del_s);
 380   3                          while(1){
 381   4                              while(in_hz==1);
 382   4                              fun_delay(25,del_ms);
 383   4                              if(in_hz==0)
 384   4                                  break;
 385   4                          }
 386   3                          while(1){
 387   4                              while(in_hz==0);
 388   4                              fun_delay(25,del_ms);
 389   4                              if(in_hz==1)
 390   4                                  break;
 391   4                          }
 392   3                          while(1){
 393   4                              while(in_hz==1);
 394   4                              fun_delay(25,del_ms);
 395   4                              if(in_hz==0)
 396   4                                  break;
 397   4                          }
 398   3                          break;
 399   3                      case dir_left://现在在左边
 400   3                          fun_startdj(mot_dj4,100);
 401   3                          fun_select(sel_912);
 402   3                          fun_delay(1,del_s);
 403   3                          while(1){
 404   4                              while(in_hz==1);
 405   4                              fun_delay(25,del_ms);
 406   4                              if(in_hz==0)
 407   4                                  break;
 408   4                          }
 409   3                          break;
 410   3                      case dir_right://现在在右边
 411   3                          fun_startdj(mot_dj4,-100);
 412   3                          fun_select(sel_912);
 413   3                          fun_delay(1,del_s);
 414   3                          while(1){
 415   4                              while(in_hz==1);
 416   4                              fun_delay(25,del_ms);
 417   4                              if(in_hz==0)
 418   4                                  break;
 419   4                          }
 420   3                          break;
 421   3                      default:
 422   3                          break;
 423   3                  }
 424   2                  break;
 425   2              case dir_down://要去下面
 426   2                  switch(str_begin.hzfx){
C51 COMPILER V9.01   8023                                                                  03/01/2015 23:51:06 PAGE 8   

 427   3                      case dir_up://现在在上面
 428   3                          fun_startdj(mot_dj4,100);
 429   3                          fun_select(sel_912);
 430   3                          fun_delay(1,del_s);
 431   3                          while(1){
 432   4                              while(in_hz==1);
 433   4                              fun_delay(25,del_ms);
 434   4                              if(in_hz==0)
 435   4                                  break;
 436   4                          }
 437   3                          while(1){
 438   4                              while(in_hz==0);
 439   4                              fun_delay(25,del_ms);
 440   4                              if(in_hz==1)
 441   4                                  break;
 442   4                          }
 443   3                          while(1){
 444   4                              while(in_hz==1);
 445   4                              fun_delay(25,del_ms);
 446   4                              if(in_hz==0)
 447   4                                  break;
 448   4                          }
 449   3                          break;
 450   3                      case dir_left://现在在左面
 451   3                          fun_startdj(mot_dj4,-100);
 452   3                          fun_select(sel_912);
 453   3                          fun_delay(1,del_s);
 454   3                          while(1){
 455   4                              while(in_hz==1);
 456   4                              fun_delay(25,del_ms);
 457   4                              if(in_hz==0)
 458   4                                  break;
 459   4                          }
 460   3                          break;
 461   3                      case dir_right://现在在右面
 462   3                          fun_startdj(mot_dj4,100);
 463   3                          fun_select(sel_912);
 464   3                          fun_delay(1,del_s);
 465   3                          while(1){
 466   4                              while(in_hz==1);
 467   4                              fun_delay(25,del_ms);
 468   4                              if(in_hz==0)
 469   4                                  break;
 470   4                          }
 471   3                          break;
 472   3                      default:
 473   3                          break;
 474   3                  }
 475   2                  break;
 476   2              case dir_left://要去左边
 477   2                  switch(str_begin.hzfx){
 478   3                      case dir_up://现在在上面
 479   3                          fun_startdj(mot_dj4,-100);
 480   3                          fun_select(sel_912);
 481   3                          fun_delay(1,del_s);
 482   3                          while(1){
 483   4                              while(in_hz==1);
 484   4                              fun_delay(25,del_ms);
 485   4                              if(in_hz==0)
 486   4                                  break;
 487   4                          }
 488   3                          break;
C51 COMPILER V9.01   8023                                                                  03/01/2015 23:51:06 PAGE 9   

 489   3                      case dir_down://现在在下面
 490   3                          fun_startdj(mot_dj4,100);
 491   3                          fun_select(sel_912);
 492   3                          fun_delay(1,del_s);
 493   3                          while(1){
 494   4                              while(in_hz==1);
 495   4                              fun_delay(25,del_ms);
 496   4                              if(in_hz==0)
 497   4                                  break;
 498   4                          }
 499   3                          break;
 500   3                      case dir_right://现在在右面
 501   3                          fun_startdj(mot_dj4,-100);
 502   3                          fun_select(sel_912);
 503   3                          fun_delay(1,del_s);
 504   3                          while(1){
 505   4                              while(in_hz==1);
 506   4                              fun_delay(25,del_ms);
 507   4                              if(in_hz==0)
 508   4                                  break;
 509   4                          }
 510   3                          while(1){
 511   4                              while(in_hz==0);
 512   4                              fun_delay(25,del_ms);
 513   4                              if(in_hz==1)
 514   4                                  break;
 515   4                          }
 516   3                          while(1){
 517   4                              while(in_hz==1);
 518   4                              fun_delay(25,del_ms);
 519   4                              if(in_hz==0){
 520   5                                  break;
 521   5                              }
 522   4                          }
 523   3                          break;
 524   3                      default:
 525   3                          break;
 526   3                  }
 527   2                  break;
 528   2              case dir_right://要去右面
 529   2                  switch(str_begin.hzfx){
 530   3                      case dir_up://现在在前面
 531   3                          fun_startdj(mot_dj4,100);
 532   3                          fun_select(sel_912);
 533   3                          fun_delay(1,del_s);
 534   3                          while(1){
 535   4                              while(in_hz==1);
 536   4                              fun_delay(25,del_ms);
 537   4                              if(in_hz==0)
 538   4                                  break;
 539   4                          }
 540   3                          break;
 541   3                      case dir_down://现在在下面
 542   3                          fun_startdj(mot_dj4,-100);
 543   3                          fun_select(sel_912);
 544   3                          fun_delay(1,del_s);
 545   3                          while(1){
 546   4                              while(in_hz==1);
 547   4                              fun_delay(25,del_ms);
 548   4                              if(in_hz==0)
 549   4                                  break;
 550   4                          }
C51 COMPILER V9.01   8023                                                                  03/01/2015 23:51:06 PAGE 10  

 551   3                          break;
 552   3                      case dir_left://现在在左面
 553   3                          fun_startdj(mot_dj4,100);
 554   3                          fun_select(sel_912);
 555   3                          fun_delay(1,del_s);
 556   3                          while(1){
 557   4                              while(in_hz==1);
 558   4                              fun_delay(25,del_ms);
 559   4                              if(in_hz==0)
 560   4                                  break;
 561   4                          }
 562   3                          while(1){
 563   4                              while(in_hz==0);
 564   4                              fun_delay(25,del_ms);
 565   4                              if(in_hz==1)
 566   4                                  break;
 567   4                          }
 568   3                          while(1){
 569   4                              while(in_hz==1);
 570   4                              fun_delay(25,del_ms);
 571   4                              if(in_hz==0){
 572   5                                  break;
 573   5                              }
 574   4                          }
 575   3                          break;
 576   3                      default:
 577   3                          break;
 578   3                  }
 579   2                  break;
 580   2              default:
 581   2                  break;
 582   2          }
 583   1          fun_stop(mot_dj4);
 584   1          str_begin.hzfx=par_model;//存储运行结果
 585   1      }//回转单步运动
 586          void fun_mptline(uc par_num,uc par_sd,enum varENU_dir par_model){
 587   1          bit loc_flag=0;
 588   1          ui loc_i;
 589   1          uc loc_con=0;
 590   1          uc loc_l=par_sd,loc_r=par_sd;
 591   1          for(loc_i=2;loc_i<par_sd;fun_startdj(mot_rl,loc_i++))//软起动
 592   1              fun_delay(cod_mlinerqd/par_sd,del_ms);
 593   1          while(1){
 594   2              loc_l=par_sd;//恢复默认参数
 595   2              loc_r=par_sd;
 596   2              if((in_ls1&&in_ls7)||(in_ls2&&in_ls8)){//巡线计数
 597   3                  loc_flag=1;
 598   3                  if(loc_con>=par_num){
 599   4                      if(par_model==dir_left){//左转
 600   5                          fun_startdj(mot_l,-20);
 601   5                          fun_delay(500,del_ms);
 602   5                          while(1){
 603   6                              while(!in_ls4||!in_ls5);
 604   6                              fun_delay(100,del_us);
 605   6                              if(in_ls4&&in_ls5){
 606   7                                  fun_stop(mot_rl);
 607   7                                  return;
 608   7                              }
 609   6                          }
 610   5                      }
 611   4                      else if(par_model==dir_right){
 612   5                          fun_startdj(mot_r,-20);
C51 COMPILER V9.01   8023                                                                  03/01/2015 23:51:06 PAGE 11  

 613   5                          fun_delay(500,del_ms);
 614   5                          while(1){
 615   6                              while(!in_ls4||!in_ls5);
 616   6                              fun_delay(100,del_us);
 617   6                              if(in_ls4&&in_ls5){
 618   7                                  fun_stop(mot_rl);
 619   7                                  return;
 620   7                              }
 621   6                          }
 622   5                      }
 623   4                  }
 624   3              }
 625   2              else if(loc_flag==1){
 626   3                  if(++loc_con>=par_num){
 627   4                      if(par_model==dir_up){
 628   5                          for(loc_i=0;loc_i<cod_mlineqc;loc_i++){
 629   6                              loc_l=par_sd*0.7;//恢复默认参数
 630   6                              loc_r=par_sd*0.7;
 631   6                              if(in_ls3){//纠偏
 632   7                                  loc_l*=0.9;
 633   7                                  loc_r*=1.1;
 634   7                              }
 635   6                              if(in_ls6){
 636   7                                  loc_l*=1.1;
 637   7                                  loc_r*=0.9;
 638   7                              }
 639   6                              if(in_ls2){
 640   7                                  loc_l*=0.8;
 641   7                                  loc_r*=1.2;
 642   7                              }
 643   6                              if(in_ls7){
 644   7                                  loc_l*=1.2;
 645   7                                  loc_r*=0.8;
 646   7                              }
 647   6                              if(in_ls1){
 648   7                                  loc_l*=0.7;
 649   7                                  loc_r*=1.3;
 650   7                              }
 651   6                              if(in_ls8){
 652   7                                  loc_l*=1.3;
 653   7                                  loc_r*=0.7;
 654   7                              }
 655   6                              fun_startdj(mot_l,loc_l);//更新电机参数
 656   6                              fun_startdj(mot_r,loc_r);
 657   6                              fun_delay(1,del_ms);
 658   6                          }
 659   5                          fun_stop(mot_rl);
 660   5                          return;
 661   5                      }
 662   4                  }
 663   3                  loc_flag=0;
 664   3              }
 665   2              if(in_ls3){//纠偏
 666   3                  loc_l*=0.9;
 667   3                  loc_r*=1.1;
 668   3              }
 669   2              if(in_ls6){
 670   3                  loc_l*=1.1;
 671   3                  loc_r*=0.9;
 672   3              }  
 673   2              if(in_ls2){
 674   3                  loc_l*=0.8;
C51 COMPILER V9.01   8023                                                                  03/01/2015 23:51:06 PAGE 12  

 675   3                  loc_r*=1.2;
 676   3              }
 677   2              if(in_ls7){
 678   3                  loc_l*=1.2;
 679   3                  loc_r*=0.8;
 680   3              }
 681   2              if(in_ls1){
 682   3                  loc_l*=0.7;
 683   3                  loc_r*=1.3;
 684   3              }
 685   2              if(in_ls8){
 686   3                  loc_l*=1.3;
 687   3                  loc_r*=0.7;
 688   3              }
 689   2              fun_startdj(mot_l,loc_l);//更新电机参数
 690   2              fun_startdj(mot_r,loc_r);
 691   2          }
 692   1      }//主函数普通巡线


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2609    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     25    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      16
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
