C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE 8023
OBJECT MODULE PLACED IN .\output\8023.obj
COMPILER INVOKED BY: D:\MyProgram\keil\C51\BIN\C51.EXE program\8023.c OPTIMIZE(8,SPEED) DEBUG OBJECTEXTEND PRINT(.\8023.
                    -lst) OBJECT(.\output\8023.obj)

line level    source

   1          #include "./output/8023.h"
   2          xdata struct str_state str_begin,str_now,str_next;//åˆ†åˆ«ä¸º:èµ·å§‹çŠ¶æ€/å½“å‰çŠ¶æ€/ç›®æ ‡çŠ¶æ€
   3          xdata struct str_parameter str_cod={
   4              /*ui str_cod.mlinerqd*/25000,//é»˜è®¤ä¸»å‡½æ•°å·¡çº¿è½¯èµ·åŠ¨è·¯ç¨‹ä¸º25000
   5              /*ui str_cod.mlineqc*/200,   //é»˜è®¤ä¸»å‡½æ•°å·¡çº¿å‰å†²æ—¶é—´ä¸º500æ¯«ç§’
   6          
   7              /*ui str_cod.sj1bzw*/58,     //å‡é™æ ‡å‡†ä½å»¶æ—¶
   8              /*ui str_cod.sj1zjw*/800,    //å‡é™ä¸­é—´ä½å»¶æ—¶
   9          
  10              /*ui str_cod.py1bz*/20,      //fun_py1æ ‡å‡†ä½å»¶æ—¶
  11              /*ui str_cod.py1qkq*/666,    //fun_py1å‰åˆ°é å‰å»¶æ—¶å‚æ•°
  12              /*ui str_cod.py1kqz*/684,    //fun_py1é å‰åˆ°ä¸­é—´å»¶æ—¶
  13              /*ui str_cod.py1zkh*/684,    //fun_py1ä¸­é—´åˆ°é åå»¶æ—¶
  14              /*ui str_cod.py1khh*/666,    //fun_py1é ååˆ°åå»¶æ—¶
  15              /*ui str_cod.py1qz*/500,     //fun_py1å‰åˆ°ä¸­é—´å»¶æ—¶
  16              /*ui str_cod.py1zh*/500,     //fun_py1ä¸­é—´åˆ°åå»¶æ—¶
  17              /*ui str_cod.py1kqkh*/1480,  //fun_py1é å‰åˆ°é åå»¶æ—¶
  18              /*ui str_cod.py1qkh*/2122,   //fun_py1å‰åˆ°é åå»¶æ—¶
  19              /*ui str_cod.py1kqh*/2122,   //fun_py1é å‰åˆ°åå»¶æ—¶
  20          
  21              /*ui str_cod.hz1bz*/20,      //fun_hz1æ ‡å‡†ä½å»¶æ—¶
  22          
  23              /*ui turn90;*/500,           //90åº¦è½¬å¼¯å±è”½å»¶æ—¶
  24              /*ui turn180;*/2000          //180åº¦è½¬å¼¯å±è”½å»¶æ—¶
  25          };
  26          xdata struct str_timerfolline str_tfl;
  27          ul var_timer=0;
  28          void fun_delay(ui par_value,enum varENU_del par_model){
  29   1          ui loc_con=par_value;
  30   1          switch(par_model){
  31   2              case del_us://å¾®ç§’çº§å»¶æ—¶
  32   2                  #ifdef Debug
                              printf("fun_delay(%d,del_us);\n",par_value);
                          #else
  35   2                      while(loc_con-->0){
  36   3                          _nop_();
  37   3                          _nop_();
  38   3                      }
  39   2                  #endif
  40   2                  return;
  41   2              case del_ms://æ¯«ç§’çº§å»¶æ—¶
  42   2                  #ifdef Debug
                              printf("fun_delay(%d,del_ms);\n",par_value);
                          #else
  45   2                      while(loc_con-->0){
  46   3                          uc loc_i, loc_j;
  47   3                          _nop_();
  48   3                          _nop_();
  49   3                          loc_i=12;
  50   3                          loc_j=168;
  51   3                          do{
  52   4                              while(--loc_j);
  53   4                          }while(--loc_i);
  54   3                      }
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 2   

  55   2                  #endif
  56   2                  return;
  57   2              case del_s://ç§’çº§å»¶æ—¶
  58   2                  #ifdef Debug
                              printf("fun_delay(%d,del_s);\n",par_value);
                          #else
  61   2                      while(loc_con-->0){
  62   3                          uc loc_i, loc_j, loc_k;
  63   3                          loc_i=46;
  64   3                          loc_j=153;
  65   3                          loc_k=245;
  66   3                          do{
  67   4                              do{
  68   5                                  while(--loc_k);
  69   5                              }while(--loc_j);
  70   4                          }while(--loc_i);
  71   3                      }
  72   2                  #endif
  73   2                  return;
  74   2              default:return;
  75   2          }
  76   1      }//å»¶æ—¶
  77          void fun_timer0init(){
  78   1          #ifdef Debug
                      printf("fun_timer0init();\n");
                  #endif
  81   1          AUXR|=0x80;   //å®šæ—¶å™¨æ—¶é’Ÿ1Tæ¨¡å¼
  82   1          TMOD&=0xF0;   //å®šæ—¶å™¨æ¨¡å¼:16ä½
  83   1          TMOD|=0x01;   //å®šæ—¶å™¨æ¨¡å¼:16ä½
  84   1          TL0=0x20;     //å®šæ—¶åˆå€¼:1ms
  85   1          TH0=0xD1;     //å®šæ—¶åˆå€¼:1ms
  86   1          TF0=0;        //æ¸…é™¤TF0æ ‡å¿—
  87   1          ET0=1;
  88   1          EA=1;         //å¼€å¯æ€»ä¸­æ–­
  89   1      }//1æ¯«ç§’å®šæ—¶å™¨0åˆå§‹åŒ–
  90          void fun_timer1init(){
  91   1          #ifdef Debug
                      printf("fun_timer1init();\n");
                  #endif
  94   1          AUXR&=0xBF;     //å®šæ—¶å™¨æ—¶é’Ÿ12Tæ¨¡å¼
  95   1          TMOD&=0x0F;     //å®šæ—¶å™¨æ¨¡å¼:16ä½
  96   1          TMOD|=0x10;     //å®šæ—¶å™¨æ¨¡å¼:16ä½
  97   1          TL1=0xE0;       //å®šæ—¶åˆå€¼:20ms
  98   1          TH1=0xB1;       //å®šæ—¶åˆå€¼:20ms
  99   1          TF1=0;          //æ¸…é™¤TF1æ ‡å¿—
 100   1          ET1=1;
 101   1          EA=1;           //å¼€å¯æ€»ä¸­æ–­
 102   1      }//20æ¯«ç§’å®šæ—¶å™¨1åˆå§‹åŒ–
 103          void fun_timer0(){
 104   1          TL0=0x20;
 105   1          TH0=0xD1;//å®šæ—¶å™¨åˆå€¼æ¢å¤è‡³1ms
 106   1          var_timer++;//å…¨å±€è®¡æ—¶å™¨å¼€å§‹è®¡æ—¶
 107   1          if(str_tfl.doing==tf_ture)//å¦‚æœæ­£åœ¨ç§»åŠ¨
 108   1              fun_timermove();//å®šæ—¶å™¨ç§»åŠ¨
 109   1      }//1æ¯«ç§’å®šæ—¶å™¨0å¤„ç†å‡½æ•°
 110          void fun_timer1(){
 111   1          TL1=0xE0;
 112   1          TH1=0xB1;
 113   1      }//20æ¯«ç§’å®šæ—¶å™¨1å¤„ç†å‡½æ•°
 114          void fun_wait(){
 115   1          #ifdef Debug
                      printf("fun_wait();\n");
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 3   

                  #else
 118   1              while(in_start==1);
 119   1              fun_delay(20,del_ms);
 120   1              while(in_start==0);
 121   1              fun_delay(256,del_ms);
 122   1          #endif
 123   1      }//ç­‰å¾…æŒ‰é”®
 124          void fun_pwminit(){
 125   1          #ifdef Debug
                      printf("fun_pwminit();\n");
                  #endif
 128   1          CCON=0x00;//PACå¯„å­˜æ§åˆ¶å™¨
 129   1          CH=0;//é‡ç½®PACè®¡æ—¶å™¨
 130   1          CL=0;
 131   1          CMOD=0x08;//ä¸åˆ†é¢‘
 132   1      }//PWMåˆå§‹åŒ–
 133          void fun_pwmr(uc par_value){
 134   1          CCAP0H=CCAP0L=par_value*25/10;//æ§åˆ¶è¾“å‡ºçš„å ç©ºæ¯”
 135   1          CCAPM0=0X42;//8ä½PWMè¾“å‡ºï¼Œæ— ä¸­æ–­
 136   1          PCA_PWM0=0x00;
 137   1      }//å³è·¯PWMè¾“å‡º
 138          void fun_pwml(uc par_value){
 139   1          CCAP1H=CCAP1L=par_value*25/10;//æ§åˆ¶è¾“å‡ºçš„å ç©ºæ¯”
 140   1          CCAPM1=0X42;//8ä½PWMè¾“å‡ºï¼Œæ— ä¸­æ–­
 141   1          PCA_PWM1=0x00;
 142   1      }//å·¦è·¯PWMè¾“å‡º
 143          void fun_motors(enum varENU_mot par_model,char par_speed){
 144   1          if(par_speed>100)
 145   1              par_speed=100;
 146   1          else if(par_speed<-100)
 147   1              par_speed=-100;//é€Ÿåº¦æœ€å¤š100,æœ€å°‘-100
 148   1          switch(par_model){
 149   2              case mot_l://å·¦è½®ç”µæœº
 150   2                  if(str_begin.leftsd==par_speed)
 151   2                      return;
 152   2                  else
 153   2                      str_begin.leftsd=par_speed;
 154   2                  if(par_speed==0){
 155   3                      fun_pwml(0);out_pwml=0;
 156   3                  }
 157   2                  else if(par_speed>0){
 158   3                      CR=1;fun_pwml(par_speed);out_pwml=0;
 159   3                  }
 160   2                  else if(par_speed<0){
 161   3                      CR=1;fun_pwml(cabs(par_speed));out_pwml=1;
 162   3                  }
 163   2                  break;
 164   2              case mot_r://å³è½®ç”µæœº
 165   2                  if(str_begin.rightsd==par_speed)
 166   2                      return;
 167   2                  else
 168   2                      str_begin.rightsd=par_speed;
 169   2                  if(par_speed==0){
 170   3                      fun_pwmr(0);out_pwmr=0;
 171   3                  }
 172   2                  else if(par_speed>0){
 173   3                      CR=1;fun_pwmr(par_speed);out_pwmr=0;
 174   3                  }
 175   2                  else if(par_speed<0){
 176   3                      CR=1;fun_pwmr(cabs(par_speed));out_pwmr=1;
 177   3                  }
 178   2                  break;
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 4   

 179   2              case mot_rl://å·¦å³è½®åŒæ­¥
 180   2                  if((str_begin.leftsd==par_speed)&&(str_begin.rightsd==par_speed))
 181   2                      return;
 182   2                  else
 183   2                      str_begin.leftsd=str_begin.rightsd=par_speed;
 184   2                  if(par_speed==0){
 185   3                      CR=0;
 186   3                      fun_pwmr(0);out_pwmr=0;
 187   3                      fun_pwml(0);out_pwml=0;
 188   3                  }
 189   2                  else if(par_speed>0){
 190   3                      CR=1;
 191   3                      fun_pwml(par_speed);out_pwml=0;
 192   3                      fun_pwmr(par_speed);out_pwmr=0;
 193   3                  }
 194   2                  else if(par_speed<0){
 195   3                      CR=1;
 196   3                      fun_pwml(cabs(par_speed));out_pwml=1;
 197   3                      fun_pwmr(cabs(par_speed));out_pwmr=1;
 198   3                  }
 199   2                  break;
 200   2              case mot_sz://æ­£è½¬ä¸ºæŠ“ç´§ï¼Œåè½¬ä¸ºæ¾å¼€
 201   2                  if(str_begin.szsd==par_speed)
 202   2                      return;
 203   2                  else
 204   2                      str_begin.szsd=par_speed;
 205   2                  if(par_speed==0){
 206   3                      out_motorselect=1;out_dir1=0;out_en1=1;
 207   3                  }
 208   2                  else if(par_speed>0){
 209   3                      out_motorselect=1;out_dir1=1;out_en1=0;
 210   3                  }
 211   2                  else if(par_speed<0){
 212   3                      out_motorselect=1;out_dir1=0;out_en1=0;
 213   3                  }
 214   2                  break;
 215   2              case mot_py://æ­£è½¬æ˜¯å‘æ— ç”µæœºä¸€æ–¹è½¬,åè½¬ä¸ºå‘æœ‰ç”µæœºä¸€æ–¹è½¬
 216   2                  if(str_begin.pysd==par_speed)
 217   2                      return;
 218   2                  else
 219   2                      str_begin.pysd=par_speed;
 220   2                  if(par_speed==0){
 221   3                      out_motorselect=1;out_dir2=0;out_en2=1;
 222   3                  }
 223   2                  else if(par_speed>0){
 224   3                      out_motorselect=1;out_dir2=1;out_en2=0;
 225   3                  }
 226   2                  else if(par_speed<0){
 227   3                      out_motorselect=1;out_dir2=0;out_en2=0;
 228   3                  }
 229   2                  break;
 230   2              case mot_sj://å‘ä¸Šä¸ºæ­£è½¬,å‘ä¸‹ä¸ºåè½¬
 231   2                  if(str_begin.sjsd==par_speed)
 232   2                      return;
 233   2                  else
 234   2                      str_begin.sjsd=par_speed;
 235   2                  if(par_speed==0){
 236   3                      out_motorselect=0;out_dir1=0;out_en1=1;
 237   3                  }
 238   2                  else if(par_speed>0){
 239   3                      out_motorselect=0;out_dir1=0;out_en1=0;
 240   3                  }
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 5   

 241   2                  else if(par_speed<0){
 242   3                      out_motorselect=0;out_dir1=1;out_en1=0;
 243   3                  }
 244   2                  break;
 245   2              case mot_hz://é¡ºæ—¶é’ˆä¸ºæ­£è½¬,é€†æ—¶é’ˆä¸ºåè½¬
 246   2                  if(str_begin.hzsd==par_speed)
 247   2                      return;
 248   2                  else
 249   2                      str_begin.hzsd=par_speed;
 250   2                  if(par_speed==0){
 251   3                      out_motorselect=0;out_dir2=0;out_en2=1;
 252   3                  }
 253   2                  else if(par_speed>0){
 254   3                      out_motorselect=0;out_dir2=0;out_en2=0;
 255   3                  }
 256   2                  else if(par_speed<0){
 257   3                      out_motorselect=0;out_dir2=1;out_en2=0;
 258   3                  }
 259   2                  break;
 260   2              default:
 261   2                  break;
 262   2          }
 263   1      }//ä¸»å‡½æ•°æ“ä½œç”µæœº
 264          void fun_motorsrl(enum varENU_mot par_model,char par_speed){
 265   1          if(par_speed>100)
 266   1              par_speed=100;
 267   1          else if(par_speed<-100)
 268   1              par_speed=-100;//é€Ÿåº¦æœ€å¤š100,æœ€å°‘-100
 269   1          switch(par_model){
 270   2              case mot_l://å·¦è½®ç”µæœº
 271   2                  if(str_begin.leftsd==par_speed)
 272   2                      return;
 273   2                  else
 274   2                      str_begin.leftsd=par_speed;
 275   2                  if(par_speed==0){
 276   3                      fun_pwml(0);out_pwml=0;
 277   3                  }
 278   2                  else if(par_speed>0){
 279   3                      CR=1;fun_pwml(par_speed);out_pwml=0;
 280   3                  }
 281   2                  else if(par_speed<0){
 282   3                      CR=1;fun_pwml(cabs(par_speed));out_pwml=1;
 283   3                  }
 284   2                  break;
 285   2              case mot_r://å³è½®ç”µæœº
 286   2                  if(str_begin.rightsd==par_speed)
 287   2                      return;
 288   2                  else
 289   2                      str_begin.rightsd=par_speed;
 290   2                  if(par_speed==0){
 291   3                      fun_pwmr(0);out_pwmr=0;
 292   3                  }
 293   2                  else if(par_speed>0){
 294   3                      CR=1;fun_pwmr(par_speed);out_pwmr=0;
 295   3                  }
 296   2                  else if(par_speed<0){
 297   3                      CR=1;fun_pwmr(cabs(par_speed));out_pwmr=1;
 298   3                  }
 299   2                  break;
 300   2              case mot_rl://å·¦å³è½®åŒæ­¥
 301   2                  if((str_begin.leftsd==par_speed)&&(str_begin.rightsd==par_speed))
 302   2                      return;
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 6   

 303   2                  else
 304   2                      str_begin.leftsd=str_begin.rightsd=par_speed;
 305   2                  if(par_speed==0){
 306   3                      CR=0;
 307   3                      fun_pwmr(0);out_pwmr=0;
 308   3                      fun_pwml(0);out_pwml=0;
 309   3                  }
 310   2                  else if(par_speed>0){
 311   3                      CR=1;
 312   3                      fun_pwml(par_speed);out_pwml=0;
 313   3                      fun_pwmr(par_speed);out_pwmr=0;
 314   3                  }
 315   2                  else if(par_speed<0){
 316   3                      CR=1;
 317   3                      fun_pwml(cabs(par_speed));out_pwml=1;
 318   3                      fun_pwmr(cabs(par_speed));out_pwmr=1;
 319   3                  }
 320   2                  break;
 321   2              default:
 322   2                  break;
 323   2          }
 324   1      }//å®šæ—¶å™¨æ“ä½œå·¦å³è½®
 325          void fun_sz1(enum varENU_han par_model){
 326   1          if(str_begin.szzt==par_model)
 327   1              return;
 328   1          if(par_model==han_s){//æ‰‹æŠ“æ¾
 329   2              #ifdef Debug
                          printf("fun_sz1(han_s);\n");
                      #else
 332   2                  fun_motors(mot_sz,-100);
 333   2                  while(in_s==1);
 334   2              #endif
 335   2          }
 336   1          else{//æ‰‹æŠ“ç´§
 337   2              #ifdef Debug
                          printf("fun_sz1(han_j);\n");
                      #else
 340   2                  fun_motors(mot_sz,100);
 341   2                  while(in_j==1);
 342   2              #endif
 343   2          }
 344   1          #ifndef Debug
 345   1              fun_delay(20,del_ms);
 346   1              fun_motors(mot_sz,0);
 347   1          #endif
 348   1          str_begin.szzt=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 349   1      }//æ‰‹æŠ“å•æ­¥è¿åŠ¨
 350          void fun_py1(enum varENU_tra par_model){
 351   1          if(str_begin.pywz==par_model)
 352   1              return;
 353   1          switch(par_model){
 354   2              case tra_q://å‰å¹³ç§»(æ²¡æœ‰ç”µæœºçš„å‘¢ä¸ªæ–¹å‘)
 355   2                  #ifdef Debug
                              printf("fun_py1(tra_q);\n");
                          #else
 358   2                      fun_motors(mot_py,100);
 359   2                      while(in_qpy==1);
 360   2                      fun_delay(str_cod.py1bz,del_ms);
 361   2                  #endif
 362   2                      break;
 363   2              case tra_kq:
 364   2                  #ifdef Debug
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 7   

                              printf("fun_py1(tra_kq);\n");
                          #else
 367   2                      switch(str_begin.pywz){
 368   3                          case tra_q:
 369   3                              fun_motors(mot_py,-100);
 370   3                              fun_delay(str_cod.py1qkq,del_ms);
 371   3                              break;
 372   3                          case tra_z:
 373   3                              fun_motors(mot_py,100);
 374   3                              fun_delay(str_cod.py1kqz,del_ms);
 375   3                              break;
 376   3                          case tra_kh:
 377   3                              fun_motors(mot_py,100);
 378   3                              fun_delay(str_cod.py1kqkh,del_ms);
 379   3                              break;
 380   3                          case tra_h:
 381   3                              fun_motors(mot_py,100);
 382   3                              fun_delay(str_cod.py1kqh,del_ms);
 383   3                              break;
 384   3                      }
 385   2                  #endif
 386   2                      break;
 387   2              case tra_z:
 388   2                  #ifdef Debug
                              printf("fun_py1(tra_z);\n");
                          #else
 391   2                      switch(str_begin.pywz){
 392   3                          case tra_q:
 393   3                              fun_motors(mot_py,-100);
 394   3                              fun_delay(str_cod.py1qz,del_ms);
 395   3                              break;
 396   3                          case tra_kq:
 397   3                              fun_motors(mot_py,-100);
 398   3                              fun_delay(str_cod.py1kqz,del_ms);
 399   3                              break;
 400   3                          case tra_kh:
 401   3                              fun_motors(mot_py,100);
 402   3                              fun_delay(str_cod.py1zkh,del_ms);
 403   3                              break;
 404   3                          case tra_h:
 405   3                              fun_motors(mot_py,100);
 406   3                              fun_delay(str_cod.py1zh,del_ms);
 407   3                              break;
 408   3                      }
 409   2                  #endif
 410   2                      break;
 411   2              case tra_kh:
 412   2                  #ifdef Debug
                              printf("fun_py1(tra_kh);\n");
                          #else
 415   2                      switch(str_begin.pywz){
 416   3                          case tra_q:
 417   3                              fun_motors(mot_py,-100);
 418   3                              fun_delay(str_cod.py1qkh,del_ms);
 419   3                              break;
 420   3                          case tra_kq:
 421   3                              fun_motors(mot_py,-100);
 422   3                              fun_delay(str_cod.py1kqkh,del_ms);
 423   3                              break;
 424   3                          case tra_z:
 425   3                              fun_motors(mot_py,-100);
 426   3                              fun_delay(str_cod.py1zkh,del_ms);
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 8   

 427   3                              break;
 428   3                          case tra_h:
 429   3                              fun_motors(mot_py,100);
 430   3                              fun_delay(str_cod.py1khh,del_ms);
 431   3                              break;
 432   3                      }
 433   2                  #endif
 434   2                      break;
 435   2              case tra_h://åå¹³ç§»(æœ‰ç”µæœºçš„å‘¢ä¸ªæ–¹å‘)
 436   2                  #ifdef Debug
                              printf("fun_py1(tra_h);\n");
                          #else
 439   2                      fun_motors(mot_py,-100);
 440   2                      while(in_hpy==1);
 441   2                      fun_delay(str_cod.py1bz,del_ms);
 442   2                  #endif
 443   2                      break;
 444   2              default:
 445   2                  break;
 446   2          }
 447   1          fun_motors(mot_py,0);
 448   1          str_begin.pywz=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 449   1      }//å¹³ç§»å•æ­¥è¿åŠ¨
 450          void fun_sj1(enum varENU_sjp par_model){
 451   1          if(str_begin.sjwz==par_model)
 452   1             return;
 453   1          switch(par_model){
 454   2              case sjp_1://å‡é™ä½ç½®1(æœ€ä¸Šä½)
 455   2                  #ifdef Debug
                              printf("fun_sj1(sjp_1);\n");
                          #else
 458   2                      fun_motors(mot_sj,100);
 459   2                      def_select(sel_58);
 460   2                      while(in_wz1==1);
 461   2                      fun_delay(str_cod.sj1bzw,del_ms);
 462   2                  #endif
 463   2                      break;
 464   2              case sjp_12:
 465   2                  #ifdef Debug
                              printf("fun_sj1(sjp_12);\n");
                          #else
 468   2                      if(par_model>str_begin.sjwz){
 469   3                          fun_motors(mot_sj,-100);
 470   3                          fun_delay(str_cod.sj1zjw,del_ms);
 471   3                      }
 472   2                      else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 473   3                          fun_sj1(sjp_2);
 474   3                          fun_motors(mot_sj,100);
 475   3                          fun_delay(str_cod.sj1zjw,del_ms);
 476   3                      }
 477   2                  #endif
 478   2                      break;
 479   2              case sjp_2://å‡é™ä½ç½®2
 480   2                  #ifdef Debug
                              printf("fun_sj1(sjp_2);\n");
                          #else
 483   2                      fun_motors(mot_sj,par_model<str_begin.sjwz?100:-100);
 484   2                      def_select(sel_58);
 485   2                      while(in_wz2==1);
 486   2                      fun_delay(str_cod.sj1bzw,del_ms);
 487   2                  #endif
 488   2                      break;
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 9   

 489   2              case sjp_23:
 490   2                  #ifdef Debug
                              printf("fun_sj1(sjp_23);\n");
                          #else
 493   2                      if(par_model>str_begin.sjwz){
 494   3                          fun_sj1(sjp_2);
 495   3                          fun_motors(mot_sj,-100);
 496   3                          fun_delay(str_cod.sj1zjw,del_ms);
 497   3                      }
 498   2                      else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 499   3                          fun_sj1(sjp_3);
 500   3                          fun_motors(mot_sj,100);
 501   3                          fun_delay(str_cod.sj1zjw,del_ms);
 502   3                      }
 503   2                  #endif
 504   2                      break;
 505   2              case sjp_3://å‡é™ä½ç½®3
 506   2                  #ifdef Debug
                              printf("fun_sj1(sjp_3);\n");
                          #else
 509   2                      fun_motors(mot_sj,par_model<str_begin.sjwz?100:-100);
 510   2                      def_select(sel_58);
 511   2                      while(in_wz3==1);
 512   2                      fun_delay(str_cod.sj1bzw,del_ms);
 513   2                  #endif
 514   2                  break;
 515   2              case sjp_34:
 516   2                  #ifdef Debug
                              printf("fun_sj1(sjp_34);\n");
                          #else
 519   2                      if(par_model>str_begin.sjwz){
 520   3                          fun_sj1(sjp_3);
 521   3                          fun_motors(mot_sj,-100);
 522   3                          fun_delay(str_cod.sj1zjw,del_ms);
 523   3                      }
 524   2                      else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 525   3                          fun_sj1(sjp_4);
 526   3                          fun_motors(mot_sj,100);
 527   3                          fun_delay(str_cod.sj1zjw,del_ms);
 528   3                      }
 529   2                  #endif
 530   2                      break;
 531   2              case sjp_4://å‡é™ä½ç½®4
 532   2                  #ifdef Debug
                              printf("fun_sj1(sjp_4);\n");
                          #else
 535   2                      fun_motors(mot_sj,par_model<str_begin.sjwz?100:-100);
 536   2                      def_select(sel_58);
 537   2                      while(in_wz4==1);
 538   2                      fun_delay(str_cod.sj1bzw,del_ms);
 539   2                  #endif
 540   2                      break;
 541   2              case sjp_45:
 542   2                  #ifdef Debug
                              printf("fun_sj1(sjp_45);\n");
                          #else
 545   2                      if(par_model>str_begin.sjwz){
 546   3                          fun_sj1(sjp_4);
 547   3                          fun_motors(mot_sj,-100);
 548   3                          fun_delay(str_cod.sj1zjw,del_ms);
 549   3                      }
 550   2                      else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 10  

 551   3                          fun_motors(mot_sj,100);
 552   3                          fun_delay(str_cod.sj1zjw,del_ms);
 553   3                      }
 554   2                  #endif
 555   2                      break;
 556   2              case sjp_5://å‡é™ä½ç½®5
 557   2                  #ifdef Debug
                              printf("fun_sj1(sjp_5);\n");
                          #else
 560   2                      fun_motors(mot_sj,-100);
 561   2                      def_select(sel_912);
 562   2                      while(in_wz5==1);
 563   2                      fun_delay(str_cod.sj1bzw,del_ms);
 564   2                  #endif
 565   2                      break;
 566   2              default:
 567   2                  break;
 568   2          }
 569   1          fun_motors(mot_sj,0);
 570   1          str_begin.sjwz=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 571   1      }//å‡é™å•æ­¥è¿åŠ¨
 572          void fun_hz1(enum varENU_dir par_model){
 573   1          if(str_begin.hzfx==par_model)
 574   1              return;
 575   1          def_select(sel_912);
 576   1          switch(par_model){
 577   2              case dir_up://å›è½¬è‡³å‰æ–¹
 578   2                  #ifdef Debug
                              printf("fun_hz1(dir_up);\n");
                          #else
 581   2                      switch(str_begin.hzfx){
 582   3                          case dir_down://ç°åœ¨åœ¨ä¸‹æ–¹
 583   3                              fun_motors(mot_hz,-100);
 584   3                              fun_delay(1,del_s);
 585   3                              while(in_hz==1);
 586   3                              while(in_hz==0);
 587   3                              while(in_hz==1);
 588   3                              fun_delay(str_cod.hz1bz,del_ms);
 589   3                              break;
 590   3                          case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 591   3                              fun_motors(mot_hz,100);
 592   3                              fun_delay(1,del_s);
 593   3                              while(in_hz==1);
 594   3                              fun_delay(str_cod.hz1bz,del_ms);
 595   3                              break;
 596   3                          case dir_right://ç°åœ¨åœ¨å³è¾¹
 597   3                              fun_motors(mot_hz,-100);
 598   3                              fun_delay(1,del_s);
 599   3                              while(in_hz==1);
 600   3                              fun_delay(str_cod.hz1bz,del_ms);
 601   3                              break;
 602   3                          default:
 603   3                              break;
 604   3                      }
 605   2                  #endif
 606   2                      break;
 607   2              case dir_down://è¦å»ä¸‹é¢
 608   2                  #ifdef Debug
                              printf("fun_hz1(dir_down);\n");
                          #else
 611   2                      switch(str_begin.hzfx){
 612   3                          case dir_up://ç°åœ¨åœ¨ä¸Šé¢
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 11  

 613   3                              fun_motors(mot_hz,100);
 614   3                              fun_delay(1,del_s);
 615   3                              while(in_hz==1);
 616   3                              while(in_hz==0);
 617   3                              while(in_hz==1);
 618   3                              fun_delay(str_cod.hz1bz,del_ms);
 619   3                              break;
 620   3                          case dir_left://ç°åœ¨åœ¨å·¦é¢
 621   3                              fun_motors(mot_hz,-100);
 622   3                              fun_delay(1,del_s);
 623   3                              while(in_hz==1);
 624   3                              fun_delay(str_cod.hz1bz,del_ms);
 625   3                              break;
 626   3                              break;
 627   3                          case dir_right://ç°åœ¨åœ¨å³é¢
 628   3                              fun_motors(mot_hz,100);
 629   3                              fun_delay(1,del_s);
 630   3                              while(in_hz==1);
 631   3                              fun_delay(str_cod.hz1bz,del_ms);
 632   3                              break;
 633   3                          default:
 634   3                              break;
 635   3                      }
 636   2                  #endif
 637   2                      break;
 638   2              case dir_left://è¦å»å·¦è¾¹
 639   2                  #ifdef Debug
                              printf("fun_hz1(dir_left);\n");
                          #else
 642   2                      switch(str_begin.hzfx){
 643   3                          case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 644   3                              fun_motors(mot_hz,-100);
 645   3                              fun_delay(1,del_s);
 646   3                              while(in_hz==1);
 647   3                              fun_delay(str_cod.hz1bz,del_ms);
 648   3                              break;
 649   3                              break;
 650   3                          case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 651   3                              fun_motors(mot_hz,100);
 652   3                              fun_delay(1,del_s);
 653   3                              while(in_hz==1);
 654   3                              fun_delay(str_cod.hz1bz,del_ms);
 655   3                              break;
 656   3                              break;
 657   3                          case dir_right://ç°åœ¨åœ¨å³é¢
 658   3                              fun_motors(mot_hz,-100);
 659   3                              fun_delay(1,del_s);
 660   3                              while(in_hz==1);
 661   3                              while(in_hz==0);
 662   3                              while(in_hz==1);
 663   3                              fun_delay(str_cod.hz1bz,del_ms);
 664   3                              break;
 665   3                          default:
 666   3                              break;
 667   3                      }
 668   2                  #endif
 669   2                      break;
 670   2              case dir_right://è¦å»å³é¢
 671   2                  #ifdef Debug
                              printf("fun_hz1(dir_right);\n");
                          #else
 674   2                      switch(str_begin.hzfx){
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 12  

 675   3                          case dir_up://ç°åœ¨åœ¨å‰é¢
 676   3                              fun_motors(mot_hz,100);
 677   3                              fun_delay(1,del_s);
 678   3                              while(in_hz==1);
 679   3                              fun_delay(str_cod.hz1bz,del_ms);
 680   3                              break;
 681   3                          case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 682   3                              fun_motors(mot_hz,-100);
 683   3                              fun_delay(1,del_s);
 684   3                              while(in_hz==1);
 685   3                              fun_delay(str_cod.hz1bz,del_ms);
 686   3                              break;
 687   3                          case dir_left://ç°åœ¨åœ¨å·¦é¢
 688   3                              fun_motors(mot_hz,100);
 689   3                              fun_delay(1,del_s);
 690   3                              while(in_hz==1);
 691   3                              while(in_hz==0);
 692   3                              while(in_hz==1);
 693   3                              fun_delay(str_cod.hz1bz,del_ms);
 694   3                              break;
 695   3                          default:
 696   3                              break;
 697   3                      }
 698   2                  #endif
 699   2                      break;
 700   2              default:
 701   2                  break;
 702   2          }
 703   1          fun_motors(mot_hz,0);
 704   1          str_begin.hzfx=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 705   1      }//å›è½¬å•æ­¥è¿åŠ¨
 706          void fun_pyhz2(enum varENU_tra par_pymodel,enum varENU_dir par_hzmodel){
 707   1          switch(par_hzmodel){
 708   2              case dir_left://è¦å»å·¦è¾¹
 709   2                  switch(str_begin.hzfx){
 710   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 711   3                      
 712   3                          break;
 713   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 714   3                      
 715   3                          break;
 716   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 717   3                      
 718   3                          break;
 719   3                      default:
 720   3                          break;
 721   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 722   2                  break;
 723   2              case dir_right://è¦å»å³è¾¹
 724   2                  switch(str_begin.hzfx){
 725   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 726   3                      
 727   3                          break;
 728   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 729   3                      
 730   3                          break;
 731   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 732   3                      
 733   3                          break;
 734   3                      default:
 735   3                          break;
 736   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 13  

 737   2                  break;
 738   2              case dir_up://è¦å»ä¸Šé¢
 739   2                  switch(str_begin.hzfx){
 740   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 741   3                      
 742   3                          break;
 743   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 744   3                      
 745   3                          break;
 746   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 747   3                      
 748   3                          break;
 749   3                      default:
 750   3                          break;
 751   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 752   2                  break;
 753   2              case dir_down://è¦å»ä¸‹é¢
 754   2                  switch(str_begin.hzfx){
 755   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 756   3                      
 757   3                          break;
 758   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 759   3                      
 760   3                          break;
 761   3                      case dir_up://ç°åœ¨åœ¨ä¸‹é¢
 762   3                      
 763   3                          break;
 764   3                      default:
 765   3                          break;
 766   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 767   2                  break;
 768   2              default:
 769   2                  break;
 770   2          }//è·å–ç°åœ¨è¦å»çš„å›è½¬ä½ç½®
 771   1          switch(par_pymodel){
 772   2              case tra_q://è¦å»å‰é¢
 773   2              
 774   2                  break;
 775   2              case tra_kq://è¦å»é å‰
 776   2              
 777   2                  break;
 778   2              case tra_z://è¦å»ä¸­é—´
 779   2              
 780   2                  break;
 781   2              case tra_kh://è¦å»é å
 782   2              
 783   2                  break;
 784   2              case tra_h://è¦å»åé¢
 785   2              
 786   2                  break;
 787   2              default:
 788   2                  break;
 789   2          }//è·å–ç°åœ¨å¹³ç§»æ‰€åœ¨çš„ä½ç½®
 790   1          switch(par_hzmodel){
 791   2              case dir_left://è¦å»å·¦è¾¹
 792   2                  switch(str_begin.hzfx){
 793   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 794   3                      
 795   3                          break;
 796   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 797   3                      
 798   3                          break;
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 14  

 799   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 800   3                      
 801   3                          break;
 802   3                      default:
 803   3                          break;
 804   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 805   2                  break;
 806   2              case dir_right://è¦å»å³è¾¹
 807   2                  switch(str_begin.hzfx){
 808   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 809   3                      
 810   3                          break;
 811   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 812   3                      
 813   3                          break;
 814   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 815   3                      
 816   3                          break;
 817   3                      default:
 818   3                          break;
 819   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 820   2                  break;
 821   2              case dir_up://è¦å»ä¸Šé¢
 822   2                  switch(str_begin.hzfx){
 823   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 824   3                      
 825   3                          break;
 826   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 827   3                      
 828   3                          break;
 829   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 830   3                      
 831   3                          break;
 832   3                      default:
 833   3                          break;
 834   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 835   2                  break;
 836   2              case dir_down://è¦å»ä¸‹é¢
 837   2                  switch(str_begin.hzfx){
 838   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 839   3                      
 840   3                          break;
 841   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 842   3                      
 843   3                          break;
 844   3                      case dir_up://ç°åœ¨åœ¨ä¸‹é¢
 845   3                      
 846   3                          break;
 847   3                      default:
 848   3                          break;
 849   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 850   2                  break;
 851   2              default:
 852   2                  break;
 853   2          }//è·å–ç°åœ¨è¦å»çš„å›è½¬ä½ç½®
 854   1      }//å¹³ç§»å›è½¬åŒæ­¥è¿åŠ¨
 855          void fun_jtjp(){
 856   1          while(1){
 857   2              if((!in_ls1&&!in_ls2&&in_ls4&&in_ls5&&!in_ls7&&!in_ls8)&&((in_ls3&&in_ls6)||(!in_ls3&&!in_ls6))){
 858   3                  fun_delay(10,del_ms);
 859   3                  fun_motors(mot_rl,0);
 860   3                  return;
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 15  

 861   3              }
 862   2              if(in_ls2||in_ls1){
 863   3                  fun_motors(mot_l,16);
 864   3                  fun_motors(mot_r,-16);
 865   3              }
 866   2              else if(in_ls7||in_ls8){
 867   3                  fun_motors(mot_l,-16);
 868   3                  fun_motors(mot_r,16);
 869   3              }
 870   2              else{
 871   3                  if(!in_ls4){
 872   4                      fun_motors(mot_l,-12);
 873   4                      fun_motors(mot_r,12);
 874   4                  }
 875   3                  else if(!in_ls5){
 876   4                      fun_motors(mot_l,12);
 877   4                      fun_motors(mot_r,-12);
 878   4                  }
 879   3                  else{
 880   4                      if(in_ls6&&!in_ls3){
 881   5                          fun_motors(mot_l,-8);
 882   5                          fun_motors(mot_r,8);
 883   5                      }
 884   4                      if(in_ls3&&!in_ls6){
 885   5                          fun_motors(mot_l,8);
 886   5                          fun_motors(mot_r,-8);
 887   5                      }
 888   4                  }
 889   3              }
 890   2          }
 891   1      }//é™æ€çº å
 892          void fun_timermove(){
 893   1          static uc loc_con=0;//éœ€è¦åˆ†æ­¥åšçš„åŠ¨ä½œéœ€è¦ç”¨åˆ°æ­¤é™æ€ç§æœ‰åˆ†æ­¥æ ‡å¿—ä½
 894   1          uc loc_sdl,loc_sdr;//å·¦è½®é€Ÿåº¦å’Œå³è½®é€Ÿåº¦çš„å±€éƒ¨å˜é‡
 895   1          switch(*str_tfl.run){//é€‰æ‹©è¿è¡Œæ–¹å¼
 896   2              case def_end://è¿è¡Œç»“æŸ
 897   2                  fun_motorsrl(mot_rl,0);//å†æ¬¡åœæ­¢ç”µæœºè¿åŠ¨
 898   2                  str_tfl.doing=tf_false;//ç§»åŠ¨ç»“æŸ
 899   2                  memset(str_tfl.step,0,sizeof(str_tfl.step));//æ¸…ç©ºstepæ•°ç»„
 900   2                  str_tfl.run=str_tfl.step;//æŒ‡é’ˆæŒ‡å‘stepçš„ç¬¬ä¸€ä¸ªå…ƒç´ 
 901   2                  break;
 902   2              case tfl_line://è¿è¡Œå·¡çº¿
 903   2                  if(*(str_tfl.run+1)){//å¦‚æœå‚æ•°ä¸ºé0æ•°
 904   3                      if((in_ls1||in_ls8)&&(in_ls2&&in_ls3&&in_ls4&&in_ls5&in_ls6&&in_ls7)){//å¦‚æœä¸­é—´6ä¸ªç
             -¯å…¨äº®,å·¦å³äº®ä»»æ„ä¸€ä¸ª
 905   4                          str_tfl.online=tf_ture;//æ ‡å¿—ä½è®°å½•åœ¨çº¿
 906   4                          fun_motorsrl(mot_rl,str_tfl.gospeed);//æŒ‰ç…§å¸¸è§„é€Ÿåº¦è¿‡çº¿
 907   4                      }
 908   3                      else if(str_tfl.online==tf_ture){//å¦‚æœæ ‡å¿—ä½è®°å½•åœ¨çº¿,è€Œä¸”ä¸ç¬¦åˆåœ¨çº¿ç‰¹å¾
 909   4                          str_tfl.online=tf_false;//æ ‡å¿—ä½è®°å½•ä¸åœ¨çº¿
 910   4                          (*(str_tfl.run+1))--;//å‚æ•°å€¼å‡1,è®°å½•å·²ç»èµ°äº†ä¸€æ¡çº¿
 911   4                      }
 912   3                      else{
 913   4                          loc_sdl=loc_sdr=str_tfl.gospeed;//å·¡çº¿é€Ÿåº¦ä¸ºstr_tfl.gospeed
 914   4                          if(in_ls1&&!in_ls8){//1äº®8ä¸äº®
 915   5                              loc_sdl*=0.5;//å·¦å‡é€Ÿ
 916   5                              loc_sdr*=1.5;//å³åŠ é€Ÿ
 917   5                          }//å‘å·¦è½¬
 918   4                          if(in_ls8&&!in_ls1){//8äº®1ä¸äº®
 919   5                              loc_sdl*=1.5;//å·¦åŠ é€Ÿ
 920   5                              loc_sdr*=0.5;//å³å‡é€Ÿ
 921   5                          }//å‘å³è½¬
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 16  

 922   4                          if(in_ls2&&!in_ls7){//2äº®7ä¸äº®
 923   5                              loc_sdl*=0.7;//å·¦å‡é€Ÿ
 924   5                              loc_sdr*=1.3;//å³åŠ é€Ÿ
 925   5                          }//å‘å·¦è½¬
 926   4                          if(in_ls7&&!in_ls2){//7äº®2ä¸äº®
 927   5                              loc_sdl*=1.3;//å·¦åŠ é€Ÿ
 928   5                              loc_sdr*=0.7;//å³å‡é€Ÿ
 929   5                          }//å‘å³è½¬
 930   4                          if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
 931   5                              loc_sdl*=0.9;//å·¦å‡é€Ÿ
 932   5                              loc_sdr*=1.1;//å³åŠ é€Ÿ
 933   5                          }//å‘å·¦è½¬
 934   4                          if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
 935   5                              loc_sdl*=1.1;//å·¦åŠ é€Ÿ
 936   5                              loc_sdr*=0.9;//å³å‡é€Ÿ
 937   5                          }//å‘å³è½¬
 938   4                          fun_motorsrl(mot_r,loc_sdr);
 939   4                          fun_motorsrl(mot_l,loc_sdl);
 940   4                      }
 941   3                  }
 942   2                  else{//å¦‚æœçº¿èµ°å®Œäº†
 943   3                      str_tfl.run+=2;//æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ç»„è¿‡ç¨‹
 944   3                      fun_motorsrl(mot_rl,0);//åœæ­¢ç”µæœºè¿åŠ¨
 945   3                  }
 946   2                  break;
 947   2              case tfl_turn://è¿è¡Œè½¬å¼¯
 948   2                  switch(loc_con){//åˆ†æ­¥è¿è¡Œæ ‡å¿—ä½
 949   3                      case 0://ç¬¬ä¸€æ­¥
 950   3                          switch(*(str_tfl.run+1)){//è·å–å‚æ•°
 951   4                              case tur_r90://å³è½¬90
 952   4                                  fun_motorsrl(mot_l,str_tfl.turnspeed);//å·¦è½®å‘å‰
 953   4                                  fun_motorsrl(mot_r,-str_tfl.turnspeed);//å³è½®å‘å
 954   4                                  str_tfl.delay=var_timer+str_cod.turn90;//è®¡æ—¶
 955   4                                  break;
 956   4                              case tur_l90://å·¦è½¬90
 957   4                                  fun_motorsrl(mot_l,-str_tfl.turnspeed);//å·¦è½®å‘å
 958   4                                  fun_motorsrl(mot_r,str_tfl.turnspeed);//å³è½®å‘å‰
 959   4                                  str_tfl.delay=var_timer+str_cod.turn90;//è®¡æ—¶
 960   4                                  break;
 961   4                              case tur_r180://å³è½¬180
 962   4                                  fun_motorsrl(mot_l,str_tfl.turnspeed);//å·¦è½®å‘å‰
 963   4                                  fun_motorsrl(mot_r,-str_tfl.turnspeed);//å³è½®å‘å
 964   4                                  str_tfl.delay=var_timer+str_cod.turn180;//è®¡æ—¶
 965   4                                  break;
 966   4                              case tur_l180://å·¦è½¬180
 967   4                                  fun_motorsrl(mot_l,-str_tfl.turnspeed);//å·¦è½®å‘å
 968   4                                  fun_motorsrl(mot_r,str_tfl.turnspeed);//å·¦è½®å‘å‰
 969   4                                  str_tfl.delay=var_timer+str_cod.turn180;//è®¡æ—¶
 970   4                                  break;
 971   4                          }
 972   3                          loc_con++;//æ‰§è¡Œä¸‹ä¸€æ­¥
 973   3                          break;
 974   3                      case 1://ç¬¬äºŒæ­¥
 975   3                          if(str_tfl.delay<=var_timer)//è®¡æ—¶æ—¶é—´åˆ°
 976   3                              loc_con++;//æ‰§è¡Œä¸‹ä¸€æ­¥
 977   3                          break;
 978   3                      case 2://ç¬¬ä¸‰æ­¥
 979   3                          if(in_ls4&&in_ls5){//å¦‚æœä¸­é—´ä¸¤ä¸ªç¯äº®
 980   4                              fun_motorsrl(mot_rl,0);//åœæ­¢ç”µæœº
 981   4                              str_tfl.run+=2;//æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ç»„è¿‡ç¨‹
 982   4                              str_tfl.delay=0;//å»¶æ—¶è®¡æ•°å™¨å½’é›¶
 983   4                              loc_con=0;//åˆ†æ­¥è¿è¡Œæ ‡å¿—ä½å½’é›¶
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 17  

 984   4                          }
 985   3                          break;
 986   3                  }
 987   2                  break;
 988   2              case tfl_cache://è¿è¡Œå‰å†²
 989   2                  switch(loc_con){
 990   3                      case 0://ç¬¬ä¸€æ­¥
 991   3                          str_tfl.delay=var_timer+((*(str_tfl.run+1))*10);//å»¶æ—¶æ—¶é—´(æ¯«ç§’)ä¸ºå‚æ•°çš„10å€
             -
 992   3                          loc_con++;//æ‰§è¡Œä¸‹ä¸€æ­¥
 993   3                          break;
 994   3                      case 1://ç¬¬äºŒæ­¥
 995   3                          if(str_tfl.delay<=var_timer){//è®¡æ—¶æ—¶é—´åˆ°
 996   4                              fun_motorsrl(mot_rl,0);//åœæ­¢ç”µæœº
 997   4                              str_tfl.run+=2;//æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ç»„è¿‡ç¨‹
 998   4                              str_tfl.delay=0;//å»¶æ—¶è®¡æ•°å™¨å½’é›¶
 999   4                              loc_con=0;//åˆ†æ­¥è¿è¡Œæ ‡å¿—ä½å½’é›¶
1000   4                          }
1001   3                          else{
1002   4                              loc_sdl=loc_sdr=str_tfl.cachespeed;//å‰å†²é€Ÿåº¦ä¸ºstr_tfl.cachespeed
1003   4                              if(in_ls1&&!in_ls8){//1äº®8ä¸äº®
1004   5                                  loc_sdl*=0.5;//å·¦å‡é€Ÿ
1005   5                                  loc_sdr*=1.5;//å³åŠ é€Ÿ
1006   5                              }//å‘å·¦è½¬
1007   4                              if(in_ls8&&!in_ls1){//8äº®1ä¸äº®
1008   5                                  loc_sdl*=1.5;//å·¦åŠ é€Ÿ
1009   5                                  loc_sdr*=0.5;//å³å‡é€Ÿ
1010   5                              }//å‘å³è½¬
1011   4                              if(in_ls2&&!in_ls7){//2äº®7ä¸äº®
1012   5                                  loc_sdl*=0.7;//å·¦å‡é€Ÿ
1013   5                                  loc_sdr*=1.3;//å³åŠ é€Ÿ
1014   5                              }//å‘å·¦è½¬
1015   4                              if(in_ls7&&!in_ls2){//7äº®2ä¸äº®
1016   5                                  loc_sdl*=1.3;//å·¦åŠ é€Ÿ
1017   5                                  loc_sdr*=0.7;//å³å‡é€Ÿ
1018   5                              }//å‘å³è½¬
1019   4                              if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
1020   5                                  loc_sdl*=0.9;//å·¦å‡é€Ÿ
1021   5                                  loc_sdr*=1.1;//å³åŠ é€Ÿ
1022   5                              }//å‘å·¦è½¬
1023   4                              if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
1024   5                                  loc_sdl*=1.1;//å·¦åŠ é€Ÿ
1025   5                                  loc_sdr*=0.9;//å³å‡é€Ÿ
1026   5                              }//å‘å³è½¬
1027   4                              fun_motorsrl(mot_r,loc_sdr);
1028   4                              fun_motorsrl(mot_l,loc_sdl);
1029   4                          }
1030   3                          break;
1031   3                  }
1032   2                  break;
1033   2              case tfl_start://è¿è¡Œå¸¦åŠ é€Ÿçš„å‰å†²
1034   2      
1035   2                  break;
1036   2              case tfl_end://è¿è¡Œå¸¦å‡é€Ÿçš„å‰å†²
1037   2      
1038   2                  break;
1039   2          }
1040   1      }//å®šæ—¶å™¨ç§»åŠ¨
1041          void fun_folline(uc par_con,uc par_speed){
1042   1          uc loc_con=par_con;//å·¡çº¿æ¡æ•°æ ‡å¿—ä½
1043   1          uc loc_sdr,loc_sdl;//å·¦å³è½®é€Ÿåº¦
1044   1          uc loc_online;//åœ¨çº¿æ ‡å¿—ä½
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 18  

1045   1          while(loc_con){
1046   2              if((in_ls1||in_ls8)&&(in_ls2&&in_ls3&&in_ls4&&in_ls5&in_ls6&&in_ls7)){//å¦‚æœä¸­é—´6ä¸ªç¯å…¨äº®,
             -å·¦å³äº®ä»»æ„ä¸€ä¸ª
1047   3                  loc_online=tf_ture;//æ ‡å¿—ä½è®°å½•åœ¨çº¿
1048   3                  fun_motors(mot_rl,par_speed);//æŒ‰ç…§å¸¸è§„é€Ÿåº¦è¿‡çº¿
1049   3              }
1050   2              else if(loc_online==tf_ture){//å¦‚æœæ ‡å¿—ä½è®°å½•åœ¨çº¿,è€Œä¸”ä¸ç¬¦åˆåœ¨çº¿ç‰¹å¾
1051   3                  loc_online=tf_false;//æ ‡å¿—ä½è®°å½•ä¸åœ¨çº¿
1052   3                  loc_con--;//å‚æ•°å€¼å‡1,è®°å½•å·²ç»èµ°äº†ä¸€æ¡çº¿
1053   3              }
1054   2              else{
1055   3                  loc_sdr=loc_sdl=par_speed;
1056   3                  if(in_ls1&&!in_ls8){//1äº®8ä¸äº®
1057   4                      loc_sdl*=0.5;//å·¦å‡é€Ÿ
1058   4                      loc_sdr*=1.5;//å³åŠ é€Ÿ
1059   4                  }//å‘å·¦è½¬
1060   3                  if(in_ls8&&!in_ls1){//8äº®1ä¸äº®
1061   4                      loc_sdl*=1.5;//å·¦åŠ é€Ÿ
1062   4                      loc_sdr*=0.5;//å³å‡é€Ÿ
1063   4                  }//å‘å³è½¬
1064   3                  if(in_ls2&&!in_ls7){//2äº®7ä¸äº®
1065   4                      loc_sdl*=0.7;//å·¦å‡é€Ÿ
1066   4                      loc_sdr*=1.3;//å³åŠ é€Ÿ
1067   4                  }//å‘å·¦è½¬
1068   3                  if(in_ls7&&!in_ls2){//7äº®2ä¸äº®
1069   4                      loc_sdl*=1.3;//å·¦åŠ é€Ÿ
1070   4                      loc_sdr*=0.7;//å³å‡é€Ÿ
1071   4                  }//å‘å³è½¬
1072   3                  if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
1073   4                      loc_sdl*=0.9;//å·¦å‡é€Ÿ
1074   4                      loc_sdr*=1.1;//å³åŠ é€Ÿ
1075   4                  }//å‘å·¦è½¬
1076   3                  if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
1077   4                      loc_sdl*=1.1;//å·¦åŠ é€Ÿ
1078   4                      loc_sdr*=0.9;//å³å‡é€Ÿ
1079   4                  }//å‘å³è½¬
1080   3                  fun_motors(mot_r,loc_sdr);
1081   3                  fun_motors(mot_l,loc_sdl);
1082   3                  fun_delay(1,del_ms);
1083   3              }
1084   2          }//å¦‚æœå·¡çº¿æ¡æ•°ä¸ä¸º0
1085   1          fun_qc(65,40);
1086   1      }//ä¸»å‡½æ•°å·¡çº¿
1087          void fun_turn(enum varENU_tur par_model,uc par_speed){
1088   1          switch(par_model){//è·å–å‚æ•°
1089   2              case tur_r90://å³è½¬90
1090   2                  fun_motors(mot_l,par_speed);//å·¦è½®å‘å‰
1091   2                  fun_motors(mot_r,-par_speed);//å³è½®å‘å
1092   2                  fun_delay(str_cod.turn90,del_ms);//è®¡æ—¶
1093   2                  break;
1094   2              case tur_l90://å·¦è½¬90
1095   2                  fun_motors(mot_l,-par_speed);//å·¦è½®å‘å
1096   2                  fun_motors(mot_r,par_speed);//å³è½®å‘å‰
1097   2                  fun_delay(str_cod.turn90,del_ms);//è®¡æ—¶
1098   2                  break;
1099   2              case tur_r180://å³è½¬180
1100   2                  fun_motors(mot_l,par_speed);//å·¦è½®å‘å‰
1101   2                  fun_motors(mot_r,-par_speed);//å³è½®å‘å
1102   2                  fun_delay(str_cod.turn180,del_ms);//è®¡æ—¶
1103   2                  break;
1104   2              case tur_l180://å·¦è½¬180
1105   2                  fun_motors(mot_l,-par_speed);//å·¦è½®å‘å
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 19  

1106   2                  fun_motors(mot_r,par_speed);//å·¦è½®å‘å‰
1107   2                  fun_delay(str_cod.turn180,del_ms);//è®¡æ—¶
1108   2                  break;
1109   2          }
1110   1          while(!in_ls4||!in_ls5);
1111   1          fun_motors(mot_rl,0);//åœæ­¢ç”µæœº
1112   1      }//ä¸»å‡½æ•°è½¬å¼¯
1113          void fun_qc(uc par_time,uc par_speed){
1114   1          uc loc_sdr,loc_sdl;//å·¦å³è½®é€Ÿåº¦
1115   1          str_tfl.delay=var_timer+par_time*10;//å»¶æ—¶æ—¶é—´(æ¯«ç§’)ä¸ºå‚æ•°çš„10å€
1116   1          while(str_tfl.delay>var_timer){
1117   2              loc_sdr=loc_sdl=par_speed;
1118   2              if(in_ls1&&!in_ls8){//1äº®8ä¸äº®
1119   3                  loc_sdl*=0.5;//å·¦å‡é€Ÿ
1120   3                  loc_sdr*=1.5;//å³åŠ é€Ÿ
1121   3              }//å‘å·¦è½¬
1122   2              if(in_ls8&&!in_ls1){//8äº®1ä¸äº®
1123   3                  loc_sdl*=1.5;//å·¦åŠ é€Ÿ
1124   3                  loc_sdr*=0.5;//å³å‡é€Ÿ
1125   3              }//å‘å³è½¬
1126   2              if(in_ls2&&!in_ls7){//2äº®7ä¸äº®
1127   3                  loc_sdl*=0.7;//å·¦å‡é€Ÿ
1128   3                  loc_sdr*=1.3;//å³åŠ é€Ÿ
1129   3              }//å‘å·¦è½¬
1130   2              if(in_ls7&&!in_ls2){//7äº®2ä¸äº®
1131   3                  loc_sdl*=1.3;//å·¦åŠ é€Ÿ
1132   3                  loc_sdr*=0.7;//å³å‡é€Ÿ
1133   3              }//å‘å³è½¬
1134   2              if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
1135   3                  loc_sdl*=0.9;//å·¦å‡é€Ÿ
1136   3                  loc_sdr*=1.1;//å³åŠ é€Ÿ
1137   3              }//å‘å·¦è½¬
1138   2              if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
1139   3                  loc_sdl*=1.1;//å·¦åŠ é€Ÿ
1140   3                  loc_sdr*=0.9;//å³å‡é€Ÿ
1141   3              }//å‘å³è½¬
1142   2              fun_motors(mot_r,loc_sdr);
1143   2              fun_motors(mot_l,loc_sdl);
1144   2              fun_delay(1,del_ms);
1145   2          }
1146   1          fun_motors(mot_rl,0);//åœæ­¢ç”µæœº
1147   1      }//ä¸»å‡½æ•°å‰å†²
1148          void fun_stope2prom(){
1149   1          IAP_CONTR = 0;                  //å…³é—­IAPåŠŸèƒ½
1150   1          IAP_CMD = 0;                    //æ¸…é™¤å‘½ä»¤
1151   1          IAP_TRIG = 0;                   //æ¸…é™¤è§¦å‘å¯„å­˜å™¨
1152   1          IAP_ADDRH = 0x80;               //æ•°æ®æŒ‡é’ˆæŒ‡å‘éEEPROMåŒº
1153   1          IAP_ADDRL = 0;                  //æ¸…é™¤IAPåœ°å€
1154   1      }//å…³é—­EEPROMåŠŸèƒ½(IapIdle)
1155          uc fun_reade2prom(ui par_add){
1156   1          uc loc_dat;                     //æ•°æ®ç¼“å†²åŒº
1157   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
1158   1          IAP_CMD = 1;                    //è®¾ç½®EEPROMè¯»å‘½ä»¤
1159   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
1160   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
1161   1          IAP_TRIG = 0x5a;                //è§¦å‘
1162   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
1163   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
1164   1          loc_dat = IAP_DATA;             //è¯»å‡ºEEPROMä¸­çš„æ•°æ®
1165   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
1166   1          return loc_dat;                 //è¿”å›è¯»å–ç»“æœ
1167   1      }//è¯»å–EEPROMæ•°æ®
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 20  

1168          void fun_writee2prom(ui par_add,uc par_dat){
1169   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
1170   1          IAP_CMD = 2;                    //è®¾ç½®EEPROMå†™å…¥å‘½ä»¤
1171   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
1172   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
1173   1          IAP_DATA = par_dat;             //å†™å…¥æ•°æ®
1174   1          IAP_TRIG = 0x5a;                //è§¦å‘
1175   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
1176   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
1177   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
1178   1      }//å†™EEPROMæ•°æ®
1179          void fun_cleane2prom(ui par_add){
1180   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
1181   1          IAP_CMD = 3;                    //è®¾ç½®EEPROMæ“¦é™¤å‘½ä»¤
1182   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
1183   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
1184   1          IAP_TRIG = 0x5a;                //è§¦å‘
1185   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
1186   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
1187   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
1188   1      }//æ¸…é™¤EEPROMæ•°æ®
1189          void fun_calibration(){
1190   1          // fun_sj1(sjp_1);//å‡åˆ°æœ€ä¸Šä½
1191   1          ul loc_time;
1192   1          fun_py1(tra_q);//ç§»åŠ¨åˆ°æœ€å‰ç«¯
1193   1          fun_py1(tra_h);//ç§»åŠ¨åˆ°æœ€åç«¯
1194   1          loc_time=var_timer;
1195   1          fun_py1(tra_q);//ç§»åŠ¨åˆ°å‰ç«¯å¹¶è®¡æ—¶
1196   1          fun_py1(tra_h);//ç§»åŠ¨åˆ°åç«¯
1197   1          loc_time=var_timer-loc_time;
1198   1          loc_time*=0.5;
1199   1          str_cod.py1zh=loc_time*0.5;//ä»ååˆ°ä¸­é—´
1200   1          str_cod.py1qz=loc_time*0.5;//ä»å‰åˆ°ä¸­é—´
1201   1          str_cod.py1qkh=loc_time*0.75;//ä»å‰åˆ°é å
1202   1          str_cod.py1kqh=loc_time*0.564;//ä»é å‰åˆ°å
1203   1          str_cod.py1qkq=loc_time*0.34;//ä»å‰åˆ°é å‰
1204   1          str_cod.py1khh=loc_time*0.2701;//ä»ååˆ°é å
1205   1          str_cod.py1kqz=loc_time*0.189;//ä»é å‰åˆ°ä¸­é—´
1206   1          str_cod.py1zkh=loc_time*0.20;//ä»é ååˆ°ä¸­é—´.
1207   1          str_cod.py1kqkh=loc_time*0.5;//ä»é å‰åˆ°é å
1208   1      }//è‡ªåŠ¨æ ¡å‡†å¹³ç§»å‚æ•°
1209          void fun_port(){
1210   1          //19200bps@12.000MHz
1211   1          PCON |= 0x80;       //ä½¿èƒ½æ³¢ç‰¹ç‡å€é€Ÿä½SMOD
1212   1          SCON = 0x50;        //8ä½æ•°æ®,å¯å˜æ³¢ç‰¹ç‡
1213   1          AUXR |= 0x04;       //ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨æ—¶é’Ÿä¸ºFosc,å³1T
1214   1          BRT = 0xD9;         //è®¾å®šç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨é‡è£…å€¼
1215   1          AUXR |= 0x01;       //ä¸²å£1é€‰æ‹©ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨ä¸ºæ³¢ç‰¹ç‡å‘ç”Ÿå™¨
1216   1          AUXR |= 0x10;       //å¯åŠ¨ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨
1217   1      }//ä¸²å£åˆå§‹åŒ–
1218          void fun_test(){
1219   1          fun_sz1(han_j);
1220   1          fun_delay(1,del_s);
1221   1          fun_sz1(han_s);
1222   1          fun_delay(1,del_s);
1223   1          fun_sz1(han_j);
1224   1          fun_delay(1,del_s);
1225   1          fun_sz1(han_s);
1226   1          fun_delay(1,del_s);
1227   1      
1228   1          str_begin.pywz=tra_h;
1229   1          fun_py1(tra_q);
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 21  

1230   1          fun_delay(1,del_s);
1231   1          fun_py1(tra_h);
1232   1          fun_delay(1,del_s);
1233   1          fun_py1(tra_q);
1234   1          fun_delay(1,del_s);
1235   1          fun_py1(tra_h);
1236   1          fun_delay(1,del_s);
1237   1      
1238   1          fun_sj1(sjp_1);
1239   1          fun_delay(1,del_s);
1240   1          fun_sj1(sjp_2);
1241   1          fun_delay(1,del_s);
1242   1          fun_sj1(sjp_3);
1243   1          fun_delay(1,del_s);
1244   1          fun_sj1(sjp_4);
1245   1          fun_delay(1,del_s);
1246   1          fun_sj1(sjp_5);
1247   1          fun_delay(1,del_s);
1248   1          fun_sj1(sjp_4);
1249   1          fun_delay(1,del_s);
1250   1          fun_sj1(sjp_3);
1251   1          fun_delay(1,del_s);
1252   1          fun_sj1(sjp_2);
1253   1          fun_delay(1,del_s);
1254   1          fun_sj1(sjp_1);
1255   1      
1256   1          str_now.hzfx=str_begin.hzfx;
1257   1          str_begin.hzfx=dir_up;
1258   1          fun_hz1(dir_right);
1259   1          fun_delay(1,del_s);
1260   1          fun_hz1(dir_up);
1261   1          fun_delay(1,del_s);
1262   1          fun_hz1(dir_right);
1263   1          fun_delay(1,del_s);
1264   1          fun_hz1(dir_up);
1265   1          fun_delay(1,del_s);
1266   1          str_begin.hzfx=str_now.hzfx;
1267   1      
1268   1          fun_motors(mot_rl,60);
1269   1          fun_delay(1,del_s);
1270   1          fun_motors(mot_rl,0);
1271   1          fun_delay(1,del_s);
1272   1      
1273   1          fun_motors(mot_rl,-60);
1274   1          fun_delay(1,del_s);
1275   1          fun_motors(mot_rl,0);
1276   1          fun_delay(1,del_s);
1277   1      
1278   1          fun_motors(mot_r,40);
1279   1          fun_motors(mot_l,-40);
1280   1          fun_delay(1,del_s);
1281   1          fun_motors(mot_rl,0);
1282   1          fun_delay(1,del_s);
1283   1      
1284   1          fun_motors(mot_r,-40);
1285   1          fun_motors(mot_l,40);
1286   1          fun_delay(1,del_s);
1287   1          fun_motors(mot_rl,0);
1288   1      }//æµ‹è¯•ç¨‹åº
1289          uc fun_min(uc par_num,...){
1290   1          va_list loc_argp;//ä¿å­˜å‚æ•°ç»“æ„
1291   1          uc loc_min=par_num;//ç°åœ¨çš„æœ€å°å€¼å°±æ˜¯ç¬¬ä¸€ä¸ª
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 22  

1292   1          uc loc_shu;//å½“å‰å‚æ•°
1293   1          va_start(loc_argp,par_num);//loc_argpæŒ‡å‘ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œpar_numæ˜¯æœ€åä¸€ä¸ªç¡®å
             -®šçš„å‚æ•°
1294   1          loc_shu=va_arg(loc_argp,uc);//å–å‡ºä¸‹ä¸€ä¸ªå‚æ•°
1295   1          do{
1296   2              if(loc_shu<loc_min)
1297   2                  loc_min=loc_shu;
1298   2              loc_shu=va_arg(loc_argp,uc);//å–å‡ºä¸‹ä¸€ä¸ªå‚æ•°
1299   2          }while(loc_shu!=def_end);
1300   1          va_end(loc_argp);//ç»“æŸ
1301   1          return loc_min;//é€€å‡º
1302   1      }//æ±‚æœ€å°å€¼
1303          void fun_coordinate(){
1304   1          
1305   1      }//è‡ªåŠ¨å·¡çº¿ä¹‹åæ ‡
1306          void fun_zdzj(ul par_04,ul par_37){//ulå‹æ•°æ®,ä¸€æ¬¡è¾“å…¥æ‰€æœ‰ç»“æœ,æ— éœ€ç­‰å¾…
1307   1          xdata struct str_zdzj str_pass,str_end;//str_zdzj(è‡ªåŠ¨æŠ“ä»¶)çš„ç»“æ„ä½“:ç°åœ¨çš„æ•°æ®å’Œç»“æŸæ—
             -¶å¾—åˆ°çš„ç»“æœ
1308   1          xdata char loc_high[8];         //æ¯æ‘å·¥ä»¶çš„é«˜åº¦
1309   1          xdata uc loc_xh1;             //ç¬¬ä¸€ä¸ªå¾ªç¯
1310   1      
1311   1          memset(str_pass.jx,0,sizeof(str_pass.jx));//æ¸…ç©ºç°åœ¨ä»¶åº
1312   1          memset(str_end.jx,0,sizeof(str_end.jx)); //æ¸…ç©ºæƒ³è¦çš„ä»¶åº
1313   1          memset(loc_high,5,sizeof(loc_high));     //æ¯ç»„é«˜åº¦ç½®5(æ²¡æœ‰ä»¶)
1314   1      
1315   1          //èµ·å§‹åŒºä»¶å·
1316   1          str_pass.jx[0][1]=(par_04/10000000)%10;  //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬1å·ä»¶ä»¶å·(æœ€é«˜ä½)
1317   1          str_pass.jx[0][2]=(par_04/1000000)%10;   //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬2å·ä»¶ä»¶å·
1318   1          str_pass.jx[0][3]=(par_04/100000)%10;    //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬3å·ä»¶ä»¶å·
1319   1          str_pass.jx[0][4]=(par_04/10000)%10;     //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬4å·ä»¶ä»¶å·(æœ€ä½ä½)
1320   1          str_pass.jx[4][1]=(par_04/1000)%10;      //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬1å·ä»¶ä»¶å·(æœ€é«˜ä½)
1321   1          str_pass.jx[4][2]=(par_04/100)%10;       //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬2å·ä»¶ä»¶å·
1322   1          str_pass.jx[4][3]=(par_04/10)%10;        //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬3å·ä»¶ä»¶å·
1323   1          str_pass.jx[4][4]=par_04%10;             //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬4å·ä»¶ä»¶å·(æœ€ä½ä½)
1324   1          //ç›®çš„åŒºä»¶å·
1325   1          str_pass.jx[3][1]=(par_37/10000000)%10;  //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬1å·ä»¶ä»¶å·(æœ€é«˜ä½)
1326   1          str_pass.jx[3][2]=(par_37/1000000)%10;   //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬2å·ä»¶ä»¶å·
1327   1          str_pass.jx[3][3]=(par_37/100000)%10;    //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬3å·ä»¶ä»¶å·
1328   1          str_pass.jx[3][4]=(par_37/10000)%10;     //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬4å·ä»¶ä»¶å·(æœ€ä½ä½)
1329   1          str_pass.jx[7][1]=(par_37/1000)%10;      //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬1å·ä»¶ä»¶å·(æœ€é«˜ä½)
1330   1          str_pass.jx[7][2]=(par_37/100)%10;       //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬2å·ä»¶ä»¶å·
1331   1          str_pass.jx[7][3]=(par_37/10)%10;        //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬3å·ä»¶ä»¶å·
1332   1          str_pass.jx[7][4]=par_37%10;             //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬4å·ä»¶ä»¶å·(æœ€ä½ä½)
1333   1          //ç›®çš„æ¬¡åº
1334   1          str_end.jx[3][1]=1;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº3çš„ç¬¬1å·ç›®çš„æ¬¡åºå·(æœ€é«˜ä½)
1335   1          str_end.jx[3][2]=2;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº3çš„ç¬¬2å·ç›®çš„æ¬¡åºå·
1336   1          str_end.jx[3][3]=3;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº3çš„ç¬¬3å·ç›®çš„æ¬¡åºå·
1337   1          str_end.jx[3][4]=4;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº3çš„ç¬¬4å·ç›®çš„æ¬¡åºå·(æœ€ä½ä½)
1338   1          str_end.jx[7][1]=5;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº7çš„ç¬¬1å·ç›®çš„æ¬¡åºå·(æœ€é«˜ä½)
1339   1          str_end.jx[7][2]=6;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº7çš„ç¬¬2å·ç›®çš„æ¬¡åºå·
1340   1          str_end.jx[7][3]=7;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº7çš„ç¬¬3å·ç›®çš„æ¬¡åºå·
1341   1          str_end.jx[7][4]=8;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº7çš„ç¬¬4å·ç›®çš„æ¬¡åºå·(æœ€ä½ä½)
1342   1      
1343   1          for(loc_xh1=1;loc_xh1<=4;loc_xh1++){
1344   2              if((str_pass.jx[0][loc_xh1]==str_pass.jx[3][1])&&(str_pass.jx[0][loc_xh1]!=0))
1345   2                  str_end.jx[0][loc_xh1]=str_end.jx[3][1];
1346   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[3][2])&&(str_pass.jx[0][loc_xh1]!=0))
1347   2                  str_end.jx[0][loc_xh1]=str_end.jx[3][2];
1348   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[3][3])&&(str_pass.jx[0][loc_xh1]!=0))
1349   2                  str_end.jx[0][loc_xh1]=str_end.jx[3][3];
1350   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[3][4])&&(str_pass.jx[0][loc_xh1]!=0))
1351   2                  str_end.jx[0][loc_xh1]=str_end.jx[3][4];
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 23  

1352   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[7][1])&&(str_pass.jx[0][loc_xh1]!=0))
1353   2                  str_end.jx[0][loc_xh1]=str_end.jx[7][1];
1354   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[7][2])&&(str_pass.jx[0][loc_xh1]!=0))
1355   2                  str_end.jx[0][loc_xh1]=str_end.jx[7][2];
1356   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[7][3])&&(str_pass.jx[0][loc_xh1]!=0))
1357   2                  str_end.jx[0][loc_xh1]=str_end.jx[7][3];
1358   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[7][4])&&(str_pass.jx[0][loc_xh1]!=0))
1359   2                  str_end.jx[0][loc_xh1]=str_end.jx[7][4];
1360   2      
1361   2              if((str_pass.jx[4][loc_xh1]==str_pass.jx[3][1])&&(str_pass.jx[4][loc_xh1]!=0))
1362   2                  str_end.jx[4][loc_xh1]=str_end.jx[3][1];
1363   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[3][2])&&(str_pass.jx[4][loc_xh1]!=0))
1364   2                  str_end.jx[4][loc_xh1]=str_end.jx[3][2];
1365   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[3][3])&&(str_pass.jx[4][loc_xh1]!=0))
1366   2                  str_end.jx[4][loc_xh1]=str_end.jx[3][3];
1367   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[3][4])&&(str_pass.jx[4][loc_xh1]!=0))
1368   2                  str_end.jx[4][loc_xh1]=str_end.jx[3][4];
1369   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[7][1])&&(str_pass.jx[4][loc_xh1]!=0))
1370   2                  str_end.jx[4][loc_xh1]=str_end.jx[7][1];
1371   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[7][2])&&(str_pass.jx[4][loc_xh1]!=0))
1372   2                  str_end.jx[4][loc_xh1]=str_end.jx[7][2];
1373   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[7][3])&&(str_pass.jx[4][loc_xh1]!=0))
1374   2                  str_end.jx[4][loc_xh1]=str_end.jx[7][3];
1375   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[7][4])&&(str_pass.jx[4][loc_xh1]!=0))
1376   2                  str_end.jx[4][loc_xh1]=str_end.jx[7][4];
1377   2          }//é€šè¿‡å®é™…ä»¶åºè·å¾—ç¼–å·
1378   1      
1379   1          memset(str_pass.jx,0,sizeof(str_pass.jx));//æ¸…ç©ºç°åœ¨å®é™…ä»¶åº
1380   1          for(loc_xh1=1;loc_xh1<=4;loc_xh1++){
1381   2              str_pass.jx[0][loc_xh1]=str_end.jx[0][loc_xh1];
1382   2              str_pass.jx[4][loc_xh1]=str_end.jx[4][loc_xh1];
1383   2          }//å°†ç°åœ¨çš„ä»¶åºä»str_end.jxä¸­æ‹¿åˆ°str_pass.jx
1384   1          for(loc_xh1=1;loc_xh1<=4;loc_xh1++){
1385   2              str_end.jx[0][loc_xh1]=0;
1386   2              str_end.jx[4][loc_xh1]=0;
1387   2          }//åˆ é™¤str_end.jxä¸­ç°åœ¨çš„ä»¶åº
1388   1          loc_high[0]=loc_high[4]=1;//åªæœ‰0å·å’Œ4å·æ”¾æ»¡äº†ä»¶
1389   1          loc_xh1=0;//å¾ªç¯æ ‡å¿—ä½å½’é›¶
1390   1      
1391   1          /*
1392   1              åˆ°ç›®å‰ä¸ºæ­¢å‡†å¤‡å·¥ä½œç»“æŸ,ç°åœ¨çš„æ•°ç»„ä¸­æ²¡æœ‰å®é™…ä»¶åº,
1393   1              ç°åœ¨çš„ç¼–å·åœ¨str_pass.jxä¸­,
1394   1              æƒ³è¦å¾—åˆ°çš„ç»“æœä»¶åºç¼–å·åœ¨str_end.jxä¸­
1395   1          */
1396   1          while(1){
1397   2              //é€€å‡ºæ¡ä»¶
1398   2              if((str_pass.jx[3][1]==str_end.jx[3][1])&&
1399   2              (str_pass.jx[3][2]==str_end.jx[3][2])&&
1400   2              (str_pass.jx[3][3]==str_end.jx[3][3])&&
1401   2              (str_pass.jx[3][4]==str_end.jx[3][4])&&
1402   2              (str_pass.jx[7][1]==str_end.jx[7][1])&&
1403   2              (str_pass.jx[7][2]==str_end.jx[7][2])&&
1404   2              (str_pass.jx[7][3]==str_end.jx[7][3])&&
1405   2              (str_pass.jx[7][4]==str_end.jx[7][4])){
1406   3                  if(str_begin.hzfx==dir_left){
1407   4                      fun_sz1(han_s);                 //æ‰‹æŠ“æ¾
1408   4                      fun_sj1(sjp_1);                 //å‡é™åˆ°æœ€é«˜ä½
1409   4                      fun_zjzt(mot_pyhz,7);           //å¹³é¢ä½ç½®7
1410   4                      fun_zjzt(mot_sj,loc_high[7]);   //å‡é™åˆ°7çš„æœ€é«˜ä½
1411   4                      fun_sz1(han_j);                 //æ‰‹æŠ“ç´§
1412   4                  }//å¦‚æœåœåœ¨å·¦è¾¹
1413   3                  return;
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 24  

1414   3              }//å¦‚æœå°è½¦ä¸€æ–¹çš„å®é™…ä»¶åºå’Œæƒ³è¦è¾¾åˆ°çš„ä»¶åºç›¸ç­‰
1415   2              if(str_begin.hzfx==dir_left){
1416   3                  //è½¬å‘æ¡ä»¶
1417   3                  loc_xh1++;//æ ‡å¿—ä½+1
1418   3                  if(loc_xh1>=100){
1419   4                      loc_xh1=0;
1420   4                      fun_zjzt(mot_sj,fun_min(loc_high[0],loc_high[1],loc_high[2],loc_high[3],loc_high[4],loc_hi
             -gh[5],loc_high[6],loc_high[7],def_end)-1);
1421   4                      fun_hz1(dir_right);
1422   4                  }
1423   3                  //å¯ä»¥ä¸€æ¬¡æ‹¿èµ°,ä¸éœ€è¦ä¸­é—´ä½çš„
1424   3                  if(loc_high[1]<5){
1425   4                      if(str_pass.jx[1][loc_high[1]]==str_end.jx[3][loc_high[3]-1]){
1426   5                          fun_najian(1,3,loc_high,str_pass.jx);//1-->3
1427   5                          continue;
1428   5                      }
1429   4                  }//å¦‚æœåŒº1æœ‰ä»¶
1430   3                  if(loc_high[2]<5){
1431   4                      if(str_pass.jx[2][loc_high[2]]==str_end.jx[3][loc_high[3]-1]){
1432   5                          fun_najian(2,3,loc_high,str_pass.jx);//2-->3
1433   5                          continue;
1434   5                      }
1435   4                  }//å¦‚æœåŒº2æœ‰ä»¶
1436   3                  if(loc_high[0]<5){
1437   4                      if(str_pass.jx[0][loc_high[0]]==str_end.jx[3][loc_high[3]-1]){
1438   5                          fun_najian(0,3,loc_high,str_pass.jx);//0-->3
1439   5                          continue;
1440   5                      }
1441   4                      if(str_pass.jx[0][loc_high[0]]==str_end.jx[7][loc_high[7]-1]){
1442   5                          fun_najian(0,7,loc_high,str_pass.jx);//0-->7
1443   5                          continue;
1444   5                      }
1445   4                  }//å¦‚æœåŒº0æœ‰ä»¶
1446   3      
1447   3                  //ä¸å¯ä»¥ä¸€æ¬¡æ‹¿èµ°,éœ€è¦ä¸­é—´ä½çš„
1448   3                  if(loc_high[0]<5){
1449   4                      if((str_pass.jx[0][loc_high[0]]==str_end.jx[3][1])||
1450   4                      (str_pass.jx[0][loc_high[0]]==str_end.jx[3][2])||
1451   4                      (str_pass.jx[0][loc_high[0]]==str_end.jx[3][3])||
1452   4                      (str_pass.jx[0][loc_high[0]]==str_end.jx[3][4])){
1453   5                          if(((loc_high[1]==5)||//å¦‚æœ1åŒºæ²¡æ”¾ä¸œè¥¿æˆ–è€…
1454   5                          (str_pass.jx[0][loc_high[0]]>str_pass.jx[1][loc_high[1]]))&&//0åŒºçš„ä»¶ç¼–å·å¤§äº1å
             -Œºçš„ç¼–å·å¹¶ä¸”
1455   5                          (loc_high[1]>2)){//1åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
1456   6                              fun_najian(0,1,loc_high,str_pass.jx);//0-->1
1457   6                              continue;
1458   6                          }
1459   5                          if(((loc_high[2]==5)||//å¦‚æœ2åŒºæ²¡æ”¾ä¸œè¥¿æˆ–è€…
1460   5                          (str_pass.jx[0][loc_high[0]]>str_pass.jx[2][loc_high[2]]))&&//0åŒºçš„ä»¶ç¼–å·å¤§äº2å
             -Œºçš„ç¼–å·å¹¶ä¸”
1461   5                          (loc_high[2]>2)){//2åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
1462   6                              fun_najian(0,2,loc_high,str_pass.jx);//0-->2
1463   6                              continue;
1464   6                          }
1465   5                      }//å¦‚æœè¦æ”¾åœ¨3ä¸Š,ä½†ç›®å‰ä¸èƒ½æ”¾
1466   4                      if((str_pass.jx[0][loc_high[0]]==str_end.jx[7][1])||
1467   4                      (str_pass.jx[0][loc_high[0]]==str_end.jx[7][2])||
1468   4                      (str_pass.jx[0][loc_high[0]]==str_end.jx[7][3])||
1469   4                      (str_pass.jx[0][loc_high[0]]==str_end.jx[7][4])){
1470   5                          if(((loc_high[5]==5)||//å¦‚æœ5åŒºæ²¡ä¸œè¥¿æ”¾æˆ–è€…
1471   5                          (str_pass.jx[0][loc_high[0]]>str_pass.jx[5][loc_high[5]]))&&//0åŒºçš„ä»¶ç¼–å·å¤§äº5å
             -Œºçš„ç¼–å·å¹¶ä¸”
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 25  

1472   5                          (loc_high[5]>2)){//5åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
1473   6                              fun_najian(0,5,loc_high,str_pass.jx);//0-->5
1474   6                              continue;
1475   6                          }
1476   5                          if(((loc_high[6]==5)||//å¦‚æœ6åŒºæ²¡ä¸œè¥¿æ”¾æˆ–è€…
1477   5                          (str_pass.jx[0][loc_high[0]]>str_pass.jx[6][loc_high[6]]))&&//0åŒºçš„ä»¶ç¼–å·å¤§äº6å
             -Œºçš„ç¼–å·å¹¶ä¸”
1478   5                          (loc_high[6]>2)){//6åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
1479   6                              fun_najian(0,6,loc_high,str_pass.jx);//0-->6
1480   6                              continue;
1481   6                          }
1482   5                      }//å¦‚æœè¦æ”¾åœ¨7ä¸Š,ä½†ç›®å‰ä¸èƒ½æ”¾
1483   4                  }//å¦‚æœåŒº0æœ‰ä»¶
1484   3      
1485   3                  //ä¸­é—´ä¸¤ä¸ªä½ç½®ä¹Ÿä¸èƒ½ä¸€æ¬¡æå®šçš„
1486   3                  if((loc_high[1]<5)&&(loc_high[2]<5)){
1487   4                      if((str_pass.jx[1][loc_high[1]]>str_pass.jx[2][loc_high[2]])&&(loc_high[2]>1)){
1488   5                          fun_najian(1,2,loc_high,str_pass.jx);//1-->2
1489   5                          continue;
1490   5                      }//1çš„ä»¶æ¯”2çš„ä»¶å¤§ä¸”åŒº2æ”¾äº†ä¸åˆ°3ä¸ªä»¶
1491   4                      if((str_pass.jx[2][loc_high[2]]>str_pass.jx[1][loc_high[1]])&&(loc_high[1]>1)){
1492   5                          fun_najian(2,1,loc_high,str_pass.jx);//2-->1
1493   5                          continue;
1494   5                      }//2çš„ä»¶æ¯”1çš„ä»¶å¤§ä¸”åŒº1æ”¾äº†ä¸åˆ°3ä¸ªä»¶
1495   4                  }//å¦‚æœåŒº1å’ŒåŒº2éƒ½æœ‰ä»¶
1496   3      
1497   3                  //ä¸­é—´ä¸¤ä¸ªä½ç½®æ€ä¹ˆä¹Ÿæä¸å®šçš„
1498   3                  if((loc_high[1]<5)&&(loc_high[2]<5)){
1499   4                      if((loc_high[0]>1)&&(str_pass.jx[1][loc_high[1]]>str_pass.jx[0][loc_high[0]])){
1500   5                          fun_najian(1,0,loc_high,str_pass.jx);//1-->0
1501   5                          continue;
1502   5                      }//1åŒºçš„ä»¶æ¯”0åŒºçš„å¤§ä¸”0åŒºæ”¾äº†ä¸åˆ°3ä¸ªä»¶
1503   4                      if((loc_high[0]>1)&&(str_pass.jx[2][loc_high[2]]>str_pass.jx[0][loc_high[0]])){
1504   5                          fun_najian(2,0,loc_high,str_pass.jx);//2-->0
1505   5                          continue;
1506   5                      }//2åŒºçš„ä»¶æ¯”0åŒºçš„å¤§ä¸”0åŒºæ”¾äº†ä¸åˆ°3ä¸ªä»¶
1507   4                  }
1508   3              }//å¦‚æœå›è½¬åœ¨å·¦è¾¹ 
1509   2              if(str_begin.hzfx==dir_right){
1510   3                  //è½¬å‘æ¡ä»¶
1511   3                  loc_xh1++;//æ ‡å¿—ä½+1
1512   3                  if(loc_xh1>=100){
1513   4                      loc_xh1=0;
1514   4                      fun_zjzt(mot_sj,fun_min(loc_high[0],loc_high[1],loc_high[2],loc_high[3],loc_high[4],loc_hi
             -gh[5],loc_high[6],loc_high[7],def_end)-1);
1515   4                      fun_hz1(dir_left);
1516   4                  }
1517   3                  //å¯ä»¥ä¸€æ¬¡æ‹¿èµ°,ä¸éœ€è¦ä¸­é—´ä½çš„
1518   3                  if(loc_high[5]<5){
1519   4                      if(str_pass.jx[5][loc_high[5]]==str_end.jx[7][loc_high[7]-1]){
1520   5                          fun_najian(5,7,loc_high,str_pass.jx);//5-->7
1521   5                          continue;
1522   5                      }//5-->7
1523   4                  }//å¦‚æœåŒº5æœ‰ä»¶
1524   3                  if(loc_high[6]<5){
1525   4                      if(str_pass.jx[6][loc_high[6]]==str_end.jx[7][loc_high[7]-1]){
1526   5                          fun_najian(6,7,loc_high,str_pass.jx);//6-->7
1527   5                          continue;
1528   5                      }//6-->7
1529   4                  }//å¦‚æœåŒº6æœ‰ä»¶
1530   3                  if(loc_high[4]<5){
1531   4                      if(str_pass.jx[4][loc_high[4]]==str_end.jx[7][loc_high[7]-1]){
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 26  

1532   5                          fun_najian(4,7,loc_high,str_pass.jx);//4-->7
1533   5                          continue;
1534   5                      }//4-->7
1535   4                      if(str_pass.jx[4][loc_high[4]]==str_end.jx[3][loc_high[3]-1]){
1536   5                          fun_najian(4,3,loc_high,str_pass.jx);//4-->3
1537   5                          continue;
1538   5                      }//4-->3
1539   4                  }//å¦‚æœåŒº4æœ‰ä»¶
1540   3      
1541   3                  //ä¸å¯ä»¥ä¸€æ¬¡æ‹¿èµ°,éœ€è¦ä¸­é—´ä½çš„
1542   3                  if(loc_high[4]<5){
1543   4                      if((str_pass.jx[4][loc_high[4]]==str_end.jx[7][1])||
1544   4                      (str_pass.jx[4][loc_high[4]]==str_end.jx[7][2])||
1545   4                      (str_pass.jx[4][loc_high[4]]==str_end.jx[7][3])||
1546   4                      (str_pass.jx[4][loc_high[4]]==str_end.jx[7][4])){
1547   5                          if(((loc_high[5]==5)||//å¦‚æœ5åŒºæ²¡ä¸œè¥¿æ”¾æˆ–è€…
1548   5                          (str_pass.jx[4][loc_high[4]]>str_pass.jx[5][loc_high[5]]))&&//4åŒºçš„ä»¶ç¼–å·å¤§äº5å
             -Œºçš„ç¼–å·å¹¶ä¸”
1549   5                          (loc_high[5]>2)){//5åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
1550   6                              fun_najian(4,5,loc_high,str_pass.jx);//4-->5
1551   6                              continue;
1552   6                          }
1553   5                          if(((loc_high[6]==5)||//å¦‚æœ6åŒºæ²¡ä¸œè¥¿æ”¾æˆ–è€…
1554   5                          (str_pass.jx[4][loc_high[4]]>str_pass.jx[6][loc_high[6]]))&&//4åŒºçš„ä»¶ç¼–å·å¤§äº6å
             -Œºçš„ç¼–å·å¹¶ä¸”
1555   5                          (loc_high[6]>2)){//6åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
1556   6                              fun_najian(4,6,loc_high,str_pass.jx);//4-->6
1557   6                              continue;
1558   6                          }
1559   5                      }//å¦‚æœè¦æ”¾åœ¨7ä¸Š,ä½†ç›®å‰ä¸èƒ½æ”¾
1560   4                      if((str_pass.jx[4][loc_high[4]]==str_end.jx[3][1])||
1561   4                      (str_pass.jx[4][loc_high[4]]==str_end.jx[3][2])||
1562   4                      (str_pass.jx[4][loc_high[4]]==str_end.jx[3][3])||
1563   4                      (str_pass.jx[4][loc_high[4]]==str_end.jx[3][4])){
1564   5                          if(((loc_high[1]==5)||//å¦‚æœ1åŒºæ²¡æ”¾ä¸œè¥¿æˆ–è€…
1565   5                          (str_pass.jx[4][loc_high[4]]>str_pass.jx[1][loc_high[1]]))&&//4åŒºçš„ä»¶ç¼–å·å¤§äº1å
             -Œºçš„ç¼–å·å¹¶ä¸”
1566   5                          (loc_high[1]>2)){//1åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
1567   6                              fun_najian(4,1,loc_high,str_pass.jx);//4-->1
1568   6                              continue;
1569   6                          }
1570   5                          if(((loc_high[2]==5)||//å¦‚æœ2åŒºæ²¡æ”¾ä¸œè¥¿æˆ–è€…
1571   5                              (str_pass.jx[4][loc_high[4]]>str_pass.jx[2][loc_high[2]]))&&//4åŒºçš„ä»¶ç¼–å·å¤§ä
             -º2åŒºçš„ç¼–å·å¹¶ä¸”
1572   5                              (loc_high[2]>2)){//2åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
1573   6                              fun_najian(4,2,loc_high,str_pass.jx);//4-->2
1574   6                              continue;
1575   6                          }
1576   5                      }//å¦‚æœè¦æ”¾åœ¨3ä¸Š,ä½†ç›®å‰ä¸èƒ½æ”¾
1577   4                  }//å¦‚æœåŒº4æœ‰ä»¶
1578   3      
1579   3                  //ä¸­é—´ä¸¤ä¸ªä½ç½®ä¹Ÿä¸èƒ½ä¸€æ¬¡æå®šçš„
1580   3                  if((loc_high[5]<5)&&(loc_high[6]<5)){
1581   4                      if((str_pass.jx[5][loc_high[5]]>str_pass.jx[6][loc_high[6]])&&(loc_high[6]>1)){
1582   5                          fun_najian(5,6,loc_high,str_pass.jx);//5-->6
1583   5                          continue;
1584   5                      }//5çš„ä»¶æ¯”6çš„ä»¶å¤§ä¸”åŒº6æ”¾äº†ä¸åˆ°3ä¸ªä»¶
1585   4                      if((str_pass.jx[6][loc_high[6]]>str_pass.jx[5][loc_high[5]])&&(loc_high[5]>1)){
1586   5                          fun_najian(6,5,loc_high,str_pass.jx);//6-->5
1587   5                          continue;
1588   5                      }//6çš„ä»¶æ¯”5çš„ä»¶å¤§ä¸”åŒº5æ”¾äº†ä¸åˆ°3ä¸ªä»¶
1589   4                  }//å¦‚æœåŒº5å’ŒåŒº6éƒ½æœ‰ä»¶
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 27  

1590   3      
1591   3                  //ä¸­é—´ä¸¤ä¸ªä½ç½®æ€ä¹ˆä¹Ÿæä¸å®šçš„
1592   3                  if((loc_high[5]<5)&&(loc_high[6]<5)){
1593   4                      if((loc_high[4]>1)&&(str_pass.jx[5][loc_high[5]]>str_pass.jx[4][loc_high[4]])){
1594   5                          fun_najian(5,4,loc_high,str_pass.jx);//5-->4
1595   5                          continue;
1596   5                      }//5åŒºçš„ä»¶æ¯”4åŒºçš„å¤§ä¸”4åŒºæ”¾äº†ä¸åˆ°3ä¸ªä»¶
1597   4                      if((loc_high[4]>1)&&(str_pass.jx[6][loc_high[6]]>str_pass.jx[4][loc_high[4]])){
1598   5                          fun_najian(6,4,loc_high,str_pass.jx);//6-->4
1599   5                          continue;
1600   5                      }//6åŒºçš„ä»¶æ¯”4åŒºçš„å¤§ä¸”4åŒºæ”¾äº†ä¸åˆ°3ä¸ªä»¶
1601   4                  }
1602   3              }//å¦‚æœå›è½¬åœ¨å³è¾¹
1603   2          }    
1604   1      }//è‡ªåŠ¨æŠ“ä»¶
1605          void fun_zjzt(uc par_motor,char par_model){
1606   1          if(par_motor==mot_pyhz){
1607   2              switch(par_model){
1608   3                  case 0:
1609   3                      if((str_begin.pywz==tra_h)&&(str_begin.hzfx==dir_left))
1610   3                          break;
1611   3                      if(str_begin.hzfx==dir_right){
1612   4                          fun_py1(tra_z);
1613   4                          fun_hz1(dir_left);
1614   4                      }
1615   3                      fun_py1(tra_h);
1616   3                      break;
1617   3                  case 1:
1618   3                      if((str_begin.pywz==tra_kh)&&(str_begin.hzfx==dir_left))
1619   3                          break;
1620   3                      if(str_begin.hzfx==dir_right){
1621   4                          fun_py1(tra_z);
1622   4                          fun_hz1(dir_left);
1623   4                      }
1624   3                      fun_py1(tra_kh);
1625   3                      break;
1626   3                  case 2:
1627   3                      if((str_begin.pywz==tra_kq)&&(str_begin.hzfx==dir_left))
1628   3                          break;
1629   3                      if(str_begin.hzfx==dir_right){
1630   4                          fun_py1(tra_z);
1631   4                          fun_hz1(dir_left);
1632   4                      }
1633   3                      fun_py1(tra_kq);
1634   3                      break;
1635   3                  case 3:
1636   3                      if((str_begin.pywz==tra_q)&&(str_begin.hzfx==dir_left))
1637   3                          break;
1638   3                      if(str_begin.hzfx==dir_right){
1639   4                          fun_py1(tra_z);
1640   4                          fun_hz1(dir_left);
1641   4                      }
1642   3                      fun_py1(tra_q);
1643   3                      break;
1644   3                  case 4:
1645   3                      if((str_begin.pywz==tra_q)&&(str_begin.hzfx==dir_right))
1646   3                          break;
1647   3                      if(str_begin.hzfx==dir_left){
1648   4                          fun_py1(tra_z);
1649   4                          fun_hz1(dir_right);
1650   4                      }
1651   3                      fun_py1(tra_q);
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 28  

1652   3                      break;
1653   3                  case 5:
1654   3                      if((str_begin.pywz==tra_kq)&&(str_begin.hzfx==dir_right))
1655   3                          break;
1656   3                      if(str_begin.hzfx==dir_left){
1657   4                          fun_py1(tra_z);
1658   4                          fun_hz1(dir_right);
1659   4                      }
1660   3                      fun_py1(tra_kq);
1661   3                      break;
1662   3                  case 6:
1663   3                      if((str_begin.pywz==tra_kh)&&(str_begin.hzfx==dir_right))
1664   3                          break;
1665   3                      if(str_begin.hzfx==dir_left){
1666   4                          fun_py1(tra_z);
1667   4                          fun_hz1(dir_right);
1668   4                      }
1669   3                      fun_py1(tra_kh);
1670   3                      break;
1671   3                  case 7:
1672   3                      if((str_begin.pywz==tra_h)&&(str_begin.hzfx==dir_right))
1673   3                          break;
1674   3                      if(str_begin.hzfx==dir_left){
1675   4                          fun_py1(tra_z);
1676   4                          fun_hz1(dir_right);
1677   4                      }
1678   3                      fun_py1(tra_h);
1679   3                      break;
1680   3                  default:
1681   3                      break;
1682   3              }
1683   2          }
1684   1          else if(par_motor==mot_sj){
1685   2              switch(par_model){
1686   3                  case 0:
1687   3                      fun_sj1(sjp_1);
1688   3                      break;
1689   3                  case 1:
1690   3                      fun_sj1(sjp_2);
1691   3                      break;
1692   3                  case 2:
1693   3                      fun_sj1(sjp_3);
1694   3                      break;
1695   3                  case 3:
1696   3                      fun_sj1(sjp_4);
1697   3                      break;
1698   3                  case 4:
1699   3                      fun_sj1(sjp_5);
1700   3                      break;
1701   3                  default:
1702   3                      if(par_model<0)
1703   3                          fun_sj1(sjp_1);
1704   3                      else if(par_model>5)
1705   3                          fun_sj1(sjp_5);
1706   3                      break;
1707   3              }
1708   2          }
1709   1      }//æŠ“ä»¶çŠ¶æ€,0ä¸ºå·¦ä¸Šä½,3ä¸ºå·¦ä¸‹ä½,4ä¸ºå³ä¸Šä½,7ä¸ºå³ä¸‹ä½
1710          void fun_najian(uc par_now,uc par_next,char par_high[8],uc par_data[8][5]){
1711   1          #ifdef Debug
                      printf("%d --> %d\n",(ui)par_now,(ui)par_next);
                  #else
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 29  

1714   1              //å–å„ä½ç½®çš„æœ€é«˜ä½
1715   1              xdata uc loc_high=fun_min(par_high[0],par_high[1],par_high[2],par_high[3],par_high[4],par_high[5],
             -par_high[6],par_high[7]);
1716   1              //å‡èµ·
1717   1              if(par_now==0||par_now==1||par_now==2||par_now==3){
1718   2                  if(str_begin.hzfx==dir_left)
1719   2                      fun_zjzt(mot_sj,fun_min(par_high[0],par_high[1],par_high[2],par_high[3],def_end)-1);
1720   2                  else if(str_begin.hzfx==dir_right)
1721   2                      fun_zjzt(mot_sj,fun_min(par_high[0],par_high[1],par_high[2],par_high[3],par_high[4],par_hi
             -gh[5],par_high[6],par_high[7],def_end)-1);            
1722   2              }
1723   1              else if(par_now==4||par_now==5||par_now==6||par_now==7){
1724   2                  if(str_begin.hzfx==dir_right)
1725   2                      fun_zjzt(mot_sj,fun_min(par_high[4],par_high[5],par_high[6],par_high[7],def_end)-1);
1726   2                  else if(str_begin.hzfx==dir_left)
1727   2                      fun_zjzt(mot_sj,fun_min(par_high[0],par_high[1],par_high[2],par_high[3],par_high[4],par_hi
             -gh[5],par_high[6],par_high[7],def_end)-1);            
1728   2              }
1729   1              //å¹³ç§»å›è½¬åˆ°éœ€è¦çš„åœ°æ–¹
1730   1              fun_zjzt(mot_pyhz,par_now);
1731   1              //ä¸‹é™åˆ°å·¥ä»¶çš„ä½ç½®
1732   1              fun_zjzt(mot_sj,par_high[par_now]);
1733   1              //æŠ“ç´§å·¥ä»¶
1734   1              fun_sz1(han_j);
1735   1              //ä¸Šå‡åˆ°æ­£ç¡®çš„æœ€é«˜ä½
1736   1              switch(par_now){
1737   2                  case 0:
1738   2                      switch(par_next){
1739   3                          case 1:
1740   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[par_next]-1,def_end)
             --1);
1741   3                              break;
1742   3                          case 2:
1743   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[1],par_high[par_next
             -]-1,def_end)-1);
1744   3                              break;
1745   3                          case 3:
1746   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[1],par_high[2],par_h
             -igh[par_next]-1,def_end)-1);
1747   3                              break;
1748   3                          case 4:
1749   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[1],par_high[5],par_h
             -igh[par_next]-1,def_end)-1);
1750   3                              break;
1751   3                          case 5:
1752   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[1],par_high[par_next
             -]-1,def_end)-1);
1753   3                              break;
1754   3                          case 6:
1755   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[1],par_high[par_next
             -]-1,def_end)-1);
1756   3                              break;
1757   3                          case 7:
1758   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[1],par_high[6],par_h
             -igh[par_next]-1,def_end)-1);
1759   3                              break;
1760   3                          default:
1761   3                              break;
1762   3                      }
1763   2                      break;
1764   2                  case 1:
1765   2                      switch(par_next){
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 30  

1766   3                          case 0:
1767   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[par_next]-1,def_end)
             --1);
1768   3                              break;
1769   3                          case 2:
1770   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[par_next]-1,def_end)
             --1);
1771   3                              break;
1772   3                          case 3:
1773   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[2],par_high[par_next
             -]-1,def_end)-1);
1774   3                              break;
1775   3                          case 4:
1776   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[5],par_high[par_next
             -]-1,def_end)-1);
1777   3                              break;
1778   3                          case 5:
1779   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[par_next]-1,def_end)
             --1);
1780   3                              break;
1781   3                          case 6:
1782   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[par_next]-1,def_end)
             --1);
1783   3                              break;
1784   3                          case 7:
1785   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[6],par_high[par_next
             -]-1,def_end)-1);
1786   3                              break;
1787   3                          default:
1788   3                              break;
1789   3                      }
1790   2                      break;
1791   2                  case 2:
1792   2                      switch(par_next){
1793   3                          case 0:
1794   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[1],par_high[par_next
             -]-1,def_end)-1);
1795   3                              break;
1796   3                          case 1:
1797   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[par_next]-1,def_end)
             --1);
1798   3                              break;
1799   3                          case 3:
1800   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[par_next]-1,def_end)
             --1);
1801   3                              break;
1802   3                          case 4:
1803   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[5],par_high[par_next
             -]-1,def_end)-1);
1804   3                              break;
1805   3                          case 5:
1806   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[par_next]-1,def_end)
             --1);
1807   3                              break;
1808   3                          case 6:
1809   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[par_next]-1,def_end)
             --1);
1810   3                              break;
1811   3                          case 7:
1812   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[6],par_high[par_next
             -]-1,def_end)-1);
1813   3                              break;
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 31  

1814   3                          default:
1815   3                              break;
1816   3                      }
1817   2                      break;
1818   2                  case 3:
1819   2                      switch(par_next){
1820   3                          case 0:
1821   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[2],par_high[1],par_h
             -igh[par_next]-1,def_end)-1);
1822   3                              break;
1823   3                          case 1:
1824   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[2],par_high[par_next
             -]-1,def_end)-1);
1825   3                              break;
1826   3                          case 2:
1827   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[par_next]-1,def_end)
             --1);
1828   3                              break;
1829   3                          case 4:
1830   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[2],par_high[5],par_h
             -igh[par_next]-1,def_end)-1);
1831   3                              break;
1832   3                          case 5:
1833   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[2],par_high[par_next
             -]-1,def_end)-1);
1834   3                              break;
1835   3                          case 6:
1836   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[2],par_high[par_next
             -]-1,def_end)-1);
1837   3                              break;
1838   3                          case 7:
1839   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[2],par_high[6],par_h
             -igh[par_next]-1,def_end)-1);
1840   3                              break;
1841   3                          default:
1842   3                              break;
1843   3                      }
1844   2                      break;
1845   2                  case 4:
1846   2                      switch(par_next){
1847   3                          case 0:
1848   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[5],par_high[1],par_h
             -igh[par_next]-1,def_end)-1);
1849   3                              break;
1850   3                          case 1:
1851   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[5],par_high[par_next
             -]-1,def_end)-1);
1852   3                              break;
1853   3                          case 2:
1854   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[5],par_high[par_next
             -]-1,def_end)-1);
1855   3                              break;
1856   3                          case 3:
1857   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[5],par_high[2],par_h
             -igh[par_next]-1,def_end)-1);
1858   3                              break;
1859   3                          case 5:
1860   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[par_next]-1,def_end)
             --1);
1861   3                              break;
1862   3                          case 6:
1863   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[5],par_high[par_next
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 32  

             -]-1,def_end)-1);
1864   3                              break;
1865   3                          case 7:
1866   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[5],par_high[6],par_h
             -igh[par_next]-1,def_end)-1);
1867   3                              break;
1868   3                          default:
1869   3                              break;
1870   3                      }
1871   2                      break;
1872   2                  case 5:
1873   2                      switch(par_next){
1874   3                          case 0:
1875   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[1],par_high[par_next
             -]-1,def_end)-1);
1876   3                              break;
1877   3                          case 1:
1878   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[par_next]-1,def_end)
             --1);
1879   3                              break;
1880   3                          case 2:
1881   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[par_next]-1,def_end)
             --1);
1882   3                              break;
1883   3                          case 3:
1884   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[2],par_high[par_next
             -]-1,def_end)-1);
1885   3                              break;
1886   3                          case 4:
1887   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[par_next]-1,def_end)
             --1);
1888   3                              break;
1889   3                          case 6:
1890   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[par_next]-1,def_end)
             --1);
1891   3                              break;
1892   3                          case 7:
1893   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[6],par_high[par_next
             -]-1,def_end)-1);
1894   3                              break;
1895   3                          default:
1896   3                              break;
1897   3                      }
1898   2                      break;
1899   2                  case 6:
1900   2                      switch(par_next){
1901   3                          case 0:
1902   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[1],par_high[par_next
             -]-1,def_end)-1);
1903   3                              break;
1904   3                          case 1:
1905   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[par_next]-1,def_end)
             --1);
1906   3                              break;
1907   3                          case 2:
1908   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[par_next]-1,def_end)
             --1);
1909   3                              break;
1910   3                          case 3:
1911   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[2],par_high[par_next
             -]-1,def_end)-1);
1912   3                              break;
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 33  

1913   3                          case 4:
1914   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[5],par_high[par_next
             -]-1,def_end)-1);
1915   3                              break;
1916   3                          case 5:
1917   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[par_next]-1,def_end)
             --1);
1918   3                              break;
1919   3                          case 7:
1920   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[par_next]-1,def_end)
             --1);
1921   3                              break;
1922   3                          default:
1923   3                              break;
1924   3                      }
1925   2                      break;
1926   2                  case 7:
1927   2                      switch(par_next){
1928   3                          case 0:
1929   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[6],par_high[1],par_h
             -igh[par_next]-1,def_end)-1);
1930   3                              break;
1931   3                          case 1:
1932   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[6],par_high[par_next
             -]-1,def_end)-1);
1933   3                              break;
1934   3                          case 2:
1935   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[6],par_high[par_next
             -]-1,def_end)-1);
1936   3                              break;
1937   3                          case 3:
1938   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[6],par_high[2],par_h
             -igh[par_next]-1,def_end)-1);
1939   3                              break;
1940   3                          case 4:
1941   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[5],par_high[6],par_h
             -igh[par_next]-1,def_end)-1);
1942   3                              break;
1943   3                          case 5:
1944   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[6],par_high[par_next
             -]-1,def_end)-1);
1945   3                              break;
1946   3                          case 6:
1947   3                              fun_zjzt(mot_sj,fun_min(loc_high+1,par_high[par_now],par_high[par_next]-1,def_end)
             --1);
1948   3                              break;
1949   3                          default:
1950   3                              break;
1951   3                      }
1952   2                      break;
1953   2                  default:
1954   2                      break;
1955   2              }
1956   1              //å¹³ç§»å›è½¬è‡³æ”¾ä»¶å¤„
1957   1              fun_zjzt(mot_pyhz,par_next);
1958   1              //ä¸‹é™åˆ°è¦æ”¾ä¸‹çš„ä½ç½®
1959   1              fun_zjzt(mot_sj,par_high[par_next]-1);
1960   1              //æ¾å¼€æ‰‹æŠ“
1961   1              fun_sz1(han_s);
1962   1          #endif
1963   1      
1964   1          //æ›´æ–°å‚æ•°
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 34  

1965   1          par_data[par_next][par_high[par_next]-1]=par_data[par_now][par_high[par_now]];
1966   1          par_data[par_now][par_high[par_now]]=0;
1967   1          par_high[par_now]++;
1968   1          par_high[par_next]--;
1969   1      }//æ‹¿ä»¶(é…åˆè‡ªåŠ¨æŠ“ä»¶ä½¿ç”¨)
1970          void fun_zhuajian(){
1971   1          fun_sz1(han_s);                 //æ‰‹æŠ“æ¾
1972   1          fun_sj1(sjp_1);                 //ä¸Šå‡åˆ°æœ€é«˜ä½
1973   1          fun_py1(tra_q);                 //å¹³ç§»åˆ°å‰ç«¯
1974   1          if(str_begin.hzfx!=dir_right)   //å¦‚æœä¸åœ¨å³è¾¹
1975   1              fun_hz1(dir_right);         //å°±å¹³ç§»åˆ°å³è¾¹
1976   1      
1977   1          fun_folline(2,60);
1978   1          fun_turn(tur_l90,40);
1979   1          fun_folline(1,60);
1980   1      }//ä»èµ·å§‹åŒºèµ°åˆ°æŠ“ä»¶åŒº
1981          void fun_back(){
1982   1          fun_motors(mot_rl,-30);
1983   1          fun_delay(1,del_s);
1984   1      
1985   1          fun_motors(mot_r,-50);
1986   1          fun_motors(mot_l,-20);
1987   1          fun_delay(3,del_s);    
1988   1      
1989   1          fun_motors(mot_rl,-35);
1990   1          fun_delay(1,del_s);
1991   1      }//ä»æŠ“ä»¶åŒºå›åˆ°èµ·å§‹åŒº
1992          void fun_start(char par_x,char par_y,enum varENU_dir par_ctfx,enum varENU_han par_szzt,enum varENU_sjp par
             -_sjwz,enum varENU_tra par_pywz,enum varENU_dir par_hzfx){
1993   1          CLK_DIV=0x00;             //ä¸åˆ†é¢‘
1994   1          P0M1=0xff;                //P0ç”¨äºè¾“å…¥
1995   1          P0M0=0x00;                //P0ä¸èƒ½è¾“å‡º
1996   1          P1M1=0x00;                //P1å£0-1åŒå‘
1997   1          P1M0=0xfc;                //P1å£2-7è¾“å‡º
1998   1          P2M1=0xf0;                //P2å£4-7è¾“å…¥
1999   1          P2M0=0x0f;                //P2å£0-3è¾“å‡º
2000   1      
2001   1          out_en1=1;                //ç”µæœº1/3ä½¿èƒ½
2002   1          out_en2=1;                //ç”µæœº2/4ä½¿èƒ½
2003   1          CR=0;                     //PACè®¡æ•°å™¨å½’é›¶
2004   1          out_motorselect=0;        //ç”µæœºç‰‡é€‰ä¸º0
2005   1      
2006   1          #ifdef Debug              //å¦‚æœæ˜¯è°ƒè¯•æ¨¡å¼
                      fun_port();           //åˆå§‹åŒ–ä¸²å£
                      TI=1;                 //æ‰“å¼€ä¸²å£ä¼ è¾“åŠŸèƒ½        
                  #endif
2010   1          fun_pwminit();            //PWMçš„åˆå§‹åŒ–
2011   1          fun_timer0init();         //åˆå§‹åŒ–å®šæ—¶å™¨0
2012   1          fun_timer1init();         //åˆå§‹åŒ–å®šæ—¶å™¨1
2013   1      
2014   1          str_begin.x=par_x;        //Xåæ ‡
2015   1          str_begin.y=par_y;        //Yåæ ‡
2016   1          str_begin.ctfx=par_ctfx;  //è½¦å¤´æ–¹å‘
2017   1          str_begin.szzt=par_szzt;  //æ‰‹æŠ“çŠ¶æ€
2018   1          str_begin.sjwz=par_sjwz;  //å‡é™ä½ç½®
2019   1          str_begin.pywz=par_pywz;  //å¹³ç§»ä½ç½®
2020   1          str_begin.hzfx=par_hzfx;  //å›è½¬æ–¹å‘
2021   1      
2022   1          str_tfl.gospeed=0;        //é€Ÿåº¦å½’é›¶
2023   1          fun_motors(mot_sz,0);     //æ‰‹æŠ“é€Ÿåº¦å½’é›¶
2024   1          fun_motors(mot_py,0);     //å¹³ç§»é€Ÿåº¦å½’é›¶
2025   1          fun_motors(mot_sj,0);     //æ‰‹æŠ“é€Ÿåº¦å½’é›¶
C51 COMPILER V9.54   8023                                                                  09/26/2015 11:12:29 PAGE 35  

2026   1          fun_motors(mot_hz,0);     //æ‰‹æŠ“é€Ÿåº¦å½’é›¶
2027   1          fun_motors(mot_rl,0);     //å·¦å³é€Ÿåº¦å½’é›¶
2028   1      
2029   1          TR0=1;                    //æ‰“å¼€å®šæ—¶å™¨0
2030   1          TR1=1;                    //æ‰“å¼€å®šæ—¶å™¨1
2031   1          in_start=1;               //æŒ‰é”®ç½®1
2032   1          #ifdef Debug              //å¦‚æœå¼€å¯è°ƒè¯•æ¨¡å¼
                      fun_delay(5,del_s);
                      MSG("Ready!")         //è¾“å‡ºReady!
                  #else
2036   1              fun_wait();           //ç­‰å¾…æŒ‰é”®
2037   1          #endif
2038   1      }//åˆå§‹åŒ–å‡½æ•°
2039          void fun_stop(){
2040   1          EA=0;                   //å…³æ€»ä¸­æ–­
2041   1          str_tfl.gospeed=0;      //é€Ÿåº¦å½’é›¶
2042   1          fun_motors(mot_sz,0);   //æ‰‹æŠ“é€Ÿåº¦å½’é›¶
2043   1          fun_motors(mot_py,0);   //å¹³ç§»é€Ÿåº¦å½’é›¶
2044   1          fun_motors(mot_sj,0);   //æ‰‹æŠ“é€Ÿåº¦å½’é›¶
2045   1          fun_motors(mot_hz,0);   //æ‰‹æŠ“é€Ÿåº¦å½’é›¶
2046   1          fun_motors(mot_rl,0);   //å·¦å³é€Ÿåº¦å½’é›¶
2047   1          MSG("End!")             //è¾“å‡ºEnd!
2048   1          while(1);               //æ­»å¾ªç¯
2049   1      }//ç»“æŸå‡½æ•°


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =  11613    ----
   CONSTANT SIZE    =      9    ----
   XDATA SIZE       =    148      90
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5      69
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
