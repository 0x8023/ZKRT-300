C51 COMPILER V9.01   8023                                                                  05/19/2015 17:08:06 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE 8023
OBJECT MODULE PLACED IN .\output\8023.obj
COMPILER INVOKED BY: H:\Program\keil\C51\BIN\C51.EXE program\8023.c DEBUG OBJECTEXTEND PRINT(.\8023.lst) OBJECT(.\output
                    -\8023.obj)

line level    source

   1          #include "./output/8023.h"
   2          xdata struct str_state str_begin,str_now,str_next;//åˆ†åˆ«ä¸º:èµ·å§‹çŠ¶æ€/å½“å‰çŠ¶æ€/ç›®æ ‡çŠ¶æ€
   3          xdata struct str_parameter str_cod={
   4              /*ui str_cod.mlinerqd*/25000,//é»˜è®¤ä¸»å‡½æ•°å·¡çº¿è½¯èµ·åŠ¨è·¯ç¨‹ä¸º25000
   5              /*ui str_cod.mlineqc*/200,   //é»˜è®¤ä¸»å‡½æ•°å·¡çº¿å‰å†²æ—¶é—´ä¸º500æ¯«ç§’
   6          
   7              /*ui str_cod.sj1bzw*/58,     //å‡é™æ ‡å‡†ä½å»¶æ—¶
   8              /*ui str_cod.sj1zjw*/800,    //å‡é™ä¸­é—´ä½å»¶æ—¶
   9          
  10              /*ui str_cod.py1bz*/20,      //fun_py1æ ‡å‡†ä½å»¶æ—¶
  11              /*ui str_cod.py1qkq*/666,    //fun_py1å‰åˆ°é å‰å»¶æ—¶å‚æ•°
  12              /*ui str_cod.py1kqz*/684,    //fun_py1é å‰åˆ°ä¸­é—´å»¶æ—¶
  13              /*ui str_cod.py1zkh*/684,    //fun_py1ä¸­é—´åˆ°é åå»¶æ—¶
  14              /*ui str_cod.py1khh*/666,    //fun_py1é ååˆ°åå»¶æ—¶
  15              /*ui str_cod.py1qz*/500,     //fun_py1å‰åˆ°ä¸­é—´å»¶æ—¶
  16              /*ui str_cod.py1zh*/500,     //fun_py1ä¸­é—´åˆ°åå»¶æ—¶
  17              /*ui str_cod.py1kqkh*/1480,  //fun_py1é å‰åˆ°é åå»¶æ—¶
  18              /*ui str_cod.py1qkh*/2122,   //fun_py1å‰åˆ°é åå»¶æ—¶
  19              /*ui str_cod.py1kqh*/2122,   //fun_py1é å‰åˆ°åå»¶æ—¶
  20          
  21              /*ui str_cod.hz1bz*/20,      //fun_hz1æ ‡å‡†ä½å»¶æ—¶
  22          
  23              /*ui turn90;*/500,           //90åº¦è½¬å¼¯å±è”½å»¶æ—¶
  24              /*ui turn180;*/2000          //180åº¦è½¬å¼¯å±è”½å»¶æ—¶
  25          };
  26          ul var_timer0=0;
  27          void fun_delay(ui par_value,enum varENU_del par_model){
  28   1          ui loc_con=par_value;
  29   1          switch(par_model){
  30   2              case del_us://å¾®ç§’çº§å»¶æ—¶
  31   2                  while(loc_con-->0){
  32   3                      _nop_();
  33   3                      _nop_();
  34   3                  }
  35   2                  return;
  36   2              case del_ms://æ¯«ç§’çº§å»¶æ—¶
  37   2                  while(loc_con-->0){
  38   3                      uc loc_i, loc_j;
  39   3                      _nop_();
  40   3                      _nop_();
  41   3                      loc_i=12;
  42   3                      loc_j=168;
  43   3                      do{
  44   4                          while(--loc_j);
  45   4                      }while(--loc_i);
  46   3                  }
  47   2                  return;
  48   2              case del_s://ç§’çº§å»¶æ—¶
  49   2                  while(loc_con-->0){
  50   3                      uc loc_i, loc_j, loc_k;
  51   3                      loc_i=46;
  52   3                      loc_j=153;
  53   3                      loc_k=245;
  54   3                      do{
C51 COMPILER V9.01   8023                                                                  05/19/2015 17:08:06 PAGE 2   

  55   4                          do{
  56   5                              while(--loc_k);
  57   5                          }while(--loc_j);
  58   4                      }while(--loc_i);
  59   3                  }
  60   2                  return;
  61   2              default:return;
  62   2          }
  63   1      }//å»¶æ—¶
  64          void fun_timer0init(){
  65   1          AUXR|=0x80;       //å®šæ—¶å™¨æ—¶é’Ÿ1Tæ¨¡å¼
  66   1          TMOD&=0xF0;       //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
  67   1          TMOD|=0x01;       //è®¾ç½®å®šæ—¶å™¨æ¨¡å¼
  68   1          TL0=0x20;     //è®¾ç½®å®šæ—¶åˆå€¼
  69   1          TH0=0xD1;     //è®¾ç½®å®šæ—¶åˆå€¼
  70   1          TF0=0;        //æ¸…é™¤TF0æ ‡å¿—
  71   1          ET0=1;
  72   1          EA=1;
  73   1      }//1æ¯«ç§’å®šæ—¶å™¨0åˆå§‹åŒ–
  74          void fun_timer1init(){
  75   1          AUXR&=0xBF;
  76   1          TMOD&=0x0F;
  77   1          TMOD|=0x10;
  78   1          TL1=0xE0;
  79   1          TH1=0xB1;
  80   1          TF1=0;
  81   1          ET1=1;
  82   1          EA=1;
  83   1      }//20æ¯«ç§’å®šæ—¶å™¨1åˆå§‹åŒ–
  84          void fun_timer0(){
  85   1          static uc loc_con=0;
  86   1          TL0=0x20;
  87   1          TH0=0xD1;
  88   1          _nop_();
  89   1          var_timer0++;
  90   1          if(str_tfl.doing==tf_ture)
  91   1              switch(*str_tfl.run){
  92   2                  case def_end:
  93   2                      str_tfl.doing=tf_false;
  94   2                      memset(str_tfl.step,0,sizeof(str_tfl.step));
  95   2                      str_tfl.run=&str_tfl.step;
  96   2                      break;
  97   2                  case tfl_line:
  98   2                      if(*(str_tfl.run+1)){
  99   3                          if((in_ls1||in_ls8)&&(in_ls2&&in_ls3&&in_ls4&&in_ls5&in_ls6&&in_ls7))
 100   3                              str_tfl.online=tf_ture;
 101   3                          else if(str_tfl.online==tf_ture){
 102   4                              str_tfl.online=tf_false;
 103   4                              (*(str_tfl.run+1))--;
 104   4                          }
 105   3                      }
 106   2                      else{
 107   3                          str_tfl.gospeed=0;
 108   3                          fun_motors(mot_rl,0);
 109   3                          str_tfl.run+=2;
 110   3                      }
 111   2                      break;
 112   2                  case tfl_turn:
 113   2                      switch(loc_con){
 114   3                          case 0:
 115   3                              switch(*(str_tfl.run+1)){
 116   4                                  case tur_r90:
C51 COMPILER V9.01   8023                                                                  05/19/2015 17:08:06 PAGE 3   

 117   4                                      fun_motors(mot_l,str_tfl.turnspeed);
 118   4                                      fun_motors(mot_r,-str_tfl.turnspeed);
 119   4                                      str_tfl.delay=var_timer0+str_cod.turn90;
 120   4                                      break;
 121   4                                  case tur_l90:
 122   4                                      fun_motors(mot_l,-str_tfl.turnspeed);
 123   4                                      fun_motors(mot_r,str_tfl.turnspeed);
 124   4                                      str_tfl.delay=var_timer0+str_cod.turn90;
 125   4                                      break;
 126   4                                  case tur_r180:
 127   4                                      fun_motors(mot_l,str_tfl.turnspeed);
 128   4                                      fun_motors(mot_r,-str_tfl.turnspeed);
 129   4                                      str_tfl.delay=var_timer0+str_cod.turn180;
 130   4                                      break;
 131   4                                  case tur_l180:
 132   4                                      fun_motors(mot_l,-str_tfl.turnspeed);
 133   4                                      fun_motors(mot_r,str_tfl.turnspeed);
 134   4                                      str_tfl.delay=var_timer0+str_cod.turn180;
 135   4                                      break;
 136   4                              }
 137   3                              loc_con++;
 138   3                              break;
 139   3                          case 1:
 140   3                              if(str_tfl.delay<=var_timer0)
 141   3                                  loc_con++;
 142   3                              break;
 143   3                          case 2:
 144   3                              if(in_ls4&&in_ls5){
 145   4                                  fun_motors(mot_rl,0);
 146   4                                  str_tfl.run+=2;
 147   4                                  loc_con=0;
 148   4                              }
 149   3                              break;
 150   3                      }
 151   2                      break;
 152   2                  case tfl_cache:
 153   2                      ;
 154   2              }
 155   1      }//1æ¯«ç§’å®šæ—¶å™¨0å¤„ç†å‡½æ•°
 156          void fun_timer1(){
 157   1          TL1=0xE0;
 158   1          TH1=0xB1;
 159   1          _nop_();
 160   1      
 161   1          if(str_tfl.online==tf_false){
 162   2              fun_dtjp();
 163   2          }
 164   1      
 165   1      }//20æ¯«ç§’å®šæ—¶å™¨1å¤„ç†å‡½æ•°
 166          void fun_wait(){
 167   1          while(in_start==1);
 168   1          fun_delay(20,del_ms);
 169   1          while(in_start==0);
 170   1          fun_delay(256,del_ms);
 171   1      }//ç­‰å¾…æŒ‰é”®
 172          void fun_initialization(){
 173   1          CLK_DIV=0x00;//ä¸åˆ†é¢‘
 174   1      
 175   1          P0M1=0xff;//P0ç”¨äºè¾“å…¥
 176   1          P0M0=0x00;//P0ä¸èƒ½è¾“å‡º
 177   1          
 178   1          P1M1=0x00;//P1å£0-1åŒå‘ï¼Œ2ä¸­æ–­è¾“å…¥ï¼Œ3-6è¾“å…¥ï¼Œ7è¾“å‡º
C51 COMPILER V9.01   8023                                                                  05/19/2015 17:08:06 PAGE 4   

 179   1          P1M0=0xfc;//P1å£2-7è¾“å‡º
 180   1      
 181   1          P2M1=0xf0;//P2å£4-7è¾“å…¥
 182   1          P2M0=0x0f;//P2å£0-3è¾“å‡º
 183   1      
 184   1          //PS_2=1;//æ‰‹æŠ“æ¾ä¼ æ„Ÿå™¨ç½®1 $?$
 185   1          //PS_11=1;//å‡é™ä½ç½®3ä¼ æ„Ÿå™¨ç½®1 $?$
 186   1      
 187   1          out_en1=1;//ç”µæœº1/3ä½¿èƒ½ $?$
 188   1          out_en2=1;//ç”µæœº2/4ä½¿èƒ½ $?$
 189   1          //out_motorselect=1;//ç”µæœºç‰‡é€‰ä¸º1 $?$
 190   1          //fun_delay(del_ms,1);//å»¶æ—¶1æ¯«ç§’ $?$
 191   1          out_motorselect=0;//ç”µæœºç‰‡é€‰ä¸º0 $?$
 192   1          //PS_5=PS_1;// $?$
 193   1      
 194   1          fun_pwminit();//PWMçš„åˆå§‹åŒ–è®¾ç½®
 195   1          fun_timer0init();//åˆå§‹åŒ–å®šæ—¶å™¨0
 196   1          fun_timer1init();//åˆå§‹åŒ–å®šæ—¶å™¨1
 197   1          fun_port();//åˆå§‹åŒ–ä¸²å£
 198   1          in_start=1;//æŒ‰é”®ç½®1
 199   1      
 200   1          fun_wait();
 201   1      }//åˆå§‹åŒ–
 202          void fun_pwminit(){
 203   1          CCON=0x00;//PACå¯„å­˜æ§åˆ¶å™¨
 204   1          CH=0;//é‡ç½®PACè®¡æ—¶å™¨
 205   1          CL=0;
 206   1          CMOD=0x08;//ä¸åˆ†é¢‘
 207   1      }//PWMåˆå§‹åŒ–
 208          void fun_pwmr(uc par_value){
 209   1          CCAP0H=CCAP0L=par_value*2.55;//æ§åˆ¶è¾“å‡ºçš„å ç©ºæ¯”
 210   1          CCAPM0=0X42;//8ä½PWMè¾“å‡ºï¼Œæ— ä¸­æ–­
 211   1          PCA_PWM0=0x00;
 212   1      }//å³è·¯PWMè¾“å‡º
 213          void fun_pwml(uc par_value){
 214   1          CCAP1H=CCAP1L=par_value*2.55;//æ§åˆ¶è¾“å‡ºçš„å ç©ºæ¯”
 215   1          CCAPM1=0X42;//8ä½PWMè¾“å‡ºï¼Œæ— ä¸­æ–­
 216   1          PCA_PWM1=0x00;
 217   1      }//å·¦è·¯PWMè¾“å‡º
 218          void fun_motors(enum varENU_mot par_model,char par_speed){
 219   1          if(par_speed>100)
 220   1              par_speed=100;
 221   1          else if(par_speed<-100)
 222   1              par_speed=-100;
 223   1          switch(par_model){
 224   2              case mot_l://å·¦è½®ç”µæœº
 225   2                  if(str_begin.leftsd==par_model)
 226   2                      return;
 227   2                  else
 228   2                      str_begin.leftsd=par_model;
 229   2                  if(par_speed==0){
 230   3                      fun_pwml(0);out_pwml=0;
 231   3                  }
 232   2                  else if(par_speed>0){
 233   3                      CR=1;fun_pwml(par_speed);out_pwml=0;
 234   3                  }
 235   2                  else if(par_speed<0){
 236   3                      CR=1;fun_pwml(cabs(par_speed));out_pwml=1;
 237   3                  }
 238   2                  break;
 239   2              case mot_r://å³è½®ç”µæœº
 240   2                  if(str_begin.rightsd==par_model)
C51 COMPILER V9.01   8023                                                                  05/19/2015 17:08:06 PAGE 5   

 241   2                      return;
 242   2                  else
 243   2                      str_begin.rightsd=par_model;
 244   2                  if(par_speed==0){
 245   3                      fun_pwmr(0);out_pwmr=0;
 246   3                  }
 247   2                  else if(par_speed>0){
 248   3                      CR=1;fun_pwmr(par_speed);out_pwmr=0;
 249   3                  }
 250   2                  else if(par_speed<0){
 251   3                      CR=1;fun_pwmr(cabs(par_speed));out_pwmr=1;
 252   3                  }
 253   2                  break;
 254   2              case mot_rl://å·¦å³è½®åŒæ­¥
 255   2                  if((str_begin.leftsd==par_model)&&(str_begin.rightsd==par_model))
 256   2                      return;
 257   2                  else
 258   2                      str_begin.leftsd=str_begin.rightsd=par_model;
 259   2                  if(par_speed==0){
 260   3                      CR=0;
 261   3                      fun_pwmr(0);out_pwmr=0;
 262   3                      fun_pwml(0);out_pwml=0;
 263   3                  }
 264   2                  else if(par_speed>0){
 265   3                      CR=1;
 266   3                      fun_pwml(par_speed);out_pwml=0;
 267   3                      fun_pwmr(par_speed);out_pwmr=0;
 268   3                  }
 269   2                  else if(par_speed<0){
 270   3                      CR=1;
 271   3                      fun_pwml(cabs(par_speed));out_pwml=1;
 272   3                      fun_pwmr(cabs(par_speed));out_pwmr=1;
 273   3                  }
 274   2                  break;
 275   2              case mot_szdj://æ­£è½¬ä¸ºæŠ“ç´§ï¼Œåè½¬ä¸ºæ¾å¼€
 276   2                  if(str_begin.szsd==par_model)
 277   2                      return;
 278   2                  else
 279   2                      str_begin.szsd=par_model;
 280   2                  if(par_speed==0){
 281   3                      out_motorselect=1;out_dir1=0;out_en1=1;
 282   3                  }
 283   2                  else if(par_speed>0){
 284   3                      out_motorselect=1;out_dir1=1;out_en1=0;
 285   3                  }
 286   2                  else if(par_speed<0){
 287   3                      out_motorselect=1;out_dir1=0;out_en1=0;
 288   3                  }
 289   2                  break;
 290   2              case mot_pydj://æ­£è½¬æ˜¯å‘æ— ç”µæœºä¸€æ–¹è½¬,åè½¬ä¸ºå‘æœ‰ç”µæœºä¸€æ–¹è½¬
 291   2                  if(str_begin.pysd==par_model)
 292   2                      return;
 293   2                  else
 294   2                      str_begin.pysd=par_model;
 295   2                  if(par_speed==0){
 296   3                      out_motorselect=1;out_dir2=0;out_en2=1;
 297   3                  }
 298   2                  else if(par_speed>0){
 299   3                      out_motorselect=1;out_dir2=1;out_en2=0;
 300   3                  }
 301   2                  else if(par_speed<0){
 302   3                      out_motorselect=1;out_dir2=0;out_en2=0;
C51 COMPILER V9.01   8023                                                                  05/19/2015 17:08:06 PAGE 6   

 303   3                  }
 304   2                  break;
 305   2              case mot_sjdj://å‘ä¸Šä¸ºæ­£è½¬,å‘ä¸‹ä¸ºåè½¬
 306   2                  if(str_begin.sjsd==par_model)
 307   2                      return;
 308   2                  else
 309   2                      str_begin.sjsd=par_model;
 310   2                  if(par_speed==0){
 311   3                      out_motorselect=0;out_dir1=0;out_en1=1;
 312   3                  }
 313   2                  else if(par_speed>0){
 314   3                      out_motorselect=0;out_dir1=0;out_en1=0;
 315   3                  }
 316   2                  else if(par_speed<0){
 317   3                      out_motorselect=0;out_dir1=1;out_en1=0;
 318   3                  }
 319   2                  break;
 320   2              case mot_hzdj://é¡ºæ—¶é’ˆä¸ºæ­£è½¬,é€†æ—¶é’ˆä¸ºåè½¬
 321   2                  if(str_begin.hzsd==par_model)
 322   2                      return;
 323   2                  else
 324   2                      str_begin.hzsd=par_model;
 325   2                  if(par_speed==0){
 326   3                      out_motorselect=0;out_dir2=0;out_en2=1;
 327   3                  }
 328   2                  else if(par_speed>0){
 329   3                      out_motorselect=0;out_dir2=0;out_en2=0;
 330   3                  }
 331   2                  else if(par_speed<0){
 332   3                      out_motorselect=0;out_dir2=1;out_en2=0;
 333   3                  }
 334   2                  break;
 335   2              default:
 336   2                  break;
 337   2          }
 338   1      }//æ“ä½œç”µæœº
 339          void fun_sz1(enum varENU_han par_model){
 340   1          if(str_begin.szzt==par_model)
 341   1              return;
 342   1          if(par_model==han_s){//æ‰‹æŠ“æ¾
 343   2              fun_motors(mot_szdj,-100);
 344   2              while(in_s==1);
 345   2          }
 346   1          else{//æ‰‹æŠ“ç´§
 347   2              fun_motors(mot_szdj,100);
 348   2              while(in_j==1);
 349   2          }
 350   1          fun_delay(20,del_ms);
 351   1          fun_motors(mot_szdj,0);
 352   1          str_begin.szzt=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 353   1      }//æ‰‹æŠ“å•æ­¥è¿åŠ¨
 354          void fun_sj1(enum varENU_sjp par_model){
 355   1          if(str_begin.sjwz==par_model)
 356   1             return;
 357   1          switch(par_model){
 358   2              case sjp_wz1://å‡é™ä½ç½®1(æœ€ä¸Šä½)
 359   2                  fun_motors(mot_sjdj,100);
 360   2                  def_select(sel_58);
 361   2                  while(in_wz1==1);
 362   2                  fun_delay(str_cod.sj1bzw,del_ms);
 363   2                  break;
 364   2              case sjp_wz12:
C51 COMPILER V9.01   8023                                                                  05/19/2015 17:08:06 PAGE 7   

 365   2                  if(par_model>str_begin.sjwz){
 366   3                      fun_motors(mot_sjdj,-100);
 367   3                      fun_delay(str_cod.sj1zjw,del_ms);
 368   3                  }
 369   2                  else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 370   3                      fun_sj1(sjp_wz2);
 371   3                      fun_motors(mot_sjdj,100);
 372   3                      fun_delay(str_cod.sj1zjw,del_ms);
 373   3                  }
 374   2                  break;
 375   2              case sjp_wz2://å‡é™ä½ç½®2
 376   2                  fun_motors(mot_sjdj,par_model<str_begin.sjwz?100:-100);
 377   2                  def_select(sel_58);
 378   2                  while(in_wz2==1);
 379   2                  fun_delay(str_cod.sj1bzw,del_ms);
 380   2                  break;
 381   2              case sjp_wz23:
 382   2                  if(par_model>str_begin.sjwz){
 383   3                      fun_sj1(sjp_wz2);
 384   3                      fun_motors(mot_sjdj,-100);
 385   3                      fun_delay(str_cod.sj1zjw,del_ms);
 386   3                  }
 387   2                  else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 388   3                      fun_sj1(sjp_wz3);
 389   3                      fun_motors(mot_sjdj,100);
 390   3                      fun_delay(str_cod.sj1zjw,del_ms);
 391   3                  }
 392   2                  break;
 393   2              case sjp_wz3://å‡é™ä½ç½®3
 394   2                  fun_motors(mot_sjdj,par_model<str_begin.sjwz?100:-100);
 395   2                  def_select(sel_58);
 396   2                  while(in_wz3==1);
 397   2                  fun_delay(str_cod.sj1bzw,del_ms);
 398   2                  break;
 399   2              case sjp_wz34:
 400   2                  if(par_model>str_begin.sjwz){
 401   3                      fun_sj1(sjp_wz3);
 402   3                      fun_motors(mot_sjdj,-100);
 403   3                      fun_delay(str_cod.sj1zjw,del_ms);
 404   3                  }
 405   2                  else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 406   3                      fun_sj1(sjp_wz4);
 407   3                      fun_motors(mot_sjdj,100);
 408   3                      fun_delay(str_cod.sj1zjw,del_ms);
 409   3                  }
 410   2                  break;
 411   2              case sjp_wz4://å‡é™ä½ç½®4
 412   2                  fun_motors(mot_sjdj,par_model<str_begin.sjwz?100:-100);
 413   2                  def_select(sel_58);
 414   2                  while(in_wz4==1);
 415   2                  fun_delay(str_cod.sj1bzw,del_ms);
 416   2                  break;
 417   2              case sjp_wz45:
 418   2                  if(par_model>str_begin.sjwz){
 419   3                      fun_sj1(sjp_wz4);
 420   3                      fun_motors(mot_sjdj,-100);
 421   3                      fun_delay(str_cod.sj1zjw,del_ms);
 422   3                  }
 423   2                  else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 424   3                      fun_motors(mot_sjdj,100);
 425   3                      fun_delay(str_cod.sj1zjw,del_ms);
 426   3                  }
C51 COMPILER V9.01   8023                                                                  05/19/2015 17:08:06 PAGE 8   

 427   2                  break;
 428   2              case sjp_wz5://å‡é™ä½ç½®5
 429   2                  fun_motors(mot_sjdj,-100);
 430   2                  def_select(sel_912);
 431   2                  while(in_wz5==1);
 432   2                  fun_delay(str_cod.sj1bzw,del_ms);
 433   2                  break;
 434   2              default:
 435   2                  break;
 436   2          }
 437   1          fun_motors(mot_sjdj,0);
 438   1          str_begin.sjwz=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 439   1      }//å‡é™å•æ­¥è¿åŠ¨
 440          void fun_py1(enum varENU_tra par_model){
 441   1          if(str_begin.pywz==par_model)
 442   1              return;
 443   1          switch(par_model){
 444   2              case tra_q://å‰å¹³ç§»(æ²¡æœ‰ç”µæœºçš„å‘¢ä¸ªæ–¹å‘)
 445   2                  fun_motors(mot_pydj,100);
 446   2                  while(in_qpy==1);
 447   2                  fun_delay(str_cod.py1bz,del_ms);
 448   2                  break;
 449   2              case tra_kq:
 450   2                  switch(str_begin.pywz){
 451   3                      case tra_q:
 452   3                          fun_motors(mot_pydj,-100);
 453   3                          fun_delay(str_cod.py1qkq,del_ms);
 454   3                          break;
 455   3                      case tra_z:
 456   3                          fun_motors(mot_pydj,100);
 457   3                          fun_delay(str_cod.py1kqz,del_ms);
 458   3                          break;
 459   3                      case tra_kh:
 460   3                          fun_motors(mot_pydj,100);
 461   3                          fun_delay(str_cod.py1kqkh,del_ms);
 462   3                          break;
 463   3                      case tra_h:
 464   3                          fun_motors(mot_pydj,100);
 465   3                          fun_delay(str_cod.py1kqh,del_ms);
 466   3                          break;
 467   3                  }
 468   2                  break;
 469   2              case tra_z:
 470   2                  switch(str_begin.pywz){
 471   3                      case tra_q:
 472   3                          fun_motors(mot_pydj,-100);
 473   3                          fun_delay(str_cod.py1qz,del_ms);
 474   3                          break;
 475   3                      case tra_kq:
 476   3                          fun_motors(mot_pydj,-100);
 477   3                          fun_delay(str_cod.py1kqz,del_ms);
 478   3                          break;
 479   3                      case tra_kh:
 480   3                          fun_motors(mot_pydj,100);
 481   3                          fun_delay(str_cod.py1zkh,del_ms);
 482   3                          break;
 483   3                      case tra_h:
 484   3                          fun_motors(mot_pydj,100);
 485   3                          fun_delay(str_cod.py1zh,del_ms);
 486   3                          break;
 487   3                  }
 488   2                  break;
C51 COMPILER V9.01   8023                                                                  05/19/2015 17:08:06 PAGE 9   

 489   2              case tra_kh:
 490   2                  switch(str_begin.pywz){
 491   3                      case tra_q:
 492   3                          fun_motors(mot_pydj,-100);
 493   3                          fun_delay(str_cod.py1qkh,del_ms);
 494   3                          break;
 495   3                      case tra_kq:
 496   3                          fun_motors(mot_pydj,-100);
 497   3                          fun_delay(str_cod.py1kqkh,del_ms);
 498   3                          break;
 499   3                      case tra_z:
 500   3                          fun_motors(mot_pydj,-100);
 501   3                          fun_delay(str_cod.py1zkh,del_ms);
 502   3                          break;
 503   3                      case tra_h:
 504   3                          fun_motors(mot_pydj,100);
 505   3                          fun_delay(str_cod.py1khh,del_ms);
 506   3                          break;
 507   3                  }
 508   2                  break;
 509   2              case tra_h://åå¹³ç§»(æœ‰ç”µæœºçš„å‘¢ä¸ªæ–¹å‘)
 510   2                  fun_motors(mot_pydj,-100);
 511   2                  while(in_hpy==1);
 512   2                  fun_delay(str_cod.py1bz,del_ms);
 513   2                  break;
 514   2              default:
 515   2                  break;
 516   2          }
 517   1          fun_motors(mot_pydj,0);
 518   1          str_begin.pywz=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 519   1      }//å¹³ç§»å•æ­¥è¿åŠ¨
 520          void fun_hz1(enum varENU_dir par_model){
 521   1          if(str_begin.hzfx==par_model)
 522   1              return;
 523   1          def_select(sel_912);
 524   1          switch(par_model){
 525   2              case dir_up://å›è½¬è‡³å‰æ–¹
 526   2                  switch(str_begin.hzfx){
 527   3                      case dir_down://ç°åœ¨åœ¨ä¸‹æ–¹
 528   3                          fun_motors(mot_hzdj,-100);
 529   3                          fun_delay(1,del_s);
 530   3                          while(in_hz==1);
 531   3                          while(in_hz==0);
 532   3                          while(in_hz==1);
 533   3                          fun_delay(str_cod.hz1bz,del_ms);
 534   3                          break;
 535   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 536   3                          fun_motors(mot_hzdj,100);
 537   3                          fun_delay(1,del_s);
 538   3                          while(in_hz==1);
 539   3                          fun_delay(str_cod.hz1bz,del_ms);
 540   3                          break;
 541   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 542   3                          fun_motors(mot_hzdj,-100);
 543   3                          fun_delay(1,del_s);
 544   3                          while(in_hz==1);
 545   3                          fun_delay(str_cod.hz1bz,del_ms);
 546   3                          break;
 547   3                      default:
 548   3                          break;
 549   3                  }
 550   2                  break;
C51 COMPILER V9.01   8023                                                                  05/19/2015 17:08:06 PAGE 10  

 551   2              case dir_down://è¦å»ä¸‹é¢
 552   2                  switch(str_begin.hzfx){
 553   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 554   3                          fun_motors(mot_hzdj,100);
 555   3                          fun_delay(1,del_s);
 556   3                          while(in_hz==1);
 557   3                          while(in_hz==0);
 558   3                          while(in_hz==1);
 559   3                          fun_delay(str_cod.hz1bz,del_ms);
 560   3                          break;
 561   3                      case dir_left://ç°åœ¨åœ¨å·¦é¢
 562   3                          fun_motors(mot_hzdj,-100);
 563   3                          fun_delay(1,del_s);
 564   3                          while(in_hz==1);
 565   3                          fun_delay(str_cod.hz1bz,del_ms);
 566   3                          break;
 567   3                          break;
 568   3                      case dir_right://ç°åœ¨åœ¨å³é¢
 569   3                          fun_motors(mot_hzdj,100);
 570   3                          fun_delay(1,del_s);
 571   3                          while(in_hz==1);
 572   3                          fun_delay(str_cod.hz1bz,del_ms);
 573   3                          break;
 574   3                      default:
 575   3                          break;
 576   3                  }
 577   2                  break;
 578   2              case dir_left://è¦å»å·¦è¾¹
 579   2                  switch(str_begin.hzfx){
 580   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 581   3                          fun_motors(mot_hzdj,-100);
 582   3                          fun_delay(1,del_s);
 583   3                          while(in_hz==1);
 584   3                          fun_delay(str_cod.hz1bz,del_ms);
 585   3                          break;
 586   3                          break;
 587   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 588   3                          fun_motors(mot_hzdj,100);
 589   3                          fun_delay(1,del_s);
 590   3                          while(in_hz==1);
 591   3                          fun_delay(str_cod.hz1bz,del_ms);
 592   3                          break;
 593   3                          break;
 594   3                      case dir_right://ç°åœ¨åœ¨å³é¢
 595   3                          fun_motors(mot_hzdj,-100);
 596   3                          fun_delay(1,del_s);
 597   3                          while(in_hz==1);
 598   3                          while(in_hz==0);
 599   3                          while(in_hz==1);
 600   3                          fun_delay(str_cod.hz1bz,del_ms);
 601   3                          break;
 602   3                      default:
 603   3                          break;
 604   3                  }
 605   2                  break;
 606   2              case dir_right://è¦å»å³é¢
 607   2                  switch(str_begin.hzfx){
 608   3                      case dir_up://ç°åœ¨åœ¨å‰é¢
 609   3                          fun_motors(mot_hzdj,100);
 610   3                          fun_delay(1,del_s);
 611   3                          while(in_hz==1);
 612   3                          fun_delay(str_cod.hz1bz,del_ms);
C51 COMPILER V9.01   8023                                                                  05/19/2015 17:08:06 PAGE 11  

 613   3                          break;
 614   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 615   3                          fun_motors(mot_hzdj,-100);
 616   3                          fun_delay(1,del_s);
 617   3                          while(in_hz==1);
 618   3                          fun_delay(str_cod.hz1bz,del_ms);
 619   3                          break;
 620   3                      case dir_left://ç°åœ¨åœ¨å·¦é¢
 621   3                          fun_motors(mot_hzdj,100);
 622   3                          fun_delay(1,del_s);
 623   3                          while(in_hz==1);
 624   3                          while(in_hz==0);
 625   3                          while(in_hz==1);
 626   3                          fun_delay(str_cod.hz1bz,del_ms);
 627   3                          break;
 628   3                      default:
 629   3                          break;
 630   3                  }
 631   2                  break;
 632   2              default:
 633   2                  break;
 634   2          }
 635   1          fun_motors(mot_hzdj,0);
 636   1          str_begin.hzfx=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 637   1      }//å›è½¬å•æ­¥è¿åŠ¨
 638          void fun_dtjp(){
 639   1          uc loc_sdl=str_tfl.gospeed,loc_sdr=str_tfl.gospeed;
 640   1          if(in_ls1&&!in_ls8){
 641   2              loc_sdl*=0.5;
 642   2              loc_sdr*=1.5;
 643   2          }
 644   1          if(in_ls8&&!in_ls1){
 645   2              loc_sdl*=1.5;
 646   2              loc_sdr*=0.5;
 647   2          }
 648   1          if(in_ls2&&!in_ls7){
 649   2              loc_sdl*=0.7;
 650   2              loc_sdr*=1.3;
 651   2          }
 652   1          if(in_ls7&&!in_ls2){
 653   2              loc_sdl*=1.3;
 654   2              loc_sdr*=0.7;
 655   2          }
 656   1          if(in_ls3&&!in_ls6){
 657   2              loc_sdl*=0.9;
 658   2              loc_sdr*=1.1;
 659   2          }
 660   1          if(in_ls6&&!in_ls3){
 661   2              loc_sdl*=1.1;
 662   2              loc_sdr*=0.9;
 663   2          }
 664   1          fun_motors(mot_r,loc_sdl);
 665   1          fun_motors(mot_l,loc_sdr);
 666   1      }//åŠ¨æ€çº å
 667          void fun_jtjp(){
 668   1          while(1){
 669   2              if((!in_ls1&&!in_ls2&&in_ls4&&in_ls5&&!in_ls7&&!in_ls8)&&((in_ls3&&in_ls6)||(!in_ls3&&!in_ls6))){
 670   3                  fun_delay(10,del_ms);
 671   3                  fun_motors(mot_rl,0);
 672   3                  return;
 673   3              }
 674   2              if(in_ls2||in_ls1){
C51 COMPILER V9.01   8023                                                                  05/19/2015 17:08:06 PAGE 12  

 675   3                  fun_motors(mot_l,16);
 676   3                  fun_motors(mot_r,-16);
 677   3              }
 678   2              else if(in_ls7||in_ls8){
 679   3                  fun_motors(mot_l,-16);
 680   3                  fun_motors(mot_r,16);
 681   3              }
 682   2              else{
 683   3                  if(!in_ls4){
 684   4                      fun_motors(mot_l,-12);
 685   4                      fun_motors(mot_r,12);
 686   4                  }
 687   3                  else if(!in_ls5){
 688   4                      fun_motors(mot_l,12);
 689   4                      fun_motors(mot_r,-12);
 690   4                  }
 691   3                  else{
 692   4                      if(in_ls6&&!in_ls3){
 693   5                          fun_motors(mot_l,-8);
 694   5                          fun_motors(mot_r,8);
 695   5                      }
 696   4                      if(in_ls3&&!in_ls6){
 697   5                          fun_motors(mot_l,8);
 698   5                          fun_motors(mot_r,-8);
 699   5                      }
 700   4                  }
 701   3              }
 702   2          }
 703   1      }//é™æ€çº å
 704          void fun_stope2prom(){
 705   1          IAP_CONTR = 0;                  //å…³é—­IAPåŠŸèƒ½
 706   1          IAP_CMD = 0;                    //æ¸…é™¤å‘½ä»¤
 707   1          IAP_TRIG = 0;                   //æ¸…é™¤è§¦å‘å¯„å­˜å™¨
 708   1          IAP_ADDRH = 0x80;               //æ•°æ®æŒ‡é’ˆæŒ‡å‘éEEPROMåŒº
 709   1          IAP_ADDRL = 0;                  //æ¸…é™¤IAPåœ°å€
 710   1      }//å…³é—­EEPROMåŠŸèƒ½(IapIdle)
 711          uc fun_reade2prom(ui par_add){
 712   1          uc loc_dat;                     //æ•°æ®ç¼“å†²åŒº
 713   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
 714   1          IAP_CMD = 1;                    //è®¾ç½®EEPROMè¯»å‘½ä»¤
 715   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
 716   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
 717   1          IAP_TRIG = 0x5a;                //è§¦å‘
 718   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
 719   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
 720   1          loc_dat = IAP_DATA;             //è¯»å‡ºEEPROMä¸­çš„æ•°æ®
 721   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
 722   1          return loc_dat;                 //è¿”å›è¯»å–ç»“æœ
 723   1      }//è¯»å–EEPROMæ•°æ®
 724          void fun_writee2prom(ui par_add,uc par_dat){
 725   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
 726   1          IAP_CMD = 2;                    //è®¾ç½®EEPROMå†™å…¥å‘½ä»¤
 727   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
 728   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
 729   1          IAP_DATA = par_dat;             //å†™å…¥æ•°æ®
 730   1          IAP_TRIG = 0x5a;                //è§¦å‘
 731   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
 732   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
 733   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
 734   1      }//å†™EEPROMæ•°æ®
 735          void fun_cleane2prom(ui par_add){
 736   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
C51 COMPILER V9.01   8023                                                                  05/19/2015 17:08:06 PAGE 13  

 737   1          IAP_CMD = 3;                    //è®¾ç½®EEPROMæ“¦é™¤å‘½ä»¤
 738   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
 739   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
 740   1          IAP_TRIG = 0x5a;                //è§¦å‘
 741   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
 742   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
 743   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
 744   1      }//æ¸…é™¤EEPROMæ•°æ®
 745          void fun_calibration(){
 746   1          // fun_sj1(sjp_wz1);//å‡åˆ°æœ€ä¸Šä½
 747   1          ul loc_time;
 748   1          fun_py1(tra_q);//ç§»åŠ¨åˆ°æœ€å‰ç«¯
 749   1          fun_py1(tra_h);//ç§»åŠ¨åˆ°æœ€åç«¯
 750   1          loc_time=var_timer0;
 751   1          fun_py1(tra_q);//ç§»åŠ¨åˆ°å‰ç«¯å¹¶è®¡æ—¶
 752   1          fun_py1(tra_h);//ç§»åŠ¨åˆ°åç«¯
 753   1          loc_time=var_timer0-loc_time;
 754   1          loc_time*=0.39;
 755   1          str_cod.py1zh=str_cod.py1qz=loc_time*0.5;
 756   1          str_cod.py1qkh=str_cod.py1kqh=loc_time*0.75;
 757   1          str_cod.py1qkq=str_cod.py1khh=loc_time*0.25;
 758   1          str_cod.py1kqz=str_cod.py1zkh=loc_time*0.25;
 759   1          str_cod.py1kqkh=loc_time*0.5;
 760   1      }//è‡ªåŠ¨æ ¡å‡†å¹³ç§»å‚æ•°
 761          void fun_port(){
 762   1          PCON|=0x80;     //ä½¿èƒ½æ³¢ç‰¹ç‡å€é€Ÿä½SMOD
 763   1          SCON=0x50;      //8ä½æ•°æ®,å¯å˜æ³¢ç‰¹ç‡
 764   1          AUXR|=0x04;     //ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨æ—¶é’Ÿä¸ºFosc,å³1T
 765   1          BRT=0xD9;       //è®¾å®šç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨é‡è£…å€¼
 766   1          AUXR|=0x01;     //ä¸²å£1é€‰æ‹©ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨ä¸ºæ³¢ç‰¹ç‡å‘ç”Ÿå™¨
 767   1          AUXR|=0x10;     //å¯åŠ¨ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨
 768   1          TI=1;           //æ‰“å¼€ä¸²å£ä¼ è¾“åŠŸèƒ½
 769   1      }//ä¸²å£åˆå§‹åŒ–
 770          void fun_test(){
 771   1          fun_sz1(han_j);
 772   1          fun_delay(1,del_s);
 773   1          fun_sz1(han_s);
 774   1          fun_delay(1,del_s);
 775   1          fun_sz1(han_j);
 776   1          fun_delay(1,del_s);
 777   1          fun_sz1(han_s);
 778   1          fun_delay(1,del_s);
 779   1      
 780   1          str_begin.pywz=tra_h;
 781   1          fun_py1(tra_q);
 782   1          fun_delay(1,del_s);
 783   1          fun_py1(tra_h);
 784   1          fun_delay(1,del_s);
 785   1          fun_py1(tra_q);
 786   1          fun_delay(1,del_s);
 787   1          fun_py1(tra_h);
 788   1          fun_delay(1,del_s);
 789   1      
 790   1          fun_sj1(sjp_wz1);
 791   1          fun_delay(1,del_s);
 792   1          fun_sj1(sjp_wz2);
 793   1          fun_delay(1,del_s);
 794   1          fun_sj1(sjp_wz3);
 795   1          fun_delay(1,del_s);
 796   1          fun_sj1(sjp_wz4);
 797   1          fun_delay(1,del_s);
 798   1          fun_sj1(sjp_wz5);
C51 COMPILER V9.01   8023                                                                  05/19/2015 17:08:06 PAGE 14  

 799   1          fun_delay(1,del_s);
 800   1          fun_sj1(sjp_wz4);
 801   1          fun_delay(1,del_s);
 802   1          fun_sj1(sjp_wz3);
 803   1          fun_delay(1,del_s);
 804   1          fun_sj1(sjp_wz2);
 805   1          fun_delay(1,del_s);
 806   1          fun_sj1(sjp_wz1);
 807   1      
 808   1          str_now.hzfx=str_begin.hzfx;
 809   1          str_begin.hzfx=dir_up;
 810   1          fun_hz1(dir_right);
 811   1          fun_delay(1,del_s);
 812   1          fun_hz1(dir_up);
 813   1          fun_delay(1,del_s);
 814   1          fun_hz1(dir_right);
 815   1          fun_delay(1,del_s);
 816   1          fun_hz1(dir_up);
 817   1          fun_delay(1,del_s);
 818   1          str_begin.hzfx=str_now.hzfx;
 819   1      
 820   1          fun_motors(mot_rl,60);
 821   1          fun_delay(1,del_s);
 822   1          fun_motors(mot_rl,0);
 823   1          fun_delay(1,del_s);
 824   1      
 825   1          fun_motors(mot_rl,-60);
 826   1          fun_delay(1,del_s);
 827   1          fun_motors(mot_rl,0);
 828   1          fun_delay(1,del_s);
 829   1      
 830   1          fun_motors(mot_r,40);
 831   1          fun_motors(mot_l,-40);
 832   1          fun_delay(1,del_s);
 833   1          fun_motors(mot_rl,0);
 834   1          fun_delay(1,del_s);
 835   1      
 836   1          fun_motors(mot_r,-40);
 837   1          fun_motors(mot_l,40);
 838   1          fun_delay(1,del_s);
 839   1          fun_motors(mot_rl,0);
 840   1      }//æµ‹è¯•ç¨‹åº
 841          uc fun_min(uc par_num,...){
 842   1          va_list loc_argp;//ä¿å­˜å‚æ•°ç»“æ„
 843   1          uc loc_min=par_num;//ç°åœ¨çš„æœ€å°å€¼å°±æ˜¯ç¬¬ä¸€ä¸ª
 844   1          uc loc_shu;//å½“å‰å‚æ•°
 845   1          va_start(loc_argp,par_num);//loc_argpæŒ‡å‘ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œpar_numæ˜¯æœ€åä¸€ä¸ªç¡®å
             -®šçš„å‚æ•°
 846   1          loc_shu=va_arg(loc_argp,uc);//å–å‡ºä¸‹ä¸€ä¸ªå‚æ•°
 847   1          do{
 848   2              if(loc_shu<loc_min)
 849   2                  loc_min=loc_shu;
 850   2              loc_shu=va_arg(loc_argp,uc);//å–å‡ºä¸‹ä¸€ä¸ªå‚æ•°
 851   2          }while(loc_shu!=def_end);
 852   1          va_end(loc_argp);//ç»“æŸ
 853   1          return loc_min;//é€€å‡º
 854   1      }//æ±‚æœ€å°å€¼


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   3422    ----
   CONSTANT SIZE    =   ----    ----
C51 COMPILER V9.01   8023                                                                  05/19/2015 17:08:06 PAGE 15  

   XDATA SIZE       =     72    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5      34
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
