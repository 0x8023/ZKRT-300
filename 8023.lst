C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE 8023
OBJECT MODULE PLACED IN .\output\8023.obj
COMPILER INVOKED BY: D:\MyProgram\keil\C51\BIN\C51.EXE program\8023.c OPTIMIZE(8,SPEED) DEBUG OBJECTEXTEND PRINT(.\8023.
                    -lst) OBJECT(.\output\8023.obj)

line level    source

   1          #include "./output/8023.h"
   2          xdata struct str_state str_begin,str_now,str_next;//åˆ†åˆ«ä¸º:èµ·å§‹çŠ¶æ€/å½“å‰çŠ¶æ€/ç›®æ ‡çŠ¶æ€
   3          xdata struct str_parameter str_cod={
   4              /*ui str_cod.mlinerqd*/25000,//é»˜è®¤ä¸»å‡½æ•°å·¡çº¿è½¯èµ·åŠ¨è·¯ç¨‹ä¸º25000
   5              /*ui str_cod.mlineqc*/200,   //é»˜è®¤ä¸»å‡½æ•°å·¡çº¿å‰å†²æ—¶é—´ä¸º500æ¯«ç§’
   6          
   7              /*ui str_cod.sj1bzw*/58,     //å‡é™æ ‡å‡†ä½å»¶æ—¶
   8              /*ui str_cod.sj1zjw*/800,    //å‡é™ä¸­é—´ä½å»¶æ—¶
   9          
  10              /*ui str_cod.py1bz*/20,      //fun_py1æ ‡å‡†ä½å»¶æ—¶
  11              /*ui str_cod.py1qkq*/666,    //fun_py1å‰åˆ°é å‰å»¶æ—¶å‚æ•°
  12              /*ui str_cod.py1kqz*/684,    //fun_py1é å‰åˆ°ä¸­é—´å»¶æ—¶
  13              /*ui str_cod.py1zkh*/684,    //fun_py1ä¸­é—´åˆ°é åå»¶æ—¶
  14              /*ui str_cod.py1khh*/666,    //fun_py1é ååˆ°åå»¶æ—¶
  15              /*ui str_cod.py1qz*/500,     //fun_py1å‰åˆ°ä¸­é—´å»¶æ—¶
  16              /*ui str_cod.py1zh*/500,     //fun_py1ä¸­é—´åˆ°åå»¶æ—¶
  17              /*ui str_cod.py1kqkh*/1480,  //fun_py1é å‰åˆ°é åå»¶æ—¶
  18              /*ui str_cod.py1qkh*/2122,   //fun_py1å‰åˆ°é åå»¶æ—¶
  19              /*ui str_cod.py1kqh*/2122,   //fun_py1é å‰åˆ°åå»¶æ—¶
  20          
  21              /*ui str_cod.hz1bz*/20,      //fun_hz1æ ‡å‡†ä½å»¶æ—¶
  22          
  23              /*ui turn90;*/500,           //90åº¦è½¬å¼¯å±è”½å»¶æ—¶
  24              /*ui turn180;*/2000          //180åº¦è½¬å¼¯å±è”½å»¶æ—¶
  25          };
  26          xdata struct str_timerfolline str_tfl;
  27          ul var_timer=0;
  28          void fun_delay(ui par_value,enum varENU_del par_model){
  29   1          #ifdef Debug
                      ;
                  #else
  32   1              ui loc_con=par_value;
  33   1              switch(par_model){
  34   2                  case del_us://å¾®ç§’çº§å»¶æ—¶
  35   2                      while(loc_con-->0){
  36   3                          _nop_();
  37   3                          _nop_();
  38   3                      }
  39   2                      return;
  40   2                  case del_ms://æ¯«ç§’çº§å»¶æ—¶
  41   2                      while(loc_con-->0){
  42   3                          uc loc_i, loc_j;
  43   3                          _nop_();
  44   3                          _nop_();
  45   3                          loc_i=12;
  46   3                          loc_j=168;
  47   3                          do{
  48   4                              while(--loc_j);
  49   4                          }while(--loc_i);
  50   3                      }
  51   2                      return;
  52   2                  case del_s://ç§’çº§å»¶æ—¶
  53   2                      while(loc_con-->0){
  54   3                          uc loc_i, loc_j, loc_k;
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 2   

  55   3                          loc_i=46;
  56   3                          loc_j=153;
  57   3                          loc_k=245;
  58   3                          do{
  59   4                              do{
  60   5                                  while(--loc_k);
  61   5                              }while(--loc_j);
  62   4                          }while(--loc_i);
  63   3                      }
  64   2                      return;
  65   2                  default:return;
  66   2              }
  67   1          #endif
  68   1      }//å»¶æ—¶
  69          void fun_timer0init(){
  70   1          AUXR|=0x80;   //å®šæ—¶å™¨æ—¶é’Ÿ1Tæ¨¡å¼
  71   1          TMOD&=0xF0;   //å®šæ—¶å™¨æ¨¡å¼:16ä½
  72   1          TMOD|=0x01;   //å®šæ—¶å™¨æ¨¡å¼:16ä½
  73   1          TL0=0x20;     //å®šæ—¶åˆå€¼:1ms
  74   1          TH0=0xD1;     //å®šæ—¶åˆå€¼:1ms
  75   1          TF0=0;        //æ¸…é™¤TF0æ ‡å¿—
  76   1          ET0=1;
  77   1          EA=1;         //å¼€å¯æ€»ä¸­æ–­
  78   1      }//1æ¯«ç§’å®šæ—¶å™¨0åˆå§‹åŒ–
  79          void fun_timer1init(){
  80   1          AUXR&=0xBF;     //å®šæ—¶å™¨æ—¶é’Ÿ12Tæ¨¡å¼
  81   1          TMOD&=0x0F;     //å®šæ—¶å™¨æ¨¡å¼:16ä½
  82   1          TMOD|=0x10;     //å®šæ—¶å™¨æ¨¡å¼:16ä½
  83   1          TL1=0xE0;       //å®šæ—¶åˆå€¼:20ms
  84   1          TH1=0xB1;       //å®šæ—¶åˆå€¼:20ms
  85   1          TF1=0;          //æ¸…é™¤TF1æ ‡å¿—
  86   1          ET1=1;
  87   1          EA=1;           //å¼€å¯æ€»ä¸­æ–­
  88   1      }//20æ¯«ç§’å®šæ—¶å™¨1åˆå§‹åŒ–
  89          void fun_timer0(){
  90   1          TL0=0x20;
  91   1          TH0=0xD1;//å®šæ—¶å™¨åˆå€¼æ¢å¤è‡³1ms
  92   1          var_timer++;//å…¨å±€è®¡æ—¶å™¨å¼€å§‹è®¡æ—¶
  93   1          if(str_tfl.doing==tf_ture)//å¦‚æœæ­£åœ¨ç§»åŠ¨
  94   1              fun_timermove();//å®šæ—¶å™¨ç§»åŠ¨
  95   1      }//1æ¯«ç§’å®šæ—¶å™¨0å¤„ç†å‡½æ•°
  96          void fun_timer1(){
  97   1          TL1=0xE0;
  98   1          TH1=0xB1;
  99   1      }//20æ¯«ç§’å®šæ—¶å™¨1å¤„ç†å‡½æ•°
 100          void fun_wait(){
 101   1          while(in_start==1);
 102   1          fun_delay(20,del_ms);
 103   1          while(in_start==0);
 104   1          fun_delay(256,del_ms);
 105   1      }//ç­‰å¾…æŒ‰é”®
 106          void fun_pwminit(){
 107   1          CCON=0x00;//PACå¯„å­˜æ§åˆ¶å™¨
 108   1          CH=0;//é‡ç½®PACè®¡æ—¶å™¨
 109   1          CL=0;
 110   1          CMOD=0x08;//ä¸åˆ†é¢‘
 111   1      }//PWMåˆå§‹åŒ–
 112          void fun_pwmr(uc par_value){
 113   1          CCAP0H=CCAP0L=par_value*25/10;//æ§åˆ¶è¾“å‡ºçš„å ç©ºæ¯”
 114   1          CCAPM0=0X42;//8ä½PWMè¾“å‡ºï¼Œæ— ä¸­æ–­
 115   1          PCA_PWM0=0x00;
 116   1      }//å³è·¯PWMè¾“å‡º
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 3   

 117          void fun_pwml(uc par_value){
 118   1          CCAP1H=CCAP1L=par_value*25/10;//æ§åˆ¶è¾“å‡ºçš„å ç©ºæ¯”
 119   1          CCAPM1=0X42;//8ä½PWMè¾“å‡ºï¼Œæ— ä¸­æ–­
 120   1          PCA_PWM1=0x00;
 121   1      }//å·¦è·¯PWMè¾“å‡º
 122          void fun_motors(enum varENU_mot par_model,char par_speed){
 123   1          if(par_speed>100)
 124   1              par_speed=100;
 125   1          else if(par_speed<-100)
 126   1              par_speed=-100;//é€Ÿåº¦æœ€å¤š100,æœ€å°‘-100
 127   1          switch(par_model){
 128   2              case mot_l://å·¦è½®ç”µæœº
 129   2                  if(str_begin.leftsd==par_speed)
 130   2                      return;
 131   2                  else
 132   2                      str_begin.leftsd=par_speed;
 133   2                  if(par_speed==0){
 134   3                      fun_pwml(0);out_pwml=0;
 135   3                  }
 136   2                  else if(par_speed>0){
 137   3                      CR=1;fun_pwml(par_speed);out_pwml=0;
 138   3                  }
 139   2                  else if(par_speed<0){
 140   3                      CR=1;fun_pwml(cabs(par_speed));out_pwml=1;
 141   3                  }
 142   2                  break;
 143   2              case mot_r://å³è½®ç”µæœº
 144   2                  if(str_begin.rightsd==par_speed)
 145   2                      return;
 146   2                  else
 147   2                      str_begin.rightsd=par_speed;
 148   2                  if(par_speed==0){
 149   3                      fun_pwmr(0);out_pwmr=0;
 150   3                  }
 151   2                  else if(par_speed>0){
 152   3                      CR=1;fun_pwmr(par_speed);out_pwmr=0;
 153   3                  }
 154   2                  else if(par_speed<0){
 155   3                      CR=1;fun_pwmr(cabs(par_speed));out_pwmr=1;
 156   3                  }
 157   2                  break;
 158   2              case mot_rl://å·¦å³è½®åŒæ­¥
 159   2                  if((str_begin.leftsd==par_speed)&&(str_begin.rightsd==par_speed))
 160   2                      return;
 161   2                  else
 162   2                      str_begin.leftsd=str_begin.rightsd=par_speed;
 163   2                  if(par_speed==0){
 164   3                      CR=0;
 165   3                      fun_pwmr(0);out_pwmr=0;
 166   3                      fun_pwml(0);out_pwml=0;
 167   3                  }
 168   2                  else if(par_speed>0){
 169   3                      CR=1;
 170   3                      fun_pwml(par_speed);out_pwml=0;
 171   3                      fun_pwmr(par_speed);out_pwmr=0;
 172   3                  }
 173   2                  else if(par_speed<0){
 174   3                      CR=1;
 175   3                      fun_pwml(cabs(par_speed));out_pwml=1;
 176   3                      fun_pwmr(cabs(par_speed));out_pwmr=1;
 177   3                  }
 178   2                  break;
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 4   

 179   2              case mot_sz://æ­£è½¬ä¸ºæŠ“ç´§ï¼Œåè½¬ä¸ºæ¾å¼€
 180   2                  if(str_begin.szsd==par_speed)
 181   2                      return;
 182   2                  else
 183   2                      str_begin.szsd=par_speed;
 184   2                  if(par_speed==0){
 185   3                      out_motorselect=1;out_dir1=0;out_en1=1;
 186   3                  }
 187   2                  else if(par_speed>0){
 188   3                      out_motorselect=1;out_dir1=1;out_en1=0;
 189   3                  }
 190   2                  else if(par_speed<0){
 191   3                      out_motorselect=1;out_dir1=0;out_en1=0;
 192   3                  }
 193   2                  break;
 194   2              case mot_py://æ­£è½¬æ˜¯å‘æ— ç”µæœºä¸€æ–¹è½¬,åè½¬ä¸ºå‘æœ‰ç”µæœºä¸€æ–¹è½¬
 195   2                  if(str_begin.pysd==par_speed)
 196   2                      return;
 197   2                  else
 198   2                      str_begin.pysd=par_speed;
 199   2                  if(par_speed==0){
 200   3                      out_motorselect=1;out_dir2=0;out_en2=1;
 201   3                  }
 202   2                  else if(par_speed>0){
 203   3                      out_motorselect=1;out_dir2=1;out_en2=0;
 204   3                  }
 205   2                  else if(par_speed<0){
 206   3                      out_motorselect=1;out_dir2=0;out_en2=0;
 207   3                  }
 208   2                  break;
 209   2              case mot_sj://å‘ä¸Šä¸ºæ­£è½¬,å‘ä¸‹ä¸ºåè½¬
 210   2                  if(str_begin.sjsd==par_speed)
 211   2                      return;
 212   2                  else
 213   2                      str_begin.sjsd=par_speed;
 214   2                  if(par_speed==0){
 215   3                      out_motorselect=0;out_dir1=0;out_en1=1;
 216   3                  }
 217   2                  else if(par_speed>0){
 218   3                      out_motorselect=0;out_dir1=0;out_en1=0;
 219   3                  }
 220   2                  else if(par_speed<0){
 221   3                      out_motorselect=0;out_dir1=1;out_en1=0;
 222   3                  }
 223   2                  break;
 224   2              case mot_hz://é¡ºæ—¶é’ˆä¸ºæ­£è½¬,é€†æ—¶é’ˆä¸ºåè½¬
 225   2                  if(str_begin.hzsd==par_speed)
 226   2                      return;
 227   2                  else
 228   2                      str_begin.hzsd=par_speed;
 229   2                  if(par_speed==0){
 230   3                      out_motorselect=0;out_dir2=0;out_en2=1;
 231   3                  }
 232   2                  else if(par_speed>0){
 233   3                      out_motorselect=0;out_dir2=0;out_en2=0;
 234   3                  }
 235   2                  else if(par_speed<0){
 236   3                      out_motorselect=0;out_dir2=1;out_en2=0;
 237   3                  }
 238   2                  break;
 239   2              default:
 240   2                  break;
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 5   

 241   2          }
 242   1      }//ä¸»å‡½æ•°æ“ä½œç”µæœº
 243          void fun_motorsrl(enum varENU_mot par_model,char par_speed){
 244   1          if(par_speed>100)
 245   1              par_speed=100;
 246   1          else if(par_speed<-100)
 247   1              par_speed=-100;//é€Ÿåº¦æœ€å¤š100,æœ€å°‘-100
 248   1          switch(par_model){
 249   2              case mot_l://å·¦è½®ç”µæœº
 250   2                  if(str_begin.leftsd==par_speed)
 251   2                      return;
 252   2                  else
 253   2                      str_begin.leftsd=par_speed;
 254   2                  if(par_speed==0){
 255   3                      fun_pwml(0);out_pwml=0;
 256   3                  }
 257   2                  else if(par_speed>0){
 258   3                      CR=1;fun_pwml(par_speed);out_pwml=0;
 259   3                  }
 260   2                  else if(par_speed<0){
 261   3                      CR=1;fun_pwml(cabs(par_speed));out_pwml=1;
 262   3                  }
 263   2                  break;
 264   2              case mot_r://å³è½®ç”µæœº
 265   2                  if(str_begin.rightsd==par_speed)
 266   2                      return;
 267   2                  else
 268   2                      str_begin.rightsd=par_speed;
 269   2                  if(par_speed==0){
 270   3                      fun_pwmr(0);out_pwmr=0;
 271   3                  }
 272   2                  else if(par_speed>0){
 273   3                      CR=1;fun_pwmr(par_speed);out_pwmr=0;
 274   3                  }
 275   2                  else if(par_speed<0){
 276   3                      CR=1;fun_pwmr(cabs(par_speed));out_pwmr=1;
 277   3                  }
 278   2                  break;
 279   2              case mot_rl://å·¦å³è½®åŒæ­¥
 280   2                  if((str_begin.leftsd==par_speed)&&(str_begin.rightsd==par_speed))
 281   2                      return;
 282   2                  else
 283   2                      str_begin.leftsd=str_begin.rightsd=par_speed;
 284   2                  if(par_speed==0){
 285   3                      CR=0;
 286   3                      fun_pwmr(0);out_pwmr=0;
 287   3                      fun_pwml(0);out_pwml=0;
 288   3                  }
 289   2                  else if(par_speed>0){
 290   3                      CR=1;
 291   3                      fun_pwml(par_speed);out_pwml=0;
 292   3                      fun_pwmr(par_speed);out_pwmr=0;
 293   3                  }
 294   2                  else if(par_speed<0){
 295   3                      CR=1;
 296   3                      fun_pwml(cabs(par_speed));out_pwml=1;
 297   3                      fun_pwmr(cabs(par_speed));out_pwmr=1;
 298   3                  }
 299   2                  break;
 300   2              default:
 301   2                  break;
 302   2          }
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 6   

 303   1      }//å®šæ—¶å™¨æ“ä½œå·¦å³è½®
 304          void fun_sz1(enum varENU_han par_model){
 305   1          if(str_begin.szzt==par_model)
 306   1              return;
 307   1          if(par_model==han_s){//æ‰‹æŠ“æ¾
 308   2              fun_motors(mot_sz,-100);
 309   2              while(in_s==1);
 310   2          }
 311   1          else{//æ‰‹æŠ“ç´§
 312   2              fun_motors(mot_sz,100);
 313   2              while(in_j==1);
 314   2          }
 315   1          fun_delay(20,del_ms);
 316   1          fun_motors(mot_sz,0);
 317   1          str_begin.szzt=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 318   1      }//æ‰‹æŠ“å•æ­¥è¿åŠ¨
 319          void fun_py1(enum varENU_tra par_model){
 320   1          if(str_begin.pywz==par_model)
 321   1              return;
 322   1          switch(par_model){
 323   2              case tra_q://å‰å¹³ç§»(æ²¡æœ‰ç”µæœºçš„å‘¢ä¸ªæ–¹å‘)
 324   2                  fun_motors(mot_py,100);
 325   2                  while(in_qpy==1);
 326   2                  fun_delay(str_cod.py1bz,del_ms);
 327   2                  break;
 328   2              case tra_kq:
 329   2                  switch(str_begin.pywz){
 330   3                      case tra_q:
 331   3                          fun_motors(mot_py,-100);
 332   3                          fun_delay(str_cod.py1qkq,del_ms);
 333   3                          break;
 334   3                      case tra_z:
 335   3                          fun_motors(mot_py,100);
 336   3                          fun_delay(str_cod.py1kqz,del_ms);
 337   3                          break;
 338   3                      case tra_kh:
 339   3                          fun_motors(mot_py,100);
 340   3                          fun_delay(str_cod.py1kqkh,del_ms);
 341   3                          break;
 342   3                      case tra_h:
 343   3                          fun_motors(mot_py,100);
 344   3                          fun_delay(str_cod.py1kqh,del_ms);
 345   3                          break;
 346   3                  }
 347   2                  break;
 348   2              case tra_z:
 349   2                  switch(str_begin.pywz){
 350   3                      case tra_q:
 351   3                          fun_motors(mot_py,-100);
 352   3                          fun_delay(str_cod.py1qz,del_ms);
 353   3                          break;
 354   3                      case tra_kq:
 355   3                          fun_motors(mot_py,-100);
 356   3                          fun_delay(str_cod.py1kqz,del_ms);
 357   3                          break;
 358   3                      case tra_kh:
 359   3                          fun_motors(mot_py,100);
 360   3                          fun_delay(str_cod.py1zkh,del_ms);
 361   3                          break;
 362   3                      case tra_h:
 363   3                          fun_motors(mot_py,100);
 364   3                          fun_delay(str_cod.py1zh,del_ms);
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 7   

 365   3                          break;
 366   3                  }
 367   2                  break;
 368   2              case tra_kh:
 369   2                  switch(str_begin.pywz){
 370   3                      case tra_q:
 371   3                          fun_motors(mot_py,-100);
 372   3                          fun_delay(str_cod.py1qkh,del_ms);
 373   3                          break;
 374   3                      case tra_kq:
 375   3                          fun_motors(mot_py,-100);
 376   3                          fun_delay(str_cod.py1kqkh,del_ms);
 377   3                          break;
 378   3                      case tra_z:
 379   3                          fun_motors(mot_py,-100);
 380   3                          fun_delay(str_cod.py1zkh,del_ms);
 381   3                          break;
 382   3                      case tra_h:
 383   3                          fun_motors(mot_py,100);
 384   3                          fun_delay(str_cod.py1khh,del_ms);
 385   3                          break;
 386   3                  }
 387   2                  break;
 388   2              case tra_h://åå¹³ç§»(æœ‰ç”µæœºçš„å‘¢ä¸ªæ–¹å‘)
 389   2                  fun_motors(mot_py,-100);
 390   2                  while(in_hpy==1);
 391   2                  fun_delay(str_cod.py1bz,del_ms);
 392   2                  break;
 393   2              default:
 394   2                  break;
 395   2          }
 396   1          fun_motors(mot_py,0);
 397   1          str_begin.pywz=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 398   1      }//å¹³ç§»å•æ­¥è¿åŠ¨
 399          void fun_sj1(enum varENU_sjp par_model){
 400   1          if(str_begin.sjwz==par_model)
 401   1             return;
 402   1          switch(par_model){
 403   2              case sjp_1://å‡é™ä½ç½®1(æœ€ä¸Šä½)
 404   2                  fun_motors(mot_sj,100);
 405   2                  def_select(sel_58);
 406   2                  while(in_wz1==1);
 407   2                  fun_delay(str_cod.sj1bzw,del_ms);
 408   2                  break;
 409   2              case sjp_12:
 410   2                  if(par_model>str_begin.sjwz){
 411   3                      fun_motors(mot_sj,-100);
 412   3                      fun_delay(str_cod.sj1zjw,del_ms);
 413   3                  }
 414   2                  else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 415   3                      fun_sj1(sjp_2);
 416   3                      fun_motors(mot_sj,100);
 417   3                      fun_delay(str_cod.sj1zjw,del_ms);
 418   3                  }
 419   2                  break;
 420   2              case sjp_2://å‡é™ä½ç½®2
 421   2                  fun_motors(mot_sj,par_model<str_begin.sjwz?100:-100);
 422   2                  def_select(sel_58);
 423   2                  while(in_wz2==1);
 424   2                  fun_delay(str_cod.sj1bzw,del_ms);
 425   2                  break;
 426   2              case sjp_23:
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 8   

 427   2                  if(par_model>str_begin.sjwz){
 428   3                      fun_sj1(sjp_2);
 429   3                      fun_motors(mot_sj,-100);
 430   3                      fun_delay(str_cod.sj1zjw,del_ms);
 431   3                  }
 432   2                  else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 433   3                      fun_sj1(sjp_3);
 434   3                      fun_motors(mot_sj,100);
 435   3                      fun_delay(str_cod.sj1zjw,del_ms);
 436   3                  }
 437   2                  break;
 438   2              case sjp_3://å‡é™ä½ç½®3
 439   2                  fun_motors(mot_sj,par_model<str_begin.sjwz?100:-100);
 440   2                  def_select(sel_58);
 441   2                  while(in_wz3==1);
 442   2                  fun_delay(str_cod.sj1bzw,del_ms);
 443   2                  break;
 444   2              case sjp_34:
 445   2                  if(par_model>str_begin.sjwz){
 446   3                      fun_sj1(sjp_3);
 447   3                      fun_motors(mot_sj,-100);
 448   3                      fun_delay(str_cod.sj1zjw,del_ms);
 449   3                  }
 450   2                  else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 451   3                      fun_sj1(sjp_4);
 452   3                      fun_motors(mot_sj,100);
 453   3                      fun_delay(str_cod.sj1zjw,del_ms);
 454   3                  }
 455   2                  break;
 456   2              case sjp_4://å‡é™ä½ç½®4
 457   2                  fun_motors(mot_sj,par_model<str_begin.sjwz?100:-100);
 458   2                  def_select(sel_58);
 459   2                  while(in_wz4==1);
 460   2                  fun_delay(str_cod.sj1bzw,del_ms);
 461   2                  break;
 462   2              case sjp_45:
 463   2                  if(par_model>str_begin.sjwz){
 464   3                      fun_sj1(sjp_4);
 465   3                      fun_motors(mot_sj,-100);
 466   3                      fun_delay(str_cod.sj1zjw,del_ms);
 467   3                  }
 468   2                  else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 469   3                      fun_motors(mot_sj,100);
 470   3                      fun_delay(str_cod.sj1zjw,del_ms);
 471   3                  }
 472   2                  break;
 473   2              case sjp_5://å‡é™ä½ç½®5
 474   2                  fun_motors(mot_sj,-100);
 475   2                  def_select(sel_912);
 476   2                  while(in_wz5==1);
 477   2                  fun_delay(str_cod.sj1bzw,del_ms);
 478   2                  break;
 479   2              default:
 480   2                  break;
 481   2          }
 482   1          fun_motors(mot_sj,0);
 483   1          str_begin.sjwz=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 484   1      }//å‡é™å•æ­¥è¿åŠ¨
 485          void fun_hz1(enum varENU_dir par_model){
 486   1          if(str_begin.hzfx==par_model)
 487   1              return;
 488   1          def_select(sel_912);
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 9   

 489   1          switch(par_model){
 490   2              case dir_up://å›è½¬è‡³å‰æ–¹
 491   2                  switch(str_begin.hzfx){
 492   3                      case dir_down://ç°åœ¨åœ¨ä¸‹æ–¹
 493   3                          fun_motors(mot_hz,-100);
 494   3                          fun_delay(1,del_s);
 495   3                          while(in_hz==1);
 496   3                          while(in_hz==0);
 497   3                          while(in_hz==1);
 498   3                          fun_delay(str_cod.hz1bz,del_ms);
 499   3                          break;
 500   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 501   3                          fun_motors(mot_hz,100);
 502   3                          fun_delay(1,del_s);
 503   3                          while(in_hz==1);
 504   3                          fun_delay(str_cod.hz1bz,del_ms);
 505   3                          break;
 506   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 507   3                          fun_motors(mot_hz,-100);
 508   3                          fun_delay(1,del_s);
 509   3                          while(in_hz==1);
 510   3                          fun_delay(str_cod.hz1bz,del_ms);
 511   3                          break;
 512   3                      default:
 513   3                          break;
 514   3                  }
 515   2                  break;
 516   2              case dir_down://è¦å»ä¸‹é¢
 517   2                  switch(str_begin.hzfx){
 518   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 519   3                          fun_motors(mot_hz,100);
 520   3                          fun_delay(1,del_s);
 521   3                          while(in_hz==1);
 522   3                          while(in_hz==0);
 523   3                          while(in_hz==1);
 524   3                          fun_delay(str_cod.hz1bz,del_ms);
 525   3                          break;
 526   3                      case dir_left://ç°åœ¨åœ¨å·¦é¢
 527   3                          fun_motors(mot_hz,-100);
 528   3                          fun_delay(1,del_s);
 529   3                          while(in_hz==1);
 530   3                          fun_delay(str_cod.hz1bz,del_ms);
 531   3                          break;
 532   3                          break;
 533   3                      case dir_right://ç°åœ¨åœ¨å³é¢
 534   3                          fun_motors(mot_hz,100);
 535   3                          fun_delay(1,del_s);
 536   3                          while(in_hz==1);
 537   3                          fun_delay(str_cod.hz1bz,del_ms);
 538   3                          break;
 539   3                      default:
 540   3                          break;
 541   3                  }
 542   2                  break;
 543   2              case dir_left://è¦å»å·¦è¾¹
 544   2                  switch(str_begin.hzfx){
 545   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 546   3                          fun_motors(mot_hz,-100);
 547   3                          fun_delay(1,del_s);
 548   3                          while(in_hz==1);
 549   3                          fun_delay(str_cod.hz1bz,del_ms);
 550   3                          break;
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 10  

 551   3                          break;
 552   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 553   3                          fun_motors(mot_hz,100);
 554   3                          fun_delay(1,del_s);
 555   3                          while(in_hz==1);
 556   3                          fun_delay(str_cod.hz1bz,del_ms);
 557   3                          break;
 558   3                          break;
 559   3                      case dir_right://ç°åœ¨åœ¨å³é¢
 560   3                          fun_motors(mot_hz,-100);
 561   3                          fun_delay(1,del_s);
 562   3                          while(in_hz==1);
 563   3                          while(in_hz==0);
 564   3                          while(in_hz==1);
 565   3                          fun_delay(str_cod.hz1bz,del_ms);
 566   3                          break;
 567   3                      default:
 568   3                          break;
 569   3                  }
 570   2                  break;
 571   2              case dir_right://è¦å»å³é¢
 572   2                  switch(str_begin.hzfx){
 573   3                      case dir_up://ç°åœ¨åœ¨å‰é¢
 574   3                          fun_motors(mot_hz,100);
 575   3                          fun_delay(1,del_s);
 576   3                          while(in_hz==1);
 577   3                          fun_delay(str_cod.hz1bz,del_ms);
 578   3                          break;
 579   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 580   3                          fun_motors(mot_hz,-100);
 581   3                          fun_delay(1,del_s);
 582   3                          while(in_hz==1);
 583   3                          fun_delay(str_cod.hz1bz,del_ms);
 584   3                          break;
 585   3                      case dir_left://ç°åœ¨åœ¨å·¦é¢
 586   3                          fun_motors(mot_hz,100);
 587   3                          fun_delay(1,del_s);
 588   3                          while(in_hz==1);
 589   3                          while(in_hz==0);
 590   3                          while(in_hz==1);
 591   3                          fun_delay(str_cod.hz1bz,del_ms);
 592   3                          break;
 593   3                      default:
 594   3                          break;
 595   3                  }
 596   2                  break;
 597   2              default:
 598   2                  break;
 599   2          }
 600   1          fun_motors(mot_hz,0);
 601   1          str_begin.hzfx=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 602   1      }//å›è½¬å•æ­¥è¿åŠ¨
 603          void fun_pyhz2(enum varENU_tra par_pymodel,enum varENU_dir par_hzmodel){
 604   1          switch(par_hzmodel){
 605   2              case dir_left://è¦å»å·¦è¾¹
 606   2                  switch(str_begin.hzfx){
 607   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 608   3                      
 609   3                          break;
 610   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 611   3                      
 612   3                          break;
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 11  

 613   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 614   3                      
 615   3                          break;
 616   3                      default:
 617   3                          break;
 618   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 619   2                  break;
 620   2              case dir_right://è¦å»å³è¾¹
 621   2                  switch(str_begin.hzfx){
 622   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 623   3                      
 624   3                          break;
 625   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 626   3                      
 627   3                          break;
 628   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 629   3                      
 630   3                          break;
 631   3                      default:
 632   3                          break;
 633   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 634   2                  break;
 635   2              case dir_up://è¦å»ä¸Šé¢
 636   2                  switch(str_begin.hzfx){
 637   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 638   3                      
 639   3                          break;
 640   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 641   3                      
 642   3                          break;
 643   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 644   3                      
 645   3                          break;
 646   3                      default:
 647   3                          break;
 648   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 649   2                  break;
 650   2              case dir_down://è¦å»ä¸‹é¢
 651   2                  switch(str_begin.hzfx){
 652   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 653   3                      
 654   3                          break;
 655   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 656   3                      
 657   3                          break;
 658   3                      case dir_up://ç°åœ¨åœ¨ä¸‹é¢
 659   3                      
 660   3                          break;
 661   3                      default:
 662   3                          break;
 663   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 664   2                  break;
 665   2              default:
 666   2                  break;
 667   2          }//è·å–ç°åœ¨è¦å»çš„å›è½¬ä½ç½®
 668   1          switch(par_pymodel){
 669   2              case tra_q://è¦å»å‰é¢
 670   2              
 671   2                  break;
 672   2              case tra_kq://è¦å»é å‰
 673   2              
 674   2                  break;
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 12  

 675   2              case tra_z://è¦å»ä¸­é—´
 676   2              
 677   2                  break;
 678   2              case tra_kh://è¦å»é å
 679   2              
 680   2                  break;
 681   2              case tra_h://è¦å»åé¢
 682   2              
 683   2                  break;
 684   2              default:
 685   2                  break;
 686   2          }//è·å–ç°åœ¨å¹³ç§»æ‰€åœ¨çš„ä½ç½®
 687   1          switch(par_hzmodel){
 688   2              case dir_left://è¦å»å·¦è¾¹
 689   2                  switch(str_begin.hzfx){
 690   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 691   3                      
 692   3                          break;
 693   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 694   3                      
 695   3                          break;
 696   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 697   3                      
 698   3                          break;
 699   3                      default:
 700   3                          break;
 701   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 702   2                  break;
 703   2              case dir_right://è¦å»å³è¾¹
 704   2                  switch(str_begin.hzfx){
 705   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 706   3                      
 707   3                          break;
 708   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 709   3                      
 710   3                          break;
 711   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 712   3                      
 713   3                          break;
 714   3                      default:
 715   3                          break;
 716   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 717   2                  break;
 718   2              case dir_up://è¦å»ä¸Šé¢
 719   2                  switch(str_begin.hzfx){
 720   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 721   3                      
 722   3                          break;
 723   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 724   3                      
 725   3                          break;
 726   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 727   3                      
 728   3                          break;
 729   3                      default:
 730   3                          break;
 731   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 732   2                  break;
 733   2              case dir_down://è¦å»ä¸‹é¢
 734   2                  switch(str_begin.hzfx){
 735   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 736   3                      
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 13  

 737   3                          break;
 738   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 739   3                      
 740   3                          break;
 741   3                      case dir_up://ç°åœ¨åœ¨ä¸‹é¢
 742   3                      
 743   3                          break;
 744   3                      default:
 745   3                          break;
 746   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 747   2                  break;
 748   2              default:
 749   2                  break;
 750   2          }//è·å–ç°åœ¨è¦å»çš„å›è½¬ä½ç½®
 751   1      }//å¹³ç§»å›è½¬åŒæ­¥è¿åŠ¨
 752          void fun_jtjp(){
 753   1          while(1){
 754   2              if((!in_ls1&&!in_ls2&&in_ls4&&in_ls5&&!in_ls7&&!in_ls8)&&((in_ls3&&in_ls6)||(!in_ls3&&!in_ls6))){
 755   3                  fun_delay(10,del_ms);
 756   3                  fun_motors(mot_rl,0);
 757   3                  return;
 758   3              }
 759   2              if(in_ls2||in_ls1){
 760   3                  fun_motors(mot_l,16);
 761   3                  fun_motors(mot_r,-16);
 762   3              }
 763   2              else if(in_ls7||in_ls8){
 764   3                  fun_motors(mot_l,-16);
 765   3                  fun_motors(mot_r,16);
 766   3              }
 767   2              else{
 768   3                  if(!in_ls4){
 769   4                      fun_motors(mot_l,-12);
 770   4                      fun_motors(mot_r,12);
 771   4                  }
 772   3                  else if(!in_ls5){
 773   4                      fun_motors(mot_l,12);
 774   4                      fun_motors(mot_r,-12);
 775   4                  }
 776   3                  else{
 777   4                      if(in_ls6&&!in_ls3){
 778   5                          fun_motors(mot_l,-8);
 779   5                          fun_motors(mot_r,8);
 780   5                      }
 781   4                      if(in_ls3&&!in_ls6){
 782   5                          fun_motors(mot_l,8);
 783   5                          fun_motors(mot_r,-8);
 784   5                      }
 785   4                  }
 786   3              }
 787   2          }
 788   1      }//é™æ€çº å
 789          void fun_timermove(){
 790   1          static uc loc_con=0;//éœ€è¦åˆ†æ­¥åšçš„åŠ¨ä½œéœ€è¦ç”¨åˆ°æ­¤é™æ€ç§æœ‰åˆ†æ­¥æ ‡å¿—ä½
 791   1          uc loc_sdl,loc_sdr;//å·¦è½®é€Ÿåº¦å’Œå³è½®é€Ÿåº¦çš„å±€éƒ¨å˜é‡
 792   1          switch(*str_tfl.run){//é€‰æ‹©è¿è¡Œæ–¹å¼
 793   2              case def_end://è¿è¡Œç»“æŸ
 794   2                  fun_motorsrl(mot_rl,0);//å†æ¬¡åœæ­¢ç”µæœºè¿åŠ¨
 795   2                  str_tfl.doing=tf_false;//ç§»åŠ¨ç»“æŸ
 796   2                  memset(str_tfl.step,0,sizeof(str_tfl.step));//æ¸…ç©ºstepæ•°ç»„
 797   2                  str_tfl.run=str_tfl.step;//æŒ‡é’ˆæŒ‡å‘stepçš„ç¬¬ä¸€ä¸ªå…ƒç´ 
 798   2                  break;
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 14  

 799   2              case tfl_line://è¿è¡Œå·¡çº¿
 800   2                  if(*(str_tfl.run+1)){//å¦‚æœå‚æ•°ä¸ºé0æ•°
 801   3                      if((in_ls1||in_ls8)&&(in_ls2&&in_ls3&&in_ls4&&in_ls5&in_ls6&&in_ls7)){//å¦‚æœä¸­é—´6ä¸ªç
             -¯å…¨äº®,å·¦å³äº®ä»»æ„ä¸€ä¸ª
 802   4                          str_tfl.online=tf_ture;//æ ‡å¿—ä½è®°å½•åœ¨çº¿
 803   4                          fun_motorsrl(mot_rl,str_tfl.gospeed);//æŒ‰ç…§å¸¸è§„é€Ÿåº¦è¿‡çº¿
 804   4                      }
 805   3                      else if(str_tfl.online==tf_ture){//å¦‚æœæ ‡å¿—ä½è®°å½•åœ¨çº¿,è€Œä¸”ä¸ç¬¦åˆåœ¨çº¿ç‰¹å¾
 806   4                          str_tfl.online=tf_false;//æ ‡å¿—ä½è®°å½•ä¸åœ¨çº¿
 807   4                          (*(str_tfl.run+1))--;//å‚æ•°å€¼å‡1,è®°å½•å·²ç»èµ°äº†ä¸€æ¡çº¿
 808   4                      }
 809   3                      else{
 810   4                          loc_sdl=loc_sdr=str_tfl.gospeed;//å·¡çº¿é€Ÿåº¦ä¸ºstr_tfl.gospeed
 811   4                          if(in_ls1&&!in_ls8){//1äº®8ä¸äº®
 812   5                              loc_sdl*=0.5;//å·¦å‡é€Ÿ
 813   5                              loc_sdr*=1.5;//å³åŠ é€Ÿ
 814   5                          }//å‘å·¦è½¬
 815   4                          if(in_ls8&&!in_ls1){//8äº®1ä¸äº®
 816   5                              loc_sdl*=1.5;//å·¦åŠ é€Ÿ
 817   5                              loc_sdr*=0.5;//å³å‡é€Ÿ
 818   5                          }//å‘å³è½¬
 819   4                          if(in_ls2&&!in_ls7){//2äº®7ä¸äº®
 820   5                              loc_sdl*=0.7;//å·¦å‡é€Ÿ
 821   5                              loc_sdr*=1.3;//å³åŠ é€Ÿ
 822   5                          }//å‘å·¦è½¬
 823   4                          if(in_ls7&&!in_ls2){//7äº®2ä¸äº®
 824   5                              loc_sdl*=1.3;//å·¦åŠ é€Ÿ
 825   5                              loc_sdr*=0.7;//å³å‡é€Ÿ
 826   5                          }//å‘å³è½¬
 827   4                          if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
 828   5                              loc_sdl*=0.9;//å·¦å‡é€Ÿ
 829   5                              loc_sdr*=1.1;//å³åŠ é€Ÿ
 830   5                          }//å‘å·¦è½¬
 831   4                          if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
 832   5                              loc_sdl*=1.1;//å·¦åŠ é€Ÿ
 833   5                              loc_sdr*=0.9;//å³å‡é€Ÿ
 834   5                          }//å‘å³è½¬
 835   4                          fun_motorsrl(mot_r,loc_sdr);
 836   4                          fun_motorsrl(mot_l,loc_sdl);
 837   4                      }
 838   3                  }
 839   2                  else{//å¦‚æœçº¿èµ°å®Œäº†
 840   3                      str_tfl.run+=2;//æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ç»„è¿‡ç¨‹
 841   3                      fun_motorsrl(mot_rl,0);//åœæ­¢ç”µæœºè¿åŠ¨
 842   3                  }
 843   2                  break;
 844   2              case tfl_turn://è¿è¡Œè½¬å¼¯
 845   2                  switch(loc_con){//åˆ†æ­¥è¿è¡Œæ ‡å¿—ä½
 846   3                      case 0://ç¬¬ä¸€æ­¥
 847   3                          switch(*(str_tfl.run+1)){//è·å–å‚æ•°
 848   4                              case tur_r90://å³è½¬90
 849   4                                  fun_motorsrl(mot_l,str_tfl.turnspeed);//å·¦è½®å‘å‰
 850   4                                  fun_motorsrl(mot_r,-str_tfl.turnspeed);//å³è½®å‘å
 851   4                                  str_tfl.delay=var_timer+str_cod.turn90;//è®¡æ—¶
 852   4                                  break;
 853   4                              case tur_l90://å·¦è½¬90
 854   4                                  fun_motorsrl(mot_l,-str_tfl.turnspeed);//å·¦è½®å‘å
 855   4                                  fun_motorsrl(mot_r,str_tfl.turnspeed);//å³è½®å‘å‰
 856   4                                  str_tfl.delay=var_timer+str_cod.turn90;//è®¡æ—¶
 857   4                                  break;
 858   4                              case tur_r180://å³è½¬180
 859   4                                  fun_motorsrl(mot_l,str_tfl.turnspeed);//å·¦è½®å‘å‰
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 15  

 860   4                                  fun_motorsrl(mot_r,-str_tfl.turnspeed);//å³è½®å‘å
 861   4                                  str_tfl.delay=var_timer+str_cod.turn180;//è®¡æ—¶
 862   4                                  break;
 863   4                              case tur_l180://å·¦è½¬180
 864   4                                  fun_motorsrl(mot_l,-str_tfl.turnspeed);//å·¦è½®å‘å
 865   4                                  fun_motorsrl(mot_r,str_tfl.turnspeed);//å·¦è½®å‘å‰
 866   4                                  str_tfl.delay=var_timer+str_cod.turn180;//è®¡æ—¶
 867   4                                  break;
 868   4                          }
 869   3                          loc_con++;//æ‰§è¡Œä¸‹ä¸€æ­¥
 870   3                          break;
 871   3                      case 1://ç¬¬äºŒæ­¥
 872   3                          if(str_tfl.delay<=var_timer)//è®¡æ—¶æ—¶é—´åˆ°
 873   3                              loc_con++;//æ‰§è¡Œä¸‹ä¸€æ­¥
 874   3                          break;
 875   3                      case 2://ç¬¬ä¸‰æ­¥
 876   3                          if(in_ls4&&in_ls5){//å¦‚æœä¸­é—´ä¸¤ä¸ªç¯äº®
 877   4                              fun_motorsrl(mot_rl,0);//åœæ­¢ç”µæœº
 878   4                              str_tfl.run+=2;//æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ç»„è¿‡ç¨‹
 879   4                              str_tfl.delay=0;//å»¶æ—¶è®¡æ•°å™¨å½’é›¶
 880   4                              loc_con=0;//åˆ†æ­¥è¿è¡Œæ ‡å¿—ä½å½’é›¶
 881   4                          }
 882   3                          break;
 883   3                  }
 884   2                  break;
 885   2              case tfl_cache://è¿è¡Œå‰å†²
 886   2                  switch(loc_con){
 887   3                      case 0://ç¬¬ä¸€æ­¥
 888   3                          str_tfl.delay=var_timer+((*(str_tfl.run+1))*10);//å»¶æ—¶æ—¶é—´(æ¯«ç§’)ä¸ºå‚æ•°çš„10å€
             -
 889   3                          loc_con++;//æ‰§è¡Œä¸‹ä¸€æ­¥
 890   3                          break;
 891   3                      case 1://ç¬¬äºŒæ­¥
 892   3                          if(str_tfl.delay<=var_timer){//è®¡æ—¶æ—¶é—´åˆ°
 893   4                              fun_motorsrl(mot_rl,0);//åœæ­¢ç”µæœº
 894   4                              str_tfl.run+=2;//æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ç»„è¿‡ç¨‹
 895   4                              str_tfl.delay=0;//å»¶æ—¶è®¡æ•°å™¨å½’é›¶
 896   4                              loc_con=0;//åˆ†æ­¥è¿è¡Œæ ‡å¿—ä½å½’é›¶
 897   4                          }
 898   3                          else{
 899   4                              loc_sdl=loc_sdr=str_tfl.cachespeed;//å‰å†²é€Ÿåº¦ä¸ºstr_tfl.cachespeed
 900   4                              if(in_ls1&&!in_ls8){//1äº®8ä¸äº®
 901   5                                  loc_sdl*=0.5;//å·¦å‡é€Ÿ
 902   5                                  loc_sdr*=1.5;//å³åŠ é€Ÿ
 903   5                              }//å‘å·¦è½¬
 904   4                              if(in_ls8&&!in_ls1){//8äº®1ä¸äº®
 905   5                                  loc_sdl*=1.5;//å·¦åŠ é€Ÿ
 906   5                                  loc_sdr*=0.5;//å³å‡é€Ÿ
 907   5                              }//å‘å³è½¬
 908   4                              if(in_ls2&&!in_ls7){//2äº®7ä¸äº®
 909   5                                  loc_sdl*=0.7;//å·¦å‡é€Ÿ
 910   5                                  loc_sdr*=1.3;//å³åŠ é€Ÿ
 911   5                              }//å‘å·¦è½¬
 912   4                              if(in_ls7&&!in_ls2){//7äº®2ä¸äº®
 913   5                                  loc_sdl*=1.3;//å·¦åŠ é€Ÿ
 914   5                                  loc_sdr*=0.7;//å³å‡é€Ÿ
 915   5                              }//å‘å³è½¬
 916   4                              if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
 917   5                                  loc_sdl*=0.9;//å·¦å‡é€Ÿ
 918   5                                  loc_sdr*=1.1;//å³åŠ é€Ÿ
 919   5                              }//å‘å·¦è½¬
 920   4                              if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 16  

 921   5                                  loc_sdl*=1.1;//å·¦åŠ é€Ÿ
 922   5                                  loc_sdr*=0.9;//å³å‡é€Ÿ
 923   5                              }//å‘å³è½¬
 924   4                              fun_motorsrl(mot_r,loc_sdr);
 925   4                              fun_motorsrl(mot_l,loc_sdl);
 926   4                          }
 927   3                          break;
 928   3                  }
 929   2                  break;
 930   2              case tfl_start://è¿è¡Œå¸¦åŠ é€Ÿçš„å‰å†²
 931   2      
 932   2                  break;
 933   2              case tfl_end://è¿è¡Œå¸¦å‡é€Ÿçš„å‰å†²
 934   2      
 935   2                  break;
 936   2          }
 937   1      }//å®šæ—¶å™¨ç§»åŠ¨
 938          void fun_folline(uc par_con,uc par_speed){
 939   1          uc loc_con=par_con;//å·¡çº¿æ¡æ•°æ ‡å¿—ä½
 940   1          uc loc_sdr,loc_sdl;//å·¦å³è½®é€Ÿåº¦
 941   1          uc loc_online;//åœ¨çº¿æ ‡å¿—ä½
 942   1          while(loc_con){
 943   2              if((in_ls1||in_ls8)&&(in_ls2&&in_ls3&&in_ls4&&in_ls5&in_ls6&&in_ls7)){//å¦‚æœä¸­é—´6ä¸ªç¯å…¨äº®,
             -å·¦å³äº®ä»»æ„ä¸€ä¸ª
 944   3                  loc_online=tf_ture;//æ ‡å¿—ä½è®°å½•åœ¨çº¿
 945   3                  fun_motors(mot_rl,par_speed);//æŒ‰ç…§å¸¸è§„é€Ÿåº¦è¿‡çº¿
 946   3              }
 947   2              else if(loc_online==tf_ture){//å¦‚æœæ ‡å¿—ä½è®°å½•åœ¨çº¿,è€Œä¸”ä¸ç¬¦åˆåœ¨çº¿ç‰¹å¾
 948   3                  loc_online=tf_false;//æ ‡å¿—ä½è®°å½•ä¸åœ¨çº¿
 949   3                  loc_con--;//å‚æ•°å€¼å‡1,è®°å½•å·²ç»èµ°äº†ä¸€æ¡çº¿
 950   3              }
 951   2              else{
 952   3                  loc_sdr=loc_sdl=par_speed;
 953   3                  if(in_ls1&&!in_ls8){//1äº®8ä¸äº®
 954   4                      loc_sdl*=0.5;//å·¦å‡é€Ÿ
 955   4                      loc_sdr*=1.5;//å³åŠ é€Ÿ
 956   4                  }//å‘å·¦è½¬
 957   3                  if(in_ls8&&!in_ls1){//8äº®1ä¸äº®
 958   4                      loc_sdl*=1.5;//å·¦åŠ é€Ÿ
 959   4                      loc_sdr*=0.5;//å³å‡é€Ÿ
 960   4                  }//å‘å³è½¬
 961   3                  if(in_ls2&&!in_ls7){//2äº®7ä¸äº®
 962   4                      loc_sdl*=0.7;//å·¦å‡é€Ÿ
 963   4                      loc_sdr*=1.3;//å³åŠ é€Ÿ
 964   4                  }//å‘å·¦è½¬
 965   3                  if(in_ls7&&!in_ls2){//7äº®2ä¸äº®
 966   4                      loc_sdl*=1.3;//å·¦åŠ é€Ÿ
 967   4                      loc_sdr*=0.7;//å³å‡é€Ÿ
 968   4                  }//å‘å³è½¬
 969   3                  if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
 970   4                      loc_sdl*=0.9;//å·¦å‡é€Ÿ
 971   4                      loc_sdr*=1.1;//å³åŠ é€Ÿ
 972   4                  }//å‘å·¦è½¬
 973   3                  if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
 974   4                      loc_sdl*=1.1;//å·¦åŠ é€Ÿ
 975   4                      loc_sdr*=0.9;//å³å‡é€Ÿ
 976   4                  }//å‘å³è½¬
 977   3                  fun_motors(mot_r,loc_sdr);
 978   3                  fun_motors(mot_l,loc_sdl);
 979   3                  fun_delay(1,del_ms);
 980   3              }
 981   2          }//å¦‚æœå·¡çº¿æ¡æ•°ä¸ä¸º0
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 17  

 982   1          fun_qc(65,40);
 983   1      }//ä¸»å‡½æ•°å·¡çº¿
 984          void fun_turn(enum varENU_tur par_model,uc par_speed){
 985   1          switch(par_model){//è·å–å‚æ•°
 986   2              case tur_r90://å³è½¬90
 987   2                  fun_motors(mot_l,par_speed);//å·¦è½®å‘å‰
 988   2                  fun_motors(mot_r,-par_speed);//å³è½®å‘å
 989   2                  fun_delay(str_cod.turn90,del_ms);//è®¡æ—¶
 990   2                  break;
 991   2              case tur_l90://å·¦è½¬90
 992   2                  fun_motors(mot_l,-par_speed);//å·¦è½®å‘å
 993   2                  fun_motors(mot_r,par_speed);//å³è½®å‘å‰
 994   2                  fun_delay(str_cod.turn90,del_ms);//è®¡æ—¶
 995   2                  break;
 996   2              case tur_r180://å³è½¬180
 997   2                  fun_motors(mot_l,par_speed);//å·¦è½®å‘å‰
 998   2                  fun_motors(mot_r,-par_speed);//å³è½®å‘å
 999   2                  fun_delay(str_cod.turn180,del_ms);//è®¡æ—¶
1000   2                  break;
1001   2              case tur_l180://å·¦è½¬180
1002   2                  fun_motors(mot_l,-par_speed);//å·¦è½®å‘å
1003   2                  fun_motors(mot_r,par_speed);//å·¦è½®å‘å‰
1004   2                  fun_delay(str_cod.turn180,del_ms);//è®¡æ—¶
1005   2                  break;
1006   2          }
1007   1          while(!in_ls4||!in_ls5);
1008   1          fun_motors(mot_rl,0);//åœæ­¢ç”µæœº
1009   1      }//ä¸»å‡½æ•°è½¬å¼¯
1010          void fun_qc(uc par_time,uc par_speed){
1011   1          uc loc_sdr,loc_sdl;//å·¦å³è½®é€Ÿåº¦
1012   1          str_tfl.delay=var_timer+par_time*10;//å»¶æ—¶æ—¶é—´(æ¯«ç§’)ä¸ºå‚æ•°çš„10å€
1013   1          while(str_tfl.delay>var_timer){
1014   2              loc_sdr=loc_sdl=par_speed;
1015   2              if(in_ls1&&!in_ls8){//1äº®8ä¸äº®
1016   3                  loc_sdl*=0.5;//å·¦å‡é€Ÿ
1017   3                  loc_sdr*=1.5;//å³åŠ é€Ÿ
1018   3              }//å‘å·¦è½¬
1019   2              if(in_ls8&&!in_ls1){//8äº®1ä¸äº®
1020   3                  loc_sdl*=1.5;//å·¦åŠ é€Ÿ
1021   3                  loc_sdr*=0.5;//å³å‡é€Ÿ
1022   3              }//å‘å³è½¬
1023   2              if(in_ls2&&!in_ls7){//2äº®7ä¸äº®
1024   3                  loc_sdl*=0.7;//å·¦å‡é€Ÿ
1025   3                  loc_sdr*=1.3;//å³åŠ é€Ÿ
1026   3              }//å‘å·¦è½¬
1027   2              if(in_ls7&&!in_ls2){//7äº®2ä¸äº®
1028   3                  loc_sdl*=1.3;//å·¦åŠ é€Ÿ
1029   3                  loc_sdr*=0.7;//å³å‡é€Ÿ
1030   3              }//å‘å³è½¬
1031   2              if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
1032   3                  loc_sdl*=0.9;//å·¦å‡é€Ÿ
1033   3                  loc_sdr*=1.1;//å³åŠ é€Ÿ
1034   3              }//å‘å·¦è½¬
1035   2              if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
1036   3                  loc_sdl*=1.1;//å·¦åŠ é€Ÿ
1037   3                  loc_sdr*=0.9;//å³å‡é€Ÿ
1038   3              }//å‘å³è½¬
1039   2              fun_motors(mot_r,loc_sdr);
1040   2              fun_motors(mot_l,loc_sdl);
1041   2              fun_delay(1,del_ms);
1042   2          }
1043   1          fun_motors(mot_rl,0);//åœæ­¢ç”µæœº
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 18  

1044   1      }//ä¸»å‡½æ•°å‰å†²
1045          void fun_stope2prom(){
1046   1          IAP_CONTR = 0;                  //å…³é—­IAPåŠŸèƒ½
1047   1          IAP_CMD = 0;                    //æ¸…é™¤å‘½ä»¤
1048   1          IAP_TRIG = 0;                   //æ¸…é™¤è§¦å‘å¯„å­˜å™¨
1049   1          IAP_ADDRH = 0x80;               //æ•°æ®æŒ‡é’ˆæŒ‡å‘éEEPROMåŒº
1050   1          IAP_ADDRL = 0;                  //æ¸…é™¤IAPåœ°å€
1051   1      }//å…³é—­EEPROMåŠŸèƒ½(IapIdle)
1052          uc fun_reade2prom(ui par_add){
1053   1          uc loc_dat;                     //æ•°æ®ç¼“å†²åŒº
1054   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
1055   1          IAP_CMD = 1;                    //è®¾ç½®EEPROMè¯»å‘½ä»¤
1056   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
1057   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
1058   1          IAP_TRIG = 0x5a;                //è§¦å‘
1059   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
1060   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
1061   1          loc_dat = IAP_DATA;             //è¯»å‡ºEEPROMä¸­çš„æ•°æ®
1062   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
1063   1          return loc_dat;                 //è¿”å›è¯»å–ç»“æœ
1064   1      }//è¯»å–EEPROMæ•°æ®
1065          void fun_writee2prom(ui par_add,uc par_dat){
1066   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
1067   1          IAP_CMD = 2;                    //è®¾ç½®EEPROMå†™å…¥å‘½ä»¤
1068   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
1069   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
1070   1          IAP_DATA = par_dat;             //å†™å…¥æ•°æ®
1071   1          IAP_TRIG = 0x5a;                //è§¦å‘
1072   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
1073   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
1074   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
1075   1      }//å†™EEPROMæ•°æ®
1076          void fun_cleane2prom(ui par_add){
1077   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
1078   1          IAP_CMD = 3;                    //è®¾ç½®EEPROMæ“¦é™¤å‘½ä»¤
1079   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
1080   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
1081   1          IAP_TRIG = 0x5a;                //è§¦å‘
1082   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
1083   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
1084   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
1085   1      }//æ¸…é™¤EEPROMæ•°æ®
1086          void fun_calibration(){
1087   1          // fun_sj1(sjp_1);//å‡åˆ°æœ€ä¸Šä½
1088   1          ul loc_time;
1089   1          fun_py1(tra_q);//ç§»åŠ¨åˆ°æœ€å‰ç«¯
1090   1          fun_py1(tra_h);//ç§»åŠ¨åˆ°æœ€åç«¯
1091   1          loc_time=var_timer;
1092   1          fun_py1(tra_q);//ç§»åŠ¨åˆ°å‰ç«¯å¹¶è®¡æ—¶
1093   1          fun_py1(tra_h);//ç§»åŠ¨åˆ°åç«¯
1094   1          loc_time=var_timer-loc_time;
1095   1          loc_time*=0.5;
1096   1          str_cod.py1zh=loc_time*0.5;//ä»ååˆ°ä¸­é—´
1097   1          str_cod.py1qz=loc_time*0.5;//ä»å‰åˆ°ä¸­é—´
1098   1          str_cod.py1qkh=loc_time*0.75;//ä»å‰åˆ°é å
1099   1          str_cod.py1kqh=loc_time*0.564;//ä»é å‰åˆ°å
1100   1          str_cod.py1qkq=loc_time*0.34;//ä»å‰åˆ°é å‰
1101   1          str_cod.py1khh=loc_time*0.2701;//ä»ååˆ°é å
1102   1          str_cod.py1kqz=loc_time*0.189;//ä»é å‰åˆ°ä¸­é—´
1103   1          str_cod.py1zkh=loc_time*0.20;//ä»é ååˆ°ä¸­é—´.
1104   1          str_cod.py1kqkh=loc_time*0.5;//ä»é å‰åˆ°é å
1105   1      }//è‡ªåŠ¨æ ¡å‡†å¹³ç§»å‚æ•°
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 19  

1106          void fun_port(){
1107   1          /*
1108   1          PCON|=0x80;     //ä½¿èƒ½æ³¢ç‰¹ç‡å€é€Ÿä½SMOD
1109   1          SCON=0x50;      //8ä½æ•°æ®,å¯å˜æ³¢ç‰¹ç‡
1110   1          AUXR|=0x04;     //ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨æ—¶é’Ÿä¸ºFosc,å³1T
1111   1          BRT=0xD9;       //è®¾å®šç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨é‡è£…å€¼
1112   1          AUXR|=0x01;     //ä¸²å£1é€‰æ‹©ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨ä¸ºæ³¢ç‰¹ç‡å‘ç”Ÿå™¨
1113   1          AUXR|=0x10;     //å¯åŠ¨ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨
1114   1          TI=1;           //æ‰“å¼€ä¸²å£ä¼ è¾“åŠŸèƒ½
1115   1          */
1116   1          //38400bps@30.000MHz
1117   1          PCON |= 0x80;       //ä½¿èƒ½æ³¢ç‰¹ç‡å€é€Ÿä½SMOD
1118   1          SCON = 0x50;        //8ä½æ•°æ®,å¯å˜æ³¢ç‰¹ç‡
1119   1          AUXR |= 0x04;       //ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨æ—¶é’Ÿä¸ºFosc,å³1T
1120   1          BRT = 0xCF;     //è®¾å®šç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨é‡è£…å€¼
1121   1          AUXR |= 0x01;       //ä¸²å£1é€‰æ‹©ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨ä¸ºæ³¢ç‰¹ç‡å‘ç”Ÿå™¨
1122   1          AUXR |= 0x10;       //å¯åŠ¨ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨
1123   1          TI=1;           //æ‰“å¼€ä¸²å£ä¼ è¾“åŠŸèƒ½
1124   1      }//ä¸²å£åˆå§‹åŒ–
1125          void fun_test(){
1126   1          fun_sz1(han_j);
1127   1          fun_delay(1,del_s);
1128   1          fun_sz1(han_s);
1129   1          fun_delay(1,del_s);
1130   1          fun_sz1(han_j);
1131   1          fun_delay(1,del_s);
1132   1          fun_sz1(han_s);
1133   1          fun_delay(1,del_s);
1134   1      
1135   1          str_begin.pywz=tra_h;
1136   1          fun_py1(tra_q);
1137   1          fun_delay(1,del_s);
1138   1          fun_py1(tra_h);
1139   1          fun_delay(1,del_s);
1140   1          fun_py1(tra_q);
1141   1          fun_delay(1,del_s);
1142   1          fun_py1(tra_h);
1143   1          fun_delay(1,del_s);
1144   1      
1145   1          fun_sj1(sjp_1);
1146   1          fun_delay(1,del_s);
1147   1          fun_sj1(sjp_2);
1148   1          fun_delay(1,del_s);
1149   1          fun_sj1(sjp_3);
1150   1          fun_delay(1,del_s);
1151   1          fun_sj1(sjp_4);
1152   1          fun_delay(1,del_s);
1153   1          fun_sj1(sjp_5);
1154   1          fun_delay(1,del_s);
1155   1          fun_sj1(sjp_4);
1156   1          fun_delay(1,del_s);
1157   1          fun_sj1(sjp_3);
1158   1          fun_delay(1,del_s);
1159   1          fun_sj1(sjp_2);
1160   1          fun_delay(1,del_s);
1161   1          fun_sj1(sjp_1);
1162   1      
1163   1          str_now.hzfx=str_begin.hzfx;
1164   1          str_begin.hzfx=dir_up;
1165   1          fun_hz1(dir_right);
1166   1          fun_delay(1,del_s);
1167   1          fun_hz1(dir_up);
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 20  

1168   1          fun_delay(1,del_s);
1169   1          fun_hz1(dir_right);
1170   1          fun_delay(1,del_s);
1171   1          fun_hz1(dir_up);
1172   1          fun_delay(1,del_s);
1173   1          str_begin.hzfx=str_now.hzfx;
1174   1      
1175   1          fun_motors(mot_rl,60);
1176   1          fun_delay(1,del_s);
1177   1          fun_motors(mot_rl,0);
1178   1          fun_delay(1,del_s);
1179   1      
1180   1          fun_motors(mot_rl,-60);
1181   1          fun_delay(1,del_s);
1182   1          fun_motors(mot_rl,0);
1183   1          fun_delay(1,del_s);
1184   1      
1185   1          fun_motors(mot_r,40);
1186   1          fun_motors(mot_l,-40);
1187   1          fun_delay(1,del_s);
1188   1          fun_motors(mot_rl,0);
1189   1          fun_delay(1,del_s);
1190   1      
1191   1          fun_motors(mot_r,-40);
1192   1          fun_motors(mot_l,40);
1193   1          fun_delay(1,del_s);
1194   1          fun_motors(mot_rl,0);
1195   1      }//æµ‹è¯•ç¨‹åº
1196          uc fun_min(uc par_num,...){
1197   1          va_list loc_argp;//ä¿å­˜å‚æ•°ç»“æ„
1198   1          uc loc_min=par_num;//ç°åœ¨çš„æœ€å°å€¼å°±æ˜¯ç¬¬ä¸€ä¸ª
1199   1          uc loc_shu;//å½“å‰å‚æ•°
1200   1          va_start(loc_argp,par_num);//loc_argpæŒ‡å‘ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œpar_numæ˜¯æœ€åä¸€ä¸ªç¡®å
             -®šçš„å‚æ•°
1201   1          loc_shu=va_arg(loc_argp,uc);//å–å‡ºä¸‹ä¸€ä¸ªå‚æ•°
1202   1          do{
1203   2              if(loc_shu<loc_min)
1204   2                  loc_min=loc_shu;
1205   2              loc_shu=va_arg(loc_argp,uc);//å–å‡ºä¸‹ä¸€ä¸ªå‚æ•°
1206   2          }while(loc_shu!=def_end);
1207   1          va_end(loc_argp);//ç»“æŸ
1208   1          return loc_min;//é€€å‡º
1209   1      }//æ±‚æœ€å°å€¼
1210          void fun_coordinate(){
1211   1          
1212   1      }//è‡ªåŠ¨å·¡çº¿ä¹‹åæ ‡
1213          void fun_zdzj(ul par_04,ul par_37){//ulå‹æ•°æ®,ä¸€æ¬¡è¾“å…¥æ‰€æœ‰ç»“æœ,æ— éœ€ç­‰å¾…
1214   1          xdata struct str_zdzj str_pass,str_end;//str_zdzj(è‡ªåŠ¨æŠ“ä»¶)çš„ç»“æ„ä½“:ç°åœ¨çš„æ•°æ®å’Œç»“æŸæ—
             -¶å¾—åˆ°çš„ç»“æœ
1215   1          xdata uc loc_high[8];         //æ¯æ‘å·¥ä»¶çš„é«˜åº¦
1216   1          xdata uc loc_xh1;             //ç¬¬ä¸€ä¸ªå¾ªç¯
1217   1      
1218   1          memset(str_pass.jx,0,sizeof(str_pass.jx));//æ¸…ç©ºç°åœ¨ä»¶åº
1219   1          memset(str_end.jx,0,sizeof(str_end.jx));//æ¸…ç©ºæƒ³è¦çš„ä»¶åº
1220   1          memset(loc_high,0,sizeof(loc_high));//æ¸…ç©ºé«˜åº¦æ•°ç»„
1221   1      
1222   1          //èµ·å§‹åŒºä»¶å·
1223   1          str_pass.jx[0][1]=(par_04/10000000)%10;  //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬1å·ä»¶ä»¶å·(æœ€é«˜ä½)
1224   1          str_pass.jx[0][2]=(par_04/1000000)%10;   //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬2å·ä»¶ä»¶å·
1225   1          str_pass.jx[0][3]=(par_04/100000)%10;    //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬3å·ä»¶ä»¶å·
1226   1          str_pass.jx[0][4]=(par_04/10000)%10;     //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬4å·ä»¶ä»¶å·(æœ€ä½ä½)
1227   1          str_pass.jx[4][1]=(par_04/1000)%10;      //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬1å·ä»¶ä»¶å·(æœ€é«˜ä½)
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 21  

1228   1          str_pass.jx[4][2]=(par_04/100)%10;       //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬2å·ä»¶ä»¶å·
1229   1          str_pass.jx[4][3]=(par_04/10)%10;        //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬3å·ä»¶ä»¶å·
1230   1          str_pass.jx[4][4]=par_04%10;             //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬4å·ä»¶ä»¶å·(æœ€ä½ä½)
1231   1          //ç›®çš„åŒºä»¶å·
1232   1          str_pass.jx[3][1]=(par_37/10000000)%10;  //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬1å·ä»¶ä»¶å·(æœ€é«˜ä½)
1233   1          str_pass.jx[3][2]=(par_37/1000000)%10;   //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬2å·ä»¶ä»¶å·
1234   1          str_pass.jx[3][3]=(par_37/100000)%10;    //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬3å·ä»¶ä»¶å·
1235   1          str_pass.jx[3][4]=(par_37/10000)%10;     //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬4å·ä»¶ä»¶å·(æœ€ä½ä½)
1236   1          str_pass.jx[7][1]=(par_37/1000)%10;      //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬1å·ä»¶ä»¶å·(æœ€é«˜ä½)
1237   1          str_pass.jx[7][2]=(par_37/100)%10;       //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬2å·ä»¶ä»¶å·
1238   1          str_pass.jx[7][3]=(par_37/10)%10;        //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬3å·ä»¶ä»¶å·
1239   1          str_pass.jx[7][4]=par_37%10;             //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬4å·ä»¶ä»¶å·(æœ€ä½ä½)
1240   1          //ç›®çš„æ¬¡åº
1241   1          str_end.jx[3][1]=1;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº3çš„ç¬¬1å·ç›®çš„æ¬¡åºå·(æœ€é«˜ä½)
1242   1          str_end.jx[3][2]=2;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº3çš„ç¬¬2å·ç›®çš„æ¬¡åºå·
1243   1          str_end.jx[3][3]=3;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº3çš„ç¬¬3å·ç›®çš„æ¬¡åºå·
1244   1          str_end.jx[3][4]=4;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº3çš„ç¬¬4å·ç›®çš„æ¬¡åºå·(æœ€ä½ä½)
1245   1          str_end.jx[7][1]=5;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº7çš„ç¬¬1å·ç›®çš„æ¬¡åºå·(æœ€é«˜ä½)
1246   1          str_end.jx[7][2]=6;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº7çš„ç¬¬2å·ç›®çš„æ¬¡åºå·
1247   1          str_end.jx[7][3]=7;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº7çš„ç¬¬3å·ç›®çš„æ¬¡åºå·
1248   1          str_end.jx[7][4]=8;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº7çš„ç¬¬4å·ç›®çš„æ¬¡åºå·(æœ€ä½ä½)
1249   1      
1250   1          for(loc_xh1=1;loc_xh1<=4;loc_xh1++){
1251   2              if((str_pass.jx[0][loc_xh1]==str_pass.jx[3][1])&&(str_pass.jx[0][loc_xh1]!=0))
1252   2                  str_end.jx[0][loc_xh1]=str_end.jx[3][1];
1253   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[3][2])&&(str_pass.jx[0][loc_xh1]!=0))
1254   2                  str_end.jx[0][loc_xh1]=str_end.jx[3][2];
1255   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[3][3])&&(str_pass.jx[0][loc_xh1]!=0))
1256   2                  str_end.jx[0][loc_xh1]=str_end.jx[3][3];
1257   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[3][4])&&(str_pass.jx[0][loc_xh1]!=0))
1258   2                  str_end.jx[0][loc_xh1]=str_end.jx[3][4];
1259   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[7][1])&&(str_pass.jx[0][loc_xh1]!=0))
1260   2                  str_end.jx[0][loc_xh1]=str_end.jx[7][1];
1261   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[7][2])&&(str_pass.jx[0][loc_xh1]!=0))
1262   2                  str_end.jx[0][loc_xh1]=str_end.jx[7][2];
1263   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[7][3])&&(str_pass.jx[0][loc_xh1]!=0))
1264   2                  str_end.jx[0][loc_xh1]=str_end.jx[7][3];
1265   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[7][4])&&(str_pass.jx[0][loc_xh1]!=0))
1266   2                  str_end.jx[0][loc_xh1]=str_end.jx[7][4];
1267   2      
1268   2              if((str_pass.jx[4][loc_xh1]==str_pass.jx[3][1])&&(str_pass.jx[4][loc_xh1]!=0))
1269   2                  str_end.jx[4][loc_xh1]=str_end.jx[3][1];
1270   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[3][2])&&(str_pass.jx[4][loc_xh1]!=0))
1271   2                  str_end.jx[4][loc_xh1]=str_end.jx[3][2];
1272   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[3][3])&&(str_pass.jx[4][loc_xh1]!=0))
1273   2                  str_end.jx[4][loc_xh1]=str_end.jx[3][3];
1274   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[3][4])&&(str_pass.jx[4][loc_xh1]!=0))
1275   2                  str_end.jx[4][loc_xh1]=str_end.jx[3][4];
1276   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[7][1])&&(str_pass.jx[4][loc_xh1]!=0))
1277   2                  str_end.jx[4][loc_xh1]=str_end.jx[7][1];
1278   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[7][2])&&(str_pass.jx[4][loc_xh1]!=0))
1279   2                  str_end.jx[4][loc_xh1]=str_end.jx[7][2];
1280   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[7][3])&&(str_pass.jx[4][loc_xh1]!=0))
1281   2                  str_end.jx[4][loc_xh1]=str_end.jx[7][3];
1282   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[7][4])&&(str_pass.jx[4][loc_xh1]!=0))
1283   2                  str_end.jx[4][loc_xh1]=str_end.jx[7][4];
1284   2          }//é€šè¿‡å®é™…ä»¶åºè·å¾—ç¼–å·
1285   1      
1286   1          memset(str_pass.jx,0,sizeof(str_pass.jx));//æ¸…ç©ºç°åœ¨å®é™…ä»¶åº
1287   1      
1288   1      
1289   1      
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 22  

1290   1      
1291   1          
1292   1      }//è‡ªåŠ¨æŠ“ä»¶
1293          void fun_zjzt(uc par_model){
1294   1          switch(par_model){
1295   2              case 0:
1296   2                  fun_py1(tra_z);
1297   2                  fun_hz1(dir_left);
1298   2                  fun_py1(tra_h);
1299   2                  break;
1300   2              case 1:
1301   2                  fun_py1(tra_z);
1302   2                  fun_hz1(dir_left);
1303   2                  fun_py1(tra_kh);
1304   2                  break;
1305   2              case 2:
1306   2                  fun_py1(tra_z);
1307   2                  fun_hz1(dir_left);
1308   2                  fun_py1(tra_kq);
1309   2                  break;
1310   2              case 3:
1311   2                  fun_py1(tra_z);
1312   2                  fun_hz1(dir_left);
1313   2                  fun_py1(tra_q);
1314   2                  break;
1315   2              case 4:
1316   2                  fun_py1(tra_z);
1317   2                  fun_hz1(dir_right);
1318   2                  fun_py1(tra_q);
1319   2                  break;
1320   2              case 5:
1321   2                  fun_py1(tra_z);
1322   2                  fun_hz1(dir_right);
1323   2                  fun_py1(tra_kq);
1324   2                  break;
1325   2              case 6:
1326   2                  fun_py1(tra_z);
1327   2                  fun_hz1(dir_right);
1328   2                  fun_py1(tra_kh);
1329   2                  break;
1330   2              case 7:
1331   2                  fun_py1(tra_z);
1332   2                  fun_hz1(dir_right);
1333   2                  fun_py1(tra_h);
1334   2                  break;
1335   2          }
1336   1      }//æŠ“ä»¶çŠ¶æ€,0ä¸ºå·¦ä¸Šä½,3ä¸ºå·¦ä¸‹ä½,4ä¸ºå³ä¸Šä½,7ä¸ºå³ä¸‹ä½
1337          void fun_zhuajian(){
1338   1          fun_folline(2,70);
1339   1          fun_turn(tur_l90,40);
1340   1          fun_folline(1,40);
1341   1      }//ä»èµ·å§‹åŒºèµ°åˆ°æŠ“ä»¶åŒº
1342          void fun_back(){
1343   1          fun_motors(mot_rl,-20);
1344   1          fun_delay(1,del_s);
1345   1      
1346   1          fun_motors(mot_rl,-50);
1347   1          fun_delay(1,del_s);
1348   1      
1349   1          fun_motors(mot_r,-50);
1350   1          fun_motors(mot_l,-20);
1351   1          fun_delay(1,del_s);
C51 COMPILER V9.54   8023                                                                  09/18/2015 14:04:48 PAGE 23  

1352   1      }//ä»æŠ“ä»¶åŒºå›åˆ°èµ·å§‹åŒº


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   6657    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    148      89
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5      51
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
