C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE 8023
OBJECT MODULE PLACED IN .\output\8023.obj
COMPILER INVOKED BY: D:\MyProgram\keil\C51\BIN\C51.EXE program\8023.c LARGE OPTIMIZE(8,SPEED) DEBUG OBJECTEXTEND PRINT(.
                    -\8023.lst) OBJECT(.\output\8023.obj)

line level    source

   1          #include "./output/8023.h"
   2          struct str_state str_begin,str_now,str_next;//åˆ†åˆ«ä¸º:èµ·å§‹çŠ¶æ€/å½“å‰çŠ¶æ€/ç›®æ ‡çŠ¶æ€
   3          struct str_parameter str_cod={
   4              /*ui str_cod.mlinerqd*/25000,//é»˜è®¤ä¸»å‡½æ•°å·¡çº¿è½¯èµ·åŠ¨è·¯ç¨‹ä¸º25000
   5              /*ui str_cod.mlineqc*/200,   //é»˜è®¤ä¸»å‡½æ•°å·¡çº¿å‰å†²æ—¶é—´ä¸º500æ¯«ç§’
   6          
   7              /*ui str_cod.sj1bzw*/58,     //å‡é™æ ‡å‡†ä½å»¶æ—¶
   8              /*ui str_cod.sj1zjw*/800,    //å‡é™ä¸­é—´ä½å»¶æ—¶
   9          
  10              /*ui str_cod.py1bz*/45,      //fun_pyæ ‡å‡†ä½å»¶æ—¶
  11              /*ui str_cod.py1qkq*/600,    //fun_pyå‰åˆ°é å‰å»¶æ—¶å‚æ•°
  12              /*ui str_cod.py1kqz*/525,    //fun_pyé å‰åˆ°ä¸­é—´å»¶æ—¶
  13              /*ui str_cod.py1zkh*/525,    //fun_pyä¸­é—´åˆ°é åå»¶æ—¶
  14              /*ui str_cod.py1khh*/540,    //fun_pyé ååˆ°åå»¶æ—¶
  15              /*ui str_cod.py1qz*/1155,    //fun_pyå‰åˆ°ä¸­é—´å»¶æ—¶
  16              /*ui str_cod.py1zh*/1090,    //fun_pyä¸­é—´åˆ°åå»¶æ—¶
  17              /*ui str_cod.py1kqkh*/1105,  //fun_pyé å‰åˆ°é åå»¶æ—¶
  18              /*ui str_cod.py1khkq*/1050,  //fun_pyé ååˆ°é å‰å»¶æ—¶
  19              /*ui str_cod.py1qkh*/1735,   //fun_pyå‰åˆ°é åå»¶æ—¶
  20              /*ui str_cod.py1kqh*/1635,   //fun_pyé å‰åˆ°åå»¶æ—¶
  21          
  22              /*ui str_cod.hz1bz*/20,      //fun_hzæ ‡å‡†ä½å»¶æ—¶
  23          
  24              /*ui mainturn90;*/1200,      //ä¸»å‡½æ•°90åº¦è½¬å¼¯å±è”½å»¶æ—¶
  25              /*ui timerturn90;*/700,     //å®šæ—¶å™¨90åº¦è½¬å¼¯å±è”½å»¶æ—¶
  26              /*ui mainturn180;*/2000,     //ä¸»å‡½æ•°180åº¦è½¬å¼¯å±è”½å»¶æ—¶
  27              /*ui timerturn180;*/2000     //å®šæ—¶å™¨180åº¦è½¬å¼¯å±è”½å»¶æ—¶
  28          };
  29          struct str_timerfolline str_tfl;
  30          struct str_coordinates str_zbfl;
  31          data ul var_timer;
  32          void fun_delay(ui par_value,enum varENU_del par_model){
  33   1          data ui loc_con=par_value;
  34   1          switch(par_model){
  35   2              case del_us://å¾®ç§’çº§å»¶æ—¶
  36   2                  while(loc_con-->0){
  37   3                      _nop_();
  38   3                      _nop_();
  39   3                  }
  40   2                  return;
  41   2              case del_ms://æ¯«ç§’çº§å»¶æ—¶
  42   2                  while(loc_con-->0){
  43   3                      data uc loc_i, loc_j;
  44   3                      _nop_();
  45   3                      _nop_();
  46   3                      loc_i=12;
  47   3                      loc_j=168;
  48   3                      do{
  49   4                          while(--loc_j);
  50   4                      }while(--loc_i);
  51   3                  }
  52   2                  return;
  53   2              case del_s://ç§’çº§å»¶æ—¶
  54   2                  while(loc_con-->0){
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 2   

  55   3                      data uc loc_i, loc_j, loc_k;
  56   3                      loc_i=46;
  57   3                      loc_j=153;
  58   3                      loc_k=245;
  59   3                      do{
  60   4                          do{
  61   5                              while(--loc_k);
  62   5                          }while(--loc_j);
  63   4                      }while(--loc_i);
  64   3                  }
  65   2                  return;
  66   2              default:return;
  67   2          }
  68   1      }//å»¶æ—¶
  69          void fun_timer0init(){
  70   1          AUXR|=0x80;   //å®šæ—¶å™¨æ—¶é’Ÿ1Tæ¨¡å¼
  71   1          TMOD&=0xF0;   //å®šæ—¶å™¨æ¨¡å¼:16ä½
  72   1          TMOD|=0x01;   //å®šæ—¶å™¨æ¨¡å¼:16ä½
  73   1          TL0=0x20;     //å®šæ—¶åˆå€¼:1ms
  74   1          TH0=0xD1;     //å®šæ—¶åˆå€¼:1ms
  75   1          TF0=0;        //æ¸…é™¤TF0æ ‡å¿—
  76   1          ET0=1;
  77   1          EA=1;         //å¼€å¯æ€»ä¸­æ–­
  78   1      }//1æ¯«ç§’å®šæ—¶å™¨0åˆå§‹åŒ–
  79          void fun_timer1init(){
  80   1          AUXR&=0xBF;     //å®šæ—¶å™¨æ—¶é’Ÿ12Tæ¨¡å¼
  81   1          TMOD&=0x0F;     //å®šæ—¶å™¨æ¨¡å¼:16ä½
  82   1          TMOD|=0x10;     //å®šæ—¶å™¨æ¨¡å¼:16ä½
  83   1          TL1=0xE0;       //å®šæ—¶åˆå€¼:20ms
  84   1          TH1=0xB1;       //å®šæ—¶åˆå€¼:20ms
  85   1          TF1=0;          //æ¸…é™¤TF1æ ‡å¿—
  86   1          ET1=1;
  87   1          EA=1;           //å¼€å¯æ€»ä¸­æ–­
  88   1      }//20æ¯«ç§’å®šæ—¶å™¨1åˆå§‹åŒ–
  89          void fun_timer0(){
  90   1          TL0=0x20;
  91   1          TH0=0xD1;//å®šæ—¶å™¨åˆå€¼æ¢å¤è‡³1ms
  92   1          var_timer++;//å…¨å±€è®¡æ—¶å™¨å¼€å§‹è®¡æ—¶
  93   1          if(str_tfl.doing==tf_ture)//å¦‚æœæ­£åœ¨ç§»åŠ¨
  94   1              fun_timermove();//å®šæ—¶å™¨ç§»åŠ¨
  95   1      }//1æ¯«ç§’å®šæ—¶å™¨0å¤„ç†å‡½æ•°
  96          void fun_timer1(){
  97   1          TL1=0xE0;
  98   1          TH1=0xB1;
  99   1      }//20æ¯«ç§’å®šæ—¶å™¨1å¤„ç†å‡½æ•°
 100          void fun_wait(){
 101   1          in_start=1;               //æŒ‰é”®ç½®1
 102   1          #ifdef Debug
 103   1              fun_delay(1,del_s);
 104   1              printf("fun_wait();\n");
 105   1          #else
                      while(in_start==1);
                      fun_delay(20,del_ms);
                      while(in_start==0);
                      fun_delay(256,del_ms);
                  #endif
 111   1      }//ç­‰å¾…æŒ‰é”®
 112          void fun_pwminit(){
 113   1          CCON=0x00;//PACå¯„å­˜æ§åˆ¶å™¨
 114   1          CH=0;//é‡ç½®PACè®¡æ—¶å™¨
 115   1          CL=0;
 116   1          CMOD=0x08;//ä¸åˆ†é¢‘
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 3   

 117   1      }//PWMåˆå§‹åŒ–
 118          void fun_pwmr(uc par_value){
 119   1          CCAP0H=CCAP0L=par_value*25/10;//æ§åˆ¶è¾“å‡ºçš„å ç©ºæ¯”
 120   1          CCAPM0=0X42;//8ä½PWMè¾“å‡ºï¼Œæ— ä¸­æ–­
 121   1          PCA_PWM0=0x00;
 122   1      }//å³è·¯PWMè¾“å‡º
 123          void fun_pwml(uc par_value){
 124   1          CCAP1H=CCAP1L=par_value*25/10;//æ§åˆ¶è¾“å‡ºçš„å ç©ºæ¯”
 125   1          CCAPM1=0X42;//8ä½PWMè¾“å‡ºï¼Œæ— ä¸­æ–­
 126   1          PCA_PWM1=0x00;
 127   1      }//å·¦è·¯PWMè¾“å‡º
 128          void fun_motors(enum varENU_mot par_model,char par_speed){
 129   1          if(par_speed>100)
 130   1              par_speed=100;
 131   1          else if(par_speed<-100)
 132   1              par_speed=-100;//é€Ÿåº¦æœ€å¤š100,æœ€å°‘-100
 133   1          switch(par_model){
 134   2              case mot_l://å·¦è½®ç”µæœº
 135   2                  if(str_begin.leftsd==par_speed)
 136   2                      return;
 137   2                  else
 138   2                      str_begin.leftsd=par_speed;
 139   2                  if(par_speed==0){
 140   3                      fun_pwml(0);out_pwml=0;
 141   3                  }
 142   2                  else if(par_speed>0){
 143   3                      CR=1;fun_pwml(par_speed);out_pwml=0;
 144   3                  }
 145   2                  else if(par_speed<0){
 146   3                      CR=1;fun_pwml(cabs(par_speed));out_pwml=1;
 147   3                  }
 148   2                  break;
 149   2              case mot_r://å³è½®ç”µæœº
 150   2                  if(str_begin.rightsd==par_speed)
 151   2                      return;
 152   2                  else
 153   2                      str_begin.rightsd=par_speed;
 154   2                  if(par_speed==0){
 155   3                      fun_pwmr(0);out_pwmr=0;
 156   3                  }
 157   2                  else if(par_speed>0){
 158   3                      CR=1;fun_pwmr(par_speed);out_pwmr=0;
 159   3                  }
 160   2                  else if(par_speed<0){
 161   3                      CR=1;fun_pwmr(cabs(par_speed));out_pwmr=1;
 162   3                  }
 163   2                  break;
 164   2              case mot_rl://å·¦å³è½®åŒæ­¥
 165   2                  if((str_begin.leftsd==par_speed)&&(str_begin.rightsd==par_speed))
 166   2                      return;
 167   2                  else
 168   2                      str_begin.leftsd=str_begin.rightsd=par_speed;
 169   2                  if(par_speed==0){
 170   3                      CR=0;
 171   3                      fun_pwmr(0);out_pwmr=0;
 172   3                      fun_pwml(0);out_pwml=0;
 173   3                  }
 174   2                  else if(par_speed>0){
 175   3                      CR=1;
 176   3                      fun_pwml(par_speed);out_pwml=0;
 177   3                      fun_pwmr(par_speed);out_pwmr=0;
 178   3                  }
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 4   

 179   2                  else if(par_speed<0){
 180   3                      CR=1;
 181   3                      fun_pwml(cabs(par_speed));out_pwml=1;
 182   3                      fun_pwmr(cabs(par_speed));out_pwmr=1;
 183   3                  }
 184   2                  break;
 185   2              case mot_sz://æ­£è½¬ä¸ºæŠ“ç´§ï¼Œåè½¬ä¸ºæ¾å¼€
 186   2                  if(str_begin.szsd==par_speed)
 187   2                      return;
 188   2                  else
 189   2                      str_begin.szsd=par_speed;
 190   2                  if(par_speed==0){
 191   3                      out_motorselect=1;out_dir1=0;out_en1=1;
 192   3                  }
 193   2                  else if(par_speed>0){
 194   3                      out_motorselect=1;out_dir1=1;out_en1=0;
 195   3                  }
 196   2                  else if(par_speed<0){
 197   3                      out_motorselect=1;out_dir1=0;out_en1=0;
 198   3                  }
 199   2                  break;
 200   2              case mot_py://æ­£è½¬æ˜¯å‘æ— ç”µæœºä¸€æ–¹è½¬,åè½¬ä¸ºå‘æœ‰ç”µæœºä¸€æ–¹è½¬
 201   2                  if(str_begin.pysd==par_speed)
 202   2                      return;
 203   2                  else
 204   2                      str_begin.pysd=par_speed;
 205   2                  if(par_speed==0){
 206   3                      out_motorselect=1;out_dir2=0;out_en2=1;
 207   3                  }
 208   2                  else if(par_speed>0){
 209   3                      out_motorselect=1;out_dir2=1;out_en2=0;
 210   3                  }
 211   2                  else if(par_speed<0){
 212   3                      out_motorselect=1;out_dir2=0;out_en2=0;
 213   3                  }
 214   2                  break;
 215   2              case mot_sj://å‘ä¸Šä¸ºæ­£è½¬,å‘ä¸‹ä¸ºåè½¬
 216   2                  if(str_begin.sjsd==par_speed)
 217   2                      return;
 218   2                  else
 219   2                      str_begin.sjsd=par_speed;
 220   2                  if(par_speed==0){
 221   3                      out_motorselect=0;out_dir1=0;out_en1=1;
 222   3                  }
 223   2                  else if(par_speed>0){
 224   3                      out_motorselect=0;out_dir1=0;out_en1=0;
 225   3                  }
 226   2                  else if(par_speed<0){
 227   3                      out_motorselect=0;out_dir1=1;out_en1=0;
 228   3                  }
 229   2                  break;
 230   2              case mot_hz://é¡ºæ—¶é’ˆä¸ºæ­£è½¬,é€†æ—¶é’ˆä¸ºåè½¬
 231   2                  if(str_begin.hzsd==par_speed)
 232   2                      return;
 233   2                  else
 234   2                      str_begin.hzsd=par_speed;
 235   2                  if(par_speed==0){
 236   3                      out_motorselect=0;out_dir2=0;out_en2=1;
 237   3                  }
 238   2                  else if(par_speed>0){
 239   3                      out_motorselect=0;out_dir2=0;out_en2=0;
 240   3                  }
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 5   

 241   2                  else if(par_speed<0){
 242   3                      out_motorselect=0;out_dir2=1;out_en2=0;
 243   3                  }
 244   2                  break;
 245   2              default:
 246   2                  break;
 247   2          }
 248   1      }//ä¸»å‡½æ•°æ“ä½œç”µæœº
 249          void fun_motorsrl(enum varENU_mot par_model,int par_speed){
 250   1          if(par_speed>100)
 251   1              par_speed=100;
 252   1          else if(par_speed<-100)
 253   1              par_speed=-100;//é€Ÿåº¦æœ€å¤š100,æœ€å°‘-100
 254   1          switch(par_model){
 255   2              case mot_l://å·¦è½®ç”µæœº
 256   2                  if(str_begin.leftsd==par_speed)
 257   2                      return;
 258   2                  else
 259   2                      str_begin.leftsd=par_speed;
 260   2                  if(par_speed==0){
 261   3                      fun_pwml(0);out_pwml=0;
 262   3                  }
 263   2                  else if(par_speed>0){
 264   3                      CR=1;fun_pwml(par_speed);out_pwml=0;
 265   3                  }
 266   2                  else if(par_speed<0){
 267   3                      CR=1;fun_pwml(cabs(par_speed));out_pwml=1;
 268   3                  }
 269   2                  break;
 270   2              case mot_r://å³è½®ç”µæœº
 271   2                  if(str_begin.rightsd==par_speed)
 272   2                      return;
 273   2                  else
 274   2                      str_begin.rightsd=par_speed;
 275   2                  if(par_speed==0){
 276   3                      fun_pwmr(0);out_pwmr=0;
 277   3                  }
 278   2                  else if(par_speed>0){
 279   3                      CR=1;fun_pwmr(par_speed);out_pwmr=0;
 280   3                  }
 281   2                  else if(par_speed<0){
 282   3                      CR=1;fun_pwmr(cabs(par_speed));out_pwmr=1;
 283   3                  }
 284   2                  break;
 285   2              case mot_rl://å·¦å³è½®åŒæ­¥
 286   2                  if((str_begin.leftsd==par_speed)&&(str_begin.rightsd==par_speed))
 287   2                      return;
 288   2                  else
 289   2                      str_begin.leftsd=str_begin.rightsd=par_speed;
 290   2                  if(par_speed==0){
 291   3                      CR=0;
 292   3                      fun_pwmr(0);out_pwmr=0;
 293   3                      fun_pwml(0);out_pwml=0;
 294   3                  }
 295   2                  else if(par_speed>0){
 296   3                      CR=1;
 297   3                      fun_pwml(par_speed);out_pwml=0;
 298   3                      fun_pwmr(par_speed);out_pwmr=0;
 299   3                  }
 300   2                  else if(par_speed<0){
 301   3                      CR=1;
 302   3                      fun_pwml(cabs(par_speed));out_pwml=1;
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 6   

 303   3                      fun_pwmr(cabs(par_speed));out_pwmr=1;
 304   3                  }
 305   2                  break;
 306   2              default:
 307   2                  break;
 308   2          }
 309   1      }//å®šæ—¶å™¨æ“ä½œå·¦å³è½®
 310          void fun_sz(enum varENU_han par_model){
 311   1          if(str_begin.szzt==par_model)
 312   1              return;
 313   1          if(par_model==han_s){//æ‰‹æŠ“æ¾
 314   2              #ifdef Debug
 315   2                  printf("fun_sz(han_s);\n");
 316   2              #else
                          fun_motors(mot_sz,-100);
                          while(in_s==1);
                      #endif
 320   2          }
 321   1          else{//æ‰‹æŠ“ç´§
 322   2              #ifdef Debug
 323   2                  printf("fun_sz(han_j);\n");
 324   2              #else
                          fun_motors(mot_sz,100);
                          while(in_j==1);
                      #endif
 328   2          }
 329   1              fun_delay(20,del_ms);
 330   1              fun_motors(mot_sz,0);
 331   1          str_begin.szzt=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 332   1      }//æ‰‹æŠ“å•æ­¥è¿åŠ¨
 333          void fun_py(enum varENU_tra par_model){
 334   1          if(str_begin.pywz==par_model)
 335   1              return;
 336   1          switch(par_model){
 337   2              case tra_q://å‰å¹³ç§»(æ²¡æœ‰ç”µæœºçš„å‘¢ä¸ªæ–¹å‘)
 338   2                  #ifdef Debug
 339   2                      printf("fun_py(tra_q);\n");
 340   2                  #else
                              fun_motors(mot_py,100);
                              while(in_qpy==1);
                              fun_delay(str_cod.py1bz,del_ms);
                          #endif
 345   2                      break;
 346   2              case tra_kq://é å‰å¹³ç§»
 347   2                  #ifdef Debug
 348   2                      printf("fun_py(tra_kq);\n");
 349   2                  #else
                              switch(str_begin.pywz){
                                  case tra_q://ç°åœ¨åœ¨å‰é¢
                                      fun_motors(mot_py,-100);
                                      fun_delay(str_cod.py1qkq,del_ms);
                                      break;
                                  case tra_z://ç°åœ¨åœ¨ä¸­é—´
                                      fun_motors(mot_py,100);
                                      fun_delay(str_cod.py1kqz,del_ms);
                                      break;
                                  case tra_kh://ç°åœ¨åœ¨é å
                                      fun_motors(mot_py,100);
                                      fun_delay(str_cod.py1khkq,del_ms);
                                      break;
                                  case tra_h://ç°åœ¨åœ¨å
                                      fun_motors(mot_py,100);
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 7   

                                      fun_delay(str_cod.py1kqh,del_ms);
                                      break;
                              }
                          #endif
 369   2                      break;
 370   2              case tra_z://å¹³ç§»åˆ°ä¸­é—´
 371   2                  #ifdef Debug
 372   2                      printf("fun_py(tra_z);\n");
 373   2                  #else
                              switch(str_begin.pywz){
                                  case tra_q://ç°åœ¨åœ¨å‰é¢
                                      fun_motors(mot_py,-100);
                                      fun_delay(str_cod.py1qz,del_ms);
                                      break;
                                  case tra_kq://ç°åœ¨åœ¨é å‰
                                      fun_motors(mot_py,-100);
                                      fun_delay(str_cod.py1kqz,del_ms);
                                      break;
                                  case tra_kh://ç°åœ¨åœ¨é å
                                      fun_motors(mot_py,100);
                                      fun_delay(str_cod.py1zkh,del_ms);
                                      break;
                                  case tra_h://ç°åœ¨åœ¨åé¢
                                      fun_motors(mot_py,100);
                                      fun_delay(str_cod.py1zh,del_ms);
                                      break;
                              }
                          #endif
 393   2                      break;
 394   2              case tra_kh://å¹³ç§»åˆ°é å
 395   2                  #ifdef Debug
 396   2                      printf("fun_py(tra_kh);\n");
 397   2                  #else
                              switch(str_begin.pywz){
                                  case tra_q://ç°åœ¨åœ¨å‰é¢
                                      fun_motors(mot_py,-100);
                                      fun_delay(str_cod.py1qkh,del_ms);
                                      break;
                                  case tra_kq://ç°åœ¨åœ¨é å‰
                                      fun_motors(mot_py,-100);
                                      fun_delay(str_cod.py1kqkh,del_ms);
                                      break;
                                  case tra_z://ç°åœ¨åœ¨ä¸­é—´
                                      fun_motors(mot_py,-100);
                                      fun_delay(str_cod.py1zkh,del_ms);
                                      break;
                                  case tra_h://ç°åœ¨åœ¨åé¢
                                      fun_motors(mot_py,100);
                                      fun_delay(str_cod.py1khh,del_ms);
                                      break;
                              }
                          #endif
 417   2                      break;
 418   2              case tra_h://åå¹³ç§»(æœ‰ç”µæœºçš„å‘¢ä¸ªæ–¹å‘)
 419   2                  #ifdef Debug
 420   2                      printf("fun_py(tra_h);\n");
 421   2                  #else
                              fun_motors(mot_py,-100);
                              while(in_hpy==1);
                              fun_delay(str_cod.py1bz,del_ms);
                          #endif
 426   2                      break;
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 8   

 427   2              default:
 428   2                  break;
 429   2          }
 430   1          fun_motors(mot_py,0);
 431   1          str_begin.pywz=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 432   1      }//å¹³ç§»å•æ­¥è¿åŠ¨
 433          void fun_sj(enum varENU_sjp par_model){
 434   1          if(str_begin.sjwz==par_model)
 435   1             return;
 436   1          def_select(sel_58)
 437   1          switch(par_model){
 438   2              case sjp_1://å‡é™ä½ç½®1(æœ€ä¸Šä½)
 439   2                  #ifdef Debug
 440   2                      printf("fun_sj(sjp_1);\n");
 441   2                  #else
                              fun_motors(mot_sj,100);
                              def_select(sel_58);
                              while(in_wz1==1);
                              fun_delay(str_cod.sj1bzw,del_ms);
                          #endif
 447   2                      break;
 448   2              case sjp_12:
 449   2                  #ifdef Debug
 450   2                      printf("fun_sj(sjp_12);\n");
 451   2                  #else
                              if(par_model>str_begin.sjwz){
                                  fun_motors(mot_sj,-100);
                                  fun_delay(str_cod.sj1zjw,del_ms);
                              }
                              else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
                                  fun_sj(sjp_2);
                                  fun_motors(mot_sj,100);
                                  fun_delay(str_cod.sj1zjw,del_ms);
                              }
                          #endif
 462   2                      break;
 463   2              case sjp_2://å‡é™ä½ç½®2
 464   2                  #ifdef Debug
 465   2                      printf("fun_sj(sjp_2);\n");
 466   2                  #else
                              fun_motors(mot_sj,par_model<str_begin.sjwz?100:-100);
                              def_select(sel_58);
                              while(in_wz2==1);
                              fun_delay(str_cod.sj1bzw,del_ms);
                          #endif
 472   2                      break;
 473   2              case sjp_23:
 474   2                  #ifdef Debug
 475   2                      printf("fun_sj(sjp_23);\n");
 476   2                  #else
                              if(par_model>str_begin.sjwz){
                                  fun_sj(sjp_2);
                                  fun_motors(mot_sj,-100);
                                  fun_delay(str_cod.sj1zjw,del_ms);
                              }
                              else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
                                  fun_sj(sjp_3);
                                  fun_motors(mot_sj,100);
                                  fun_delay(str_cod.sj1zjw,del_ms);
                              }
                          #endif
 488   2                      break;
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 9   

 489   2              case sjp_3://å‡é™ä½ç½®3
 490   2                  #ifdef Debug
 491   2                      printf("fun_sj(sjp_3);\n");
 492   2                  #else
                              fun_motors(mot_sj,par_model<str_begin.sjwz?100:-100);
                              def_select(sel_58);
                              while(in_wz3==1);
                              fun_delay(str_cod.sj1bzw,del_ms);
                          #endif
 498   2                  break;
 499   2              case sjp_34:
 500   2                  #ifdef Debug
 501   2                      printf("fun_sj(sjp_34);\n");
 502   2                  #else
                              if(par_model>str_begin.sjwz){
                                  fun_sj(sjp_3);
                                  fun_motors(mot_sj,-100);
                                  fun_delay(str_cod.sj1zjw,del_ms);
                              }
                              else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
                                  fun_sj(sjp_4);
                                  fun_motors(mot_sj,100);
                                  fun_delay(str_cod.sj1zjw,del_ms);
                              }
                          #endif
 514   2                      break;
 515   2              case sjp_4://å‡é™ä½ç½®4
 516   2                  #ifdef Debug
 517   2                      printf("fun_sj(sjp_4);\n");
 518   2                  #else
                              fun_motors(mot_sj,par_model<str_begin.sjwz?100:-100);
                              def_select(sel_58);
                              while(in_wz4==1);
                              fun_delay(str_cod.sj1bzw,del_ms);
                          #endif
 524   2                      break;
 525   2              case sjp_45:
 526   2                  #ifdef Debug
 527   2                      printf("fun_sj(sjp_45);\n");
 528   2                  #else
                              if(par_model>str_begin.sjwz){
                                  fun_sj(sjp_4);
                                  fun_motors(mot_sj,-100);
                                  fun_delay(str_cod.sj1zjw,del_ms);
                              }
                              else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
                                  fun_motors(mot_sj,100);
                                  fun_delay(str_cod.sj1zjw,del_ms);
                              }
                          #endif
 539   2                      break;
 540   2              case sjp_5://å‡é™ä½ç½®5
 541   2                  #ifdef Debug
 542   2                      printf("fun_sj(sjp_5);\n");
 543   2                  #else
                              fun_motors(mot_sj,-100);
                              def_select(sel_912);
                              while(in_wz5==1);
                              fun_delay(str_cod.sj1bzw,del_ms);
                          #endif
 549   2                      break;
 550   2              default:
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 10  

 551   2                  break;
 552   2          }
 553   1          fun_motors(mot_sj,0);
 554   1          str_begin.sjwz=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 555   1      }//å‡é™å•æ­¥è¿åŠ¨
 556          void fun_hz(enum varENU_dir par_model){
 557   1          if(str_begin.hzfx==par_model)
 558   1              return;
 559   1          def_select(sel_912);
 560   1          switch(par_model){
 561   2              case dir_up://å›è½¬è‡³å‰æ–¹
 562   2                  #ifdef Debug
 563   2                      printf("fun_hz(dir_up);\n");
 564   2                  #else
                              switch(str_begin.hzfx){
                                  case dir_down://ç°åœ¨åœ¨ä¸‹æ–¹
                                      fun_motors(mot_hz,-100);
                                      fun_delay(1,del_s);
                                      while(in_hz==1);
                                      while(in_hz==0);
                                      while(in_hz==1);
                                      fun_delay(str_cod.hz1bz,del_ms);
                                      break;
                                  case dir_left://ç°åœ¨åœ¨å·¦è¾¹
                                      fun_motors(mot_hz,100);
                                      fun_delay(1,del_s);
                                      while(in_hz==1);
                                      fun_delay(str_cod.hz1bz,del_ms);
                                      break;
                                  case dir_right://ç°åœ¨åœ¨å³è¾¹
                                      fun_motors(mot_hz,-100);
                                      fun_delay(1,del_s);
                                      while(in_hz==1);
                                      fun_delay(str_cod.hz1bz,del_ms);
                                      break;
                                  default:
                                      break;
                              }
                          #endif
 590   2                      break;
 591   2              case dir_down://è¦å»ä¸‹é¢
 592   2                  #ifdef Debug
 593   2                      printf("fun_hz(dir_down);\n");
 594   2                  #else
                              switch(str_begin.hzfx){
                                  case dir_up://ç°åœ¨åœ¨ä¸Šé¢
                                      fun_motors(mot_hz,100);
                                      fun_delay(1,del_s);
                                      while(in_hz==1);
                                      while(in_hz==0);
                                      while(in_hz==1);
                                      fun_delay(str_cod.hz1bz,del_ms);
                                      break;
                                  case dir_left://ç°åœ¨åœ¨å·¦é¢
                                      fun_motors(mot_hz,-100);
                                      fun_delay(1,del_s);
                                      while(in_hz==1);
                                      fun_delay(str_cod.hz1bz,del_ms);
                                      break;
                                  case dir_right://ç°åœ¨åœ¨å³é¢
                                      fun_motors(mot_hz,100);
                                      fun_delay(1,del_s);
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 11  

                                      while(in_hz==1);
                                      fun_delay(str_cod.hz1bz,del_ms);
                                      break;
                                  default:
                                      break;
                              }
                          #endif
 620   2                      break;
 621   2              case dir_left://è¦å»å·¦è¾¹
 622   2                  #ifdef Debug
 623   2                      printf("fun_hz(dir_left);\n");
 624   2                  #else
                              switch(str_begin.hzfx){
                                  case dir_up://ç°åœ¨åœ¨ä¸Šé¢
                                      fun_motors(mot_hz,-100);
                                      fun_delay(1,del_s);
                                      while(in_hz==1);
                                      fun_delay(str_cod.hz1bz,del_ms);
                                      break;
                                  case dir_down://ç°åœ¨åœ¨ä¸‹é¢
                                      fun_motors(mot_hz,100);
                                      fun_delay(1,del_s);
                                      while(in_hz==1);
                                      fun_delay(str_cod.hz1bz,del_ms);
                                      break;
                                  case dir_right://ç°åœ¨åœ¨å³é¢
                                      fun_motors(mot_hz,-100);
                                      fun_delay(1,del_s);
                                      while(in_hz==1);
                                      while(in_hz==0);
                                      while(in_hz==1);
                                      fun_delay(str_cod.hz1bz,del_ms);
                                      break;
                                  default:
                                      break;
                              }
                          #endif
 650   2                      break;
 651   2              case dir_right://è¦å»å³é¢
 652   2                  #ifdef Debug
 653   2                      printf("fun_hz(dir_right);\n");
 654   2                  #else
                              switch(str_begin.hzfx){
                                  case dir_up://ç°åœ¨åœ¨å‰é¢
                                      fun_motors(mot_hz,100);
                                      fun_delay(1,del_s);
                                      while(in_hz==1);
                                      fun_delay(str_cod.hz1bz,del_ms);
                                      break;
                                  case dir_down://ç°åœ¨åœ¨ä¸‹é¢
                                      fun_motors(mot_hz,-100);
                                      fun_delay(1,del_s);
                                      while(in_hz==1);
                                      fun_delay(str_cod.hz1bz,del_ms);
                                      break;
                                  case dir_left://ç°åœ¨åœ¨å·¦é¢
                                      fun_motors(mot_hz,100);
                                      fun_delay(1,del_s);
                                      while(in_hz==1);
                                      while(in_hz==0);
                                      while(in_hz==1);
                                      fun_delay(str_cod.hz1bz,del_ms);
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 12  

                                      break;
                                  default:
                                      break;
                              }
                          #endif
 680   2                      break;
 681   2              default:
 682   2                  break;
 683   2          }
 684   1          fun_motors(mot_hz,0);
 685   1          str_begin.hzfx=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 686   1      }//å›è½¬å•æ­¥è¿åŠ¨
 687          void fun_pyhz(enum varENU_tra par_pymodel,enum varENU_dir par_hzmodel){
 688   1          switch(par_hzmodel){//è·å–æƒ³è¦åˆ°è¾¾çš„å›è½¬ä½ç½®
 689   2              case dir_left://è¦å»å·¦è¾¹
 690   2                  switch(str_begin.hzfx){
 691   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 692   3                          fun_motors(mot_hz,-100);
 693   3                          break;
 694   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 695   3                          fun_motors(mot_hz,-100);
 696   3                          break;
 697   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 698   3                          fun_motors(mot_hz,100);
 699   3                          break;
 700   3                      default:
 701   3                          break;
 702   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 703   2                  break;
 704   2              case dir_right://è¦å»å³è¾¹
 705   2                  switch(str_begin.hzfx){
 706   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 707   3                          fun_motors(mot_hz,100);
 708   3                          break;
 709   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 710   3                          fun_motors(mot_hz,100);
 711   3                          break;
 712   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 713   3                          fun_motors(mot_hz,-100);
 714   3                          break;
 715   3                      default:
 716   3                          break;
 717   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 718   2                  break;
 719   2              case dir_up://è¦å»ä¸Šé¢
 720   2                  switch(str_begin.hzfx){
 721   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 722   3                          fun_motors(mot_hz,100);
 723   3                          break;
 724   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 725   3                          fun_motors(mot_hz,-100);
 726   3                          break;
 727   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 728   3                          fun_motors(mot_hz,-100);
 729   3                          break;
 730   3                      default:
 731   3                          break;
 732   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 733   2                  break;
 734   2              case dir_down://è¦å»ä¸‹é¢
 735   2                  switch(str_begin.hzfx){
 736   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 13  

 737   3                          fun_motors(mot_hz,-100);
 738   3                          break;
 739   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 740   3                          fun_motors(mot_hz,100);
 741   3                          break;
 742   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 743   3                          fun_motors(mot_hz,100);
 744   3                          break;
 745   3                      default:
 746   3                          break;
 747   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 748   2                  break;
 749   2              default:
 750   2                  break;
 751   2          }//è·å–ç°åœ¨è¦å»çš„å›è½¬ä½ç½®
 752   1          fun_py(par_pymodel);//åšå¹³ç§»
 753   1          def_select(sel_912);//ä¼ æ„Ÿå™¨ç‰‡é€‰
 754   1          fun_delay(1,del_s);//å»¶æ—¶ä¸€æ®µæ—¶é—´ç­‰å¾…å›è½¬ä¼ æ„Ÿå™¨è¿‡å»
 755   1          switch(par_hzmodel){//è·å–æƒ³è¦åˆ°è¾¾çš„å›è½¬ä½ç½®
 756   2              case dir_up://å›è½¬è‡³å‰æ–¹
 757   2                  switch(str_begin.hzfx){
 758   3                      case dir_down://ç°åœ¨åœ¨ä¸‹æ–¹
 759   3                          while(in_hz==1);
 760   3                          while(in_hz==0);
 761   3                          while(in_hz==1);
 762   3                          fun_delay(str_cod.hz1bz,del_ms);
 763   3                          break;
 764   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 765   3                          while(in_hz==1);
 766   3                          fun_delay(str_cod.hz1bz,del_ms);
 767   3                          break;
 768   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 769   3                          while(in_hz==1);
 770   3                          fun_delay(str_cod.hz1bz,del_ms);
 771   3                          break;
 772   3                      default:
 773   3                          break;
 774   3                  }
 775   2                  break;
 776   2              case dir_down://è¦å»ä¸‹é¢
 777   2                  switch(str_begin.hzfx){
 778   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 779   3                          while(in_hz==1);
 780   3                          while(in_hz==0);
 781   3                          while(in_hz==1);
 782   3                          fun_delay(str_cod.hz1bz,del_ms);
 783   3                          break;
 784   3                      case dir_left://ç°åœ¨åœ¨å·¦é¢
 785   3                          while(in_hz==1);
 786   3                          fun_delay(str_cod.hz1bz,del_ms);
 787   3                          break;
 788   3                      case dir_right://ç°åœ¨åœ¨å³é¢
 789   3                          while(in_hz==1);
 790   3                          fun_delay(str_cod.hz1bz,del_ms);
 791   3                          break;
 792   3                      default:
 793   3                          break;
 794   3                  }
 795   2                  break;
 796   2              case dir_left://è¦å»å·¦è¾¹
 797   2                  switch(str_begin.hzfx){
 798   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 14  

 799   3                          while(in_hz==1);
 800   3                          fun_delay(str_cod.hz1bz,del_ms);
 801   3                          break;
 802   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 803   3                          while(in_hz==1);
 804   3                          fun_delay(str_cod.hz1bz,del_ms);
 805   3                          break;
 806   3                      case dir_right://ç°åœ¨åœ¨å³é¢
 807   3                          while(in_hz==1);
 808   3                          while(in_hz==0);
 809   3                          while(in_hz==1);
 810   3                          fun_delay(str_cod.hz1bz,del_ms);
 811   3                          break;
 812   3                      default:
 813   3                          break;
 814   3                  }
 815   2                  break;
 816   2              case dir_right://è¦å»å³é¢
 817   2                  switch(str_begin.hzfx){
 818   3                      case dir_up://ç°åœ¨åœ¨å‰é¢
 819   3                          while(in_hz==1);
 820   3                          fun_delay(str_cod.hz1bz,del_ms);
 821   3                          break;
 822   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 823   3                          while(in_hz==1);
 824   3                          fun_delay(str_cod.hz1bz,del_ms);
 825   3                          break;
 826   3                      case dir_left://ç°åœ¨åœ¨å·¦é¢
 827   3                          while(in_hz==1);
 828   3                          while(in_hz==0);
 829   3                          while(in_hz==1);
 830   3                          fun_delay(str_cod.hz1bz,del_ms);
 831   3                          break;
 832   3                      default:
 833   3                          break;
 834   3                  }
 835   2                  break;
 836   2              default:
 837   2                  break;
 838   2          }//è·å–ç°åœ¨è¦å»çš„å›è½¬ä½ç½®
 839   1          fun_motors(mot_hz,0);//åœæ­¢å›è½¬åŠ¨ä½œ
 840   1          str_begin.hzfx=par_hzmodel;//å­˜å‚¨è¿è¡Œç»“æœ
 841   1      }//å¹³ç§»å›è½¬åŒæ­¥è¿åŠ¨
 842          void fun_sjhz(enum varENU_tra par_sjmodel,enum varENU_dir par_hzmodel){
 843   1          ul loc_sjdelay=0;//å‡é™ä¸­é—´ä½å»¶æ—¶
 844   1          ul loc_hzdelay=0xFFFF;//å›è½¬å»¶æ—¶
 845   1          uc loc_sjcgq=0;//å‡é™ä¼ æ„Ÿå™¨æ£€æµ‹æ ‡å¿—ä½(0ä¸ºä¸åšå‡é™,1ä¸ºæœªåˆ°ä¼ æ„Ÿå™¨,2ä¸ºå·²åˆ°ä¼ æ„Ÿå
             -™¨)
 846   1          uc loc_hzcgq=0;//å›è½¬å‘¨æœŸæ ‡å¿—ä½(0ä¸ºä¸åš,1ä¸ºä¸€åœˆ,2ä¸ºä¸¤åœˆ)
 847   1          uc loc_hzflag=0;//å›è½¬ä¼ æ„Ÿå™¨æ ‡å¿—ä½
 848   1          if(par_hzmodel!=str_begin.hzfx){
 849   2              switch(par_hzmodel){
 850   3                  case dir_up://å›è½¬è‡³å‰æ–¹
 851   3                      switch(str_begin.hzfx){
 852   4                          case dir_down://ç°åœ¨åœ¨ä¸‹æ–¹
 853   4                              fun_motors(mot_hz,-100);//åè½¬
 854   4                              loc_hzcgq=2;//ä¿©å‘¨æœŸ
 855   4                              break;
 856   4                          case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 857   4                              fun_motors(mot_hz,100);//æ­£è½¬
 858   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
 859   4                              break;
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 15  

 860   4                          case dir_right://ç°åœ¨åœ¨å³è¾¹
 861   4                              fun_motors(mot_hz,-100);//åè½¬
 862   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
 863   4                              break;
 864   4                          default:
 865   4                              break;
 866   4                      }
 867   3                      break;
 868   3                  case dir_down://è¦å»ä¸‹é¢
 869   3                      switch(str_begin.hzfx){
 870   4                          case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 871   4                              fun_motors(mot_hz,100);//æ­£è½¬
 872   4                              loc_hzcgq=2;//ä¿©å‘¨æœŸ
 873   4                              break;
 874   4                          case dir_left://ç°åœ¨åœ¨å·¦é¢
 875   4                              fun_motors(mot_hz,-100);//åè½¬
 876   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
 877   4                              break;
 878   4                          case dir_right://ç°åœ¨åœ¨å³é¢
 879   4                              fun_motors(mot_hz,100);//æ­£è½¬
 880   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
 881   4                              break;
 882   4                          default:
 883   4                              break;
 884   4                      }
 885   3                      break;
 886   3                  case dir_left://è¦å»å·¦è¾¹
 887   3                      switch(str_begin.hzfx){
 888   4                          case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 889   4                              fun_motors(mot_hz,-100);//åè½¬
 890   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
 891   4                              break;
 892   4                          case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 893   4                              fun_motors(mot_hz,100);//æ­£è½¬
 894   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
 895   4                              break;
 896   4                          case dir_right://ç°åœ¨åœ¨å³é¢
 897   4                              fun_motors(mot_hz,-100);//åè½¬
 898   4                              loc_hzcgq=2;//ä¿©å‘¨æœŸ
 899   4                              break;
 900   4                          default:
 901   4                              break;
 902   4                      }
 903   3                      break;
 904   3                  case dir_right://è¦å»å³é¢
 905   3                      switch(str_begin.hzfx){
 906   4                          case dir_up://ç°åœ¨åœ¨å‰é¢
 907   4                              fun_motors(mot_hz,100);//æ­£è½¬
 908   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
 909   4                              break;
 910   4                          case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 911   4                              fun_motors(mot_hz,-100);//åè½¬
 912   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
 913   4                              break;
 914   4                          case dir_left://ç°åœ¨åœ¨å·¦é¢
 915   4                              fun_motors(mot_hz,100);//æ­£è½¬
 916   4                              loc_hzcgq=2;//ä¿©å‘¨æœŸ
 917   4                              break;
 918   4                          default:
 919   4                              break;
 920   4                      }
 921   3                      break;
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 16  

 922   3                  default:
 923   3                      break;
 924   3              }//é€‰æ‹©éœ€è¦çš„è¿åŠ¨å‘¨æœŸ
 925   2              loc_hzdelay=var_timer+1000;//å›è½¬ä¼ æ„Ÿå™¨éš”1ç§’æ£€æµ‹
 926   2          }//å¯åŠ¨å›è½¬ç”µæœº
 927   1          if(par_sjmodel!=str_begin.sjwz){//å¦‚æœä¸åœ¨ä½
 928   2              fun_motors(mot_sj,par_sjmodel<str_begin.sjwz?100:-100);//é€šè¿‡é«˜åº¦è®¡ç®—å¹¶å¯åŠ¨æ­£åè½¬
 929   2              loc_sjcgq=1;//æ ‡å¿—ä½è®°å½•ä¸ºç­‰å¾…ä¼ æ„Ÿå™¨
 930   2          }//å¯åŠ¨å‡é™ç”µæœº
 931   1          while(str_begin.hzsd!=0||str_begin.sjsd!=0){//éé˜»å¡å‹Mainå‡½æ•°å¾ªç¯æ£€æµ‹
 932   2              if(loc_sjcgq==1){//å¦‚æœè¿˜æ²¡åˆ°ä¼ æ„Ÿå™¨
 933   3                  switch(par_sjmodel){
 934   4                      case sjp_1:
 935   4                          def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
 936   4                          fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
 937   4                          if(in_wz1==0){//å¦‚æœç¬¬ä¸€ä¸ªä¼ æ„Ÿå™¨æœ‰ä¿¡å·
 938   5                              loc_sjdelay=var_timer+str_cod.sj1bzw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡ç®—æ
             - ‡å‡†ä½å»¶æ—¶
 939   5                              loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
 940   5                          }
 941   4                          break;
 942   4                      case sjp_12:
 943   4                          def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
 944   4                          fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
 945   4                          if(str_begin.sjwz==sjp_1||in_wz2==0){//å¦‚æœå¼€å§‹çš„æ—¶å€™æ—¶åœ¨ä½ç½®1æˆ–å·²ç»åˆ°ä
             -º†ä½ç½®2
 946   5                              loc_sjdelay=var_timer+str_cod.sj1zjw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡ç®—ä
             -¸­é—´ä½å»¶æ—¶
 947   5                              loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
 948   5                          }
 949   4                          break;
 950   4                      case sjp_2:
 951   4                          def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
 952   4                          fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
 953   4                          if(in_wz2==0){//å¦‚æœç¬¬äºŒä¸ªä¼ æ„Ÿå™¨æœ‰ä¿¡å·
 954   5                              loc_sjdelay=var_timer+str_cod.sj1bzw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡ç®—æ
             - ‡å‡†ä½å»¶æ—¶
 955   5                              loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
 956   5                          }
 957   4                          break;
 958   4                      case sjp_23:
 959   4                          def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
 960   4                          fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
 961   4                          if(in_wz2==0||in_wz3==0){//å¦‚æœå·²ç»åˆ°äº†ä½ç½®2æˆ–å·²ç»åˆ°äº†ä½ç½®3
 962   5                              loc_sjdelay=var_timer+str_cod.sj1zjw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡ç®—ä
             -¸­é—´ä½å»¶æ—¶
 963   5                              loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
 964   5                          }
 965   4                          break;
 966   4                      case sjp_3:
 967   4                          def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
 968   4                          fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
 969   4                          if(in_wz3==0){//å¦‚æœç¬¬ä¸‰ä¸ªä¼ æ„Ÿå™¨æœ‰ä¿¡å·
 970   5                              loc_sjdelay=var_timer+str_cod.sj1bzw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡ç®—æ
             - ‡å‡†ä½å»¶æ—¶
 971   5                              loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
 972   5                          }
 973   4                          break;
 974   4                      case sjp_34:
 975   4                          def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
 976   4                          fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
 977   4                          if(in_wz3==0||in_wz4==0){//å¦‚æœå·²ç»åˆ°äº†ä½ç½®3æˆ–å·²ç»åˆ°äº†ä½ç½®4
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 17  

 978   5                              loc_sjdelay=var_timer+str_cod.sj1zjw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡ç®—ä
             -¸­é—´ä½å»¶æ—¶
 979   5                              loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
 980   5                          }
 981   4                          break;
 982   4                      case sjp_4:
 983   4                          def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
 984   4                          fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
 985   4                          if(in_wz4==0){//å¦‚æœç¬¬å››ä¸ªä¼ æ„Ÿå™¨æœ‰ä¿¡å·
 986   5                              loc_sjdelay=var_timer+str_cod.sj1bzw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡ç®—æ
             - ‡å‡†ä½å»¶æ—¶
 987   5                              loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
 988   5                          }
 989   4                          break;
 990   4                      case sjp_45:
 991   4                          def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
 992   4                          fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
 993   4                          if(in_wz4==0||str_begin.sjwz==sjp_5){//å¦‚æœå·²ç»åˆ°äº†ä½ç½®4æˆ–å¼€å§‹çš„æ—¶å€™æ—¶å
             -œ¨ä½ç½®5
 994   5                              loc_sjdelay=var_timer+str_cod.sj1zjw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡ç®—ä
             -¸­é—´ä½å»¶æ—¶
 995   5                              loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
 996   5                          }
 997   4                          break;
 998   4                      case sjp_5:
 999   4                          def_select(sel_912);//ç‰‡é€‰912ä¼ æ„Ÿå™¨
1000   4                          fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1001   4                          if(in_wz5==0){//å¦‚æœç¬¬äº”ä¸ªä¼ æ„Ÿå™¨æœ‰ä¿¡å·
1002   5                              loc_sjdelay=var_timer+str_cod.sj1bzw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡ç®—æ
             - ‡å‡†ä½å»¶æ—¶
1003   5                              loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1004   5                          }
1005   4                          break;
1006   4                      default:
1007   4                          break;
1008   4                  }
1009   3              }
1010   2              else if(loc_sjcgq==2){//å¦‚æœå»¶æ—¶æ—¶é—´åˆ°
1011   3                  if(loc_sjdelay<=var_timer){
1012   4                      fun_motors(mot_sj,0);//åœæ­¢ç”µæœº
1013   4                      loc_sjcgq=0;//ä¸åšå‡é™äº†
1014   4                      str_begin.sjwz=par_sjmodel;//å­˜å‚¨è¿è¡Œç»“æœ
1015   4                  }
1016   3              }//å·²ç»åˆ°äº†ä¼ æ„Ÿå™¨éœ€è¦å»¶æ—¶
1017   2              if(loc_hzdelay<=var_timer){//å¦‚æœ1ç§’å»¶æ—¶å·²ç»è¿‡å»
1018   3                  if(loc_hzcgq!=0){//å¦‚æœä¸æ˜¯è½¬0åœˆ
1019   4                      def_select(sel_912);//ä¼ æ„Ÿå™¨ç‰‡é€‰
1020   4                      fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1021   4                      if(in_hz==1){//å¦‚æœä¼ æ„Ÿå™¨æ²¡äº®
1022   5                          loc_hzflag=1;//æ ‡å¿—ä½å˜1
1023   5                      }
1024   4                      else if(loc_hzflag==1){//å¦‚æœæ ‡å¿—ä½ä¸º1ä¸”ä¼ æ„Ÿå™¨æœ‰ä¿¡å·
1025   5                          loc_hzcgq--;//ç®—ä¸€ä¸ªå‘¨æœŸå®Œæˆ
1026   5                          loc_hzflag=0;//æ ‡å¿—ä½å˜0
1027   5                      }
1028   4                  }
1029   3                  else{//å¦‚æœåœˆæ•°ä¸º0
1030   4                      fun_motors(mot_hz,0);//åœæ­¢ç”µæœº
1031   4                      loc_hzdelay=0xFFFF;//ä¸åšå›è½¬äº†
1032   4                      str_begin.hzfx=par_hzmodel;//å­˜å‚¨è¿è¡Œç»“æœ
1033   4                  }
1034   3              }
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 18  

1035   2          }
1036   1      }//å‡é™å›è½¬åŒæ­¥è¿åŠ¨
1037          void fun_pysjhz(enum varENU_tra par_pymodel,enum varENU_tra par_sjmodel,enum varENU_dir par_hzmodel){
1038   1          ul loc_sjdelay=0;//å‡é™ä¸­é—´ä½å»¶æ—¶
1039   1          ul loc_hzdelay=0xFFFF;//å›è½¬å»¶æ—¶
1040   1          uc loc_sjcgq=0;//å‡é™ä¼ æ„Ÿå™¨æ£€æµ‹æ ‡å¿—ä½(0ä¸ºä¸åšå‡é™,1ä¸ºæœªåˆ°ä¼ æ„Ÿå™¨,2ä¸ºå·²åˆ°ä¼ æ„Ÿå
             -™¨)
1041   1          uc loc_hzcgq=0;//å›è½¬å‘¨æœŸæ ‡å¿—ä½(0ä¸ºä¸åš,1ä¸ºä¸€åœˆ,2ä¸ºä¸¤åœˆ)
1042   1          uc loc_hzflag=0;//å›è½¬ä¼ æ„Ÿå™¨æ ‡å¿—ä½
1043   1          idata bit loc_pyflag=0;//å¹³ç§»æ ‡å¿—ä½ä¸º0(æœªå®Œæˆ)
1044   1          if(par_hzmodel!=str_begin.hzfx){
1045   2              switch(par_hzmodel){
1046   3                  case dir_up://å›è½¬è‡³å‰æ–¹
1047   3                      switch(str_begin.hzfx){
1048   4                          case dir_down://ç°åœ¨åœ¨ä¸‹æ–¹
1049   4                              fun_motors(mot_hz,-100);//åè½¬
1050   4                              loc_hzcgq=2;//ä¿©å‘¨æœŸ
1051   4                              break;
1052   4                          case dir_left://ç°åœ¨åœ¨å·¦è¾¹
1053   4                              fun_motors(mot_hz,100);//æ­£è½¬
1054   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
1055   4                              break;
1056   4                          case dir_right://ç°åœ¨åœ¨å³è¾¹
1057   4                              fun_motors(mot_hz,-100);//åè½¬
1058   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
1059   4                              break;
1060   4                          default:
1061   4                              break;
1062   4                      }
1063   3                      break;
1064   3                  case dir_down://è¦å»ä¸‹é¢
1065   3                      switch(str_begin.hzfx){
1066   4                          case dir_up://ç°åœ¨åœ¨ä¸Šé¢
1067   4                              fun_motors(mot_hz,100);//æ­£è½¬
1068   4                              loc_hzcgq=2;//ä¿©å‘¨æœŸ
1069   4                              break;
1070   4                          case dir_left://ç°åœ¨åœ¨å·¦é¢
1071   4                              fun_motors(mot_hz,-100);//åè½¬
1072   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
1073   4                              break;
1074   4                          case dir_right://ç°åœ¨åœ¨å³é¢
1075   4                              fun_motors(mot_hz,100);//æ­£è½¬
1076   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
1077   4                              break;
1078   4                          default:
1079   4                              break;
1080   4                      }
1081   3                      break;
1082   3                  case dir_left://è¦å»å·¦è¾¹
1083   3                      switch(str_begin.hzfx){
1084   4                          case dir_up://ç°åœ¨åœ¨ä¸Šé¢
1085   4                              fun_motors(mot_hz,-100);//åè½¬
1086   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
1087   4                              break;
1088   4                          case dir_down://ç°åœ¨åœ¨ä¸‹é¢
1089   4                              fun_motors(mot_hz,100);//æ­£è½¬
1090   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
1091   4                              break;
1092   4                          case dir_right://ç°åœ¨åœ¨å³é¢
1093   4                              fun_motors(mot_hz,-100);//åè½¬
1094   4                              loc_hzcgq=2;//ä¿©å‘¨æœŸ
1095   4                              break;
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 19  

1096   4                          default:
1097   4                              break;
1098   4                      }
1099   3                      break;
1100   3                  case dir_right://è¦å»å³é¢
1101   3                      switch(str_begin.hzfx){
1102   4                          case dir_up://ç°åœ¨åœ¨å‰é¢
1103   4                              fun_motors(mot_hz,100);//æ­£è½¬
1104   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
1105   4                              break;
1106   4                          case dir_down://ç°åœ¨åœ¨ä¸‹é¢
1107   4                              fun_motors(mot_hz,-100);//åè½¬
1108   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
1109   4                              break;
1110   4                          case dir_left://ç°åœ¨åœ¨å·¦é¢
1111   4                              fun_motors(mot_hz,100);//æ­£è½¬
1112   4                              loc_hzcgq=2;//ä¿©å‘¨æœŸ
1113   4                              break;
1114   4                          default:
1115   4                              break;
1116   4                      }
1117   3                      break;
1118   3                  default:
1119   3                      break;
1120   3              }//é€‰æ‹©éœ€è¦çš„è¿åŠ¨å‘¨æœŸ
1121   2              loc_hzdelay=var_timer+1000;//å›è½¬ä¼ æ„Ÿå™¨éš”1ç§’æ£€æµ‹
1122   2          }//å¯åŠ¨å›è½¬ç”µæœº
1123   1          if(par_sjmodel!=str_begin.sjwz){//å¦‚æœä¸åœ¨ä½
1124   2              fun_motors(mot_sj,par_sjmodel<str_begin.sjwz?100:-100);//é€šè¿‡é«˜åº¦è®¡ç®—å¹¶å¯åŠ¨æ­£åè½¬
1125   2              loc_sjcgq=1;//æ ‡å¿—ä½è®°å½•ä¸ºç­‰å¾…ä¼ æ„Ÿå™¨
1126   2          }//å¯åŠ¨å‡é™ç”µæœº
1127   1          while(str_begin.hzsd!=0||str_begin.sjsd!=0||loc_sjcgq!=0){//éé˜»å¡å‹Mainå‡½æ•°å¾ªç¯æ£€æµ‹
1128   2              switch(loc_sjcgq){
1129   3                  case 1://å¦‚æœè¿˜éœ€ç­‰å¾…ä¼ æ„Ÿå™¨
1130   3                      switch(par_sjmodel){
1131   4                          case sjp_1:
1132   4                              def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
1133   4                              fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1134   4                              if(in_wz1==0){//å¦‚æœç¬¬ä¸€ä¸ªä¼ æ„Ÿå™¨æœ‰ä¿¡å·
1135   5                                  loc_sjdelay=var_timer+str_cod.sj1bzw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡
             -ç®—æ ‡å‡†ä½å»¶æ—¶
1136   5                                  loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1137   5                              }
1138   4                              break;
1139   4                          case sjp_12:
1140   4                              def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
1141   4                              fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1142   4                              if(str_begin.sjwz==sjp_1||in_wz2==0){//å¦‚æœå¼€å§‹çš„æ—¶å€™æ—¶åœ¨ä½ç½®1æˆ–å·²ç»
             -åˆ°äº†ä½ç½®2
1143   5                                  loc_sjdelay=var_timer+str_cod.sj1zjw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡
             -ç®—ä¸­é—´ä½å»¶æ—¶
1144   5                                  loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1145   5                              }
1146   4                              break;
1147   4                          case sjp_2:
1148   4                              def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
1149   4                              fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1150   4                              if(in_wz2==0){//å¦‚æœç¬¬äºŒä¸ªä¼ æ„Ÿå™¨æœ‰ä¿¡å·
1151   5                                  loc_sjdelay=var_timer+str_cod.sj1bzw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡
             -ç®—æ ‡å‡†ä½å»¶æ—¶
1152   5                                  loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1153   5                              }
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 20  

1154   4                              break;
1155   4                          case sjp_23:
1156   4                              def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
1157   4                              fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1158   4                              if(in_wz2==0||in_wz3==0){//å¦‚æœå·²ç»åˆ°äº†ä½ç½®2æˆ–å·²ç»åˆ°äº†ä½ç½®3
1159   5                                  loc_sjdelay=var_timer+str_cod.sj1zjw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡
             -ç®—ä¸­é—´ä½å»¶æ—¶
1160   5                                  loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1161   5                              }
1162   4                              break;
1163   4                          case sjp_3:
1164   4                              def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
1165   4                              fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1166   4                              if(in_wz3==0){//å¦‚æœç¬¬ä¸‰ä¸ªä¼ æ„Ÿå™¨æœ‰ä¿¡å·
1167   5                                  loc_sjdelay=var_timer+str_cod.sj1bzw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡
             -ç®—æ ‡å‡†ä½å»¶æ—¶
1168   5                                  loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1169   5                              }
1170   4                              break;
1171   4                          case sjp_34:
1172   4                              def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
1173   4                              fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1174   4                              if(in_wz3==0||in_wz4==0){//å¦‚æœå·²ç»åˆ°äº†ä½ç½®3æˆ–å·²ç»åˆ°äº†ä½ç½®4
1175   5                                  loc_sjdelay=var_timer+str_cod.sj1zjw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡
             -ç®—ä¸­é—´ä½å»¶æ—¶
1176   5                                  loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1177   5                              }
1178   4                              break;
1179   4                          case sjp_4:
1180   4                              def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
1181   4                              fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1182   4                              if(in_wz4==0){//å¦‚æœç¬¬å››ä¸ªä¼ æ„Ÿå™¨æœ‰ä¿¡å·
1183   5                                  loc_sjdelay=var_timer+str_cod.sj1bzw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡
             -ç®—æ ‡å‡†ä½å»¶æ—¶
1184   5                                  loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1185   5                              }
1186   4                              break;
1187   4                          case sjp_45:
1188   4                              def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
1189   4                              fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1190   4                              if(in_wz4==0||str_begin.sjwz==sjp_5){//å¦‚æœå·²ç»åˆ°äº†ä½ç½®4æˆ–å¼€å§‹çš„æ—¶å€™
             -æ—¶åœ¨ä½ç½®5
1191   5                                  loc_sjdelay=var_timer+str_cod.sj1zjw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡
             -ç®—ä¸­é—´ä½å»¶æ—¶
1192   5                                  loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1193   5                              }
1194   4                              break;
1195   4                          case sjp_5:
1196   4                              def_select(sel_912);//ç‰‡é€‰912ä¼ æ„Ÿå™¨
1197   4                              fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1198   4                              if(in_wz5==0){//å¦‚æœç¬¬äº”ä¸ªä¼ æ„Ÿå™¨æœ‰ä¿¡å·
1199   5                                  loc_sjdelay=var_timer+str_cod.sj1bzw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡
             -ç®—æ ‡å‡†ä½å»¶æ—¶
1200   5                                  loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1201   5                              }
1202   4                              break;
1203   4                          default:
1204   4                              break;
1205   4                      }
1206   3                      break;
1207   3                  case 2://å¦‚æœå»¶æ—¶æ—¶é—´åˆ°
1208   3                      if(loc_sjdelay<=var_timer){
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 21  

1209   4                          fun_motors(mot_sj,0);//åœæ­¢ç”µæœº
1210   4                          loc_sjcgq=0;//ä¸åšå‡é™äº†
1211   4                          loc_sjcgq=3;//å‡†å¤‡å¯åŠ¨å¹³ç§»
1212   4                          str_begin.sjwz=par_sjmodel;//å­˜å‚¨è¿è¡Œç»“æœ
1213   4                      }
1214   3                      break;
1215   3                  case 3://å·²ç»åˆ°äº†ä¼ æ„Ÿå™¨éœ€è¦å¹³ç§»
1216   3                      if(par_pymodel==tra_h)
1217   3                          fun_motors(mot_py,-100);
1218   3                      else if(par_pymodel==tra_q)
1219   3                          fun_motors(mot_py,100);
1220   3                      loc_sjcgq=4;//å‡†å¤‡æ£€æµ‹å¹³ç§»
1221   3                      break;
1222   3                  case 4://å¯åŠ¨å¹³ç§»ç”µæœºå®Œæ¯•
1223   3                      if(par_pymodel==tra_h&&in_hpy==0){
1224   4                          loc_sjdelay=var_timer+str_cod.py1bz;
1225   4                          loc_sjcgq=5;//å‡†å¤‡æ£€æµ‹å¹³ç§»å»¶æ—¶
1226   4                      }
1227   3                      if(par_pymodel==tra_q&&in_qpy==0){
1228   4                          loc_sjdelay=var_timer+str_cod.py1bz;
1229   4                          loc_sjcgq=5;//å‡†å¤‡æ£€æµ‹å¹³ç§»å»¶æ—¶
1230   4                      }
1231   3                      break;
1232   3                  case 5:
1233   3                      if(loc_sjdelay<=var_timer){
1234   4                          fun_motors(mot_py,0);//åœæ­¢ç”µæœº
1235   4                          loc_sjcgq=0;//ä¸åšå‡é™å¹³ç§»äº†
1236   4                          str_begin.pywz=par_pymodel;//å­˜å‚¨è¿è¡Œç»“æœ
1237   4                      }
1238   3                      break;
1239   3                  default:
1240   3                      break;
1241   3              }
1242   2              if(loc_hzdelay<=var_timer){//å¦‚æœ1ç§’å»¶æ—¶å·²ç»è¿‡å»
1243   3                  if(loc_hzcgq!=0){//å¦‚æœä¸æ˜¯è½¬0åœˆ
1244   4                      def_select(sel_912);//ä¼ æ„Ÿå™¨ç‰‡é€‰
1245   4                      fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1246   4                      if(in_hz==1){//å¦‚æœä¼ æ„Ÿå™¨æ²¡äº®
1247   5                          loc_hzflag=1;//æ ‡å¿—ä½å˜1
1248   5                      }
1249   4                      else if(loc_hzflag==1){//å¦‚æœæ ‡å¿—ä½ä¸º1ä¸”ä¼ æ„Ÿå™¨æœ‰ä¿¡å·
1250   5                          loc_hzcgq--;//ç®—ä¸€ä¸ªå‘¨æœŸå®Œæˆ
1251   5                          loc_hzflag=0;//æ ‡å¿—ä½å˜0
1252   5                      }
1253   4                  }
1254   3                  else{//å¦‚æœåœˆæ•°ä¸º0
1255   4                      fun_motors(mot_hz,0);//åœæ­¢ç”µæœº
1256   4                      loc_hzdelay=0xFFFF;//ä¸åšå›è½¬äº†
1257   4                      str_begin.hzfx=par_hzmodel;//å­˜å‚¨è¿è¡Œç»“æœ
1258   4                  }
1259   3              }
1260   2          }
1261   1      }//å¹³ç§»å‡é™å›è½¬åŒæ­¥è¿åŠ¨(å…ˆå‡é™å›è½¬,å†å¹³ç§»å›è½¬)
1262          void fun_jtjp(){
1263   1          while(1){//å¾ªç¯çº å
1264   2              if((!in_ls1&&!in_ls2&&in_ls4&&in_ls5&&!in_ls7&&!in_ls8)&&((in_ls3&&in_ls6)||(!in_ls3&&!in_ls6))){/
             -/1278ä¸äº®,45äº®,36è¦ä¹ˆä¸€èµ·äº®è¦ä¹ˆä¸€èµ·ç­
1265   3                  fun_delay(10,del_ms);
1266   3                  fun_motors(mot_rl,0);
1267   3                  return;
1268   3              }
1269   2              if(!in_ls4){//4ä¸äº®
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 22  

1270   3                  fun_motors(mot_l,12);
1271   3                  fun_motors(mot_r,-12);
1272   3              }
1273   2              else if(!in_ls5){//4äº®5ä¸äº®
1274   3                  fun_motors(mot_l,-12);
1275   3                  fun_motors(mot_r,12);
1276   3              }
1277   2              if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
1278   3                  fun_motors(mot_l,8);
1279   3                  fun_motors(mot_r,-8);
1280   3              }
1281   2              else if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
1282   3                  fun_motors(mot_l,-8);
1283   3                  fun_motors(mot_r,8);
1284   3              }
1285   2              if(in_ls2||in_ls1){//12äº®
1286   3                  fun_motors(mot_l,-16);
1287   3                  fun_motors(mot_r,16);
1288   3              }
1289   2              else if(in_ls7||in_ls8){//78äº®
1290   3                  fun_motors(mot_l,16);
1291   3                  fun_motors(mot_r,-16);
1292   3              }
1293   2              fun_delay(100,del_ms);
1294   2          }
1295   1      }//é™æ€çº å
1296          void fun_timermove(){
1297   1          static data uc loc_con=0;//éœ€è¦åˆ†æ­¥åšçš„åŠ¨ä½œéœ€è¦ç”¨åˆ°æ­¤é™æ€ç§æœ‰åˆ†æ­¥æ ‡å¿—ä½
1298   1          data int loc_sdl,loc_sdr;//å·¦è½®é€Ÿåº¦å’Œå³è½®é€Ÿåº¦çš„å±€éƒ¨å˜é‡
1299   1          switch(*str_tfl.run){//é€‰æ‹©è¿è¡Œæ–¹å¼
1300   2              case def_end://è¿è¡Œç»“æŸ
1301   2                  fun_motorsrl(mot_rl,0);//å†æ¬¡åœæ­¢ç”µæœºè¿åŠ¨
1302   2                  str_tfl.doing=tf_false;//ç§»åŠ¨ç»“æŸ
1303   2                  memset(str_tfl.step,0,sizeof(str_tfl.step));//æ¸…ç©ºstepæ•°ç»„
1304   2                  str_tfl.run=str_tfl.step;//æŒ‡é’ˆæŒ‡å‘stepçš„ç¬¬ä¸€ä¸ªå…ƒç´ 
1305   2                  break;
1306   2              case tfl_line://è¿è¡Œå·¡çº¿
1307   2                  if(*(str_tfl.run+1)){//å¦‚æœå‚æ•°ä¸ºé0æ•°
1308   3                      if((in_ls1||in_ls8)&&(in_ls2&&in_ls3&&in_ls4&&in_ls5&in_ls6&&in_ls7)){//å¦‚æœä¸­é—´6ä¸ªç
             -¯å…¨äº®,å·¦å³äº®ä»»æ„ä¸€ä¸ª
1309   4                          str_tfl.online=tf_ture;//æ ‡å¿—ä½è®°å½•åœ¨çº¿
1310   4                          fun_motorsrl(mot_rl,str_tfl.gospeed);//æŒ‰ç…§å¸¸è§„é€Ÿåº¦è¿‡çº¿
1311   4                      }
1312   3                      else if(str_tfl.online==tf_ture){//å¦‚æœæ ‡å¿—ä½è®°å½•åœ¨çº¿,è€Œä¸”ä¸ç¬¦åˆåœ¨çº¿ç‰¹å¾
1313   4                          str_tfl.online=tf_false;//æ ‡å¿—ä½è®°å½•ä¸åœ¨çº¿
1314   4                          (*(str_tfl.run+1))--;//å‚æ•°å€¼å‡1,è®°å½•å·²ç»èµ°äº†ä¸€æ¡çº¿
1315   4                      }
1316   3                      else{
1317   4                          //ç¬¬ä¸‰ç‰ˆçº åç®—æ³•
1318   4                          loc_sdl=loc_sdr=str_tfl.gospeed;//å·¡çº¿é€Ÿåº¦ä¸ºstr_tfl.gospeed
1319   4                          if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
1320   5                              loc_sdl-=(loc_sdl+21)/10;
1321   5                              loc_sdr+=(99-loc_sdr)/10;
1322   5                          }//å‘å·¦è½¬
1323   4                          if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
1324   5                              loc_sdl+=(99-loc_sdl)/10;
1325   5                              loc_sdr-=(loc_sdr+21)/10;
1326   5                          }//å‘å³è½¬
1327   4                          if(in_ls2&&!in_ls7){//2äº®7ä¸äº®
1328   5                              loc_sdl-=(loc_sdl+21)*3/10;
1329   5                              loc_sdr+=(99-loc_sdr)*3/10;
1330   5                          }//å‘å·¦è½¬
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 23  

1331   4                          if(in_ls7&&!in_ls2){//7äº®2ä¸äº®
1332   5                              loc_sdl+=(99-loc_sdl)*3/10;
1333   5                              loc_sdr-=(loc_sdr+21)*3/10;
1334   5                          }//å‘å³è½¬
1335   4                          if(in_ls1&&!in_ls8){//1äº®8ä¸äº®
1336   5                              loc_sdl-=(loc_sdl+21)*5/10;
1337   5                              loc_sdr+=(99-loc_sdr)*5/10;
1338   5                          }//å‘å·¦è½¬
1339   4                          if(in_ls8&&!in_ls1){//8äº®1ä¸äº®
1340   5                              loc_sdl+=(99-loc_sdl)*5/10;
1341   5                              loc_sdr-=(loc_sdr+21)*5/10;
1342   5                          }//å‘å³è½¬
1343   4                          fun_motorsrl(mot_r,loc_sdr);
1344   4                          fun_motorsrl(mot_l,loc_sdl);
1345   4                      }
1346   3                  }
1347   2                  else{//å¦‚æœçº¿èµ°å®Œäº†
1348   3                      str_tfl.run+=2;//æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ç»„è¿‡ç¨‹
1349   3                      fun_motorsrl(mot_rl,0);//åœæ­¢ç”µæœºè¿åŠ¨
1350   3                  }
1351   2                  break;
1352   2              case tfl_turn://è¿è¡Œè½¬å¼¯
1353   2                  switch(loc_con){//åˆ†æ­¥è¿è¡Œæ ‡å¿—ä½
1354   3                      case 0://ç¬¬ä¸€æ­¥
1355   3                          switch(*(str_tfl.run+1)){//è·å–å‚æ•°
1356   4                              case tur_r90://å³è½¬90
1357   4                                  fun_motorsrl(mot_l,str_tfl.turnspeed);//å·¦è½®å‘å‰
1358   4                                  fun_motorsrl(mot_r,-str_tfl.turnspeed);//å³è½®å‘å
1359   4                                  str_tfl.delay=var_timer+str_cod.timerturn90;//è®¡æ—¶
1360   4                                  break;
1361   4                              case tur_l90://å·¦è½¬90
1362   4                                  fun_motorsrl(mot_l,-str_tfl.turnspeed);//å·¦è½®å‘å
1363   4                                  fun_motorsrl(mot_r,str_tfl.turnspeed);//å³è½®å‘å‰
1364   4                                  str_tfl.delay=var_timer+str_cod.timerturn90;//è®¡æ—¶
1365   4                                  break;
1366   4                              case tur_r180://å³è½¬180
1367   4                                  fun_motorsrl(mot_l,str_tfl.turnspeed);//å·¦è½®å‘å‰
1368   4                                  fun_motorsrl(mot_r,-str_tfl.turnspeed);//å³è½®å‘å
1369   4                                  str_tfl.delay=var_timer+str_cod.timerturn180;//è®¡æ—¶
1370   4                                  break;
1371   4                              case tur_l180://å·¦è½¬180
1372   4                                  fun_motorsrl(mot_l,-str_tfl.turnspeed);//å·¦è½®å‘å
1373   4                                  fun_motorsrl(mot_r,str_tfl.turnspeed);//å·¦è½®å‘å‰
1374   4                                  str_tfl.delay=var_timer+str_cod.timerturn180;//è®¡æ—¶
1375   4                                  break;
1376   4                          }
1377   3                          loc_con++;//æ‰§è¡Œä¸‹ä¸€æ­¥
1378   3                          break;
1379   3                      case 1://ç¬¬äºŒæ­¥
1380   3                          if(str_tfl.delay<=var_timer)//è®¡æ—¶æ—¶é—´åˆ°
1381   3                              loc_con++;//æ‰§è¡Œä¸‹ä¸€æ­¥
1382   3                          break;
1383   3                      case 2://ç¬¬ä¸‰æ­¥
1384   3                          if(in_ls3||in_ls6){//å¦‚æœ3äº®æˆ–6äº®
1385   4                              fun_motorsrl(mot_rl,0);//åœæ­¢ç”µæœº
1386   4                              str_tfl.run+=2;//æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ç»„è¿‡ç¨‹
1387   4                              str_tfl.delay=0;//å»¶æ—¶è®¡æ•°å™¨å½’é›¶
1388   4                              loc_con=0;//åˆ†æ­¥è¿è¡Œæ ‡å¿—ä½å½’é›¶
1389   4                          }
1390   3                          break;
1391   3                  }
1392   2                  break;
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 24  

1393   2              case tfl_cache://è¿è¡Œå‰å†²
1394   2                  switch(loc_con){
1395   3                      case 0://ç¬¬ä¸€æ­¥
1396   3                          str_tfl.delay=var_timer+((*(str_tfl.run+1))*10);//å»¶æ—¶æ—¶é—´(æ¯«ç§’)ä¸ºå‚æ•°çš„10å€
             -
1397   3                          loc_con++;//æ‰§è¡Œä¸‹ä¸€æ­¥
1398   3                          break;
1399   3                      case 1://ç¬¬äºŒæ­¥
1400   3                          if(str_tfl.delay<=var_timer){//è®¡æ—¶æ—¶é—´åˆ°
1401   4                              fun_motorsrl(mot_rl,0);//åœæ­¢ç”µæœº
1402   4                              str_tfl.run+=2;//æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ç»„è¿‡ç¨‹
1403   4                              str_tfl.delay=0;//å»¶æ—¶è®¡æ•°å™¨å½’é›¶
1404   4                              loc_con=0;//åˆ†æ­¥è¿è¡Œæ ‡å¿—ä½å½’é›¶
1405   4                          }
1406   3                          else{
1407   4                              loc_sdl=loc_sdr=str_tfl.cachespeed;//å‰å†²é€Ÿåº¦ä¸ºstr_tfl.cachespeed
1408   4                              if(in_ls1&&!in_ls8){//1äº®8ä¸äº®
1409   5                                  loc_sdl*=0.7;//å·¦å‡é€Ÿ
1410   5                                  loc_sdr*=1.3;//å³åŠ é€Ÿ
1411   5                              }//å‘å·¦è½¬
1412   4                              if(in_ls8&&!in_ls1){//8äº®1ä¸äº®
1413   5                                  loc_sdl*=1.3;//å·¦åŠ é€Ÿ
1414   5                                  loc_sdr*=0.7;//å³å‡é€Ÿ
1415   5                              }//å‘å³è½¬
1416   4                              if(in_ls2&&!in_ls7){//2äº®7ä¸äº®
1417   5                                  loc_sdl*=0.8;//å·¦å‡é€Ÿ
1418   5                                  loc_sdr*=1.2;//å³åŠ é€Ÿ
1419   5                              }//å‘å·¦è½¬
1420   4                              if(in_ls7&&!in_ls2){//7äº®2ä¸äº®
1421   5                                  loc_sdl*=1.2;//å·¦åŠ é€Ÿ
1422   5                                  loc_sdr*=0.8;//å³å‡é€Ÿ
1423   5                              }//å‘å³è½¬
1424   4                              if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
1425   5                                  loc_sdl*=0.9;//å·¦å‡é€Ÿ
1426   5                                  loc_sdr*=1.1;//å³åŠ é€Ÿ
1427   5                              }//å‘å·¦è½¬
1428   4                              if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
1429   5                                  loc_sdl*=1.1;//å·¦åŠ é€Ÿ
1430   5                                  loc_sdr*=0.9;//å³å‡é€Ÿ
1431   5                              }//å‘å³è½¬
1432   4                              fun_motorsrl(mot_r,loc_sdr);
1433   4                              fun_motorsrl(mot_l,loc_sdl);
1434   4                          }
1435   3                          break;
1436   3                  }
1437   2                  break;
1438   2              default:
1439   2                  break;
1440   2          }
1441   1      }//å®šæ—¶å™¨ç§»åŠ¨
1442          void fun_flsetting(char par_gospeed,char par_turnspeed,char par_cachespeed,...){
1443   1          va_list loc_argp;//ä¿å­˜å‚æ•°ç»“æ„
1444   1          uc loc_step=0;//å¾ªç¯stepæ•°ç»„ç”¨çš„ä¸œè¥¿
1445   1          uc loc_con;//å½“å‰å‚æ•°
1446   1          va_start(loc_argp,par_cachespeed);//loc_argpæŒ‡å‘ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå¯é€‰å‚æ•°,par_cachespeedæ˜¯æœ€å
             -ä¸€ä¸ªç¡®å®šçš„å‚æ•°
1447   1          loc_con=va_arg(loc_argp,char);//å–å‡ºç¬¬ä¸€ä¸ªå‚æ•°
1448   1          while(loc_con!=def_end){
1449   2              str_tfl.step[loc_step++]=loc_con;//æŠŠç»™stepæ•°ç»„,æ ‡å¿—ä½+1
1450   2              loc_con=va_arg(loc_argp,char);//å–å‡ºä¸‹ä¸€ä¸ªå‚æ•°
1451   2          }
1452   1          str_tfl.step[loc_step]=def_end;//stepæ•°ç»„ç»“æŸæ ‡å¿—ä½
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 25  

1453   1          va_end(loc_argp);//ç»“æŸ
1454   1      
1455   1          str_tfl.online=tf_false;//ä¸åœ¨çº¿
1456   1          str_tfl.run=str_tfl.step;//æŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªæ•°ç»„
1457   1          str_tfl.gospeed=par_gospeed;//é»˜è®¤é€Ÿåº¦
1458   1          str_tfl.turnspeed=par_turnspeed;//æ‹å¼¯é€Ÿåº¦
1459   1          str_tfl.cachespeed=par_cachespeed;//å‰å†²é€Ÿåº¦
1460   1          str_tfl.doing=tf_ture;//å¼€å§‹åš
1461   1      }//ä¸»å‡½æ•°ç”¨å®šæ—¶å™¨å·¡çº¿è°ƒç”¨å‡½æ•°
1462          void fun_folline(uc par_con,uc par_speed){
1463   1          uc loc_con=par_con;//å·¡çº¿æ¡æ•°æ ‡å¿—ä½
1464   1          uc loc_sdr,loc_sdl;//å·¦å³è½®é€Ÿåº¦
1465   1          uc loc_online;//åœ¨çº¿æ ‡å¿—ä½
1466   1          while(loc_con){
1467   2              if((in_ls1||in_ls8)&&(in_ls2&&in_ls3&&in_ls4&&in_ls5&in_ls6&&in_ls7)){//å¦‚æœä¸­é—´6ä¸ªç¯å…¨äº®,
             -å·¦å³äº®ä»»æ„ä¸€ä¸ª
1468   3                  loc_online=tf_ture;//æ ‡å¿—ä½è®°å½•åœ¨çº¿
1469   3                  fun_motors(mot_rl,par_speed);//æŒ‰ç…§å¸¸è§„é€Ÿåº¦è¿‡çº¿
1470   3              }
1471   2              else if(loc_online==tf_ture){//å¦‚æœæ ‡å¿—ä½è®°å½•åœ¨çº¿,è€Œä¸”ä¸ç¬¦åˆåœ¨çº¿ç‰¹å¾
1472   3                  loc_online=tf_false;//æ ‡å¿—ä½è®°å½•ä¸åœ¨çº¿
1473   3                  loc_con--;//å‚æ•°å€¼å‡1,è®°å½•å·²ç»èµ°äº†ä¸€æ¡çº¿
1474   3              }
1475   2              else{
1476   3                  //ç¬¬äºŒç‰ˆçº åç®—æ³•
1477   3                  loc_sdr=loc_sdl=par_speed;
1478   3                  if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
1479   4                      loc_sdl-=loc_sdl/10;
1480   4                      loc_sdr+=(100-loc_sdr)/10;
1481   4                  }//å‘å·¦è½¬
1482   3                  if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
1483   4                      loc_sdl+=(100-loc_sdl)/10;
1484   4                      loc_sdr-=loc_sdr/10;
1485   4                  }//å‘å³è½¬
1486   3                  if(in_ls2&&!in_ls7){//2äº®7ä¸äº®
1487   4                      loc_sdl-=loc_sdl/10*3;
1488   4                      loc_sdr+=(100-loc_sdr)/10*3;
1489   4                  }//å‘å·¦è½¬
1490   3                  if(in_ls7&&!in_ls2){//7äº®2ä¸äº®
1491   4                      loc_sdl+=(100-loc_sdl)/10*3;
1492   4                      loc_sdr-=loc_sdr/10*3;
1493   4                  }//å‘å³è½¬
1494   3                  if(in_ls1&&!in_ls8){//1äº®8ä¸äº®
1495   4                      loc_sdl-=loc_sdl/10*5;
1496   4                      loc_sdr+=(100-loc_sdr)/10*5;
1497   4                  }//å‘å·¦è½¬
1498   3                  if(in_ls8&&!in_ls1){//8äº®1ä¸äº®
1499   4                      loc_sdl+=(100-loc_sdl)/10*5;
1500   4                      loc_sdr-=loc_sdr/10*5;
1501   4                  }//å‘å³è½¬
1502   3                  fun_motors(mot_r,loc_sdr);
1503   3                  fun_motors(mot_l,loc_sdl);
1504   3                  fun_delay(1,del_ms);
1505   3              }
1506   2          }//å¦‚æœå·¡çº¿æ¡æ•°ä¸ä¸º0
1507   1          fun_qc(40,40);//å‰å†²
1508   1      }//ä¸»å‡½æ•°å·¡çº¿
1509          void fun_turn(enum varENU_tur par_model,uc par_speed){
1510   1          switch(par_model){//è·å–å‚æ•°
1511   2              case tur_r90://å³è½¬90
1512   2                  fun_motors(mot_l,par_speed);//å·¦è½®å‘å‰
1513   2                  fun_motors(mot_r,-par_speed);//å³è½®å‘å
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 26  

1514   2                  fun_delay(str_cod.mainturn90,del_ms);//è®¡æ—¶
1515   2                  break;
1516   2              case tur_l90://å·¦è½¬90
1517   2                  fun_motors(mot_l,-par_speed);//å·¦è½®å‘å
1518   2                  fun_motors(mot_r,par_speed);//å³è½®å‘å‰
1519   2                  fun_delay(str_cod.mainturn90,del_ms);//è®¡æ—¶
1520   2                  break;
1521   2              case tur_r180://å³è½¬180
1522   2                  fun_motors(mot_l,par_speed);//å·¦è½®å‘å‰
1523   2                  fun_motors(mot_r,-par_speed);//å³è½®å‘å
1524   2                  fun_delay(str_cod.mainturn180,del_ms);//è®¡æ—¶
1525   2                  break;
1526   2              case tur_l180://å·¦è½¬180
1527   2                  fun_motors(mot_l,-par_speed);//å·¦è½®å‘å
1528   2                  fun_motors(mot_r,par_speed);//å·¦è½®å‘å‰
1529   2                  fun_delay(str_cod.mainturn180,del_ms);//è®¡æ—¶
1530   2                  break;
1531   2          }
1532   1          while(in_ls3||in_ls6);//3äº®æˆ–è€…6äº®
1533   1          fun_motors(mot_rl,0);//åœæ­¢ç”µæœº
1534   1      }//ä¸»å‡½æ•°è½¬å¼¯
1535          void fun_qc(uc par_time,uc par_speed){
1536   1          uc loc_sdr,loc_sdl;//å·¦å³è½®é€Ÿåº¦
1537   1          str_tfl.delay=var_timer+par_time*10;//å»¶æ—¶æ—¶é—´(æ¯«ç§’)ä¸ºå‚æ•°çš„10å€
1538   1          while(str_tfl.delay>var_timer){
1539   2              //ç¬¬ä¸€ç‰ˆçº åç®—æ³•
1540   2              loc_sdr=loc_sdl=par_speed;
1541   2              if(in_ls1&&!in_ls8){//1äº®8ä¸äº®
1542   3                  loc_sdl*=0.7;//å·¦å‡é€Ÿ
1543   3                  loc_sdr*=1.3;//å³åŠ é€Ÿ
1544   3              }//å‘å·¦è½¬
1545   2              if(in_ls8&&!in_ls1){//8äº®1ä¸äº®
1546   3                  loc_sdl*=1.3;//å·¦åŠ é€Ÿ
1547   3                  loc_sdr*=0.7;//å³å‡é€Ÿ
1548   3              }//å‘å³è½¬
1549   2              if(in_ls2&&!in_ls7){//2äº®7ä¸äº®
1550   3                  loc_sdl*=0.8;//å·¦å‡é€Ÿ
1551   3                  loc_sdr*=1.2;//å³åŠ é€Ÿ
1552   3              }//å‘å·¦è½¬
1553   2              if(in_ls7&&!in_ls2){//7äº®2ä¸äº®
1554   3                  loc_sdl*=1.2;//å·¦åŠ é€Ÿ
1555   3                  loc_sdr*=0.8;//å³å‡é€Ÿ
1556   3              }//å‘å³è½¬
1557   2              if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
1558   3                  loc_sdl*=0.9;//å·¦å‡é€Ÿ
1559   3                  loc_sdr*=1.1;//å³åŠ é€Ÿ
1560   3              }//å‘å·¦è½¬
1561   2              if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
1562   3                  loc_sdl*=1.1;//å·¦åŠ é€Ÿ
1563   3                  loc_sdr*=0.9;//å³å‡é€Ÿ
1564   3              }//å‘å³è½¬
1565   2              fun_motors(mot_r,loc_sdr);
1566   2              fun_motors(mot_l,loc_sdl);
1567   2              fun_delay(1,del_ms);
1568   2          }
1569   1          fun_motors(mot_rl,0);//åœæ­¢ç”µæœº
1570   1      }//ä¸»å‡½æ•°å‰å†²
1571          void fun_stope2prom(){
1572   1          IAP_CONTR = 0;                  //å…³é—­IAPåŠŸèƒ½
1573   1          IAP_CMD = 0;                    //æ¸…é™¤å‘½ä»¤
1574   1          IAP_TRIG = 0;                   //æ¸…é™¤è§¦å‘å¯„å­˜å™¨
1575   1          IAP_ADDRH = 0x80;               //æ•°æ®æŒ‡é’ˆæŒ‡å‘éEEPROMåŒº
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 27  

1576   1          IAP_ADDRL = 0;                  //æ¸…é™¤IAPåœ°å€
1577   1      }//å…³é—­EEPROMåŠŸèƒ½(IapIdle)
1578          uc fun_reade2prom(ui par_add){
1579   1          uc loc_dat;                     //æ•°æ®ç¼“å†²åŒº
1580   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
1581   1          IAP_CMD = 1;                    //è®¾ç½®EEPROMè¯»å‘½ä»¤
1582   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
1583   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
1584   1          IAP_TRIG = 0x5a;                //è§¦å‘
1585   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
1586   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
1587   1          loc_dat = IAP_DATA;             //è¯»å‡ºEEPROMä¸­çš„æ•°æ®
1588   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
1589   1          return loc_dat;                 //è¿”å›è¯»å–ç»“æœ
1590   1      }//è¯»å–EEPROMæ•°æ®
1591          void fun_writee2prom(ui par_add,uc par_dat){
1592   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
1593   1          IAP_CMD = 2;                    //è®¾ç½®EEPROMå†™å…¥å‘½ä»¤
1594   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
1595   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
1596   1          IAP_DATA = par_dat;             //å†™å…¥æ•°æ®
1597   1          IAP_TRIG = 0x5a;                //è§¦å‘
1598   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
1599   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
1600   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
1601   1      }//å†™EEPROMæ•°æ®
1602          void fun_cleane2prom(ui par_add){
1603   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
1604   1          IAP_CMD = 3;                    //è®¾ç½®EEPROMæ“¦é™¤å‘½ä»¤
1605   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
1606   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
1607   1          IAP_TRIG = 0x5a;                //è§¦å‘
1608   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
1609   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
1610   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
1611   1      }//æ¸…é™¤EEPROMæ•°æ®
1612          void fun_calibration(){
1613   1          // fun_sj(sjp_1);//å‡åˆ°æœ€ä¸Šä½
1614   1          ul loc_time;
1615   1          fun_py(tra_q);//ç§»åŠ¨åˆ°æœ€å‰ç«¯
1616   1          fun_py(tra_h);//ç§»åŠ¨åˆ°æœ€åç«¯
1617   1          loc_time=var_timer;
1618   1          fun_py(tra_q);//ç§»åŠ¨åˆ°å‰ç«¯å¹¶è®¡æ—¶
1619   1          fun_py(tra_h);//ç§»åŠ¨åˆ°åç«¯
1620   1          loc_time=var_timer-loc_time;
1621   1          loc_time*=0.5;
1622   1          str_cod.py1zh=loc_time*0.5;//ä»ååˆ°ä¸­é—´
1623   1          str_cod.py1qz=loc_time*0.5;//ä»å‰åˆ°ä¸­é—´
1624   1          str_cod.py1qkh=loc_time*0.75;//ä»å‰åˆ°é å
1625   1          str_cod.py1kqh=loc_time*0.564;//ä»é å‰åˆ°å
1626   1          str_cod.py1qkq=loc_time*0.34;//ä»å‰åˆ°é å‰
1627   1          str_cod.py1khh=loc_time*0.2701;//ä»ååˆ°é å
1628   1          str_cod.py1kqz=loc_time*0.189;//ä»é å‰åˆ°ä¸­é—´
1629   1          str_cod.py1zkh=loc_time*0.20;//ä»é ååˆ°ä¸­é—´
1630   1          str_cod.py1kqkh=loc_time*0.5;//ä»é å‰åˆ°é å
1631   1          str_cod.py1khkq=loc_time*0.5;//ä»é ååˆ°é å‰
1632   1      }//è‡ªåŠ¨æ ¡å‡†å¹³ç§»å‚æ•°
1633          void fun_port(){
1634   1          //19200bps@12.000MHz
1635   1          PCON |= 0x80;       //ä½¿èƒ½æ³¢ç‰¹ç‡å€é€Ÿä½SMOD
1636   1          SCON = 0x50;        //8ä½æ•°æ®,å¯å˜æ³¢ç‰¹ç‡
1637   1          AUXR |= 0x04;       //ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨æ—¶é’Ÿä¸ºFosc,å³1T
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 28  

1638   1          BRT = 0xD9;         //è®¾å®šç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨é‡è£…å€¼
1639   1          AUXR |= 0x01;       //ä¸²å£1é€‰æ‹©ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨ä¸ºæ³¢ç‰¹ç‡å‘ç”Ÿå™¨
1640   1          AUXR |= 0x10;       //å¯åŠ¨ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨
1641   1      }//ä¸²å£åˆå§‹åŒ–
1642          void fun_test(){
1643   1          fun_sz(han_j);
1644   1          fun_delay(1,del_s);
1645   1          fun_sz(han_s);
1646   1          fun_delay(1,del_s);
1647   1          fun_sz(han_j);
1648   1          fun_delay(1,del_s);
1649   1          fun_sz(han_s);
1650   1          fun_delay(1,del_s);
1651   1      
1652   1          str_begin.pywz=tra_h;
1653   1          fun_py(tra_q);
1654   1          fun_delay(1,del_s);
1655   1          fun_py(tra_h);
1656   1          fun_delay(1,del_s);
1657   1          fun_py(tra_q);
1658   1          fun_delay(1,del_s);
1659   1          fun_py(tra_h);
1660   1          fun_delay(1,del_s);
1661   1      
1662   1          fun_sj(sjp_1);
1663   1          fun_delay(1,del_s);
1664   1          fun_sj(sjp_2);
1665   1          fun_delay(1,del_s);
1666   1          fun_sj(sjp_3);
1667   1          fun_delay(1,del_s);
1668   1          fun_sj(sjp_4);
1669   1          fun_delay(1,del_s);
1670   1          fun_sj(sjp_5);
1671   1          fun_delay(1,del_s);
1672   1          fun_sj(sjp_4);
1673   1          fun_delay(1,del_s);
1674   1          fun_sj(sjp_3);
1675   1          fun_delay(1,del_s);
1676   1          fun_sj(sjp_2);
1677   1          fun_delay(1,del_s);
1678   1          fun_sj(sjp_1);
1679   1      
1680   1          str_now.hzfx=str_begin.hzfx;
1681   1          str_begin.hzfx=dir_up;
1682   1          fun_hz(dir_right);
1683   1          fun_delay(1,del_s);
1684   1          fun_hz(dir_up);
1685   1          fun_delay(1,del_s);
1686   1          fun_hz(dir_right);
1687   1          fun_delay(1,del_s);
1688   1          fun_hz(dir_up);
1689   1          fun_delay(1,del_s);
1690   1          str_begin.hzfx=str_now.hzfx;
1691   1      
1692   1          fun_motors(mot_rl,60);
1693   1          fun_delay(1,del_s);
1694   1          fun_motors(mot_rl,0);
1695   1          fun_delay(1,del_s);
1696   1      
1697   1          fun_motors(mot_rl,-60);
1698   1          fun_delay(1,del_s);
1699   1          fun_motors(mot_rl,0);
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 29  

1700   1          fun_delay(1,del_s);
1701   1      
1702   1          fun_motors(mot_r,40);
1703   1          fun_motors(mot_l,-40);
1704   1          fun_delay(1,del_s);
1705   1          fun_motors(mot_rl,0);
1706   1          fun_delay(1,del_s);
1707   1      
1708   1          fun_motors(mot_r,-40);
1709   1          fun_motors(mot_l,40);
1710   1          fun_delay(1,del_s);
1711   1          fun_motors(mot_rl,0);
1712   1      }//æµ‹è¯•ç¨‹åº
1713          uc fun_min(uc par_num,...){
1714   1          va_list loc_argp;//ä¿å­˜å‚æ•°ç»“æ„
1715   1          uc loc_min=par_num;//ç°åœ¨çš„æœ€å°å€¼å°±æ˜¯ç¬¬ä¸€ä¸ª
1716   1          uc loc_shu;//å½“å‰å‚æ•°
1717   1          va_start(loc_argp,par_num);//loc_argpæŒ‡å‘ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œpar_numæ˜¯æœ€åä¸€ä¸ªç¡®å
             -®šçš„å‚æ•°
1718   1          loc_shu=va_arg(loc_argp,uc);//å–å‡ºä¸‹ä¸€ä¸ªå‚æ•°
1719   1          while(loc_shu!=def_end){//å¦‚æœä¸æ˜¯æœ€åä¸€ä¸ª
1720   2              if(loc_shu<loc_min)//å¦‚æœå–å‡ºçš„å‚æ•°æ¯”ä¹‹å‰æœ€å°çš„æ•°å°
1721   2                  loc_min=loc_shu;//å°†æ­¤æ•°ä¿å­˜
1722   2              loc_shu=va_arg(loc_argp,uc);//å–å‡ºä¸‹ä¸€ä¸ªå‚æ•°
1723   2          }
1724   1          va_end(loc_argp);//ç»“æŸ
1725   1          return loc_min;//é€€å‡º
1726   1      }//æ±‚æœ€å°å€¼
1727          void fun_setxy(uc par_1x,uc par_1y,uc par_1value,enum varENU_dir par_1fx,enum varENU_dir par_1gw,
1728              par_2x,uc par_2y,uc par_2value,enum varENU_dir par_2fx,enum varENU_dir par_2gw,
1729              par_3x,uc par_3y,uc par_3value,enum varENU_dir par_3fx,enum varENU_dir par_3gw,
1730              par_4x,uc par_4y,uc par_4value,enum varENU_dir par_4fx,enum varENU_dir par_4gw,
1731              uc par_5value,uc par_5fx){
1732   1          //xä¸ºxè½´åæ ‡,yä¸ºyè½´åæ ‡,valueä¸ºå·¥ä½å·,fxä¸ºåˆ°è¾¾æ­¤åæ ‡æ—¶éœ€è¦çš„æœå‘,gwä¸ºå·¥ä½åœ
             -¨å°è½¦çš„å“ªä¸€ä¾§
1733   1      
1734   1          //è®¾ç½®åæ ‡çš„value
1735   1          str_zbfl.xy[par_1x][par_1y].value=par_1value;
1736   1          str_zbfl.xy[par_2x][par_2y].value=par_2value;
1737   1          str_zbfl.xy[par_3x][par_3y].value=par_3value;
1738   1          str_zbfl.xy[par_4x][par_4y].value=par_4value;
1739   1          str_zbfl.top.value=par_5value;
1740   1      
1741   1          //è®¾ç½®åæ ‡çš„æ–¹å‘
1742   1          str_zbfl.xy[par_1x][par_1y].fx=par_1fx;
1743   1          str_zbfl.xy[par_2x][par_2y].fx=par_2fx;
1744   1          str_zbfl.xy[par_3x][par_3y].fx=par_3fx;
1745   1          str_zbfl.xy[par_4x][par_4y].fx=par_4fx;
1746   1          str_zbfl.top.fx=par_5fx;
1747   1      
1748   1          //Y=13
1749   1          str_zbfl.xy[0][13].enright=tf_false;
1750   1          str_zbfl.xy[0][13].enleft=tf_false;
1751   1          str_zbfl.xy[1][13].enup=tf_false;
1752   1          str_zbfl.xy[1][13].enright=tf_false;
1753   1          str_zbfl.xy[1][13].enleft=tf_false;
1754   1          str_zbfl.xy[1][13].endown=tf_false;
1755   1          str_zbfl.xy[2][13].enup=tf_false;
1756   1          str_zbfl.xy[2][13].enright=tf_false;
1757   1          str_zbfl.xy[2][13].enleft=tf_false;
1758   1          str_zbfl.xy[2][13].endown=tf_false;
1759   1          str_zbfl.xy[3][13].enup=tf_false;
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 30  

1760   1          str_zbfl.xy[3][13].enright=tf_false;
1761   1          str_zbfl.xy[3][13].enleft=tf_false;
1762   1          str_zbfl.xy[3][13].endown=tf_false;
1763   1          str_zbfl.xy[4][13].enright=tf_false;
1764   1          str_zbfl.xy[4][13].enleft=tf_false;
1765   1      
1766   1          //Y=12
1767   1          str_zbfl.xy[2][12].enup=tf_false;
1768   1          str_zbfl.xy[2][12].enright=tf_false;
1769   1          str_zbfl.xy[2][12].enleft=tf_false;
1770   1          str_zbfl.xy[2][12].endown=tf_false;
1771   1      
1772   1          //Y=12
1773   1          str_zbfl.xy[2][11].enup=tf_false;
1774   1      
1775   1          //å±è”½å·¥ä»¶å°ç›¸å…³åæ ‡
1776   1          fun_pbxy(par_1x,par_1y,par_1fx,par_1gw);
1777   1          fun_pbxy(par_2x,par_2y,par_2fx,par_2gw);
1778   1          fun_pbxy(par_3x,par_3y,par_3fx,par_3gw);
1779   1          fun_pbxy(par_4x,par_4y,par_4fx,par_4gw);
1780   1      
1781   1          //ç¦æ­¢åˆ°è¾¾æŠ“ä»¶å°å‘¨å›´
1782   1          str_zbfl.xy[2][0].enright=tf_false;
1783   1          str_zbfl.xy[2][1].enright=tf_false;
1784   1          str_zbfl.xy[2][2].enright=tf_false;
1785   1          str_zbfl.xy[3][0].enleft=tf_false;
1786   1          str_zbfl.xy[3][1].enleft=tf_false;
1787   1          str_zbfl.xy[3][2].enleft=tf_false;
1788   1          str_zbfl.xy[2][2].endown=tf_false;
1789   1          str_zbfl.xy[3][2].endown=tf_false;
1790   1          str_zbfl.xy[2][0].enup=tf_false;
1791   1          str_zbfl.xy[3][0].enup=tf_false;
1792   1      }//è®¾ç½®åˆå§‹åæ ‡
1793          void fun_pbxy(uc par_x,uc par_y,enum varENU_dir par_fx,enum varENU_dir par_gw){
1794   1          /*
1795   1              æ­¤å·¦å³ä¸ºç»å¯¹ä½ç½®
1796   1          */
1797   1          if(par_fx==dir_down){//å¦‚æœéœ€è¦å‘ä¸‹åœ
1798   2              if(par_gw==dir_left){//å¦‚æœå·¥ä½åœ¨å°è½¦å·¦è¾¹
1799   3                  str_zbfl.xy[par_x][par_y].enright=tf_false;
1800   3                  str_zbfl.xy[par_x+1][par_y].enleft=tf_false;
1801   3                  str_zbfl.xy[par_x][par_y-1].enright=tf_false;
1802   3                  str_zbfl.xy[par_x+1][par_y-1].enleft=tf_false;
1803   3              }
1804   2              else if(par_gw==dir_right){//å¦‚æœå·¥ä½åœ¨å°è½¦å³è¾¹
1805   3                  str_zbfl.xy[par_x][par_y].enright=tf_false;
1806   3                  str_zbfl.xy[par_x-1][par_y].enleft=tf_false;
1807   3                  str_zbfl.xy[par_x][par_y-1].enright=tf_false;
1808   3                  str_zbfl.xy[par_x-1][par_y-1].enleft=tf_false;
1809   3              }
1810   2          }else if(par_fx==dir_up){//å¦‚æœéœ€è¦å‘ä¸Šåœ
1811   2              if(par_gw==dir_left){//å¦‚æœå·¥ä½åœ¨å°è½¦å·¦è¾¹
1812   3                  str_zbfl.xy[par_x][par_y].enright=tf_false;
1813   3                  str_zbfl.xy[par_x-1][par_y].enleft=tf_false;
1814   3                  str_zbfl.xy[par_x][par_y+1].enright=tf_false;
1815   3                  str_zbfl.xy[par_x-1][par_y+1].enleft=tf_false;
1816   3              }
1817   2              else if(par_gw==dir_right){//å¦‚æœå·¥ä½åœ¨å°è½¦å³è¾¹
1818   3                  str_zbfl.xy[par_x][par_y].enright=tf_false;
1819   3                  str_zbfl.xy[par_x+1][par_y].enleft=tf_false;
1820   3                  str_zbfl.xy[par_x][par_y+1].enright=tf_false;
1821   3                  str_zbfl.xy[par_x+1][par_y+1].enleft=tf_false;
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 31  

1822   3              }
1823   2          }
1824   1      }//é€šè¿‡å·¥ä»¶çš„æœå‘å’Œå°è½¦çš„è½¦å¤´æ–¹å‘å±è”½åæ ‡
1825          void fun_getxy(char par_value){
1826   1          uc loc_xhx,loc_xhy;//ä¸¤ä¸ªå¾ªç¯å˜é‡
1827   1          str_now.x=str_begin.x;//å½“å‰çš„xè½´åæ ‡ç­‰äºèµ·å§‹çš„xè½´åæ ‡
1828   1          str_now.y=str_begin.y;//å½“å‰çš„yè½´åæ ‡ç­‰äºèµ·å§‹çš„yè½´åæ ‡
1829   1          str_now.ctfx=str_begin.ctfx;//å½“å‰çš„è½¦å¤´æ–¹å‘ç­‰äºèµ·å§‹çš„è½¦å¤´æ–¹å‘
1830   1          if(par_value==str_zbfl.top.value){//å¦‚æœæ˜¯å»æœ€é¡¶ä¸Šçš„å·¥ä½å°
1831   2              if(str_zbfl.top.fx==dir_right){
1832   3                  str_next.x=0;//xè½´åæ ‡èµ‹å€¼ä¸º0
1833   3                  str_next.y=12;//yè½´åæ ‡èµ‹å€¼ä¸º12
1834   3                  str_next.ctfx=dir_right;//è½¦å¤´æ–¹å‘èµ‹å€¼ä¸ºdir_right
1835   3              }else if(str_zbfl.top.fx==dir_left){
1836   3                  str_next.x=4;//xè½´åæ ‡èµ‹å€¼ä¸º4
1837   3                  str_next.y=12;//yè½´åæ ‡èµ‹å€¼ä¸º12
1838   3                  str_next.ctfx=dir_left;//è½¦å¤´æ–¹å‘èµ‹å€¼ä¸ºdir_left
1839   3              }
1840   2          }else{
1841   2              for(loc_xhx=0;loc_xhx<=4;loc_xhx++){//Xè½´å¾ªç¯,0-5
1842   3                  for(loc_xhy=0;loc_xhy<=12;loc_xhy++){//yè½´å¾ªç¯,0-12
1843   4                      if(str_zbfl.xy[loc_xhx][loc_xhy].value==par_value){//å¦‚æœæ‰¾åˆ°äº†è¿™ä¸ªä»¶
1844   5                          str_next.x=loc_xhx;//xè½´åæ ‡èµ‹å€¼ç»™str_next.x
1845   5                          str_next.y=loc_xhy;//yè½´åæ ‡èµ‹å€¼ç»™str_next.y
1846   5                          str_next.ctfx=str_zbfl.xy[loc_xhx][loc_xhy].fx;//è½¦å¤´æ–¹å‘èµ‹å€¼ç»™str_next.ctfx
1847   5                          return;//é€€å‡ºå‡½æ•°
1848   5                      }
1849   4                  }
1850   3              }
1851   2          }
1852   1      }//é€šè¿‡æƒ³è¦å»çš„å·¥ä½å·è·å¾—XYåæ ‡å¹¶å‚¨å­˜åœ¨str_nextç»“æ„ä½“ä¸­,æŠŠç°åœ¨çš„å·¥ä½å·å­˜å‚¨å†
             -str_nowç»“æ„ä½“ä¸­
1853          void fun_xymove(enum varENU_tfl par_model,char par_value){
1854   1          if(*str_tfl.run==0){//å¦‚æœå½“å‰æ­¥éª¤æ²¡è¢«ç¼–è¾‘è¿‡
1855   2              if(par_model==tfl_cache){//å¦‚æœç¬¬ä¸€ä¸ªæ˜¯å‰å†²
1856   3                  return;//ä¸å…è®¸æ˜¯å‰å†²
1857   3              }
1858   2              (*str_tfl.run)=par_model;//é‚£å°±ç­‰äºç°åœ¨çš„æ¨¡å¼
1859   2          }else if(*str_tfl.run!=par_model){//å¦‚æœå½“å‰æ­¥éª¤å’Œä¼ å…¥çš„æ­¥éª¤ä¸ä¸€æ ·
1860   2              str_tfl.run+=2;//æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ç»„æ•°ç»„
1861   2              (*str_tfl.run)=par_model;//å­˜å…¥æ­¥éª¤
1862   2          }
1863   1          switch(*str_tfl.run){//é€‰æ‹©æ­£åœ¨ç¼–è¾‘çš„æ­¥éª¤
1864   2              case tfl_line://å¦‚æœæ­£åœ¨ç¼–è¾‘å·¡çº¿
1865   2                  *(str_tfl.run+1)+=par_value;//å·¡çº¿æ­¥éª¤çš„å‚æ•°åŠ ä¸Šéœ€è¦å¢åŠ çš„å‚æ•°(æ®è¯´å¯ä»¥å‡
             -å»)
1866   2                  switch(str_now.ctfx){
1867   3                      case dir_up:
1868   3                          str_now.y+=par_value;
1869   3                          break;
1870   3                      case dir_down:
1871   3                          str_now.y-=par_value;
1872   3                          break;
1873   3                      case dir_left:
1874   3                          str_now.x-=par_value;
1875   3                          break;
1876   3                      case dir_right:
1877   3                          str_now.x+=par_value;
1878   3                          break;
1879   3                      default:
1880   3                          break;
1881   3                  }
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 32  

1882   2                  break;
1883   2              case tfl_turn://å¦‚æœæ­£åœ¨ç¼–è¾‘è½¬å¼¯
1884   2                  *(str_tfl.run+1)=par_value;//å‚æ•°ä¼ å…¥
1885   2                  switch(str_now.ctfx){
1886   3                      case dir_up:
1887   3                          switch(par_value){
1888   4                              case tur_l90:
1889   4                                  str_now.ctfx=dir_left;
1890   4                                  break;
1891   4                              case tur_r90:
1892   4                                  str_now.ctfx=dir_right;
1893   4                                  break;
1894   4                              case tur_l180:
1895   4                                  str_now.ctfx=dir_down;
1896   4                                  break;
1897   4                              case tur_r180:
1898   4                                  str_now.ctfx=dir_down;
1899   4                                  break;
1900   4                              default:
1901   4                                  break;
1902   4                          }
1903   3                          break;
1904   3                      case dir_down:
1905   3                          switch(par_value){
1906   4                              case tur_l90:
1907   4                                  str_now.ctfx=dir_right;
1908   4                                  break;
1909   4                              case tur_r90:
1910   4                                  str_now.ctfx=dir_left;
1911   4                                  break;
1912   4                              case tur_l180:
1913   4                                  str_now.ctfx=dir_up;
1914   4                                  break;
1915   4                              case tur_r180:
1916   4                                  str_now.ctfx=dir_up;
1917   4                                  break;
1918   4                              default:
1919   4                                  break;
1920   4                          }
1921   3                          break;
1922   3                      case dir_left:
1923   3                          switch(par_value){
1924   4                              case tur_l90:
1925   4                                  str_now.ctfx=dir_down;
1926   4                                  break;
1927   4                              case tur_r90:
1928   4                                  str_now.ctfx=dir_up;
1929   4                                  break;
1930   4                              case tur_l180:
1931   4                                  str_now.ctfx=dir_right;
1932   4                                  break;
1933   4                              case tur_r180:
1934   4                                  str_now.ctfx=dir_right;
1935   4                                  break;
1936   4                              default:
1937   4                                  break;
1938   4                          }
1939   3                          break;
1940   3                      case dir_right:
1941   3                          switch(par_value){
1942   4                              case tur_l90:
1943   4                                  str_now.ctfx=dir_up;
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 33  

1944   4                                  break;
1945   4                              case tur_r90:
1946   4                                  str_now.ctfx=dir_left;
1947   4                                  break;
1948   4                              case tur_l180:
1949   4                                  str_now.ctfx=dir_left;
1950   4                                  break;
1951   4                              case tur_r180:
1952   4                                  str_now.ctfx=dir_left;
1953   4                                  break;
1954   4                              default:
1955   4                                  break;
1956   4                          }
1957   3                          break;
1958   3                      default:
1959   3                          break;
1960   3                  }
1961   2                  break;
1962   2              case tfl_cache://å¦‚æœæ­£åœ¨ç¼–è¾‘å‰å†²
1963   2                  *(str_tfl.run+1)+=par_value;
1964   2                  break;
1965   2              default:
1966   2                  break;
1967   2          }
1968   1      }//åæ ‡å·¡çº¿å•æ­¥ç´¯è®¡æ­¥éª¤ç”Ÿæˆ
1969          char fun_getpublicy(char par_xnow,char par_ynow,char par_xnext,char par_ynext,enum varENU_dir par_gwfx){
1970   1          //0-19æ—¶ä¸ºæ­£å¸¸çš„PublicY,20-39æ—¶ä¸ºåŒåœ¨Xè½´(åŒä¸€ç«–çº¿ä¸Š),40-59æ—¶ä¸ºåŒåœ¨Yè½´(åŒä¸€æ¨ªçº¿
             -ä¸Š),-1ä¸ºé”™è¯¯
1971   1          char loc_xhy=0,loc_xhx=0,loc_con=0,loc_flag=0;
1972   1          if(par_xnext<par_xnow){//å¦‚æœè¦å»çš„åœ¨ç°åœ¨çš„å·¦è¾¹
1973   2              if(par_ynext>par_ynow){//å¦‚æœè¦å»çš„åœ¨ç°åœ¨çš„ä¸Šé¢
1974   3                  if(par_gwfx==dir_up){//å¦‚æœåœä¸‹çš„æ—¶å€™è½¦å¤´æ–¹å‘éœ€è¦å‘ä¸Š
1975   4                      for(loc_xhy=par_ynow;loc_xhy<par_ynext;loc_xhy++){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°è¦å»çš„Yè½´
             --1
1976   5                          for(loc_xhx=par_xnow;loc_xhx>=par_xnext;loc_xhx--){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
1977   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enleft==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
1978   7                                  loc_flag++;
1979   7                              }
1980   6                          }
1981   5                          if(par_xnow-par_xnext==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
1982   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
1983   6                          }else{
1984   6                              loc_flag=0;
1985   6                          }
1986   5                      }
1987   4                      for(loc_xhy=par_ynow;loc_xhy>=0;loc_xhy--){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°0
1988   5                          for(loc_xhx=par_xnow;loc_xhx>=par_xnext;loc_xhx--){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
1989   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enleft==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
1990   7                                  loc_flag++;
1991   7                              }
1992   6                          }
1993   5                          if(par_xnow-par_xnext==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
1994   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
1995   6                          }else{
1996   6                              loc_flag=0;
1997   6                          }
1998   5                      }
1999   4                      for(loc_xhy=par_ynext;loc_xhy<=12;loc_xhy++){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°12
2000   5                          for(loc_xhx=par_xnow;loc_xhx>=par_xnext;loc_xhx--){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 34  

2001   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enleft==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2002   7                                  loc_flag++;
2003   7                              }
2004   6                          }
2005   5                          if(par_xnow-par_xnext==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2006   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2007   6                          }else{
2008   6                              loc_flag=0;
2009   6                          }
2010   5                      }
2011   4                  }else if(par_gwfx==dir_down){//å¦‚æœåœä¸‹çš„æ—¶å€™è½¦å¤´æ–¹å‘éœ€è¦å‘ä¸‹
2012   4                      for(loc_xhy=par_ynext;loc_xhy<=12;loc_xhy++){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°12
2013   5                          for(loc_xhx=par_xnow;loc_xhx>=par_xnext;loc_xhx--){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2014   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enleft==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2015   7                                  loc_flag++;
2016   7                              }
2017   6                          }
2018   5                          if(par_xnow-par_xnext==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2019   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2020   6                          }else{
2021   6                              loc_flag=0;
2022   6                          }
2023   5                      }
2024   4                      for(loc_xhy=par_ynow;loc_xhy<par_ynext;loc_xhy++){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°è¦å»çš„Yè½´
             --1
2025   5                          for(loc_xhx=par_xnow;loc_xhx>=par_xnext;loc_xhx--){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2026   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enleft==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2027   7                                  loc_flag++;
2028   7                              }
2029   6                          }
2030   5                          if(par_xnow-par_xnext==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2031   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2032   6                          }else{
2033   6                              loc_flag=0;
2034   6                          }
2035   5                      }
2036   4                      for(loc_xhy=par_ynow;loc_xhy>=0;loc_xhy--){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°0
2037   5                          for(loc_xhx=par_xnow;loc_xhx>=par_xnext;loc_xhx--){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2038   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enleft==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2039   7                                  loc_flag++;
2040   7                              }
2041   6                          }
2042   5                          if(par_xnow-par_xnext==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2043   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2044   6                          }else{
2045   6                              loc_flag=0;
2046   6                          }
2047   5                      }
2048   4                  }
2049   3              }else if(par_ynext<par_ynow){//å¦‚æœè¦å»çš„åœ¨ç°åœ¨çš„ä¸‹é¢
2050   3                  if(par_gwfx==dir_up){
2051   4                      for(loc_xhy=par_ynext;loc_xhy>=0;loc_xhy--){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°è¦å»çš„Y=0
2052   5                          for(loc_xhx=par_xnow;loc_xhx>=par_xnext;loc_xhx--){//ä»ç°åœ¨çš„Xè½´å¾ªç¯åˆ°è¦å»çš
             -„Xè½´
2053   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enleft==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2054   7                                  loc_flag++;
2055   7                              }
2056   6                          }
2057   5                          if(par_xnow-par_xnext==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 35  

2058   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2059   6                          }else{
2060   6                              loc_flag=0;
2061   6                          }
2062   5                      }
2063   4                      for(loc_xhy=par_ynow;loc_xhy>par_ynext;loc_xhy--){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°è¦å»çš„Yè½´
2064   5                          for(loc_xhx=par_xnow;loc_xhx>=par_xnext;loc_xhx--){//ä»ç°åœ¨çš„Xè½´å¾ªç¯åˆ°è¦å»çš
             -„Xè½´
2065   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enleft==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2066   7                                  loc_flag++;
2067   7                              }
2068   6                          }
2069   5                          if(par_xnow-par_xnext==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2070   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2071   6                          }else{
2072   6                              loc_flag=0;
2073   6                          }
2074   5                      }
2075   4                      for(loc_xhy=par_ynow;loc_xhy<=12;loc_xhy++){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°è¦å»çš„Y=12
2076   5                          for(loc_xhx=par_xnow;loc_xhx>=par_xnext;loc_xhx--){//ä»ç°åœ¨çš„Xè½´å¾ªç¯åˆ°è¦å»çš
             -„Xè½´
2077   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enleft==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2078   7                                  loc_flag++;
2079   7                              }
2080   6                          }
2081   5                          if(par_xnow-par_xnext==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2082   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2083   6                          }else{
2084   6                              loc_flag=0;
2085   6                          }
2086   5                      }
2087   4                  }else if(par_gwfx==dir_down){
2088   4                      for(loc_xhy=par_ynow;loc_xhy>par_ynext;loc_xhy--){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°è¦å»çš„Yè½´
2089   5                          for(loc_xhx=par_xnow;loc_xhx>=par_xnext;loc_xhx--){//ä»ç°åœ¨çš„Xè½´å¾ªç¯åˆ°è¦å»çš
             -„Xè½´
2090   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enleft==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2091   7                                  loc_flag++;
2092   7                              }
2093   6                          }
2094   5                          if(par_xnow-par_xnext==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2095   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2096   6                          }else{
2097   6                              loc_flag=0;
2098   6                          }
2099   5                      }
2100   4                      for(loc_xhy=par_ynow;loc_xhy<=12;loc_xhy++){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°è¦å»çš„Y=12
2101   5                          for(loc_xhx=par_xnow;loc_xhx>=par_xnext;loc_xhx--){//ä»ç°åœ¨çš„Xè½´å¾ªç¯åˆ°è¦å»çš
             -„Xè½´
2102   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enleft==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2103   7                                  loc_flag++;
2104   7                              }
2105   6                          }
2106   5                          if(par_xnow-par_xnext==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2107   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2108   6                          }else{
2109   6                              loc_flag=0;
2110   6                          }
2111   5                      }
2112   4                      for(loc_xhy=par_ynext;loc_xhy>=0;loc_xhy--){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°è¦å»çš„Y=0
2113   5                          for(loc_xhx=par_xnow;loc_xhx>=par_xnext;loc_xhx--){//ä»ç°åœ¨çš„Xè½´å¾ªç¯åˆ°è¦å»çš
             -„Xè½´
2114   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enleft==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 36  

2115   7                                  loc_flag++;
2116   7                              }
2117   6                          }
2118   5                          if(par_xnow-par_xnext==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2119   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2120   6                          }else{
2121   6                              loc_flag=0;
2122   6                          }
2123   5                      }
2124   4                  }
2125   3              }else{//å¦‚æœåŒåœ¨Yè½´(ä¸€æ¡æ¨ªçº¿ä¸Š)
2126   3                  if(par_gwfx==dir_up){
2127   4                      for(loc_xhy=par_ynow;loc_xhy>=0;loc_xhy--){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°0
2128   5                          for(loc_xhx=par_xnow;loc_xhx>=par_xnext;loc_xhx--){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2129   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enleft==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2130   7                                  loc_flag++;
2131   7                              }
2132   6                          }
2133   5                          if(par_xnow-par_xnext==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2134   6                              return (loc_xhy+40);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2135   6                          }else{
2136   6                              loc_flag=0;
2137   6                          }
2138   5                      }
2139   4                      for(loc_xhy=par_ynext;loc_xhy<=12;loc_xhy++){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°12
2140   5                          for(loc_xhx=par_xnow;loc_xhx>=par_xnext;loc_xhx--){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2141   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enleft==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2142   7                                  loc_flag++;
2143   7                              }
2144   6                          }
2145   5                          if(par_xnow-par_xnext==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2146   6                              return (loc_xhy+40);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2147   6                          }else{
2148   6                              loc_flag=0;
2149   6                          }
2150   5                      }
2151   4                  }else if(par_gwfx==dir_down){
2152   4                      for(loc_xhy=par_ynext;loc_xhy<=12;loc_xhy++){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°12
2153   5                          for(loc_xhx=par_xnow;loc_xhx>=par_xnext;loc_xhx--){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2154   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enleft==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2155   7                                  loc_flag++;
2156   7                              }
2157   6                          }
2158   5                          if(par_xnow-par_xnext==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2159   6                              return (loc_xhy+40);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2160   6                          }else{
2161   6                              loc_flag=0;
2162   6                          }
2163   5                      }
2164   4                      for(loc_xhy=par_ynow;loc_xhy>=0;loc_xhy--){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°0
2165   5                          for(loc_xhx=par_xnow;loc_xhx>=par_xnext;loc_xhx--){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2166   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enleft==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2167   7                                  loc_flag++;
2168   7                              }
2169   6                          }
2170   5                          if(par_xnow-par_xnext==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2171   6                              return (loc_xhy+40);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2172   6                          }else{
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 37  

2173   6                              loc_flag=0;
2174   6                          }
2175   5                      }
2176   4                  }
2177   3              }
2178   2          }else if(par_xnext>par_xnow){//å¦‚æœè¦å»çš„åœ¨ç°åœ¨çš„å³è¾¹
2179   2              if(par_ynext>par_ynow){//å¦‚æœè¦å»çš„åœ¨ç°åœ¨çš„ä¸Šé¢
2180   3                  if(par_gwfx==dir_up){//å¦‚æœå·¥ä½è¦æ±‚å‘ä¸Šåœ
2181   4                      for(loc_xhy=par_ynow;loc_xhy<par_ynext;loc_xhy++){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°è¦å»çš„Yè½´
             --1
2182   5                          for(loc_xhx=par_xnow;loc_xhx<=par_xnext;loc_xhx++){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2183   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enright==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2184   7                                  loc_flag++;
2185   7                              }
2186   6                          }
2187   5                          if(par_xnext-par_xnow==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2188   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2189   6                          }else{
2190   6                              loc_flag=0;
2191   6                          }
2192   5                      }
2193   4                      for(loc_xhy=par_ynow;loc_xhy>=0;loc_xhy--){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°0
2194   5                          for(loc_xhx=par_xnow;loc_xhx<=par_xnext;loc_xhx++){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2195   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enright==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2196   7                                  loc_flag++;
2197   7                              }
2198   6                          }
2199   5                          if(par_xnext-par_xnow==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2200   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2201   6                          }else{
2202   6                              loc_flag=0;
2203   6                          }
2204   5                      }
2205   4                      for(loc_xhy=par_ynext;loc_xhy<=12;loc_xhy++){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°12
2206   5                          for(loc_xhx=par_xnow;loc_xhx<=par_xnext;loc_xhx++){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2207   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enright==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2208   7                                  loc_flag++;
2209   7                              }
2210   6                          }
2211   5                          if(par_xnext-par_xnow==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2212   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2213   6                          }else{
2214   6                              loc_flag=0;
2215   6                          }
2216   5                      }
2217   4                  }else if(par_gwfx==dir_down){//å¦‚æœå·¥ä½è¦æ±‚å‘ä¸‹åœ
2218   4                      for(loc_xhy=par_ynext;loc_xhy<=12;loc_xhy++){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°12
2219   5                          for(loc_xhx=par_xnow;loc_xhx<=par_xnext;loc_xhx++){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2220   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enright==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2221   7                                  loc_flag++;
2222   7                              }
2223   6                          }
2224   5                          if(par_xnext-par_xnow==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2225   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2226   6                          }else{
2227   6                              loc_flag=0;
2228   6                          }
2229   5                      }
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 38  

2230   4                      for(loc_xhy=par_ynow;loc_xhy<par_ynext;loc_xhy++){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°è¦å»çš„Yè½´
             --1
2231   5                          for(loc_xhx=par_xnow;loc_xhx<=par_xnext;loc_xhx++){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2232   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enright==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2233   7                                  loc_flag++;
2234   7                              }
2235   6                          }
2236   5                          if(par_xnext-par_xnow==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2237   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2238   6                          }else{
2239   6                              loc_flag=0;
2240   6                          }
2241   5                      }
2242   4                      for(loc_xhy=par_ynow;loc_xhy>=0;loc_xhy--){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°0
2243   5                          for(loc_xhx=par_xnow;loc_xhx<=par_xnext;loc_xhx++){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2244   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enright==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2245   7                                  loc_flag++;
2246   7                              }
2247   6                          }
2248   5                          if(par_xnext-par_xnow==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2249   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2250   6                          }else{
2251   6                              loc_flag=0;
2252   6                          }
2253   5                      }
2254   4                  }
2255   3              }else if(par_ynext<par_ynow){//å¦‚æœè¦å»çš„åœ¨ç°åœ¨çš„ä¸‹é¢
2256   3                  if(par_gwfx==dir_up){//å¦‚æœå·¥å§”è¦æ±‚å‘ä¸Šåœ
2257   4                      for(loc_xhy=par_ynext;loc_xhy>=0;loc_xhy--){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°è¦å»çš„Y=0
2258   5                          for(loc_xhx=par_xnow;loc_xhx<=par_xnext;loc_xhx++){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2259   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enright==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2260   7                                  loc_flag++;
2261   7                              }
2262   6                          }
2263   5                          if(par_xnext-par_xnow==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2264   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2265   6                          }else{
2266   6                              loc_flag=0;
2267   6                          }
2268   5                      }
2269   4                      for(loc_xhy=par_ynow;loc_xhy>par_ynext;loc_xhy--){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°è¦å»çš„Yè½´
2270   5                          for(loc_xhx=par_xnow;loc_xhx<=par_xnext;loc_xhx++){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2271   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enright==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2272   7                                  loc_flag++;
2273   7                              }
2274   6                          }
2275   5                          if(par_xnext-par_xnow==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2276   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2277   6                          }else{
2278   6                              loc_flag=0;
2279   6                          }
2280   5                      }
2281   4                      for(loc_xhy=par_ynow;loc_xhy<=12;loc_xhy++){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°è¦å»çš„Y=12
2282   5                          for(loc_xhx=par_xnow;loc_xhx<=par_xnext;loc_xhx++){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2283   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enright==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2284   7                                  loc_flag++;
2285   7                              }
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 39  

2286   6                          }
2287   5                          if(par_xnext-par_xnow==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2288   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2289   6                          }else{
2290   6                              loc_flag=0;
2291   6                          }
2292   5                      }
2293   4                  }else if(par_gwfx==dir_down){//å¦‚æœå·¥ä½è¦æ±‚å‘ä¸‹åœ
2294   4                      for(loc_xhy=par_ynow;loc_xhy>par_ynext;loc_xhy--){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°è¦å»çš„Yè½´
2295   5                          for(loc_xhx=par_xnow;loc_xhx<=par_xnext;loc_xhx++){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2296   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enright==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2297   7                                  loc_flag++;
2298   7                              }
2299   6                          }
2300   5                          if(par_xnext-par_xnow==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2301   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2302   6                          }else{
2303   6                              loc_flag=0;
2304   6                          }
2305   5                      }
2306   4                      for(loc_xhy=par_ynow;loc_xhy<=12;loc_xhy++){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°è¦å»çš„Y=12
2307   5                          for(loc_xhx=par_xnow;loc_xhx<=par_xnext;loc_xhx++){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2308   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enright==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2309   7                                  loc_flag++;
2310   7                              }
2311   6                          }
2312   5                          if(par_xnext-par_xnow==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2313   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2314   6                          }else{
2315   6                              loc_flag=0;
2316   6                          }
2317   5                      }
2318   4                      for(loc_xhy=par_ynext;loc_xhy>=0;loc_xhy--){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°è¦å»çš„Y=0
2319   5                          for(loc_xhx=par_xnow;loc_xhx<=par_xnext;loc_xhx++){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2320   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enright==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2321   7                                  loc_flag++;
2322   7                              }
2323   6                          }
2324   5                          if(par_xnext-par_xnow==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2325   6                              return (loc_xhy);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2326   6                          }else{
2327   6                              loc_flag=0;
2328   6                          }
2329   5                      }
2330   4                  }
2331   3              }else{//å¦‚æœåŒåœ¨Yè½´(ä¸€æ¡æ¨ªçº¿ä¸Š)
2332   3                  if(par_gwfx==dir_up){
2333   4                      for(loc_xhy=par_ynow;loc_xhy>=0;loc_xhy--){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°0
2334   5                          for(loc_xhx=par_xnow;loc_xhx>=par_xnext;loc_xhx--){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2335   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enright==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2336   7                                  loc_flag++;
2337   7                              }
2338   6                          }
2339   5                          if(par_xnow-par_xnext==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2340   6                              return (loc_xhy+40);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2341   6                          }else{
2342   6                              loc_flag=0;
2343   6                          }
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 40  

2344   5                      }
2345   4                      for(loc_xhy=par_ynext;loc_xhy<=12;loc_xhy++){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°12
2346   5                          for(loc_xhx=par_xnow;loc_xhx>=par_xnext;loc_xhx--){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2347   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enright==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2348   7                                  loc_flag++;
2349   7                              }
2350   6                          }
2351   5                          if(par_xnow-par_xnext==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2352   6                              return (loc_xhy+40);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2353   6                          }else{
2354   6                              loc_flag=0;
2355   6                          }
2356   5                      }
2357   4                  }else if(par_gwfx==dir_down){
2358   4                      for(loc_xhy=par_ynext;loc_xhy<=12;loc_xhy++){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°12
2359   5                          for(loc_xhx=par_xnow;loc_xhx>=par_xnext;loc_xhx--){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2360   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enright==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2361   7                                  loc_flag++;
2362   7                              }
2363   6                          }
2364   5                          if(par_xnow-par_xnext==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2365   6                              return (loc_xhy+40);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2366   6                          }else{
2367   6                              loc_flag=0;
2368   6                          }
2369   5                      }
2370   4                      for(loc_xhy=par_ynow;loc_xhy>=0;loc_xhy--){//ä»ç°åœ¨çš„Yè½´å¾ªç¯åˆ°0
2371   5                          for(loc_xhx=par_xnow;loc_xhx>=par_xnext;loc_xhx--){//ä»ç°åœ¨çš„xè½´å¾ªç¯åˆ°è¦å»çš
             -„xè½´
2372   6                              if(str_zbfl.xy[loc_xhx][loc_xhy].enright==tf_ture){//å¦‚æœè¯¥ä½ç½®å…è®¸å·¦è½¬
2373   7                                  loc_flag++;
2374   7                              }
2375   6                          }
2376   5                          if(par_xnow-par_xnext==loc_flag-1){//å¦‚æœæ¯ä¸€æ¡çº¿éƒ½å¯ä»¥èµ°
2377   6                              return (loc_xhy+40);//è¿”å›å¯ä»¥èµ°çš„Yå€¼
2378   6                          }else{
2379   6                              loc_flag=0;
2380   6                          }
2381   5                      }
2382   4                  }
2383   3              }
2384   2          }else{//å¦‚æœè¦å»çš„åœ¨åŒä¸€Xè½´ä¸Š(ä¸€æ¡ç«–çº¿ä¸Š)
2385   2              return (par_ynext+20);
2386   2          }
2387   1          return (-1);
2388   1      }//è·å–å…±æœ‰Yè½´
2389          void fun_record(char par_xnow,char par_ynow,enum varENU_dir par_ctfxnow,char par_xnext,char par_ynext,enum
             - varENU_dir par_ctfxnext){
2390   1          //          éœ€è¦åˆ°çš„X ,éœ€è¦åˆ°çš„y ,éœ€è¦çš„è½¦å¤´æ–¹å‘
2391   1          /*
2392   1              ä¼˜å…ˆå·¦å³èµ°,å…¶æ¬¡è€ƒè™‘è½¦å¤´æ–¹å‘,å†æ¬¡è€ƒè™‘å·¥ä»¶å°çš„ä½ç½®
2393   1          */
2394   1          char loc_xnow=par_xnow,loc_ynow=par_ynow,loc_ctfxnow=par_ctfxnow;//å±€éƒ¨å˜é‡ç”¨äºè®¡ç®—æ—¶çš„ä¸­é—
             -´å€¼
2395   1          while((par_xnow!=par_xnext)||(par_ynow!=par_ynext)||(par_ctfxnow!=par_ctfxnext)){//å¦‚æœxyè½´åˆ°è¾¾äº
             -†,è½¦å¤´æ–¹å‘ä¸€è‡´äº†
2396   2              switch(par_ctfxnow){//åˆ¤æ–­å½“å‰è½¦å¤´æ–¹å‘
2397   3                  case dir_up://ç°åœ¨è½¦å¤´æœä¸Š
2398   3                      if(par_xnext>par_xnow){//å¦‚æœè¦å»çš„xå€¼æ¯”ç°åœ¨çš„å¤§,å‘å³èµ°
2399   4                          fun_xymove(tfl_cache,40);
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 41  

2400   4                          fun_xymove(tfl_turn,tur_r90);
2401   4                          par_ctfxnow=dir_right;
2402   4                          continue;
2403   4                      }
2404   3                      if(par_xnext<par_xnow){//å¦‚æœè¦å»çš„xå€¼æ¯”ç°åœ¨çš„å°,å‘å·¦èµ°
2405   4                          fun_xymove(tfl_cache,40);
2406   4                          fun_xymove(tfl_turn,tur_l90);
2407   4                          par_ctfxnow=dir_left;
2408   4                          continue;
2409   4                      }
2410   3                      if(par_ynext>par_ynow){//å¦‚æœè¦å»çš„Yå€¼æ¯”ç°åœ¨çš„å¤§,å‘ä¸Šèµ°
2411   4                          fun_xymove(tfl_line,1);
2412   4                          par_ynow+=1;
2413   4                          continue;
2414   4                      }
2415   3                      if(par_ynext<par_ynow){//å¦‚æœè¦å»çš„Yå€¼æ¯”ç°åœ¨çš„å°,å‘ä¸‹èµ°
2416   4                          fun_xymove(tfl_cache,40);
2417   4                          fun_xymove(tfl_turn,tur_r180);
2418   4                          par_ctfxnow=dir_down;
2419   4                          continue;
2420   4                      }
2421   3                      if(par_xnext==par_xnow&&par_ynext==par_ynow){//éœ€è¦åœ¨åŸåœ°è½¬ä¸ªå¼¯
2422   4                          fun_xymove(tfl_cache,40);
2423   4                          switch(par_ctfxnext){
2424   5                              case dir_left:
2425   5                                  fun_xymove(tfl_turn,tur_l90);
2426   5                                  break;
2427   5                              case dir_right:
2428   5                                  fun_xymove(tfl_turn,tur_r90);
2429   5                                  break;
2430   5                              case dir_down:
2431   5                                  fun_xymove(tfl_turn,tur_l180);
2432   5                                  break;
2433   5                              default:
2434   5                                  break;
2435   5                          }
2436   4                          par_ctfxnow=par_ctfxnext;
2437   4                          continue;
2438   4                      }
2439   3                      break;
2440   3                  case dir_down://ç°åœ¨è½¦å¤´æœä¸‹
2441   3                      if(par_xnext>par_xnow){//å¦‚æœè¦å»çš„xå€¼æ¯”ç°åœ¨çš„å¤§//å‘å³èµ°
2442   4                          fun_xymove(tfl_cache,40);
2443   4                          fun_xymove(tfl_turn,tur_l90);
2444   4                          par_ctfxnow=dir_right;
2445   4                          continue;
2446   4                      }
2447   3                      if(par_xnext<par_xnow){//å¦‚æœè¦å»çš„xå€¼æ¯”ç°åœ¨çš„å°//å‘å·¦èµ°
2448   4                          fun_xymove(tfl_cache,40);
2449   4                          fun_xymove(tfl_turn,tur_r90);
2450   4                          par_ctfxnow=dir_left;
2451   4                          continue;
2452   4                      }
2453   3                      if(par_ynext<par_ynow){//å¦‚æœè¦å»çš„Yå€¼æ¯”ç°åœ¨çš„å°//å‘ä¸‹èµ°
2454   4                          fun_xymove(tfl_line,1);
2455   4                          par_ynow-=1;
2456   4                          continue;
2457   4                      }
2458   3                      if(par_ynext>par_ynow){//å¦‚æœè¦å»çš„Yå€¼æ¯”ç°åœ¨çš„å¤§//å‘ä¸Šèµ°
2459   4                          fun_xymove(tfl_cache,40);
2460   4                          fun_xymove(tfl_turn,tur_r180);
2461   4                          par_ctfxnow=dir_up;
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 42  

2462   4                          continue;
2463   4                      }
2464   3                      if(par_xnext==par_xnow&&par_ynext==par_ynow){//éœ€è¦åœ¨åŸåœ°è½¬ä¸ªå¼¯
2465   4                          fun_xymove(tfl_cache,40);
2466   4                          switch(par_ctfxnext){
2467   5                              case dir_left:
2468   5                                  fun_xymove(tfl_turn,tur_r90);
2469   5                                  break;
2470   5                              case dir_right:
2471   5                                  fun_xymove(tfl_turn,tur_l90);
2472   5                                  break;
2473   5                              case dir_up:
2474   5                                  fun_xymove(tfl_turn,tur_l180);
2475   5                                  break;
2476   5                              default:
2477   5                                  break;
2478   5                          }
2479   4                          par_ctfxnow=par_ctfxnext;
2480   4                          continue;
2481   4                      }
2482   3                      break;
2483   3                  case dir_right://ç°åœ¨è½¦å¤´æœå³
2484   3                      if(par_xnext>par_xnow){//å¦‚æœè¦å»çš„xå€¼æ¯”ç°åœ¨çš„å¤§,å‘å³èµ°
2485   4                          fun_xymove(tfl_line,1);
2486   4                          par_xnow+=1;
2487   4                          continue;
2488   4                      }
2489   3                      if(par_xnext<par_xnow){//å¦‚æœè¦å»çš„xå€¼æ¯”ç°åœ¨çš„å°,å‘å·¦èµ°
2490   4                          fun_xymove(tfl_cache,40);
2491   4                          fun_xymove(tfl_turn,tur_l180);
2492   4                          par_ctfxnow=dir_left;
2493   4                          continue;
2494   4                      }
2495   3                      if(par_ynext>par_ynow){//å¦‚æœè¦å»çš„Yå€¼æ¯”ç°åœ¨çš„å¤§,å‘ä¸Šèµ°
2496   4                          fun_xymove(tfl_cache,40);
2497   4                          fun_xymove(tfl_turn,tur_l90);
2498   4                          par_ctfxnow=dir_up;
2499   4                          continue;
2500   4                      }
2501   3                      if(par_ynext<par_ynow){//å¦‚æœè¦å»çš„Yå€¼æ¯”ç°åœ¨çš„å°,å‘ä¸‹èµ°
2502   4                          fun_xymove(tfl_cache,40);
2503   4                          fun_xymove(tfl_turn,tur_r90);
2504   4                          par_ctfxnow=dir_down;
2505   4                          continue;
2506   4                      }
2507   3                      if(par_xnext==par_xnow&&par_ynext==par_ynow){//éœ€è¦åœ¨åŸåœ°è½¬ä¸ªå¼¯
2508   4                          fun_xymove(tfl_cache,40);
2509   4                          switch(par_ctfxnext){
2510   5                              case dir_left:
2511   5                                  fun_xymove(tfl_turn,tur_l180);
2512   5                                  break;
2513   5                              case dir_down:
2514   5                                  fun_xymove(tfl_turn,tur_r90);
2515   5                                  break;
2516   5                              case dir_up:
2517   5                                  fun_xymove(tfl_turn,tur_l90);
2518   5                                  break;
2519   5                              default:
2520   5                                  break;
2521   5                          }
2522   4                          par_ctfxnow=par_ctfxnext;
2523   4                          continue;
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 43  

2524   4                      }
2525   3                      break;
2526   3                  case dir_left://ç°åœ¨è½¦å¤´æœå·¦
2527   3                      if(par_xnext<par_xnow){//å¦‚æœè¦å»çš„xå€¼æ¯”ç°åœ¨çš„å°,å‘å·¦èµ°
2528   4                          fun_xymove(tfl_line,1);
2529   4                          par_xnow-=1;
2530   4                          continue;
2531   4                      }
2532   3                      if(par_xnext>par_xnow){//å¦‚æœè¦å»çš„xå€¼æ¯”ç°åœ¨çš„å¤§,å‘å³èµ°
2533   4                          fun_xymove(tfl_cache,40);
2534   4                          fun_xymove(tfl_turn,tur_l180);
2535   4                          par_ctfxnow=dir_right;
2536   4                          continue;
2537   4                      }
2538   3                      if(par_ynext>par_ynow){//å¦‚æœè¦å»çš„Yå€¼æ¯”ç°åœ¨çš„å¤§,å‘ä¸Šèµ°
2539   4                          fun_xymove(tfl_cache,40);
2540   4                          fun_xymove(tfl_turn,tur_r90);
2541   4                          par_ctfxnow=dir_up;
2542   4                          continue;
2543   4                      }
2544   3                      if(par_ynext<par_ynow){//å¦‚æœè¦å»çš„Yå€¼æ¯”ç°åœ¨çš„å°,å‘ä¸‹èµ°
2545   4                          fun_xymove(tfl_cache,40);
2546   4                          fun_xymove(tfl_turn,tur_l90);
2547   4                          par_ctfxnow=dir_down;
2548   4                          continue;
2549   4                      }
2550   3                      if(par_xnext==par_xnow&&par_ynext==par_ynow){//éœ€è¦åœ¨åŸåœ°è½¬ä¸ªå¼¯
2551   4                          fun_xymove(tfl_cache,40);
2552   4                          switch(par_ctfxnext){
2553   5                              case dir_right:
2554   5                                  fun_xymove(tfl_turn,tur_l180);
2555   5                                  break;
2556   5                              case dir_down:
2557   5                                  fun_xymove(tfl_turn,tur_l90);
2558   5                                  break;
2559   5                              case dir_up:
2560   5                                  fun_xymove(tfl_turn,tur_r90);
2561   5                                  break;
2562   5                              default:
2563   5                                  break;
2564   5                          }
2565   4                          par_ctfxnow=par_ctfxnext;
2566   4                          continue;
2567   4                      }
2568   3                      break;
2569   3                  default:
2570   3                      break;
2571   3              }
2572   2          }
2573   1      }//å®šæ—¶å™¨åæ ‡å·¡çº¿æ­¥éª¤ç”Ÿæˆ
2574          void fun_back(){
2575   1          ;
2576   1      }
2577          void fun_coordinate(char par_gospeed,char par_turnspeed,char par_cachespeed){
2578   1          char loc_y=fun_getpublicy(str_now.x,str_now.y,str_next.x,str_next.y,str_next.ctfx);//è·å–å…¬å…±Y
2579   1          str_tfl.run=str_tfl.step;//æŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªæ­¥éª¤
2580   1          if((loc_y>=0&&loc_y<20)||(loc_y>=40&&loc_y<60)){//å¸¸è§„æƒ…å†µå’Œåœ¨åŒä¸€æ¨ªè½´çš„æƒ…å†µ
2581   2              if(loc_y>=40&&loc_y<60){
2582   3                  loc_y-=40;
2583   3              }
2584   2              //ç¬¬ä¸€æ­¥:ç›´è¡Œ
2585   2              if(loc_y!=str_now.y){//å½“å‰è¡Œä¸æ˜¯PublicY
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 44  

2586   3                  if(str_next.y>str_now.y){//è¦å¾€ä¸Šèµ°
2587   4                      if(str_now.ctfx!=dir_up){//å¦‚æœè½¦å¤´ä¸æ˜¯å‘ä¸Š(æ˜¯å‘ä¸‹)
2588   5                          fun_xymove(tfl_cache,40);//å‰å†²
2589   5                          switch(str_now.ctfx){//é€‰æ‹©ç°åœ¨çš„è½¦å¤´æ–¹å‘
2590   6                              case dir_down://å¦‚æœç°åœ¨è½¦å¤´å‘ä¸‹
2591   6                                  if(str_zbfl.xy[str_now.x][str_now.y].enleft==tf_ture){//å¦‚æœå·¦è¾¹æ²¡ä¸œè¥¿
2592   7                                      fun_xymove(tfl_turn,tur_r180);//å³è½¬180
2593   7                                      fun_xymove(tfl_line,str_next.y-str_now.y);//å·¡çº¿è‡³PublicY
2594   7                                  }else if(str_zbfl.xy[str_now.x][str_now.y].enright==tf_ture){//å¦‚æœå³è¾¹æ²¡
             -ä¸œè¥¿
2595   7                                      fun_xymove(tfl_turn,tur_l180);//å·¦è½¬180
2596   7                                      fun_xymove(tfl_line,str_next.y-str_now.y);//å·¡çº¿è‡³PublicY
2597   7                                  }else{//å·¦å³éƒ½æœ‰ä¸œè¥¿
2598   7                                      ;//*$*//
2599   7                                  }
2600   6                                  break;
2601   6                              case dir_left://å¦‚æœç°åœ¨è½¦å¤´å‘å·¦
2602   6                                  fun_xymove(tfl_turn,tur_r90);//è½¬å¼¯
2603   6                                  fun_xymove(tfl_line,str_next.y-str_now.y);//å·¡çº¿è‡³PublicY
2604   6                                  break;
2605   6                              case dir_right://å¦‚æœç°åœ¨è½¦å¤´å‘å³
2606   6                                  fun_xymove(tfl_turn,tur_l90);//è½¬å¼¯
2607   6                                  fun_xymove(tfl_line,str_next.y-str_now.y);//å·¡çº¿è‡³PublicY
2608   6                                  break;
2609   6                              default:
2610   6                                  break;
2611   6                          }
2612   5                      }else{//å¦‚æœè½¦å¤´å‘ä¸Š
2613   5                          fun_xymove(tfl_line,str_next.y-str_now.y);//ç›´æ¥å·¡çº¿è‡³PublicY
2614   5                      }
2615   4                  }else if(str_next.y<str_now.y){//å¦‚æœè¦å»çš„åœ¨ç°åœ¨çš„ä¸‹é¢,å¾€ä¸‹èµ°
2616   4                      if(str_now.ctfx!=dir_down){//å¦‚æœè½¦å¤´ä¸æ˜¯å‘ä¸‹(æ˜¯å‘ä¸Š)
2617   5                          fun_xymove(tfl_cache,40);//å‰å†²
2618   5                          switch(str_now.ctfx){//é€‰æ‹©ç°åœ¨çš„è½¦å¤´æ–¹å‘
2619   6                              case dir_up://å¦‚æœç°åœ¨è½¦å¤´å‘ä¸Š
2620   6                                  if(str_zbfl.xy[str_now.x][str_now.y].enleft==tf_ture){//å¦‚æœå·¦è¾¹æ²¡ä¸œè¥¿
2621   7                                      fun_xymove(tfl_turn,tur_l180);//å·¦è½¬180
2622   7                                      fun_xymove(tfl_line,str_now.y-str_next.y);//å·¡çº¿è‡³PublicY
2623   7                                  }else if(str_zbfl.xy[str_now.x][str_now.y].enright==tf_ture){//å¦‚æœå³è¾¹æ²¡
             -ä¸œè¥¿
2624   7                                      fun_xymove(tfl_turn,tur_r180);//å³è½¬180
2625   7                                      fun_xymove(tfl_line,str_now.y-str_next.y);//å·¡çº¿è‡³PublicY
2626   7                                  }else{//å·¦å³éƒ½æœ‰ä¸œè¥¿
2627   7                                      ;//*$*//
2628   7                                  }
2629   6                                  break;
2630   6                              case dir_left://å¦‚æœç°åœ¨è½¦å¤´å‘å·¦
2631   6                                  fun_xymove(tfl_turn,tur_l90);//è½¬å¼¯
2632   6                                  fun_xymove(tfl_line,str_now.y-str_next.y);//å·¡çº¿è‡³PublicY
2633   6                                  break;
2634   6                              case dir_right://å¦‚æœç°åœ¨è½¦å¤´å‘å³
2635   6                                  fun_xymove(tfl_turn,tur_r90);//è½¬å¼¯
2636   6                                  fun_xymove(tfl_line,str_now.y-str_next.y);//å·¡çº¿è‡³PublicY
2637   6                                  break;
2638   6                              default:
2639   6                                  break;
2640   6                          }
2641   5                      }else{//å¦‚æœè½¦å¤´å‘ä¸‹
2642   5                          fun_xymove(tfl_line,str_now.y-str_next.y);//ç›´æ¥å·¡çº¿è‡³PublicY
2643   5                      }
2644   4                  }
2645   3              }
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 45  

2646   2              //ç¬¬äºŒæ­¥:æ‹å¼¯
2647   2              if(str_next.x>str_now.x){//å‘å³è½¬
2648   3                  fun_xymove(tfl_cache,40);//å‰å†²
2649   3                  if(str_now.ctfx==dir_up){
2650   4                      fun_xymove(tfl_turn,tur_r90);//è½¬å¼¯
2651   4                  }else if(str_now.ctfx==dir_down){
2652   4                      fun_xymove(tfl_turn,tur_l90);//è½¬å¼¯
2653   4                  }
2654   3              }else if(str_next.x<str_now.x){//å‘å·¦è½¬
2655   3                  fun_xymove(tfl_cache,40);//å‰å†²
2656   3                  if(str_now.ctfx==dir_up){
2657   4                      fun_xymove(tfl_turn,tur_l90);//è½¬å¼¯
2658   4                  }else if(str_now.ctfx==dir_down){
2659   4                      fun_xymove(tfl_turn,tur_r90);//è½¬å¼¯
2660   4                  }
2661   3              }
2662   2              //ç¬¬ä¸‰æ­¥:ç›´è¡Œ
2663   2              if(str_next.x>str_now.x){//å‘å³èµ°
2664   3                  fun_xymove(tfl_line,str_next.x-str_now.x);
2665   3              }else if(str_next.x<str_now.x){//å‘å·¦èµ°
2666   3                  fun_xymove(tfl_line,str_now.x-str_next.x);
2667   3              }
2668   2              //ç¬¬å››æ­¥:è½¬å¼¯
2669   2              if(str_next.y>str_now.y){//å¦‚æœè¦å¾€ä¸Šèµ°
2670   3                  fun_xymove(tfl_cache,40);//å‰å†²
2671   3                  if(str_now.ctfx==dir_left){
2672   4                      fun_xymove(tfl_turn,tur_r90);//è½¬å¼¯
2673   4                  }else if(str_now.ctfx==dir_right){
2674   4                      fun_xymove(tfl_turn,tur_l90);//è½¬å¼¯
2675   4                  }
2676   3              }else if(str_next.y<str_now.y){//å¦‚æœè¦å¾€ä¸‹èµ°
2677   3                  fun_xymove(tfl_cache,40);//å‰å†²
2678   3                  if(str_now.ctfx==dir_left){
2679   4                      fun_xymove(tfl_turn,tur_l90);//è½¬å¼¯
2680   4                  }else if(str_now.ctfx==dir_right){
2681   4                      fun_xymove(tfl_turn,tur_r90);//è½¬å¼¯
2682   4                  }
2683   3              }
2684   2              //ç¬¬äº”æ­¥:ç›´è¡Œ
2685   2              if(str_next.y>str_now.y){//å¦‚æœè¦å¾€ä¸Šèµ°
2686   3                  fun_xymove(tfl_line,str_next.y-str_now.y);
2687   3                  fun_xymove(tfl_cache,40);//å‰å†²
2688   3              }else if(str_next.y<str_now.y){//å¦‚æœè¦å¾€ä¸‹èµ°
2689   3                  fun_xymove(tfl_line,str_now.y-str_next.y);
2690   3                  fun_xymove(tfl_cache,40);//å‰å†²
2691   3              }
2692   2          }else if(loc_y>=20&&loc_y<40){//åœ¨åŒä¸€Xè½´(åŒä¸€ç«–çº¿)
2693   2              loc_y-=20;//æŠŠæ•°æ®è¿˜åŸ
2694   2              //ç¬¬ä¸€æ­¥:ç›´è¡Œ
2695   2              if(str_next.y>str_now.y){//è¦å¾€ä¸Šèµ°
2696   3                  if(str_now.ctfx!=dir_up){//å¦‚æœè½¦å¤´ä¸æ˜¯å‘ä¸Š(æ˜¯å‘ä¸‹)
2697   4                      fun_xymove(tfl_cache,40);//å‰å†²
2698   4                      switch(str_now.ctfx){//é€‰æ‹©ç°åœ¨çš„è½¦å¤´æ–¹å‘
2699   5                          case dir_down://å¦‚æœç°åœ¨è½¦å¤´å‘ä¸‹
2700   5                              if(str_zbfl.xy[str_now.x][str_now.y].enleft==tf_ture){//å¦‚æœå·¦è¾¹æ²¡ä¸œè¥¿
2701   6                                  fun_xymove(tfl_turn,tur_r180);//å³è½¬180
2702   6                                  fun_xymove(tfl_line,str_next.y-str_now.y);//å·¡çº¿è‡³PublicY
2703   6                              }else if(str_zbfl.xy[str_now.x][str_now.y].enright==tf_ture){//å¦‚æœå³è¾¹æ²¡ä¸œè
             -¥¿
2704   6                                  fun_xymove(tfl_turn,tur_l180);//å·¦è½¬180
2705   6                                  fun_xymove(tfl_line,str_next.y-str_now.y);//å·¡çº¿è‡³PublicY
2706   6                              }else{//å·¦å³éƒ½æœ‰ä¸œè¥¿
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 46  

2707   6                                  ;//*$*//
2708   6                              }
2709   5                              break;
2710   5                          case dir_left://å¦‚æœç°åœ¨è½¦å¤´å‘å·¦
2711   5                              fun_xymove(tfl_turn,tur_r90);//è½¬å¼¯
2712   5                              fun_xymove(tfl_line,str_next.y-str_now.y);//å·¡çº¿è‡³PublicY
2713   5                              break;
2714   5                          case dir_right://å¦‚æœç°åœ¨è½¦å¤´å‘å³
2715   5                              fun_xymove(tfl_turn,tur_l90);//è½¬å¼¯
2716   5                              fun_xymove(tfl_line,str_next.y-str_now.y);//å·¡çº¿è‡³PublicY
2717   5                              break;
2718   5                          default:
2719   5                              break;
2720   5                      }
2721   4                  }else{//å¦‚æœè½¦å¤´å‘ä¸Š
2722   4                      fun_xymove(tfl_line,str_next.y-str_now.y);//ç›´æ¥å·¡çº¿è‡³PublicY
2723   4                  }
2724   3              }else if(str_next.y<str_now.y){//å¦‚æœè¦å»çš„åœ¨ç°åœ¨çš„ä¸‹é¢,å¾€ä¸‹èµ°
2725   3                  if(str_now.ctfx!=dir_down){//å¦‚æœè½¦å¤´ä¸æ˜¯å‘ä¸‹(æ˜¯å‘ä¸Š)
2726   4                      fun_xymove(tfl_cache,40);//å‰å†²
2727   4                      switch(str_now.ctfx){//é€‰æ‹©ç°åœ¨çš„è½¦å¤´æ–¹å‘
2728   5                          case dir_up://å¦‚æœç°åœ¨è½¦å¤´å‘ä¸Š
2729   5                              if(str_zbfl.xy[str_now.x][str_now.y].enleft==tf_ture){//å¦‚æœå·¦è¾¹æ²¡ä¸œè¥¿
2730   6                                  fun_xymove(tfl_turn,tur_l180);//å·¦è½¬180
2731   6                                  fun_xymove(tfl_line,str_now.y-str_next.y);//å·¡çº¿è‡³PublicY
2732   6                              }else if(str_zbfl.xy[str_now.x][str_now.y].enright==tf_ture){//å¦‚æœå³è¾¹æ²¡ä¸œè
             -¥¿
2733   6                                  fun_xymove(tfl_turn,tur_r180);//å³è½¬180
2734   6                                  fun_xymove(tfl_line,str_now.y-str_next.y);//å·¡çº¿è‡³PublicY
2735   6                              }else{//å·¦å³éƒ½æœ‰ä¸œè¥¿
2736   6                                  ;//*$*//
2737   6                              }
2738   5                              break;
2739   5                          case dir_left://å¦‚æœç°åœ¨è½¦å¤´å‘å·¦
2740   5                              fun_xymove(tfl_turn,tur_l90);//è½¬å¼¯
2741   5                              fun_xymove(tfl_line,str_now.y-str_next.y);//å·¡çº¿è‡³PublicY
2742   5                              break;
2743   5                          case dir_right://å¦‚æœç°åœ¨è½¦å¤´å‘å³
2744   5                              fun_xymove(tfl_turn,tur_r90);//è½¬å¼¯
2745   5                              fun_xymove(tfl_line,str_now.y-str_next.y);//å·¡çº¿è‡³PublicY
2746   5                              break;
2747   5                          default:
2748   5                              break;
2749   5                      }
2750   4                  }else{//å¦‚æœè½¦å¤´å‘ä¸‹
2751   4                      fun_xymove(tfl_line,str_now.y-str_next.y);//ç›´æ¥å·¡çº¿è‡³PublicY
2752   4                  }
2753   3              }
2754   2              fun_xymove(tfl_cache,40);//å‰å†²
2755   2          }else{
2756   2              //é”™è¯¯
2757   2          }
2758   1      
2759   1          str_tfl.run+=2;//æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ç»„æ•°ç»„
2760   1          (*str_tfl.run)=def_end;//å­˜å…¥æ­¥éª¤
2761   1          printf("%d\n",(int)loc_y);
2762   1      
2763   1          str_tfl.online=tf_false;//ä¸åœ¨çº¿
2764   1          str_tfl.run=str_tfl.step;//æŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªæ•°ç»„
2765   1          str_tfl.gospeed=par_gospeed;//é»˜è®¤é€Ÿåº¦
2766   1          str_tfl.turnspeed=par_turnspeed;//æ‹å¼¯é€Ÿåº¦
2767   1          str_tfl.cachespeed=par_cachespeed;//å‰å†²é€Ÿåº¦
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 47  

2768   1          str_tfl.doing=tf_ture;//å¼€å§‹åš
2769   1      }//è‡ªåŠ¨å·¡çº¿ä¹‹åæ ‡
2770          void fun_go(enum varENU_go par_model){
2771   1          if(par_model>=115){
2772   2              ;
2773   2          }else{
2774   2              fun_getxy(par_model-109);//é€šè¿‡å·¥ä½å·è·å–xyåæ ‡
2775   2              if(str_next.ctfx==dir_up){//å¦‚æœå»çš„åœ°æ–¹è¦è½¦å¤´å‘ä¸Š
2776   3                  //fun_record(str_next.x,str_next.y-1,str_next.ctfx,56,45,50);//å°‘å‘ä¸Šä¸€ä¸ª
2777   3                  fun_coordinate(56,45,50);
2778   3                  str_now.x=str_next.x;
2779   3                  str_now.y=str_next.y;
2780   3                  str_now.ctfx=str_next.ctfx;
2781   3              }else if(str_next.ctfx==dir_down){//å¦‚æœå»çš„åœ°æ–¹è¦è½¦å¤´å‘ä¸‹
2782   3                  //fun_record(str_next.x,str_next.y+1,str_next.ctfx,56,45,50);//å°‘å‘ä¸‹ä¸€ä¸ª
2783   3                  fun_coordinate(56,45,50);
2784   3                  str_now.x=str_next.x;
2785   3                  str_now.y=str_next.y;
2786   3                  str_now.ctfx=str_next.ctfx;
2787   3              }else{//æœ€é¡¶ä¸Šå·¥ä½çš„æƒ…å†µ
2788   3                  //fun_record(str_next.x,str_next.y,dir_up,56,45,50);//ä¸å¤šä¸Šä¸å¤šä¸‹,ä½†è®¾ç½®è½¦å¤´æ–¹å‘
             -ä¸ºå‘å‰
2789   3                  fun_coordinate(56,45,50);
2790   3                  if(str_next.x==0){//ä»å·¦è¾¹çš„æ¥
2791   4                      str_now.x=4;
2792   4                      str_now.y=13;
2793   4                      str_now.ctfx=dir_down;
2794   4                  }else if(str_next.x==4){//ä»å³è¾¹çš„æ¥
2795   4                      str_now.x=0;
2796   4                      str_now.y=13;
2797   4                      str_now.ctfx=dir_down;
2798   4                  }
2799   3              }
2800   2          }
2801   1      }//å®šæ—¶å™¨åæ ‡å·¡çº¿æœ€ç»ˆè°ƒç”¨å½¢å¼
2802          void fun_maintfl(){
2803   1          while(str_tfl.doing==tf_ture){
2804   2              fun_delay(50,del_ms);
2805   2          }
2806   1          fun_jtjp();
2807   1      }//ä¸»å‡½æ•°è®¾ç½®å®šæ—¶å™¨ç­‰å¾…å·¡çº¿ç»“æŸå‡½æ•°
2808          void fun_zbtfl(){
2809   1          fun_maintfl();
2810   1          str_begin=str_now;
2811   1      }//åæ ‡å·¡çº¿è®¾ç½®å®šæ—¶å™¨ç­‰å¾…å·¡çº¿ç»“æŸå‡½æ•°
2812          void fun_zdzj(ul par_04,ul par_37){//ulå‹æ•°æ®,ä¸€æ¬¡è¾“å…¥æ‰€æœ‰ç»“æœ,æ— éœ€ç­‰å¾…
2813   1          struct str_zdzj str_pass,str_end;//str_zdzj(è‡ªåŠ¨æŠ“ä»¶)çš„ç»“æ„ä½“:ç°åœ¨çš„æ•°æ®å’Œç»“æŸæ—¶å¾—åˆ
             -°çš„ç»“æœ
2814   1          char loc_high[8];         //æ¯æ‘å·¥ä»¶çš„é«˜åº¦
2815   1          uc loc_xh1;             //ç¬¬ä¸€ä¸ªå¾ªç¯
2816   1      
2817   1          memset(str_pass.jx,0,sizeof(str_pass.jx));//æ¸…ç©ºç°åœ¨ä»¶åº
2818   1          memset(str_end.jx,0,sizeof(str_end.jx)); //æ¸…ç©ºæƒ³è¦çš„ä»¶åº
2819   1          memset(loc_high,5,sizeof(loc_high));     //æ¯ç»„é«˜åº¦ç½®5(æ²¡æœ‰ä»¶)
2820   1      
2821   1          //èµ·å§‹åŒºä»¶å·
2822   1          str_pass.jx[0][1]=(par_04/10000000)%10;  //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬1å·ä»¶ä»¶å·(æœ€é«˜ä½)
2823   1          str_pass.jx[0][2]=(par_04/1000000)%10;   //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬2å·ä»¶ä»¶å·
2824   1          str_pass.jx[0][3]=(par_04/100000)%10;    //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬3å·ä»¶ä»¶å·
2825   1          str_pass.jx[0][4]=(par_04/10000)%10;     //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬4å·ä»¶ä»¶å·(æœ€ä½ä½)
2826   1          str_pass.jx[4][1]=(par_04/1000)%10;      //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬1å·ä»¶ä»¶å·(æœ€é«˜ä½)
2827   1          str_pass.jx[4][2]=(par_04/100)%10;       //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬2å·ä»¶ä»¶å·
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 48  

2828   1          str_pass.jx[4][3]=(par_04/10)%10;        //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬3å·ä»¶ä»¶å·
2829   1          str_pass.jx[4][4]=par_04%10;             //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬4å·ä»¶ä»¶å·(æœ€ä½ä½)
2830   1          //ç›®çš„åŒºä»¶å·
2831   1          str_pass.jx[3][1]=(par_37/10000000)%10;  //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬1å·ä»¶ä»¶å·(æœ€é«˜ä½)
2832   1          str_pass.jx[3][2]=(par_37/1000000)%10;   //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬2å·ä»¶ä»¶å·
2833   1          str_pass.jx[3][3]=(par_37/100000)%10;    //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬3å·ä»¶ä»¶å·
2834   1          str_pass.jx[3][4]=(par_37/10000)%10;     //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬4å·ä»¶ä»¶å·(æœ€ä½ä½)
2835   1          str_pass.jx[7][1]=(par_37/1000)%10;      //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬1å·ä»¶ä»¶å·(æœ€é«˜ä½)
2836   1          str_pass.jx[7][2]=(par_37/100)%10;       //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬2å·ä»¶ä»¶å·
2837   1          str_pass.jx[7][3]=(par_37/10)%10;        //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬3å·ä»¶ä»¶å·
2838   1          str_pass.jx[7][4]=par_37%10;             //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬4å·ä»¶ä»¶å·(æœ€ä½ä½)
2839   1          //ç›®çš„æ¬¡åº
2840   1          str_end.jx[3][1]=1;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº3çš„ç¬¬1å·ç›®çš„æ¬¡åºå·(æœ€é«˜ä½)
2841   1          str_end.jx[3][2]=2;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº3çš„ç¬¬2å·ç›®çš„æ¬¡åºå·
2842   1          str_end.jx[3][3]=3;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº3çš„ç¬¬3å·ç›®çš„æ¬¡åºå·
2843   1          str_end.jx[3][4]=4;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº3çš„ç¬¬4å·ç›®çš„æ¬¡åºå·(æœ€ä½ä½)
2844   1          str_end.jx[7][1]=5;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº7çš„ç¬¬1å·ç›®çš„æ¬¡åºå·(æœ€é«˜ä½)
2845   1          str_end.jx[7][2]=6;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº7çš„ç¬¬2å·ç›®çš„æ¬¡åºå·
2846   1          str_end.jx[7][3]=7;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº7çš„ç¬¬3å·ç›®çš„æ¬¡åºå·
2847   1          str_end.jx[7][4]=8;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº7çš„ç¬¬4å·ç›®çš„æ¬¡åºå·(æœ€ä½ä½)
2848   1      
2849   1          for(loc_xh1=1;loc_xh1<=4;loc_xh1++){
2850   2              if((str_pass.jx[0][loc_xh1]==str_pass.jx[3][1])&&(str_pass.jx[0][loc_xh1]!=0))
2851   2                  str_end.jx[0][loc_xh1]=str_end.jx[3][1];
2852   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[3][2])&&(str_pass.jx[0][loc_xh1]!=0))
2853   2                  str_end.jx[0][loc_xh1]=str_end.jx[3][2];
2854   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[3][3])&&(str_pass.jx[0][loc_xh1]!=0))
2855   2                  str_end.jx[0][loc_xh1]=str_end.jx[3][3];
2856   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[3][4])&&(str_pass.jx[0][loc_xh1]!=0))
2857   2                  str_end.jx[0][loc_xh1]=str_end.jx[3][4];
2858   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[7][1])&&(str_pass.jx[0][loc_xh1]!=0))
2859   2                  str_end.jx[0][loc_xh1]=str_end.jx[7][1];
2860   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[7][2])&&(str_pass.jx[0][loc_xh1]!=0))
2861   2                  str_end.jx[0][loc_xh1]=str_end.jx[7][2];
2862   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[7][3])&&(str_pass.jx[0][loc_xh1]!=0))
2863   2                  str_end.jx[0][loc_xh1]=str_end.jx[7][3];
2864   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[7][4])&&(str_pass.jx[0][loc_xh1]!=0))
2865   2                  str_end.jx[0][loc_xh1]=str_end.jx[7][4];
2866   2      
2867   2              if((str_pass.jx[4][loc_xh1]==str_pass.jx[3][1])&&(str_pass.jx[4][loc_xh1]!=0))
2868   2                  str_end.jx[4][loc_xh1]=str_end.jx[3][1];
2869   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[3][2])&&(str_pass.jx[4][loc_xh1]!=0))
2870   2                  str_end.jx[4][loc_xh1]=str_end.jx[3][2];
2871   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[3][3])&&(str_pass.jx[4][loc_xh1]!=0))
2872   2                  str_end.jx[4][loc_xh1]=str_end.jx[3][3];
2873   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[3][4])&&(str_pass.jx[4][loc_xh1]!=0))
2874   2                  str_end.jx[4][loc_xh1]=str_end.jx[3][4];
2875   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[7][1])&&(str_pass.jx[4][loc_xh1]!=0))
2876   2                  str_end.jx[4][loc_xh1]=str_end.jx[7][1];
2877   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[7][2])&&(str_pass.jx[4][loc_xh1]!=0))
2878   2                  str_end.jx[4][loc_xh1]=str_end.jx[7][2];
2879   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[7][3])&&(str_pass.jx[4][loc_xh1]!=0))
2880   2                  str_end.jx[4][loc_xh1]=str_end.jx[7][3];
2881   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[7][4])&&(str_pass.jx[4][loc_xh1]!=0))
2882   2                  str_end.jx[4][loc_xh1]=str_end.jx[7][4];
2883   2          }//é€šè¿‡å®é™…ä»¶åºè·å¾—ç¼–å·
2884   1      
2885   1          memset(str_pass.jx,0,sizeof(str_pass.jx));//æ¸…ç©ºç°åœ¨å®é™…ä»¶åº
2886   1          for(loc_xh1=1;loc_xh1<=4;loc_xh1++){
2887   2              str_pass.jx[0][loc_xh1]=str_end.jx[0][loc_xh1];
2888   2              str_pass.jx[4][loc_xh1]=str_end.jx[4][loc_xh1];
2889   2          }//å°†ç°åœ¨çš„ä»¶åºä»str_end.jxä¸­æ‹¿åˆ°str_pass.jx
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 49  

2890   1          for(loc_xh1=1;loc_xh1<=4;loc_xh1++){
2891   2              str_end.jx[0][loc_xh1]=0;
2892   2              str_end.jx[4][loc_xh1]=0;
2893   2          }//åˆ é™¤str_end.jxä¸­ç°åœ¨çš„ä»¶åº
2894   1          loc_high[0]=loc_high[4]=1;//åªæœ‰0å·å’Œ4å·æ”¾æ»¡äº†ä»¶
2895   1          loc_xh1=0;//å¾ªç¯æ ‡å¿—ä½å½’é›¶
2896   1      
2897   1          /*
2898   1              åˆ°ç›®å‰ä¸ºæ­¢å‡†å¤‡å·¥ä½œç»“æŸ,ç°åœ¨çš„æ•°ç»„ä¸­æ²¡æœ‰å®é™…ä»¶åº,
2899   1              ç°åœ¨çš„ç¼–å·åœ¨str_pass.jxä¸­,
2900   1              æƒ³è¦å¾—åˆ°çš„ç»“æœä»¶åºç¼–å·åœ¨str_end.jxä¸­
2901   1          */
2902   1          while(1){
2903   2              //é€€å‡ºæ¡ä»¶
2904   2              if((str_pass.jx[3][1]==str_end.jx[3][1])&&
2905   2              (str_pass.jx[3][2]==str_end.jx[3][2])&&
2906   2              (str_pass.jx[3][3]==str_end.jx[3][3])&&
2907   2              (str_pass.jx[3][4]==str_end.jx[3][4])&&
2908   2              (str_pass.jx[7][1]==str_end.jx[7][1])&&
2909   2              (str_pass.jx[7][2]==str_end.jx[7][2])&&
2910   2              (str_pass.jx[7][3]==str_end.jx[7][3])&&
2911   2              (str_pass.jx[7][4]==str_end.jx[7][4])){
2912   3                  if(str_begin.hzfx==dir_left){
2913   4                      fun_sz(han_s);                 //æ‰‹æŠ“æ¾
2914   4                      fun_sj(sjp_1);                 //å‡é™åˆ°æœ€é«˜ä½
2915   4                      fun_zjzt(mot_pyhz,7);           //å¹³é¢ä½ç½®7
2916   4                      fun_zjzt(mot_sj,loc_high[7]);   //å‡é™åˆ°7çš„æœ€é«˜ä½
2917   4                      fun_sz(han_j);                 //æ‰‹æŠ“ç´§
2918   4                  }//å¦‚æœåœåœ¨å·¦è¾¹
2919   3                  return;
2920   3              }//å¦‚æœå°è½¦ä¸€æ–¹çš„å®é™…ä»¶åºå’Œæƒ³è¦è¾¾åˆ°çš„ä»¶åºç›¸ç­‰
2921   2              if(str_begin.hzfx==dir_left){
2922   3                  //è½¬å‘æ¡ä»¶
2923   3                  loc_xh1++;//æ ‡å¿—ä½+1
2924   3                  if(loc_xh1>=100){
2925   4                      loc_xh1=0;
2926   4                      fun_zjzt(mot_sj,fun_min(loc_high[0],loc_high[1],loc_high[2],loc_high[3],loc_high[4],loc_hi
             -gh[5],loc_high[6],loc_high[7],def_end)-1);
2927   4                      fun_hz(dir_right);
2928   4                  }
2929   3                  //å¯ä»¥ä¸€æ¬¡æ‹¿èµ°,ä¸éœ€è¦ä¸­é—´ä½çš„
2930   3                  if(loc_high[1]<5){
2931   4                      if(str_pass.jx[1][loc_high[1]]==str_end.jx[3][loc_high[3]-1]){
2932   5                          fun_najian(1,3,loc_high,str_pass.jx);//1-->3
2933   5                          continue;
2934   5                      }
2935   4                  }//å¦‚æœåŒº1æœ‰ä»¶
2936   3                  if(loc_high[2]<5){
2937   4                      if(str_pass.jx[2][loc_high[2]]==str_end.jx[3][loc_high[3]-1]){
2938   5                          fun_najian(2,3,loc_high,str_pass.jx);//2-->3
2939   5                          continue;
2940   5                      }
2941   4                  }//å¦‚æœåŒº2æœ‰ä»¶
2942   3                  if(loc_high[0]<5){
2943   4                      if(str_pass.jx[0][loc_high[0]]==str_end.jx[3][loc_high[3]-1]){
2944   5                          fun_najian(0,3,loc_high,str_pass.jx);//0-->3
2945   5                          continue;
2946   5                      }
2947   4                      if(str_pass.jx[0][loc_high[0]]==str_end.jx[7][loc_high[7]-1]){
2948   5                          fun_najian(0,7,loc_high,str_pass.jx);//0-->7
2949   5                          continue;
2950   5                      }
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 50  

2951   4                  }//å¦‚æœåŒº0æœ‰ä»¶
2952   3      
2953   3                  //ä¸å¯ä»¥ä¸€æ¬¡æ‹¿èµ°,éœ€è¦ä¸­é—´ä½çš„
2954   3                  if(loc_high[0]<5){
2955   4                      if((str_pass.jx[0][loc_high[0]]==str_end.jx[3][1])||
2956   4                      (str_pass.jx[0][loc_high[0]]==str_end.jx[3][2])||
2957   4                      (str_pass.jx[0][loc_high[0]]==str_end.jx[3][3])||
2958   4                      (str_pass.jx[0][loc_high[0]]==str_end.jx[3][4])){
2959   5                          if(((loc_high[1]==5)||//å¦‚æœ1åŒºæ²¡æ”¾ä¸œè¥¿æˆ–è€…
2960   5                          (str_pass.jx[0][loc_high[0]]>str_pass.jx[1][loc_high[1]]))&&//0åŒºçš„ä»¶ç¼–å·å¤§äº1å
             -Œºçš„ç¼–å·å¹¶ä¸”
2961   5                          (loc_high[1]>2)){//1åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
2962   6                              fun_najian(0,1,loc_high,str_pass.jx);//0-->1
2963   6                              continue;
2964   6                          }
2965   5                          if(((loc_high[2]==5)||//å¦‚æœ2åŒºæ²¡æ”¾ä¸œè¥¿æˆ–è€…
2966   5                          (str_pass.jx[0][loc_high[0]]>str_pass.jx[2][loc_high[2]]))&&//0åŒºçš„ä»¶ç¼–å·å¤§äº2å
             -Œºçš„ç¼–å·å¹¶ä¸”
2967   5                          (loc_high[2]>2)){//2åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
2968   6                              fun_najian(0,2,loc_high,str_pass.jx);//0-->2
2969   6                              continue;
2970   6                          }
2971   5                      }//å¦‚æœè¦æ”¾åœ¨3ä¸Š,ä½†ç›®å‰ä¸èƒ½æ”¾
2972   4                      if((str_pass.jx[0][loc_high[0]]==str_end.jx[7][1])||
2973   4                      (str_pass.jx[0][loc_high[0]]==str_end.jx[7][2])||
2974   4                      (str_pass.jx[0][loc_high[0]]==str_end.jx[7][3])||
2975   4                      (str_pass.jx[0][loc_high[0]]==str_end.jx[7][4])){
2976   5                          if(((loc_high[5]==5)||//å¦‚æœ5åŒºæ²¡ä¸œè¥¿æ”¾æˆ–è€…
2977   5                          (str_pass.jx[0][loc_high[0]]>str_pass.jx[5][loc_high[5]]))&&//0åŒºçš„ä»¶ç¼–å·å¤§äº5å
             -Œºçš„ç¼–å·å¹¶ä¸”
2978   5                          (loc_high[5]>2)){//5åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
2979   6                              fun_najian(0,5,loc_high,str_pass.jx);//0-->5
2980   6                              continue;
2981   6                          }
2982   5                          if(((loc_high[6]==5)||//å¦‚æœ6åŒºæ²¡ä¸œè¥¿æ”¾æˆ–è€…
2983   5                          (str_pass.jx[0][loc_high[0]]>str_pass.jx[6][loc_high[6]]))&&//0åŒºçš„ä»¶ç¼–å·å¤§äº6å
             -Œºçš„ç¼–å·å¹¶ä¸”
2984   5                          (loc_high[6]>2)){//6åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
2985   6                              fun_najian(0,6,loc_high,str_pass.jx);//0-->6
2986   6                              continue;
2987   6                          }
2988   5                      }//å¦‚æœè¦æ”¾åœ¨7ä¸Š,ä½†ç›®å‰ä¸èƒ½æ”¾
2989   4                  }//å¦‚æœåŒº0æœ‰ä»¶
2990   3      
2991   3                  //ä¸­é—´ä¸¤ä¸ªä½ç½®ä¹Ÿä¸èƒ½ä¸€æ¬¡æå®šçš„
2992   3                  if((loc_high[1]<5)&&(loc_high[2]<5)){
2993   4                      if((str_pass.jx[1][loc_high[1]]>str_pass.jx[2][loc_high[2]])&&(loc_high[2]>1)){
2994   5                          fun_najian(1,2,loc_high,str_pass.jx);//1-->2
2995   5                          continue;
2996   5                      }//1çš„ä»¶æ¯”2çš„ä»¶å¤§ä¸”åŒº2æ”¾äº†ä¸åˆ°3ä¸ªä»¶
2997   4                      if((str_pass.jx[2][loc_high[2]]>str_pass.jx[1][loc_high[1]])&&(loc_high[1]>1)){
2998   5                          fun_najian(2,1,loc_high,str_pass.jx);//2-->1
2999   5                          continue;
3000   5                      }//2çš„ä»¶æ¯”1çš„ä»¶å¤§ä¸”åŒº1æ”¾äº†ä¸åˆ°3ä¸ªä»¶
3001   4                  }//å¦‚æœåŒº1å’ŒåŒº2éƒ½æœ‰ä»¶
3002   3      
3003   3                  //ä¸­é—´ä¸¤ä¸ªä½ç½®æ€ä¹ˆä¹Ÿæä¸å®šçš„
3004   3                  if((loc_high[1]<5)&&(loc_high[2]<5)){
3005   4                      if((loc_high[0]>1)&&(str_pass.jx[1][loc_high[1]]>str_pass.jx[0][loc_high[0]])){
3006   5                          fun_najian(1,0,loc_high,str_pass.jx);//1-->0
3007   5                          continue;
3008   5                      }//1åŒºçš„ä»¶æ¯”0åŒºçš„å¤§ä¸”0åŒºæ”¾äº†ä¸åˆ°3ä¸ªä»¶
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 51  

3009   4                      if((loc_high[0]>1)&&(str_pass.jx[2][loc_high[2]]>str_pass.jx[0][loc_high[0]])){
3010   5                          fun_najian(2,0,loc_high,str_pass.jx);//2-->0
3011   5                          continue;
3012   5                      }//2åŒºçš„ä»¶æ¯”0åŒºçš„å¤§ä¸”0åŒºæ”¾äº†ä¸åˆ°3ä¸ªä»¶
3013   4                  }
3014   3              }//å¦‚æœå›è½¬åœ¨å·¦è¾¹ 
3015   2              if(str_begin.hzfx==dir_right){
3016   3                  //è½¬å‘æ¡ä»¶
3017   3                  loc_xh1++;//æ ‡å¿—ä½+1
3018   3                  if(loc_xh1>=100){
3019   4                      loc_xh1=0;
3020   4                      fun_zjzt(mot_sj,fun_min(loc_high[0],loc_high[1],loc_high[2],loc_high[3],loc_high[4],loc_hi
             -gh[5],loc_high[6],loc_high[7],def_end)-1);
3021   4                      fun_hz(dir_left);
3022   4                  }
3023   3                  //å¯ä»¥ä¸€æ¬¡æ‹¿èµ°,ä¸éœ€è¦ä¸­é—´ä½çš„
3024   3                  if(loc_high[5]<5){
3025   4                      if(str_pass.jx[5][loc_high[5]]==str_end.jx[7][loc_high[7]-1]){
3026   5                          fun_najian(5,7,loc_high,str_pass.jx);//5-->7
3027   5                          continue;
3028   5                      }//5-->7
3029   4                  }//å¦‚æœåŒº5æœ‰ä»¶
3030   3                  if(loc_high[6]<5){
3031   4                      if(str_pass.jx[6][loc_high[6]]==str_end.jx[7][loc_high[7]-1]){
3032   5                          fun_najian(6,7,loc_high,str_pass.jx);//6-->7
3033   5                          continue;
3034   5                      }//6-->7
3035   4                  }//å¦‚æœåŒº6æœ‰ä»¶
3036   3                  if(loc_high[4]<5){
3037   4                      if(str_pass.jx[4][loc_high[4]]==str_end.jx[7][loc_high[7]-1]){
3038   5                          fun_najian(4,7,loc_high,str_pass.jx);//4-->7
3039   5                          continue;
3040   5                      }//4-->7
3041   4                      if(str_pass.jx[4][loc_high[4]]==str_end.jx[3][loc_high[3]-1]){
3042   5                          fun_najian(4,3,loc_high,str_pass.jx);//4-->3
3043   5                          continue;
3044   5                      }//4-->3
3045   4                  }//å¦‚æœåŒº4æœ‰ä»¶
3046   3      
3047   3                  //ä¸å¯ä»¥ä¸€æ¬¡æ‹¿èµ°,éœ€è¦ä¸­é—´ä½çš„
3048   3                  if(loc_high[4]<5){
3049   4                      if((str_pass.jx[4][loc_high[4]]==str_end.jx[7][1])||
3050   4                      (str_pass.jx[4][loc_high[4]]==str_end.jx[7][2])||
3051   4                      (str_pass.jx[4][loc_high[4]]==str_end.jx[7][3])||
3052   4                      (str_pass.jx[4][loc_high[4]]==str_end.jx[7][4])){
3053   5                          if(((loc_high[5]==5)||//å¦‚æœ5åŒºæ²¡ä¸œè¥¿æ”¾æˆ–è€…
3054   5                          (str_pass.jx[4][loc_high[4]]>str_pass.jx[5][loc_high[5]]))&&//4åŒºçš„ä»¶ç¼–å·å¤§äº5å
             -Œºçš„ç¼–å·å¹¶ä¸”
3055   5                          (loc_high[5]>2)){//5åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
3056   6                              fun_najian(4,5,loc_high,str_pass.jx);//4-->5
3057   6                              continue;
3058   6                          }
3059   5                          if(((loc_high[6]==5)||//å¦‚æœ6åŒºæ²¡ä¸œè¥¿æ”¾æˆ–è€…
3060   5                          (str_pass.jx[4][loc_high[4]]>str_pass.jx[6][loc_high[6]]))&&//4åŒºçš„ä»¶ç¼–å·å¤§äº6å
             -Œºçš„ç¼–å·å¹¶ä¸”
3061   5                          (loc_high[6]>2)){//6åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
3062   6                              fun_najian(4,6,loc_high,str_pass.jx);//4-->6
3063   6                              continue;
3064   6                          }
3065   5                      }//å¦‚æœè¦æ”¾åœ¨7ä¸Š,ä½†ç›®å‰ä¸èƒ½æ”¾
3066   4                      if((str_pass.jx[4][loc_high[4]]==str_end.jx[3][1])||
3067   4                      (str_pass.jx[4][loc_high[4]]==str_end.jx[3][2])||
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 52  

3068   4                      (str_pass.jx[4][loc_high[4]]==str_end.jx[3][3])||
3069   4                      (str_pass.jx[4][loc_high[4]]==str_end.jx[3][4])){
3070   5                          if(((loc_high[1]==5)||//å¦‚æœ1åŒºæ²¡æ”¾ä¸œè¥¿æˆ–è€…
3071   5                          (str_pass.jx[4][loc_high[4]]>str_pass.jx[1][loc_high[1]]))&&//4åŒºçš„ä»¶ç¼–å·å¤§äº1å
             -Œºçš„ç¼–å·å¹¶ä¸”
3072   5                          (loc_high[1]>2)){//1åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
3073   6                              fun_najian(4,1,loc_high,str_pass.jx);//4-->1
3074   6                              continue;
3075   6                          }
3076   5                          if(((loc_high[2]==5)||//å¦‚æœ2åŒºæ²¡æ”¾ä¸œè¥¿æˆ–è€…
3077   5                              (str_pass.jx[4][loc_high[4]]>str_pass.jx[2][loc_high[2]]))&&//4åŒºçš„ä»¶ç¼–å·å¤§ä
             -º2åŒºçš„ç¼–å·å¹¶ä¸”
3078   5                              (loc_high[2]>2)){//2åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
3079   6                              fun_najian(4,2,loc_high,str_pass.jx);//4-->2
3080   6                              continue;
3081   6                          }
3082   5                      }//å¦‚æœè¦æ”¾åœ¨3ä¸Š,ä½†ç›®å‰ä¸èƒ½æ”¾
3083   4                  }//å¦‚æœåŒº4æœ‰ä»¶
3084   3      
3085   3                  //ä¸­é—´ä¸¤ä¸ªä½ç½®ä¹Ÿä¸èƒ½ä¸€æ¬¡æå®šçš„
3086   3                  if((loc_high[5]<5)&&(loc_high[6]<5)){
3087   4                      if((str_pass.jx[5][loc_high[5]]>str_pass.jx[6][loc_high[6]])&&(loc_high[6]>1)){
3088   5                          fun_najian(5,6,loc_high,str_pass.jx);//5-->6
3089   5                          continue;
3090   5                      }//5çš„ä»¶æ¯”6çš„ä»¶å¤§ä¸”åŒº6æ”¾äº†ä¸åˆ°3ä¸ªä»¶
3091   4                      if((str_pass.jx[6][loc_high[6]]>str_pass.jx[5][loc_high[5]])&&(loc_high[5]>1)){
3092   5                          fun_najian(6,5,loc_high,str_pass.jx);//6-->5
3093   5                          continue;
3094   5                      }//6çš„ä»¶æ¯”5çš„ä»¶å¤§ä¸”åŒº5æ”¾äº†ä¸åˆ°3ä¸ªä»¶
3095   4                  }//å¦‚æœåŒº5å’ŒåŒº6éƒ½æœ‰ä»¶
3096   3      
3097   3                  //ä¸­é—´ä¸¤ä¸ªä½ç½®æ€ä¹ˆä¹Ÿæä¸å®šçš„
3098   3                  if((loc_high[5]<5)&&(loc_high[6]<5)){
3099   4                      if((loc_high[4]>1)&&(str_pass.jx[5][loc_high[5]]>str_pass.jx[4][loc_high[4]])){
3100   5                          fun_najian(5,4,loc_high,str_pass.jx);//5-->4
3101   5                          continue;
3102   5                      }//5åŒºçš„ä»¶æ¯”4åŒºçš„å¤§ä¸”4åŒºæ”¾äº†ä¸åˆ°3ä¸ªä»¶
3103   4                      if((loc_high[4]>1)&&(str_pass.jx[6][loc_high[6]]>str_pass.jx[4][loc_high[4]])){
3104   5                          fun_najian(6,4,loc_high,str_pass.jx);//6-->4
3105   5                          continue;
3106   5                      }//6åŒºçš„ä»¶æ¯”4åŒºçš„å¤§ä¸”4åŒºæ”¾äº†ä¸åˆ°3ä¸ªä»¶
3107   4                  }
3108   3              }//å¦‚æœå›è½¬åœ¨å³è¾¹
3109   2          }    
3110   1      }//è‡ªåŠ¨æŠ“ä»¶
3111          void fun_zjzt(uc par_motor,char par_model){
3112   1          if(par_motor==mot_pyhz){
3113   2              switch(par_model){
3114   3                  case 0:
3115   3                      if((str_begin.pywz==tra_h)&&(str_begin.hzfx==dir_left))
3116   3                          break;
3117   3                      if(str_begin.hzfx==dir_right)
3118   3                          fun_pyhz(tra_z,dir_left);
3119   3                      fun_py(tra_h);
3120   3                      break;
3121   3                  case 1:
3122   3                      if((str_begin.pywz==tra_kh)&&(str_begin.hzfx==dir_left))
3123   3                          break;
3124   3                      if(str_begin.hzfx==dir_right)
3125   3                          fun_pyhz(tra_z,dir_left);
3126   3                      fun_py(tra_kh);
3127   3                      break;
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 53  

3128   3                  case 2:
3129   3                      if((str_begin.pywz==tra_kq)&&(str_begin.hzfx==dir_left))
3130   3                          break;
3131   3                      if(str_begin.hzfx==dir_right)
3132   3                          fun_pyhz(tra_z,dir_left);
3133   3                      fun_py(tra_kq);
3134   3                      break;
3135   3                  case 3:
3136   3                      if((str_begin.pywz==tra_q)&&(str_begin.hzfx==dir_left))
3137   3                          break;
3138   3                      if(str_begin.hzfx==dir_right)
3139   3                          fun_pyhz(tra_z,dir_left);
3140   3                      fun_py(tra_q);
3141   3                      break;
3142   3                  case 4:
3143   3                      if((str_begin.pywz==tra_q)&&(str_begin.hzfx==dir_right))
3144   3                          break;
3145   3                      if(str_begin.hzfx==dir_left)
3146   3                          fun_pyhz(tra_z,dir_right);
3147   3                      fun_py(tra_q);
3148   3                      break;
3149   3                  case 5:
3150   3                      if((str_begin.pywz==tra_kq)&&(str_begin.hzfx==dir_right))
3151   3                          break;
3152   3                      if(str_begin.hzfx==dir_left)
3153   3                          fun_pyhz(tra_z,dir_right);
3154   3                      fun_py(tra_kq);
3155   3                      break;
3156   3                  case 6:
3157   3                      if((str_begin.pywz==tra_kh)&&(str_begin.hzfx==dir_right))
3158   3                          break;
3159   3                      if(str_begin.hzfx==dir_left)
3160   3                          fun_pyhz(tra_z,dir_right);
3161   3                      fun_py(tra_kh);
3162   3                      break;
3163   3                  case 7:
3164   3                      if((str_begin.pywz==tra_h)&&(str_begin.hzfx==dir_right))
3165   3                          break;
3166   3                      if(str_begin.hzfx==dir_left)
3167   3                          fun_pyhz(tra_z,dir_right);
3168   3                      fun_py(tra_h);
3169   3                      break;
3170   3                  default:
3171   3                      break;
3172   3              }
3173   2          }
3174   1          else if(par_motor==mot_sj){
3175   2              switch(par_model){
3176   3                  case 0:
3177   3                      fun_sj(sjp_1);
3178   3                      break;
3179   3                  case 1:
3180   3                      fun_sj(sjp_2);
3181   3                      break;
3182   3                  case 2:
3183   3                      fun_sj(sjp_3);
3184   3                      break;
3185   3                  case 3:
3186   3                      fun_sj(sjp_4);
3187   3                      break;
3188   3                  case 4:
3189   3                      fun_sj(sjp_5);
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 54  

3190   3                      break;
3191   3                  default:
3192   3                      if(par_model<0)
3193   3                          fun_sj(sjp_1);
3194   3                      else if(par_model>5)
3195   3                          fun_sj(sjp_5);
3196   3                      break;
3197   3              }
3198   2          }
3199   1      }//æŠ“ä»¶çŠ¶æ€,0ä¸ºå·¦ä¸Šä½,3ä¸ºå·¦ä¸‹ä½,4ä¸ºå³ä¸Šä½,7ä¸ºå³ä¸‹ä½
3200          void fun_najian(uc par_now,uc par_next,char par_high[8],uc par_data[8][5]){
3201   1          #ifdef Debug
3202   1              printf("%d --> %d\n",(ui)par_now,(ui)par_next);
3203   1          #else
                      //å–å„ä½ç½®çš„æœ€é«˜ä½
                      uc loc_high=fun_min(par_high[0],par_high[1],par_high[2],par_high[3],par_high[4],par_high[5],par_hi
             -gh[6],par_high[7],def_end);
                      //å‡èµ·
                      if(par_now==0||par_now==1||par_now==2||par_now==3){
                          if(str_begin.hzfx==dir_left)
                              fun_zjzt(mot_sj,fun_min(par_high[0],par_high[1],par_high[2],par_high[3],def_end)-1);
                          else if(str_begin.hzfx==dir_right)
                              fun_zjzt(mot_sj,fun_min(par_high[0],par_high[1],par_high[2],par_high[3],par_high[4],par_hi
             -gh[5],par_high[6],par_high[7],def_end)-1);            
                      }
                      else if(par_now==4||par_now==5||par_now==6||par_now==7){
                          if(str_begin.hzfx==dir_right)
                              fun_zjzt(mot_sj,fun_min(par_high[4],par_high[5],par_high[6],par_high[7],def_end)-1);
                          else if(str_begin.hzfx==dir_left)
                              fun_zjzt(mot_sj,fun_min(par_high[0],par_high[1],par_high[2],par_high[3],par_high[4],par_hi
             -gh[5],par_high[6],par_high[7],def_end)-1);            
                      }
                      //å¹³ç§»å›è½¬åˆ°éœ€è¦çš„åœ°æ–¹
                      fun_zjzt(mot_pyhz,par_now);
                      //ä¸‹é™åˆ°å·¥ä»¶çš„ä½ç½®
                      fun_zjzt(mot_sj,par_high[par_now]);
                      //æŠ“ç´§å·¥ä»¶
                      fun_sz(han_j);
                      //ä¸Šå‡åˆ°æ­£ç¡®çš„æœ€é«˜ä½
                      switch(par_now){
                          case 0:
                              switch(par_next){
                                  case 1:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
                                      break;
                                  case 2:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[1],par_high[par_ne
             -xt],def_end)-2);
                                      break;
                                  case 3:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[1],par_high[2],par
             -_high[par_next],def_end)-2);
                                      break;
                                  case 4:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[1],par_high[5],par
             -_high[par_next],def_end)-2);
                                      break;
                                  case 5:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[1],par_high[par_ne
             -xt],def_end)-2);
                                      break;
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 55  

                                  case 6:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[1],par_high[par_ne
             -xt],def_end)-2);
                                      break;
                                  case 7:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[1],par_high[6],par
             -_high[par_next],def_end)-2);
                                      break;
                                  default:
                                      break;
                              }
                              break;
                          case 1:
                              switch(par_next){
                                  case 0:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
                                      break;
                                  case 2:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
                                      break;
                                  case 3:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[2],par_high[par_ne
             -xt],def_end)-2);
                                      break;
                                  case 4:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[5],par_high[par_ne
             -xt],def_end)-2);
                                      break;
                                  case 5:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
                                      break;
                                  case 6:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
                                      break;
                                  case 7:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[6],par_high[par_ne
             -xt],def_end)-2);
                                      break;
                                  default:
                                      break;
                              }
                              break;
                          case 2:
                              switch(par_next){
                                  case 0:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[1],par_high[par_ne
             -xt],def_end)-2);
                                      break;
                                  case 1:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
                                      break;
                                  case 3:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
                                      break;
                                  case 4:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[5],par_high[par_ne
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 56  

             -xt],def_end)-2);
                                      break;
                                  case 5:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
                                      break;
                                  case 6:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
                                      break;
                                  case 7:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[6],par_high[par_ne
             -xt],def_end)-2);
                                      break;
                                  default:
                                      break;
                              }
                              break;
                          case 3:
                              switch(par_next){
                                  case 0:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[2],par_high[1],par
             -_high[par_next],def_end)-2);
                                      break;
                                  case 1:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[2],par_high[par_ne
             -xt],def_end)-2);
                                      break;
                                  case 2:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
                                      break;
                                  case 4:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[2],par_high[5],par
             -_high[par_next],def_end)-2);
                                      break;
                                  case 5:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[2],par_high[par_ne
             -xt],def_end)-2);
                                      break;
                                  case 6:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[2],par_high[par_ne
             -xt],def_end)-2);
                                      break;
                                  case 7:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[2],par_high[6],par
             -_high[par_next],def_end)-2);
                                      break;
                                  default:
                                      break;
                              }
                              break;
                          case 4:
                              switch(par_next){
                                  case 0:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[5],par_high[1],par
             -_high[par_next],def_end)-2);
                                      break;
                                  case 1:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[5],par_high[par_ne
             -xt],def_end)-2);
                                      break;
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 57  

                                  case 2:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[5],par_high[par_ne
             -xt],def_end)-2);
                                      break;
                                  case 3:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[5],par_high[2],par
             -_high[par_next],def_end)-2);
                                      break;
                                  case 5:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
                                      break;
                                  case 6:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[5],par_high[par_ne
             -xt],def_end)-2);
                                      break;
                                  case 7:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[5],par_high[6],par
             -_high[par_next],def_end)-2);
                                      break;
                                  default:
                                      break;
                              }
                              break;
                          case 5:
                              switch(par_next){
                                  case 0:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[1],par_high[par_ne
             -xt],def_end)-2);
                                      break;
                                  case 1:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
                                      break;
                                  case 2:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
                                      break;
                                  case 3:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[2],par_high[par_ne
             -xt],def_end)-2);
                                      break;
                                  case 4:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
                                      break;
                                  case 6:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
                                      break;
                                  case 7:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[6],par_high[par_ne
             -xt],def_end)-2);
                                      break;
                                  default:
                                      break;
                              }
                              break;
                          case 6:
                              switch(par_next){
                                  case 0:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[1],par_high[par_ne
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 58  

             -xt],def_end)-2);
                                      break;
                                  case 1:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
                                      break;
                                  case 2:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
                                      break;
                                  case 3:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[2],par_high[par_ne
             -xt],def_end)-2);
                                      break;
                                  case 4:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[5],par_high[par_ne
             -xt],def_end)-2);
                                      break;
                                  case 5:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
                                      break;
                                  case 7:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
                                      break;
                                  default:
                                      break;
                              }
                              break;
                          case 7:
                              switch(par_next){
                                  case 0:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[6],par_high[1],par
             -_high[par_next],def_end)-2);
                                      break;
                                  case 1:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[6],par_high[par_ne
             -xt],def_end)-2);
                                      break;
                                  case 2:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[6],par_high[par_ne
             -xt],def_end)-2);
                                      break;
                                  case 3:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[6],par_high[2],par
             -_high[par_next],def_end)-2);
                                      break;
                                  case 4:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[5],par_high[6],par
             -_high[par_next],def_end)-2);
                                      break;
                                  case 5:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[6],par_high[par_ne
             -xt],def_end)-2);
                                      break;
                                  case 6:
                                      fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
                                      break;
                                  default:
                                      break;
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 59  

                              }
                              break;
                          default:
                              break;
                      }
                      //å¹³ç§»å›è½¬è‡³æ”¾ä»¶å¤„
                      fun_zjzt(mot_pyhz,par_next);
                      //ä¸‹é™åˆ°è¦æ”¾ä¸‹çš„ä½ç½®
                      fun_zjzt(mot_sj,par_high[par_next]-1);
                      //æ¾å¼€æ‰‹æŠ“
                      fun_sz(han_s);
                  #endif
3453   1      
3454   1          //æ›´æ–°å‚æ•°
3455   1          par_data[par_next][par_high[par_next]-1]=par_data[par_now][par_high[par_now]];
3456   1          par_data[par_now][par_high[par_now]]=0;
3457   1          par_high[par_now]++;
3458   1          par_high[par_next]--;
3459   1      }//æ‹¿ä»¶(é…åˆè‡ªåŠ¨æŠ“ä»¶ä½¿ç”¨)
3460          void fun_zhuajian(){
3461   1          fun_sz(han_s);                 //æ‰‹æŠ“æ¾
3462   1          fun_sj(sjp_1);                 //ä¸Šå‡åˆ°æœ€é«˜ä½
3463   1          fun_py(tra_q);                 //å¹³ç§»åˆ°å‰ç«¯
3464   1          if(str_begin.hzfx!=dir_right)  //å¦‚æœä¸åœ¨å³è¾¹
3465   1              fun_hz(dir_right);         //å°±å¹³ç§»åˆ°å³è¾¹
3466   1      
3467   1          fun_folline(2,60);
3468   1          fun_turn(tur_l90,40);
3469   1          fun_folline(1,60);
3470   1          fun_qc(100,40);
3471   1          while((!in_ls4||!in_ls5)||(in_ls1||in_ls2||in_ls3||in_ls6||in_ls7||in_ls8)){
3472   2              if(in_ls1||in_ls2||in_ls3||!in_ls5){
3473   3                  fun_motors(mot_rl,-30);
3474   3                  fun_delay(300,del_ms);
3475   3                  fun_motors(mot_r,-20);
3476   3                  fun_motors(mot_l,-30);
3477   3                  fun_delay(300,del_ms);
3478   3                  fun_motors(mot_rl,-30);
3479   3                  fun_delay(300,del_ms);
3480   3              }//3äº®æˆ–5ä¸äº®
3481   2              else if(in_ls6||in_ls7||in_ls8||!in_ls4){
3482   3                  fun_motors(mot_rl,-30);
3483   3                  fun_delay(300,del_ms);
3484   3                  fun_motors(mot_r,-30);
3485   3                  fun_motors(mot_l,-29);
3486   3                  fun_delay(300,del_ms);
3487   3                  fun_motors(mot_rl,-30);
3488   3                  fun_delay(300,del_ms);
3489   3              }//6äº®æˆ–4ä¸äº®
3490   2              fun_qc(200,40);//é‡æ–°è¿›è¡Œå‰å†²
3491   2          }
3492   1          fun_motors(mot_rl,0);
3493   1      }//ä»èµ·å§‹åŒºèµ°åˆ°æŠ“ä»¶åŒº
3494          void fun_back90(){
3495   1          fun_motors(mot_rl,-25);
3496   1          fun_delay(1,del_s);
3497   1      
3498   1          fun_motors(mot_r,-48);
3499   1          fun_motors(mot_l,-20);
3500   1          fun_delay(3,del_s);    
3501   1      
3502   1          fun_motors(mot_rl,-35);
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 60  

3503   1          fun_delay(1,del_s);
3504   1          fun_motors(mot_rl,0);
3505   1      }//ä»æŠ“ä»¶åŒºå›åˆ°èµ·å§‹åŒº
3506          void fun_start(char par_x,char par_y,enum varENU_dir par_ctfx,
3507              enum varENU_han par_szzt,enum varENU_sjp par_sjwz,enum varENU_tra par_pywz,enum varENU_dir par_hzfx){
3508   1          CLK_DIV=0x00;             //ä¸åˆ†é¢‘
3509   1          P0M1=0xff;                //P0ç”¨äºè¾“å…¥
3510   1          P0M0=0x00;                //P0ä¸èƒ½è¾“å‡º
3511   1          P1M1=0x00;                //P1å£0-1åŒå‘
3512   1          P1M0=0xfc;                //P1å£2-7è¾“å‡º
3513   1          P2M1=0xf0;                //P2å£4-7è¾“å…¥
3514   1          P2M0=0x0f;                //P2å£0-3è¾“å‡º
3515   1      
3516   1          out_en1=1;                //ç”µæœº1/3ä½¿èƒ½
3517   1          out_en2=1;                //ç”µæœº2/4ä½¿èƒ½
3518   1          CR=0;                     //PACè®¡æ•°å™¨å½’é›¶
3519   1          out_motorselect=0;        //ç”µæœºç‰‡é€‰ä¸º0
3520   1      
3521   1          fun_port();               //åˆå§‹åŒ–ä¸²å£
3522   1          TI=1;                     //æ‰“å¼€ä¸²å£ä¼ è¾“åŠŸèƒ½
3523   1      
3524   1          fun_pwminit();            //PWMçš„åˆå§‹åŒ–
3525   1      
3526   1          fun_timer0init();         //åˆå§‹åŒ–å®šæ—¶å™¨0
3527   1          fun_timer1init();         //åˆå§‹åŒ–å®šæ—¶å™¨1
3528   1          TR0=1;                    //æ‰“å¼€å®šæ—¶å™¨0
3529   1          TR1=1;                    //æ‰“å¼€å®šæ—¶å™¨1
3530   1          var_timer=0;              //å®šæ—¶å™¨å®šæ—¶æ ‡å¿—ä½å½’é›¶,é€šç”µæ—¶å¼€å§‹è®¡æ—¶
3531   1      
3532   1          memset(str_tfl.step,0,sizeof(str_tfl.step));//æ¸…é›¶å·¡çº¿ç”¨æ­¥éª¤æ•°ç»„
3533   1          memset(str_zbfl.xy,tf_ture,sizeof(str_zbfl.xy));//æ¸…ç©ºåæ ‡
3534   1          str_zbfl.top.value=0;//é¡¶ä¸Šçš„å·¥ä½å·
3535   1          str_zbfl.top.fx=dir_up;//é¡¶ä¸Šçš„æ–¹å‘
3536   1      
3537   1          str_begin.x=par_x;        //Xåæ ‡
3538   1          str_begin.y=par_y;        //Yåæ ‡
3539   1          str_begin.ctfx=par_ctfx;  //è½¦å¤´æ–¹å‘
3540   1          str_begin.szzt=par_szzt;  //æ‰‹æŠ“çŠ¶æ€
3541   1          str_begin.sjwz=par_sjwz;  //å‡é™ä½ç½®
3542   1          str_begin.pywz=par_pywz;  //å¹³ç§»ä½ç½®
3543   1          str_begin.hzfx=par_hzfx;  //å›è½¬æ–¹å‘
3544   1      
3545   1          str_tfl.gospeed=0;        //é€Ÿåº¦å½’é›¶
3546   1          fun_motors(mot_sz,0);     //æ‰‹æŠ“é€Ÿåº¦å½’é›¶
3547   1          fun_motors(mot_py,0);     //å¹³ç§»é€Ÿåº¦å½’é›¶
3548   1          fun_motors(mot_sj,0);     //æ‰‹æŠ“é€Ÿåº¦å½’é›¶
3549   1          fun_motors(mot_hz,0);     //æ‰‹æŠ“é€Ÿåº¦å½’é›¶
3550   1          fun_motors(mot_rl,0);     //å·¦å³é€Ÿåº¦å½’é›¶
3551   1      
3552   1          #ifdef Debug              //å¦‚æœå¼€å¯è°ƒè¯•æ¨¡å¼
3553   1              fun_delay(3,del_s);
3554   1              MSG("Ready!")         //è¾“å‡ºReady!
3555   1          #else
                      fun_wait();           //ç­‰å¾…æŒ‰é”®
                  #endif
3558   1      }//åˆå§‹åŒ–å‡½æ•°
3559          void fun_stop(){
3560   1          EA=0;                   //å…³æ€»ä¸­æ–­
3561   1          str_tfl.gospeed=0;      //é€Ÿåº¦å½’é›¶
3562   1          fun_motors(mot_sz,0);   //æ‰‹æŠ“é€Ÿåº¦å½’é›¶
3563   1          fun_motors(mot_py,0);   //å¹³ç§»é€Ÿåº¦å½’é›¶
3564   1          fun_motors(mot_sj,0);   //æ‰‹æŠ“é€Ÿåº¦å½’é›¶
C51 COMPILER V9.54   8023                                                                  11/12/2015 11:01:56 PAGE 61  

3565   1          fun_motors(mot_hz,0);   //æ‰‹æŠ“é€Ÿåº¦å½’é›¶
3566   1          fun_motors(mot_rl,0);   //å·¦å³é€Ÿåº¦å½’é›¶
3567   1          MSG("End!")             //è¾“å‡ºEnd!
3568   1          while(1);               //æ­»å¾ªç¯
3569   1      }//ç»“æŸå‡½æ•°
3570          #ifdef Debug
3571              void deb_outstep(uc par_model){
3572   1              uc loc_con;
3573   1              for(loc_con=0;loc_con<=par_model-1;loc_con+=8){
3574   2                  printf("%d:%d , %d:%d , %d:%d , %d:%d\n",
3575   2                  (int)str_tfl.step[loc_con+0],
3576   2                  (int)str_tfl.step[loc_con+1],
3577   2                  (int)str_tfl.step[loc_con+2],
3578   2                  (int)str_tfl.step[loc_con+3],
3579   2                  (int)str_tfl.step[loc_con+4],
3580   2                  (int)str_tfl.step[loc_con+5],
3581   2                  (int)str_tfl.step[loc_con+6],
3582   2                  (int)str_tfl.step[loc_con+7]);
3583   2              }
3584   1          }//è¾“å‡ºå®šæ—¶å™¨å·¡çº¿æ•°ç»„
3585          #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =  21385    ----
   CONSTANT SIZE    =    412    ----
   XDATA SIZE       =    580     305
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5      12
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
