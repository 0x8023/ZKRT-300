C51 COMPILER V9.01   8023                                                                  02/26/2015 14:53:33 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE 8023
OBJECT MODULE PLACED IN .\output\8023.obj
COMPILER INVOKED BY: H:\Program\keil\C51\BIN\C51.EXE program\8023.c DEBUG OBJECTEXTEND PRINT(.\8023.lst) OBJECT(.\output
                    -\8023.obj)

line level    source

   1          #include "./output/8023.h"
   2          void fun_delay(ui par_value,enum varENU_delaymodel par_model){
   3   1          ui loc_con=par_value;
   4   1          switch(par_model){
   5   2              case us:
   6   2                  while(loc_con-->0){
   7   3                      _nop_();
   8   3                      _nop_();
   9   3                  }
  10   2                  return;
  11   2              case ms:
  12   2                  while(loc_con-->0){
  13   3                      uc loc_i, loc_j;
  14   3                      _nop_();
  15   3                      _nop_();
  16   3                      loc_i=12;
  17   3                      loc_j=168;
  18   3                      do{
  19   4                          while(--loc_j);
  20   4                      }while(--loc_i);
  21   3                  }
  22   2                  return;
  23   2              case s:
  24   2                  while(loc_con-->0){
  25   3                      uc loc_i, loc_j, loc_k;
  26   3                      loc_i=46;
  27   3                      loc_j=153;
  28   3                      loc_k=245;
  29   3                      do{
  30   4                          do{
  31   5                              while(--loc_k);
  32   5                          }while(--loc_j);
  33   4                      }while(--loc_i);
  34   3                  }
  35   2                  return;
  36   2              default:return;
  37   2          }
  38   1      }//延时
  39          void fun_timer0init(){
  40   1          AUXR&=0x7F;
  41   1          TMOD&=0xF0;
  42   1          TMOD|=0x01;
  43   1          TL0=0xB0;
  44   1          TH0=0x3C;
  45   1          TF0=0;
  46   1      }//50毫秒定时器0初始化
  47          void fun_timer1init(){
  48   1          AUXR&=0xBF;
  49   1          TMOD&=0x0F;
  50   1          TMOD|=0x10;
  51   1          TL1=0xE0;
  52   1          TH1=0xB1;
  53   1          TF1=0;
  54   1      }//20毫秒定时器1初始化
C51 COMPILER V9.01   8023                                                                  02/26/2015 14:53:33 PAGE 2   

  55          void fun_timer0(){
  56   1          TL0=0xB0;
  57   1          TH0=0x3C;
  58   1          _nop_();
  59   1      }//50毫秒定时器0处理函数
  60          void fun_timer1(){
  61   1          TL1=0xE0;
  62   1          TH1=0xB1;
  63   1          _nop_();
  64   1      }//20毫秒定时器1处理函数
  65          void fun_wait(){
  66   1          while(in_start==1);
  67   1          fun_delay(20,ms);
  68   1          while(in_start==0);
  69   1          fun_delay(256,ms);
  70   1      }//等待按键
  71          void fun_select(enum varENU_selectsensor par_model){
  72   1          if(par_model==ps58)
  73   1              out_switchselect=0;
  74   1          else if(par_model==ps912)
  75   1              out_switchselect=1;
  76   1      }//传感器片选
  77          void fun_initialization(){
  78   1          CLK_DIV=0x00;//不分频
  79   1      
  80   1          P0M1=0xff;//P0用于输入
  81   1          P0M0=0x00;//P0不能输出
  82   1          
  83   1          P1M1=0x00;//P1口0-1双向，2中断输入，3-6输入，7输出
  84   1          P1M0=0xfc;//P1口2-7输出
  85   1      
  86   1          P2M1=0xf0;//P2口4-7输入
  87   1          P2M0=0x0f;//P2口0-3输出
  88   1      
  89   1          //PS_2=1;//手抓松传感器置1 $?$
  90   1          //PS_11=1;//升降位置3传感器置1 $?$
  91   1      
  92   1          out_en1=1;//电机1/3使能 $?$
  93   1          out_en2=1;//电机2/4使能 $?$
  94   1          out_motorselect=1;//电机片选为1 $?$
  95   1          fun_delay(ms,1);//延时1毫秒 $?$
  96   1          out_motorselect=0;//电机片选为0 $?$
  97   1          //PS_5=PS_1;// $?$
  98   1      
  99   1          fun_pwminit();//PWM的初始化设置
 100   1          fun_timer0init();//初始化定时器0
 101   1          fun_timer1init();//初始化定时器1
 102   1          in_start=1;//按键置1
 103   1      
 104   1          fun_wait();
 105   1      }//初始化
 106          void fun_pwminit(){
 107   1          CCON=0x00;
 108   1          CH=0;
 109   1          CL=0;
 110   1          CMOD=0x00;
 111   1      }//PWM初始化
 112          void fun_pwmr(ui par_value){
 113   1          CCAP0H=CCAP0L=par_value*2.5;//控制输出的占空比
 114   1          CCAPM0=0X42;//8位PWM输出，无中断
 115   1          PCA_PWM0=0x00;
 116   1      }//右路PWM输出
C51 COMPILER V9.01   8023                                                                  02/26/2015 14:53:33 PAGE 3   

 117          void fun_pwml(ui par_value){
 118   1          CCAP1H=CCAP1L=par_value*2.5;//控制输出的占空比
 119   1          CCAPM1=0X42;//8位PWM输出，无中断
 120   1          PCA_PWM1=0x00;
 121   1      }//左路PWM输出
 122          void fun_startdj(enum varENU_motor par_model,char par_speed){
 123   1          if(par_speed==0)
 124   1              return;
 125   1          else if(par_speed>100)
 126   1              par_speed=100;
 127   1          else if(par_speed<-100)
 128   1              par_speed=-100;
 129   1          switch(par_model){
 130   2              case l:
 131   2                  CR=1;
 132   2                  if(par_speed>0){
 133   3                      fun_pwml(par_speed);out_pwml=0;
 134   3                  }
 135   2                  else if(par_speed<0){
 136   3                      fun_pwml(cabs(par_speed));out_pwml=1;
 137   3                  }
 138   2                  break;
 139   2              case r:
 140   2                  CR=1;
 141   2                  if(par_speed>0){
 142   3                      fun_pwmr(par_speed);out_pwmr=0;
 143   3                  }
 144   2                  else if(par_speed<0){
 145   3                      fun_pwmr(cabs(par_speed));out_pwmr=1;
 146   3                  }
 147   2                  break;
 148   2              case rl:
 149   2                  CR=1;
 150   2                  if(par_speed>0){
 151   3                      fun_pwml(par_speed);out_pwml=0;
 152   3                      fun_pwmr(par_speed);out_pwmr=0;
 153   3                  }
 154   2                  else if(par_speed<0){
 155   3                      fun_pwml(cabs(par_speed));out_pwml=1;
 156   3                      fun_pwmr(cabs(par_speed));out_pwmr=1;
 157   3                  }
 158   2                  break;
 159   2              case dj1:
 160   2                  out_motorselect=1;
 161   2                  if(par_speed>0)
 162   2                      out_dir1=1;
 163   2                  else if(par_speed<0)
 164   2                      out_dir1=0;
 165   2                  out_en1=0;
 166   2                  break;
 167   2              case dj2:
 168   2                  out_motorselect=1;
 169   2                  if(par_speed>0)
 170   2                      out_dir2=1;
 171   2                  else if(par_speed<0)
 172   2                      out_dir2=0;
 173   2                  out_en2=0;
 174   2                  break;
 175   2              case dj3:
 176   2                  out_motorselect=0;
 177   2                  if(par_speed>0)
 178   2                      out_dir1=0;
C51 COMPILER V9.01   8023                                                                  02/26/2015 14:53:33 PAGE 4   

 179   2                  else if(par_speed<0)
 180   2                      out_dir1=1;
 181   2                  out_en1=0;
 182   2                  break;
 183   2              case dj4:
 184   2                  out_motorselect=0;
 185   2                  if(par_speed>0)
 186   2                      out_dir2=1;
 187   2                  else if(par_speed<0)
 188   2                      out_dir2=0;
 189   2                  out_en2=0;
 190   2                  break;
 191   2              default:
 192   2                  break;
 193   2          }
 194   1      }//启动电机
 195          void fun_stop(enum varENU_motor par_model){
 196   1          switch(par_model){
 197   2              case l:
 198   2                  fun_pwml(0);out_pwml=0;break;
 199   2              case r:
 200   2                  fun_pwmr(0);out_pwmr=0;break;
 201   2              case rl:
 202   2                  CR=0;fun_pwmr(0);out_pwmr=0;fun_pwml(0);out_pwml=0;break;
 203   2              case dj1:
 204   2                  out_motorselect=1;out_dir1=0;out_en1=1;break;
 205   2              case dj2:
 206   2                  out_motorselect=1;out_dir2=0;out_en2=1;break;
 207   2              case dj3:
 208   2                  out_motorselect=0;out_dir1=0;out_en1=1;break;
 209   2              case dj4:
 210   2                  out_motorselect=0;out_dir2=0;out_en2=1;break;
 211   2              default:
 212   2                  break;
 213   2          }
 214   1      }//停止电机
 215          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    721    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     15    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
