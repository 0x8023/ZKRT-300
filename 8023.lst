C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE 8023
OBJECT MODULE PLACED IN .\output\8023.obj
COMPILER INVOKED BY: D:\MyProgram\keil\C51\BIN\C51.EXE program\8023.c LARGE OPTIMIZE(8,SPEED) DEBUG OBJECTEXTEND PRINT(.
                    -\8023.lst) OBJECT(.\output\8023.obj)

line level    source

   1          #include "./output/8023.h"
   2          struct str_state str_begin,str_now,str_next;//åˆ†åˆ«ä¸º:èµ·å§‹çŠ¶æ€/å½“å‰çŠ¶æ€/ç›®æ ‡çŠ¶æ€
   3          struct str_parameter str_cod={
   4              /*ui str_cod.mlinerqd*/25000,//é»˜è®¤ä¸»å‡½æ•°å·¡çº¿è½¯èµ·åŠ¨è·¯ç¨‹ä¸º25000
   5              /*ui str_cod.mlineqc*/200,   //é»˜è®¤ä¸»å‡½æ•°å·¡çº¿å‰å†²æ—¶é—´ä¸º500æ¯«ç§’
   6          
   7              /*ui str_cod.sj1bzw*/58,     //å‡é™æ ‡å‡†ä½å»¶æ—¶
   8              /*ui str_cod.sj1zjw*/800,    //å‡é™ä¸­é—´ä½å»¶æ—¶
   9          
  10              /*ui str_cod.py1bz*/45,      //fun_pyæ ‡å‡†ä½å»¶æ—¶
  11              /*ui str_cod.py1qkq*/600,    //fun_pyå‰åˆ°é å‰å»¶æ—¶å‚æ•°
  12              /*ui str_cod.py1kqz*/525,    //fun_pyé å‰åˆ°ä¸­é—´å»¶æ—¶
  13              /*ui str_cod.py1zkh*/525,    //fun_pyä¸­é—´åˆ°é åå»¶æ—¶
  14              /*ui str_cod.py1khh*/540,    //fun_pyé ååˆ°åå»¶æ—¶
  15              /*ui str_cod.py1qz*/1155,    //fun_pyå‰åˆ°ä¸­é—´å»¶æ—¶
  16              /*ui str_cod.py1zh*/1090,    //fun_pyä¸­é—´åˆ°åå»¶æ—¶
  17              /*ui str_cod.py1kqkh*/1105,  //fun_pyé å‰åˆ°é åå»¶æ—¶
  18              /*ui str_cod.py1khkq*/1050,  //fun_pyé ååˆ°é å‰å»¶æ—¶
  19              /*ui str_cod.py1qkh*/1735,   //fun_pyå‰åˆ°é åå»¶æ—¶
  20              /*ui str_cod.py1kqh*/1635,   //fun_pyé å‰åˆ°åå»¶æ—¶
  21          
  22              /*ui str_cod.hz1bz*/20,      //fun_hzæ ‡å‡†ä½å»¶æ—¶
  23          
  24              /*ui mainturn90;*/1200,      //ä¸»å‡½æ•°90åº¦è½¬å¼¯å±è”½å»¶æ—¶
  25              /*ui timerturn90;*/700,     //å®šæ—¶å™¨90åº¦è½¬å¼¯å±è”½å»¶æ—¶
  26              /*ui mainturn180;*/2000,     //ä¸»å‡½æ•°180åº¦è½¬å¼¯å±è”½å»¶æ—¶
  27              /*ui timerturn180;*/2000     //å®šæ—¶å™¨180åº¦è½¬å¼¯å±è”½å»¶æ—¶
  28          };
  29          struct str_timerfolline str_tfl;
  30          struct str_coordinates str_zbfl;
  31          data ul var_timer;
  32          void fun_delay(ui par_value,enum varENU_del par_model){
  33   1          data ui loc_con=par_value;
  34   1          switch(par_model){
  35   2              case del_us://å¾®ç§’çº§å»¶æ—¶
  36   2                  #ifdef Debug
                              printf("fun_delay(%d,del_us);\n",par_value);
                          #else
  39   2                      while(loc_con-->0){
  40   3                          _nop_();
  41   3                          _nop_();
  42   3                      }
  43   2                  #endif
  44   2                  return;
  45   2              case del_ms://æ¯«ç§’çº§å»¶æ—¶
  46   2                  #ifdef Debug
                              printf("fun_delay(%d,del_ms);\n",par_value);
                          #else
  49   2                      while(loc_con-->0){
  50   3                          data uc loc_i, loc_j;
  51   3                          _nop_();
  52   3                          _nop_();
  53   3                          loc_i=12;
  54   3                          loc_j=168;
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 2   

  55   3                          do{
  56   4                              while(--loc_j);
  57   4                          }while(--loc_i);
  58   3                      }
  59   2                  #endif
  60   2                  return;
  61   2              case del_s://ç§’çº§å»¶æ—¶
  62   2                  #ifdef Debug
                              printf("fun_delay(%d,del_s);\n",par_value);
                          #else
  65   2                      while(loc_con-->0){
  66   3                          data uc loc_i, loc_j, loc_k;
  67   3                          loc_i=46;
  68   3                          loc_j=153;
  69   3                          loc_k=245;
  70   3                          do{
  71   4                              do{
  72   5                                  while(--loc_k);
  73   5                              }while(--loc_j);
  74   4                          }while(--loc_i);
  75   3                      }
  76   2                  #endif
  77   2                  return;
  78   2              default:return;
  79   2          }
  80   1      }//å»¶æ—¶
  81          void fun_timer0init(){
  82   1          #ifdef Debug
                      printf("fun_timer0init();\n");
                  #endif
  85   1          AUXR|=0x80;   //å®šæ—¶å™¨æ—¶é’Ÿ1Tæ¨¡å¼
  86   1          TMOD&=0xF0;   //å®šæ—¶å™¨æ¨¡å¼:16ä½
  87   1          TMOD|=0x01;   //å®šæ—¶å™¨æ¨¡å¼:16ä½
  88   1          TL0=0x20;     //å®šæ—¶åˆå€¼:1ms
  89   1          TH0=0xD1;     //å®šæ—¶åˆå€¼:1ms
  90   1          TF0=0;        //æ¸…é™¤TF0æ ‡å¿—
  91   1          ET0=1;
  92   1          EA=1;         //å¼€å¯æ€»ä¸­æ–­
  93   1      }//1æ¯«ç§’å®šæ—¶å™¨0åˆå§‹åŒ–
  94          void fun_timer1init(){
  95   1          #ifdef Debug
                      printf("fun_timer1init();\n");
                  #endif
  98   1          AUXR&=0xBF;     //å®šæ—¶å™¨æ—¶é’Ÿ12Tæ¨¡å¼
  99   1          TMOD&=0x0F;     //å®šæ—¶å™¨æ¨¡å¼:16ä½
 100   1          TMOD|=0x10;     //å®šæ—¶å™¨æ¨¡å¼:16ä½
 101   1          TL1=0xE0;       //å®šæ—¶åˆå€¼:20ms
 102   1          TH1=0xB1;       //å®šæ—¶åˆå€¼:20ms
 103   1          TF1=0;          //æ¸…é™¤TF1æ ‡å¿—
 104   1          ET1=1;
 105   1          EA=1;           //å¼€å¯æ€»ä¸­æ–­
 106   1      }//20æ¯«ç§’å®šæ—¶å™¨1åˆå§‹åŒ–
 107          void fun_timer0(){
 108   1          TL0=0x20;
 109   1          TH0=0xD1;//å®šæ—¶å™¨åˆå€¼æ¢å¤è‡³1ms
 110   1          var_timer++;//å…¨å±€è®¡æ—¶å™¨å¼€å§‹è®¡æ—¶
 111   1          if(str_tfl.doing==tf_ture)//å¦‚æœæ­£åœ¨ç§»åŠ¨
 112   1              fun_timermove();//å®šæ—¶å™¨ç§»åŠ¨
 113   1      }//1æ¯«ç§’å®šæ—¶å™¨0å¤„ç†å‡½æ•°
 114          void fun_timer1(){
 115   1          TL1=0xE0;
 116   1          TH1=0xB1;
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 3   

 117   1      }//20æ¯«ç§’å®šæ—¶å™¨1å¤„ç†å‡½æ•°
 118          void fun_wait(){
 119   1          in_start=1;               //æŒ‰é”®ç½®1
 120   1          #ifdef Debug
                      printf("fun_wait();\n");
                  #else
 123   1              while(in_start==1);
 124   1              fun_delay(20,del_ms);
 125   1              while(in_start==0);
 126   1              fun_delay(256,del_ms);
 127   1          #endif
 128   1      }//ç­‰å¾…æŒ‰é”®
 129          void fun_pwminit(){
 130   1          #ifdef Debug
                      printf("fun_pwminit();\n");
                  #endif
 133   1          CCON=0x00;//PACå¯„å­˜æ§åˆ¶å™¨
 134   1          CH=0;//é‡ç½®PACè®¡æ—¶å™¨
 135   1          CL=0;
 136   1          CMOD=0x08;//ä¸åˆ†é¢‘
 137   1      }//PWMåˆå§‹åŒ–
 138          void fun_pwmr(uc par_value){
 139   1          CCAP0H=CCAP0L=par_value*25/10;//æ§åˆ¶è¾“å‡ºçš„å ç©ºæ¯”
 140   1          CCAPM0=0X42;//8ä½PWMè¾“å‡ºï¼Œæ— ä¸­æ–­
 141   1          PCA_PWM0=0x00;
 142   1      }//å³è·¯PWMè¾“å‡º
 143          void fun_pwml(uc par_value){
 144   1          CCAP1H=CCAP1L=par_value*25/10;//æ§åˆ¶è¾“å‡ºçš„å ç©ºæ¯”
 145   1          CCAPM1=0X42;//8ä½PWMè¾“å‡ºï¼Œæ— ä¸­æ–­
 146   1          PCA_PWM1=0x00;
 147   1      }//å·¦è·¯PWMè¾“å‡º
 148          void fun_motors(enum varENU_mot par_model,char par_speed){
 149   1          if(par_speed>100)
 150   1              par_speed=100;
 151   1          else if(par_speed<-100)
 152   1              par_speed=-100;//é€Ÿåº¦æœ€å¤š100,æœ€å°‘-100
 153   1          switch(par_model){
 154   2              case mot_l://å·¦è½®ç”µæœº
 155   2                  if(str_begin.leftsd==par_speed)
 156   2                      return;
 157   2                  else
 158   2                      str_begin.leftsd=par_speed;
 159   2                  if(par_speed==0){
 160   3                      fun_pwml(0);out_pwml=0;
 161   3                  }
 162   2                  else if(par_speed>0){
 163   3                      CR=1;fun_pwml(par_speed);out_pwml=0;
 164   3                  }
 165   2                  else if(par_speed<0){
 166   3                      CR=1;fun_pwml(cabs(par_speed));out_pwml=1;
 167   3                  }
 168   2                  break;
 169   2              case mot_r://å³è½®ç”µæœº
 170   2                  if(str_begin.rightsd==par_speed)
 171   2                      return;
 172   2                  else
 173   2                      str_begin.rightsd=par_speed;
 174   2                  if(par_speed==0){
 175   3                      fun_pwmr(0);out_pwmr=0;
 176   3                  }
 177   2                  else if(par_speed>0){
 178   3                      CR=1;fun_pwmr(par_speed);out_pwmr=0;
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 4   

 179   3                  }
 180   2                  else if(par_speed<0){
 181   3                      CR=1;fun_pwmr(cabs(par_speed));out_pwmr=1;
 182   3                  }
 183   2                  break;
 184   2              case mot_rl://å·¦å³è½®åŒæ­¥
 185   2                  if((str_begin.leftsd==par_speed)&&(str_begin.rightsd==par_speed))
 186   2                      return;
 187   2                  else
 188   2                      str_begin.leftsd=str_begin.rightsd=par_speed;
 189   2                  if(par_speed==0){
 190   3                      CR=0;
 191   3                      fun_pwmr(0);out_pwmr=0;
 192   3                      fun_pwml(0);out_pwml=0;
 193   3                  }
 194   2                  else if(par_speed>0){
 195   3                      CR=1;
 196   3                      fun_pwml(par_speed);out_pwml=0;
 197   3                      fun_pwmr(par_speed);out_pwmr=0;
 198   3                  }
 199   2                  else if(par_speed<0){
 200   3                      CR=1;
 201   3                      fun_pwml(cabs(par_speed));out_pwml=1;
 202   3                      fun_pwmr(cabs(par_speed));out_pwmr=1;
 203   3                  }
 204   2                  break;
 205   2              case mot_sz://æ­£è½¬ä¸ºæŠ“ç´§ï¼Œåè½¬ä¸ºæ¾å¼€
 206   2                  if(str_begin.szsd==par_speed)
 207   2                      return;
 208   2                  else
 209   2                      str_begin.szsd=par_speed;
 210   2                  if(par_speed==0){
 211   3                      out_motorselect=1;out_dir1=0;out_en1=1;
 212   3                  }
 213   2                  else if(par_speed>0){
 214   3                      out_motorselect=1;out_dir1=1;out_en1=0;
 215   3                  }
 216   2                  else if(par_speed<0){
 217   3                      out_motorselect=1;out_dir1=0;out_en1=0;
 218   3                  }
 219   2                  break;
 220   2              case mot_py://æ­£è½¬æ˜¯å‘æ— ç”µæœºä¸€æ–¹è½¬,åè½¬ä¸ºå‘æœ‰ç”µæœºä¸€æ–¹è½¬
 221   2                  if(str_begin.pysd==par_speed)
 222   2                      return;
 223   2                  else
 224   2                      str_begin.pysd=par_speed;
 225   2                  if(par_speed==0){
 226   3                      out_motorselect=1;out_dir2=0;out_en2=1;
 227   3                  }
 228   2                  else if(par_speed>0){
 229   3                      out_motorselect=1;out_dir2=1;out_en2=0;
 230   3                  }
 231   2                  else if(par_speed<0){
 232   3                      out_motorselect=1;out_dir2=0;out_en2=0;
 233   3                  }
 234   2                  break;
 235   2              case mot_sj://å‘ä¸Šä¸ºæ­£è½¬,å‘ä¸‹ä¸ºåè½¬
 236   2                  if(str_begin.sjsd==par_speed)
 237   2                      return;
 238   2                  else
 239   2                      str_begin.sjsd=par_speed;
 240   2                  if(par_speed==0){
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 5   

 241   3                      out_motorselect=0;out_dir1=0;out_en1=1;
 242   3                  }
 243   2                  else if(par_speed>0){
 244   3                      out_motorselect=0;out_dir1=0;out_en1=0;
 245   3                  }
 246   2                  else if(par_speed<0){
 247   3                      out_motorselect=0;out_dir1=1;out_en1=0;
 248   3                  }
 249   2                  break;
 250   2              case mot_hz://é¡ºæ—¶é’ˆä¸ºæ­£è½¬,é€†æ—¶é’ˆä¸ºåè½¬
 251   2                  if(str_begin.hzsd==par_speed)
 252   2                      return;
 253   2                  else
 254   2                      str_begin.hzsd=par_speed;
 255   2                  if(par_speed==0){
 256   3                      out_motorselect=0;out_dir2=0;out_en2=1;
 257   3                  }
 258   2                  else if(par_speed>0){
 259   3                      out_motorselect=0;out_dir2=0;out_en2=0;
 260   3                  }
 261   2                  else if(par_speed<0){
 262   3                      out_motorselect=0;out_dir2=1;out_en2=0;
 263   3                  }
 264   2                  break;
 265   2              default:
 266   2                  break;
 267   2          }
 268   1      }//ä¸»å‡½æ•°æ“ä½œç”µæœº
 269          void fun_motorsrl(enum varENU_mot par_model,int par_speed){
 270   1          if(par_speed>100)
 271   1              par_speed=100;
 272   1          else if(par_speed<-100)
 273   1              par_speed=-100;//é€Ÿåº¦æœ€å¤š100,æœ€å°‘-100
 274   1          switch(par_model){
 275   2              case mot_l://å·¦è½®ç”µæœº
 276   2                  if(str_begin.leftsd==par_speed)
 277   2                      return;
 278   2                  else
 279   2                      str_begin.leftsd=par_speed;
 280   2                  if(par_speed==0){
 281   3                      fun_pwml(0);out_pwml=0;
 282   3                  }
 283   2                  else if(par_speed>0){
 284   3                      CR=1;fun_pwml(par_speed);out_pwml=0;
 285   3                  }
 286   2                  else if(par_speed<0){
 287   3                      CR=1;fun_pwml(cabs(par_speed));out_pwml=1;
 288   3                  }
 289   2                  break;
 290   2              case mot_r://å³è½®ç”µæœº
 291   2                  if(str_begin.rightsd==par_speed)
 292   2                      return;
 293   2                  else
 294   2                      str_begin.rightsd=par_speed;
 295   2                  if(par_speed==0){
 296   3                      fun_pwmr(0);out_pwmr=0;
 297   3                  }
 298   2                  else if(par_speed>0){
 299   3                      CR=1;fun_pwmr(par_speed);out_pwmr=0;
 300   3                  }
 301   2                  else if(par_speed<0){
 302   3                      CR=1;fun_pwmr(cabs(par_speed));out_pwmr=1;
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 6   

 303   3                  }
 304   2                  break;
 305   2              case mot_rl://å·¦å³è½®åŒæ­¥
 306   2                  if((str_begin.leftsd==par_speed)&&(str_begin.rightsd==par_speed))
 307   2                      return;
 308   2                  else
 309   2                      str_begin.leftsd=str_begin.rightsd=par_speed;
 310   2                  if(par_speed==0){
 311   3                      CR=0;
 312   3                      fun_pwmr(0);out_pwmr=0;
 313   3                      fun_pwml(0);out_pwml=0;
 314   3                  }
 315   2                  else if(par_speed>0){
 316   3                      CR=1;
 317   3                      fun_pwml(par_speed);out_pwml=0;
 318   3                      fun_pwmr(par_speed);out_pwmr=0;
 319   3                  }
 320   2                  else if(par_speed<0){
 321   3                      CR=1;
 322   3                      fun_pwml(cabs(par_speed));out_pwml=1;
 323   3                      fun_pwmr(cabs(par_speed));out_pwmr=1;
 324   3                  }
 325   2                  break;
 326   2              default:
 327   2                  break;
 328   2          }
 329   1      }//å®šæ—¶å™¨æ“ä½œå·¦å³è½®
 330          void fun_sz(enum varENU_han par_model){
 331   1          if(str_begin.szzt==par_model)
 332   1              return;
 333   1          if(par_model==han_s){//æ‰‹æŠ“æ¾
 334   2              #ifdef Debug
                          printf("fun_sz(han_s);\n");
                      #else
 337   2                  fun_motors(mot_sz,-100);
 338   2                  while(in_s==1);
 339   2              #endif
 340   2          }
 341   1          else{//æ‰‹æŠ“ç´§
 342   2              #ifdef Debug
                          printf("fun_sz(han_j);\n");
                      #else
 345   2                  fun_motors(mot_sz,100);
 346   2                  while(in_j==1);
 347   2              #endif
 348   2          }
 349   1              fun_delay(20,del_ms);
 350   1              fun_motors(mot_sz,0);
 351   1          str_begin.szzt=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 352   1      }//æ‰‹æŠ“å•æ­¥è¿åŠ¨
 353          void fun_py(enum varENU_tra par_model){
 354   1          if(str_begin.pywz==par_model)
 355   1              return;
 356   1          switch(par_model){
 357   2              case tra_q://å‰å¹³ç§»(æ²¡æœ‰ç”µæœºçš„å‘¢ä¸ªæ–¹å‘)
 358   2                  #ifdef Debug
                              printf("fun_py(tra_q);\n");
                          #else
 361   2                      fun_motors(mot_py,100);
 362   2                      while(in_qpy==1);
 363   2                      fun_delay(str_cod.py1bz,del_ms);
 364   2                  #endif
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 7   

 365   2                      break;
 366   2              case tra_kq://é å‰å¹³ç§»
 367   2                  #ifdef Debug
                              printf("fun_py(tra_kq);\n");
                          #else
 370   2                      switch(str_begin.pywz){
 371   3                          case tra_q://ç°åœ¨åœ¨å‰é¢
 372   3                              fun_motors(mot_py,-100);
 373   3                              fun_delay(str_cod.py1qkq,del_ms);
 374   3                              break;
 375   3                          case tra_z://ç°åœ¨åœ¨ä¸­é—´
 376   3                              fun_motors(mot_py,100);
 377   3                              fun_delay(str_cod.py1kqz,del_ms);
 378   3                              break;
 379   3                          case tra_kh://ç°åœ¨åœ¨é å
 380   3                              fun_motors(mot_py,100);
 381   3                              fun_delay(str_cod.py1khkq,del_ms);
 382   3                              break;
 383   3                          case tra_h://ç°åœ¨åœ¨å
 384   3                              fun_motors(mot_py,100);
 385   3                              fun_delay(str_cod.py1kqh,del_ms);
 386   3                              break;
 387   3                      }
 388   2                  #endif
 389   2                      break;
 390   2              case tra_z://å¹³ç§»åˆ°ä¸­é—´
 391   2                  #ifdef Debug
                              printf("fun_py(tra_z);\n");
                          #else
 394   2                      switch(str_begin.pywz){
 395   3                          case tra_q://ç°åœ¨åœ¨å‰é¢
 396   3                              fun_motors(mot_py,-100);
 397   3                              fun_delay(str_cod.py1qz,del_ms);
 398   3                              break;
 399   3                          case tra_kq://ç°åœ¨åœ¨é å‰
 400   3                              fun_motors(mot_py,-100);
 401   3                              fun_delay(str_cod.py1kqz,del_ms);
 402   3                              break;
 403   3                          case tra_kh://ç°åœ¨åœ¨é å
 404   3                              fun_motors(mot_py,100);
 405   3                              fun_delay(str_cod.py1zkh,del_ms);
 406   3                              break;
 407   3                          case tra_h://ç°åœ¨åœ¨åé¢
 408   3                              fun_motors(mot_py,100);
 409   3                              fun_delay(str_cod.py1zh,del_ms);
 410   3                              break;
 411   3                      }
 412   2                  #endif
 413   2                      break;
 414   2              case tra_kh://å¹³ç§»åˆ°é å
 415   2                  #ifdef Debug
                              printf("fun_py(tra_kh);\n");
                          #else
 418   2                      switch(str_begin.pywz){
 419   3                          case tra_q://ç°åœ¨åœ¨å‰é¢
 420   3                              fun_motors(mot_py,-100);
 421   3                              fun_delay(str_cod.py1qkh,del_ms);
 422   3                              break;
 423   3                          case tra_kq://ç°åœ¨åœ¨é å‰
 424   3                              fun_motors(mot_py,-100);
 425   3                              fun_delay(str_cod.py1kqkh,del_ms);
 426   3                              break;
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 8   

 427   3                          case tra_z://ç°åœ¨åœ¨ä¸­é—´
 428   3                              fun_motors(mot_py,-100);
 429   3                              fun_delay(str_cod.py1zkh,del_ms);
 430   3                              break;
 431   3                          case tra_h://ç°åœ¨åœ¨åé¢
 432   3                              fun_motors(mot_py,100);
 433   3                              fun_delay(str_cod.py1khh,del_ms);
 434   3                              break;
 435   3                      }
 436   2                  #endif
 437   2                      break;
 438   2              case tra_h://åå¹³ç§»(æœ‰ç”µæœºçš„å‘¢ä¸ªæ–¹å‘)
 439   2                  #ifdef Debug
                              printf("fun_py(tra_h);\n");
                          #else
 442   2                      fun_motors(mot_py,-100);
 443   2                      while(in_hpy==1);
 444   2                      fun_delay(str_cod.py1bz,del_ms);
 445   2                  #endif
 446   2                      break;
 447   2              default:
 448   2                  break;
 449   2          }
 450   1          fun_motors(mot_py,0);
 451   1          str_begin.pywz=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 452   1      }//å¹³ç§»å•æ­¥è¿åŠ¨
 453          void fun_sj(enum varENU_sjp par_model){
 454   1          if(str_begin.sjwz==par_model)
 455   1             return;
 456   1          def_select(sel_58)
 457   1          switch(par_model){
 458   2              case sjp_1://å‡é™ä½ç½®1(æœ€ä¸Šä½)
 459   2                  #ifdef Debug
                              printf("fun_sj(sjp_1);\n");
                          #else
 462   2                      fun_motors(mot_sj,100);
 463   2                      def_select(sel_58);
 464   2                      while(in_wz1==1);
 465   2                      fun_delay(str_cod.sj1bzw,del_ms);
 466   2                  #endif
 467   2                      break;
 468   2              case sjp_12:
 469   2                  #ifdef Debug
                              printf("fun_sj(sjp_12);\n");
                          #else
 472   2                      if(par_model>str_begin.sjwz){
 473   3                          fun_motors(mot_sj,-100);
 474   3                          fun_delay(str_cod.sj1zjw,del_ms);
 475   3                      }
 476   2                      else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 477   3                          fun_sj(sjp_2);
 478   3                          fun_motors(mot_sj,100);
 479   3                          fun_delay(str_cod.sj1zjw,del_ms);
 480   3                      }
 481   2                  #endif
 482   2                      break;
 483   2              case sjp_2://å‡é™ä½ç½®2
 484   2                  #ifdef Debug
                              printf("fun_sj(sjp_2);\n");
                          #else
 487   2                      fun_motors(mot_sj,par_model<str_begin.sjwz?100:-100);
 488   2                      def_select(sel_58);
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 9   

 489   2                      while(in_wz2==1);
 490   2                      fun_delay(str_cod.sj1bzw,del_ms);
 491   2                  #endif
 492   2                      break;
 493   2              case sjp_23:
 494   2                  #ifdef Debug
                              printf("fun_sj(sjp_23);\n");
                          #else
 497   2                      if(par_model>str_begin.sjwz){
 498   3                          fun_sj(sjp_2);
 499   3                          fun_motors(mot_sj,-100);
 500   3                          fun_delay(str_cod.sj1zjw,del_ms);
 501   3                      }
 502   2                      else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 503   3                          fun_sj(sjp_3);
 504   3                          fun_motors(mot_sj,100);
 505   3                          fun_delay(str_cod.sj1zjw,del_ms);
 506   3                      }
 507   2                  #endif
 508   2                      break;
 509   2              case sjp_3://å‡é™ä½ç½®3
 510   2                  #ifdef Debug
                              printf("fun_sj(sjp_3);\n");
                          #else
 513   2                      fun_motors(mot_sj,par_model<str_begin.sjwz?100:-100);
 514   2                      def_select(sel_58);
 515   2                      while(in_wz3==1);
 516   2                      fun_delay(str_cod.sj1bzw,del_ms);
 517   2                  #endif
 518   2                  break;
 519   2              case sjp_34:
 520   2                  #ifdef Debug
                              printf("fun_sj(sjp_34);\n");
                          #else
 523   2                      if(par_model>str_begin.sjwz){
 524   3                          fun_sj(sjp_3);
 525   3                          fun_motors(mot_sj,-100);
 526   3                          fun_delay(str_cod.sj1zjw,del_ms);
 527   3                      }
 528   2                      else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 529   3                          fun_sj(sjp_4);
 530   3                          fun_motors(mot_sj,100);
 531   3                          fun_delay(str_cod.sj1zjw,del_ms);
 532   3                      }
 533   2                  #endif
 534   2                      break;
 535   2              case sjp_4://å‡é™ä½ç½®4
 536   2                  #ifdef Debug
                              printf("fun_sj(sjp_4);\n");
                          #else
 539   2                      fun_motors(mot_sj,par_model<str_begin.sjwz?100:-100);
 540   2                      def_select(sel_58);
 541   2                      while(in_wz4==1);
 542   2                      fun_delay(str_cod.sj1bzw,del_ms);
 543   2                  #endif
 544   2                      break;
 545   2              case sjp_45:
 546   2                  #ifdef Debug
                              printf("fun_sj(sjp_45);\n");
                          #else
 549   2                      if(par_model>str_begin.sjwz){
 550   3                          fun_sj(sjp_4);
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 10  

 551   3                          fun_motors(mot_sj,-100);
 552   3                          fun_delay(str_cod.sj1zjw,del_ms);
 553   3                      }
 554   2                      else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 555   3                          fun_motors(mot_sj,100);
 556   3                          fun_delay(str_cod.sj1zjw,del_ms);
 557   3                      }
 558   2                  #endif
 559   2                      break;
 560   2              case sjp_5://å‡é™ä½ç½®5
 561   2                  #ifdef Debug
                              printf("fun_sj(sjp_5);\n");
                          #else
 564   2                      fun_motors(mot_sj,-100);
 565   2                      def_select(sel_912);
 566   2                      while(in_wz5==1);
 567   2                      fun_delay(str_cod.sj1bzw,del_ms);
 568   2                  #endif
 569   2                      break;
 570   2              default:
 571   2                  break;
 572   2          }
 573   1          fun_motors(mot_sj,0);
 574   1          str_begin.sjwz=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 575   1      }//å‡é™å•æ­¥è¿åŠ¨
 576          void fun_hz(enum varENU_dir par_model){
 577   1          if(str_begin.hzfx==par_model)
 578   1              return;
 579   1          def_select(sel_912);
 580   1          switch(par_model){
 581   2              case dir_up://å›è½¬è‡³å‰æ–¹
 582   2                  #ifdef Debug
                              printf("fun_hz(dir_up);\n");
                          #else
 585   2                      switch(str_begin.hzfx){
 586   3                          case dir_down://ç°åœ¨åœ¨ä¸‹æ–¹
 587   3                              fun_motors(mot_hz,-100);
 588   3                              fun_delay(1,del_s);
 589   3                              while(in_hz==1);
 590   3                              while(in_hz==0);
 591   3                              while(in_hz==1);
 592   3                              fun_delay(str_cod.hz1bz,del_ms);
 593   3                              break;
 594   3                          case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 595   3                              fun_motors(mot_hz,100);
 596   3                              fun_delay(1,del_s);
 597   3                              while(in_hz==1);
 598   3                              fun_delay(str_cod.hz1bz,del_ms);
 599   3                              break;
 600   3                          case dir_right://ç°åœ¨åœ¨å³è¾¹
 601   3                              fun_motors(mot_hz,-100);
 602   3                              fun_delay(1,del_s);
 603   3                              while(in_hz==1);
 604   3                              fun_delay(str_cod.hz1bz,del_ms);
 605   3                              break;
 606   3                          default:
 607   3                              break;
 608   3                      }
 609   2                  #endif
 610   2                      break;
 611   2              case dir_down://è¦å»ä¸‹é¢
 612   2                  #ifdef Debug
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 11  

                              printf("fun_hz(dir_down);\n");
                          #else
 615   2                      switch(str_begin.hzfx){
 616   3                          case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 617   3                              fun_motors(mot_hz,100);
 618   3                              fun_delay(1,del_s);
 619   3                              while(in_hz==1);
 620   3                              while(in_hz==0);
 621   3                              while(in_hz==1);
 622   3                              fun_delay(str_cod.hz1bz,del_ms);
 623   3                              break;
 624   3                          case dir_left://ç°åœ¨åœ¨å·¦é¢
 625   3                              fun_motors(mot_hz,-100);
 626   3                              fun_delay(1,del_s);
 627   3                              while(in_hz==1);
 628   3                              fun_delay(str_cod.hz1bz,del_ms);
 629   3                              break;
 630   3                          case dir_right://ç°åœ¨åœ¨å³é¢
 631   3                              fun_motors(mot_hz,100);
 632   3                              fun_delay(1,del_s);
 633   3                              while(in_hz==1);
 634   3                              fun_delay(str_cod.hz1bz,del_ms);
 635   3                              break;
 636   3                          default:
 637   3                              break;
 638   3                      }
 639   2                  #endif
 640   2                      break;
 641   2              case dir_left://è¦å»å·¦è¾¹
 642   2                  #ifdef Debug
                              printf("fun_hz(dir_left);\n");
                          #else
 645   2                      switch(str_begin.hzfx){
 646   3                          case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 647   3                              fun_motors(mot_hz,-100);
 648   3                              fun_delay(1,del_s);
 649   3                              while(in_hz==1);
 650   3                              fun_delay(str_cod.hz1bz,del_ms);
 651   3                              break;
 652   3                          case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 653   3                              fun_motors(mot_hz,100);
 654   3                              fun_delay(1,del_s);
 655   3                              while(in_hz==1);
 656   3                              fun_delay(str_cod.hz1bz,del_ms);
 657   3                              break;
 658   3                          case dir_right://ç°åœ¨åœ¨å³é¢
 659   3                              fun_motors(mot_hz,-100);
 660   3                              fun_delay(1,del_s);
 661   3                              while(in_hz==1);
 662   3                              while(in_hz==0);
 663   3                              while(in_hz==1);
 664   3                              fun_delay(str_cod.hz1bz,del_ms);
 665   3                              break;
 666   3                          default:
 667   3                              break;
 668   3                      }
 669   2                  #endif
 670   2                      break;
 671   2              case dir_right://è¦å»å³é¢
 672   2                  #ifdef Debug
                              printf("fun_hz(dir_right);\n");
                          #else
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 12  

 675   2                      switch(str_begin.hzfx){
 676   3                          case dir_up://ç°åœ¨åœ¨å‰é¢
 677   3                              fun_motors(mot_hz,100);
 678   3                              fun_delay(1,del_s);
 679   3                              while(in_hz==1);
 680   3                              fun_delay(str_cod.hz1bz,del_ms);
 681   3                              break;
 682   3                          case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 683   3                              fun_motors(mot_hz,-100);
 684   3                              fun_delay(1,del_s);
 685   3                              while(in_hz==1);
 686   3                              fun_delay(str_cod.hz1bz,del_ms);
 687   3                              break;
 688   3                          case dir_left://ç°åœ¨åœ¨å·¦é¢
 689   3                              fun_motors(mot_hz,100);
 690   3                              fun_delay(1,del_s);
 691   3                              while(in_hz==1);
 692   3                              while(in_hz==0);
 693   3                              while(in_hz==1);
 694   3                              fun_delay(str_cod.hz1bz,del_ms);
 695   3                              break;
 696   3                          default:
 697   3                              break;
 698   3                      }
 699   2                  #endif
 700   2                      break;
 701   2              default:
 702   2                  break;
 703   2          }
 704   1          fun_motors(mot_hz,0);
 705   1          str_begin.hzfx=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 706   1      }//å›è½¬å•æ­¥è¿åŠ¨
 707          void fun_pyhz(enum varENU_tra par_pymodel,enum varENU_dir par_hzmodel){
 708   1          switch(par_hzmodel){//è·å–æƒ³è¦åˆ°è¾¾çš„å›è½¬ä½ç½®
 709   2              case dir_left://è¦å»å·¦è¾¹
 710   2                  switch(str_begin.hzfx){
 711   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 712   3                          fun_motors(mot_hz,-100);
 713   3                          break;
 714   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 715   3                          fun_motors(mot_hz,-100);
 716   3                          break;
 717   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 718   3                          fun_motors(mot_hz,100);
 719   3                          break;
 720   3                      default:
 721   3                          break;
 722   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 723   2                  break;
 724   2              case dir_right://è¦å»å³è¾¹
 725   2                  switch(str_begin.hzfx){
 726   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 727   3                          fun_motors(mot_hz,100);
 728   3                          break;
 729   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 730   3                          fun_motors(mot_hz,100);
 731   3                          break;
 732   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 733   3                          fun_motors(mot_hz,-100);
 734   3                          break;
 735   3                      default:
 736   3                          break;
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 13  

 737   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 738   2                  break;
 739   2              case dir_up://è¦å»ä¸Šé¢
 740   2                  switch(str_begin.hzfx){
 741   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 742   3                          fun_motors(mot_hz,100);
 743   3                          break;
 744   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 745   3                          fun_motors(mot_hz,-100);
 746   3                          break;
 747   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 748   3                          fun_motors(mot_hz,-100);
 749   3                          break;
 750   3                      default:
 751   3                          break;
 752   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 753   2                  break;
 754   2              case dir_down://è¦å»ä¸‹é¢
 755   2                  switch(str_begin.hzfx){
 756   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 757   3                          fun_motors(mot_hz,-100);
 758   3                          break;
 759   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 760   3                          fun_motors(mot_hz,100);
 761   3                          break;
 762   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 763   3                          fun_motors(mot_hz,100);
 764   3                          break;
 765   3                      default:
 766   3                          break;
 767   3                  }//è·å–ç°åœ¨å›è½¬æ‰€åœ¨çš„ä½ç½®
 768   2                  break;
 769   2              default:
 770   2                  break;
 771   2          }//è·å–ç°åœ¨è¦å»çš„å›è½¬ä½ç½®
 772   1          fun_py(par_pymodel);//åšå¹³ç§»
 773   1          def_select(sel_912);//ä¼ æ„Ÿå™¨ç‰‡é€‰
 774   1          fun_delay(1,del_s);//å»¶æ—¶ä¸€æ®µæ—¶é—´ç­‰å¾…å›è½¬ä¼ æ„Ÿå™¨è¿‡å»
 775   1          switch(par_hzmodel){//è·å–æƒ³è¦åˆ°è¾¾çš„å›è½¬ä½ç½®
 776   2              case dir_up://å›è½¬è‡³å‰æ–¹
 777   2                  switch(str_begin.hzfx){
 778   3                      case dir_down://ç°åœ¨åœ¨ä¸‹æ–¹
 779   3                          while(in_hz==1);
 780   3                          while(in_hz==0);
 781   3                          while(in_hz==1);
 782   3                          fun_delay(str_cod.hz1bz,del_ms);
 783   3                          break;
 784   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 785   3                          while(in_hz==1);
 786   3                          fun_delay(str_cod.hz1bz,del_ms);
 787   3                          break;
 788   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 789   3                          while(in_hz==1);
 790   3                          fun_delay(str_cod.hz1bz,del_ms);
 791   3                          break;
 792   3                      default:
 793   3                          break;
 794   3                  }
 795   2                  break;
 796   2              case dir_down://è¦å»ä¸‹é¢
 797   2                  switch(str_begin.hzfx){
 798   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 14  

 799   3                          while(in_hz==1);
 800   3                          while(in_hz==0);
 801   3                          while(in_hz==1);
 802   3                          fun_delay(str_cod.hz1bz,del_ms);
 803   3                          break;
 804   3                      case dir_left://ç°åœ¨åœ¨å·¦é¢
 805   3                          while(in_hz==1);
 806   3                          fun_delay(str_cod.hz1bz,del_ms);
 807   3                          break;
 808   3                      case dir_right://ç°åœ¨åœ¨å³é¢
 809   3                          while(in_hz==1);
 810   3                          fun_delay(str_cod.hz1bz,del_ms);
 811   3                          break;
 812   3                      default:
 813   3                          break;
 814   3                  }
 815   2                  break;
 816   2              case dir_left://è¦å»å·¦è¾¹
 817   2                  switch(str_begin.hzfx){
 818   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 819   3                          while(in_hz==1);
 820   3                          fun_delay(str_cod.hz1bz,del_ms);
 821   3                          break;
 822   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 823   3                          while(in_hz==1);
 824   3                          fun_delay(str_cod.hz1bz,del_ms);
 825   3                          break;
 826   3                      case dir_right://ç°åœ¨åœ¨å³é¢
 827   3                          while(in_hz==1);
 828   3                          while(in_hz==0);
 829   3                          while(in_hz==1);
 830   3                          fun_delay(str_cod.hz1bz,del_ms);
 831   3                          break;
 832   3                      default:
 833   3                          break;
 834   3                  }
 835   2                  break;
 836   2              case dir_right://è¦å»å³é¢
 837   2                  switch(str_begin.hzfx){
 838   3                      case dir_up://ç°åœ¨åœ¨å‰é¢
 839   3                          while(in_hz==1);
 840   3                          fun_delay(str_cod.hz1bz,del_ms);
 841   3                          break;
 842   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 843   3                          while(in_hz==1);
 844   3                          fun_delay(str_cod.hz1bz,del_ms);
 845   3                          break;
 846   3                      case dir_left://ç°åœ¨åœ¨å·¦é¢
 847   3                          while(in_hz==1);
 848   3                          while(in_hz==0);
 849   3                          while(in_hz==1);
 850   3                          fun_delay(str_cod.hz1bz,del_ms);
 851   3                          break;
 852   3                      default:
 853   3                          break;
 854   3                  }
 855   2                  break;
 856   2              default:
 857   2                  break;
 858   2          }//è·å–ç°åœ¨è¦å»çš„å›è½¬ä½ç½®
 859   1          fun_motors(mot_hz,0);//åœæ­¢å›è½¬åŠ¨ä½œ
 860   1          str_begin.hzfx=par_hzmodel;//å­˜å‚¨è¿è¡Œç»“æœ
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 15  

 861   1      }//å¹³ç§»å›è½¬åŒæ­¥è¿åŠ¨
 862          void fun_sjhz(enum varENU_tra par_sjmodel,enum varENU_dir par_hzmodel){
 863   1          ul loc_sjdelay=0;//å‡é™ä¸­é—´ä½å»¶æ—¶
 864   1          ul loc_hzdelay=0xFFFF;//å›è½¬å»¶æ—¶
 865   1          uc loc_sjcgq=0;//å‡é™ä¼ æ„Ÿå™¨æ£€æµ‹æ ‡å¿—ä½(0ä¸ºä¸åšå‡é™,1ä¸ºæœªåˆ°ä¼ æ„Ÿå™¨,2ä¸ºå·²åˆ°ä¼ æ„Ÿå
             -™¨)
 866   1          uc loc_hzcgq=0;//å›è½¬å‘¨æœŸæ ‡å¿—ä½(0ä¸ºä¸åš,1ä¸ºä¸€åœˆ,2ä¸ºä¸¤åœˆ)
 867   1          uc loc_hzflag=0;//å›è½¬ä¼ æ„Ÿå™¨æ ‡å¿—ä½
 868   1          if(par_hzmodel!=str_begin.hzfx){
 869   2              switch(par_hzmodel){
 870   3                  case dir_up://å›è½¬è‡³å‰æ–¹
 871   3                      switch(str_begin.hzfx){
 872   4                          case dir_down://ç°åœ¨åœ¨ä¸‹æ–¹
 873   4                              fun_motors(mot_hz,-100);//åè½¬
 874   4                              loc_hzcgq=2;//ä¿©å‘¨æœŸ
 875   4                              break;
 876   4                          case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 877   4                              fun_motors(mot_hz,100);//æ­£è½¬
 878   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
 879   4                              break;
 880   4                          case dir_right://ç°åœ¨åœ¨å³è¾¹
 881   4                              fun_motors(mot_hz,-100);//åè½¬
 882   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
 883   4                              break;
 884   4                          default:
 885   4                              break;
 886   4                      }
 887   3                      break;
 888   3                  case dir_down://è¦å»ä¸‹é¢
 889   3                      switch(str_begin.hzfx){
 890   4                          case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 891   4                              fun_motors(mot_hz,100);//æ­£è½¬
 892   4                              loc_hzcgq=2;//ä¿©å‘¨æœŸ
 893   4                              break;
 894   4                          case dir_left://ç°åœ¨åœ¨å·¦é¢
 895   4                              fun_motors(mot_hz,-100);//åè½¬
 896   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
 897   4                              break;
 898   4                          case dir_right://ç°åœ¨åœ¨å³é¢
 899   4                              fun_motors(mot_hz,100);//æ­£è½¬
 900   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
 901   4                              break;
 902   4                          default:
 903   4                              break;
 904   4                      }
 905   3                      break;
 906   3                  case dir_left://è¦å»å·¦è¾¹
 907   3                      switch(str_begin.hzfx){
 908   4                          case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 909   4                              fun_motors(mot_hz,-100);//åè½¬
 910   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
 911   4                              break;
 912   4                          case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 913   4                              fun_motors(mot_hz,100);//æ­£è½¬
 914   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
 915   4                              break;
 916   4                          case dir_right://ç°åœ¨åœ¨å³é¢
 917   4                              fun_motors(mot_hz,-100);//åè½¬
 918   4                              loc_hzcgq=2;//ä¿©å‘¨æœŸ
 919   4                              break;
 920   4                          default:
 921   4                              break;
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 16  

 922   4                      }
 923   3                      break;
 924   3                  case dir_right://è¦å»å³é¢
 925   3                      switch(str_begin.hzfx){
 926   4                          case dir_up://ç°åœ¨åœ¨å‰é¢
 927   4                              fun_motors(mot_hz,100);//æ­£è½¬
 928   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
 929   4                              break;
 930   4                          case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 931   4                              fun_motors(mot_hz,-100);//åè½¬
 932   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
 933   4                              break;
 934   4                          case dir_left://ç°åœ¨åœ¨å·¦é¢
 935   4                              fun_motors(mot_hz,100);//æ­£è½¬
 936   4                              loc_hzcgq=2;//ä¿©å‘¨æœŸ
 937   4                              break;
 938   4                          default:
 939   4                              break;
 940   4                      }
 941   3                      break;
 942   3                  default:
 943   3                      break;
 944   3              }//é€‰æ‹©éœ€è¦çš„è¿åŠ¨å‘¨æœŸ
 945   2              loc_hzdelay=var_timer+1000;//å›è½¬ä¼ æ„Ÿå™¨éš”1ç§’æ£€æµ‹
 946   2          }//å¯åŠ¨å›è½¬ç”µæœº
 947   1          if(par_sjmodel!=str_begin.sjwz){//å¦‚æœä¸åœ¨ä½
 948   2              fun_motors(mot_sj,par_sjmodel<str_begin.sjwz?100:-100);//é€šè¿‡é«˜åº¦è®¡ç®—å¹¶å¯åŠ¨æ­£åè½¬
 949   2              loc_sjcgq=1;//æ ‡å¿—ä½è®°å½•ä¸ºç­‰å¾…ä¼ æ„Ÿå™¨
 950   2          }//å¯åŠ¨å‡é™ç”µæœº
 951   1          while(str_begin.hzsd!=0||str_begin.sjsd!=0){//éé˜»å¡å‹Mainå‡½æ•°å¾ªç¯æ£€æµ‹
 952   2              if(loc_sjcgq==1){//å¦‚æœè¿˜æ²¡åˆ°ä¼ æ„Ÿå™¨
 953   3                  switch(par_sjmodel){
 954   4                      case sjp_1:
 955   4                          def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
 956   4                          fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
 957   4                          if(in_wz1==0){//å¦‚æœç¬¬ä¸€ä¸ªä¼ æ„Ÿå™¨æœ‰ä¿¡å·
 958   5                              loc_sjdelay=var_timer+str_cod.sj1bzw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡ç®—æ
             - ‡å‡†ä½å»¶æ—¶
 959   5                              loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
 960   5                          }
 961   4                          break;
 962   4                      case sjp_12:
 963   4                          def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
 964   4                          fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
 965   4                          if(str_begin.sjwz==sjp_1||in_wz2==0){//å¦‚æœå¼€å§‹çš„æ—¶å€™æ—¶åœ¨ä½ç½®1æˆ–å·²ç»åˆ°ä
             -º†ä½ç½®2
 966   5                              loc_sjdelay=var_timer+str_cod.sj1zjw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡ç®—ä
             -¸­é—´ä½å»¶æ—¶
 967   5                              loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
 968   5                          }
 969   4                          break;
 970   4                      case sjp_2:
 971   4                          def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
 972   4                          fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
 973   4                          if(in_wz2==0){//å¦‚æœç¬¬äºŒä¸ªä¼ æ„Ÿå™¨æœ‰ä¿¡å·
 974   5                              loc_sjdelay=var_timer+str_cod.sj1bzw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡ç®—æ
             - ‡å‡†ä½å»¶æ—¶
 975   5                              loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
 976   5                          }
 977   4                          break;
 978   4                      case sjp_23:
 979   4                          def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 17  

 980   4                          fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
 981   4                          if(in_wz2==0||in_wz3==0){//å¦‚æœå·²ç»åˆ°äº†ä½ç½®2æˆ–å·²ç»åˆ°äº†ä½ç½®3
 982   5                              loc_sjdelay=var_timer+str_cod.sj1zjw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡ç®—ä
             -¸­é—´ä½å»¶æ—¶
 983   5                              loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
 984   5                          }
 985   4                          break;
 986   4                      case sjp_3:
 987   4                          def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
 988   4                          fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
 989   4                          if(in_wz3==0){//å¦‚æœç¬¬ä¸‰ä¸ªä¼ æ„Ÿå™¨æœ‰ä¿¡å·
 990   5                              loc_sjdelay=var_timer+str_cod.sj1bzw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡ç®—æ
             - ‡å‡†ä½å»¶æ—¶
 991   5                              loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
 992   5                          }
 993   4                          break;
 994   4                      case sjp_34:
 995   4                          def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
 996   4                          fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
 997   4                          if(in_wz3==0||in_wz4==0){//å¦‚æœå·²ç»åˆ°äº†ä½ç½®3æˆ–å·²ç»åˆ°äº†ä½ç½®4
 998   5                              loc_sjdelay=var_timer+str_cod.sj1zjw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡ç®—ä
             -¸­é—´ä½å»¶æ—¶
 999   5                              loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1000   5                          }
1001   4                          break;
1002   4                      case sjp_4:
1003   4                          def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
1004   4                          fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1005   4                          if(in_wz4==0){//å¦‚æœç¬¬å››ä¸ªä¼ æ„Ÿå™¨æœ‰ä¿¡å·
1006   5                              loc_sjdelay=var_timer+str_cod.sj1bzw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡ç®—æ
             - ‡å‡†ä½å»¶æ—¶
1007   5                              loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1008   5                          }
1009   4                          break;
1010   4                      case sjp_45:
1011   4                          def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
1012   4                          fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1013   4                          if(in_wz4==0||str_begin.sjwz==sjp_5){//å¦‚æœå·²ç»åˆ°äº†ä½ç½®4æˆ–å¼€å§‹çš„æ—¶å€™æ—¶å
             -œ¨ä½ç½®5
1014   5                              loc_sjdelay=var_timer+str_cod.sj1zjw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡ç®—ä
             -¸­é—´ä½å»¶æ—¶
1015   5                              loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1016   5                          }
1017   4                          break;
1018   4                      case sjp_5:
1019   4                          def_select(sel_912);//ç‰‡é€‰912ä¼ æ„Ÿå™¨
1020   4                          fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1021   4                          if(in_wz5==0){//å¦‚æœç¬¬äº”ä¸ªä¼ æ„Ÿå™¨æœ‰ä¿¡å·
1022   5                              loc_sjdelay=var_timer+str_cod.sj1bzw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡ç®—æ
             - ‡å‡†ä½å»¶æ—¶
1023   5                              loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1024   5                          }
1025   4                          break;
1026   4                      default:
1027   4                          break;
1028   4                  }
1029   3              }
1030   2              else if(loc_sjcgq==2){//å¦‚æœå»¶æ—¶æ—¶é—´åˆ°
1031   3                  if(loc_sjdelay<=var_timer){
1032   4                      fun_motors(mot_sj,0);//åœæ­¢ç”µæœº
1033   4                      loc_sjcgq=0;//ä¸åšå‡é™äº†
1034   4                      str_begin.sjwz=par_sjmodel;//å­˜å‚¨è¿è¡Œç»“æœ
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 18  

1035   4                  }
1036   3              }//å·²ç»åˆ°äº†ä¼ æ„Ÿå™¨éœ€è¦å»¶æ—¶
1037   2              if(loc_hzdelay<=var_timer){//å¦‚æœ1ç§’å»¶æ—¶å·²ç»è¿‡å»
1038   3                  if(loc_hzcgq!=0){//å¦‚æœä¸æ˜¯è½¬0åœˆ
1039   4                      def_select(sel_912);//ä¼ æ„Ÿå™¨ç‰‡é€‰
1040   4                      fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1041   4                      if(in_hz==1){//å¦‚æœä¼ æ„Ÿå™¨æ²¡äº®
1042   5                          loc_hzflag=1;//æ ‡å¿—ä½å˜1
1043   5                      }
1044   4                      else if(loc_hzflag==1){//å¦‚æœæ ‡å¿—ä½ä¸º1ä¸”ä¼ æ„Ÿå™¨æœ‰ä¿¡å·
1045   5                          loc_hzcgq--;//ç®—ä¸€ä¸ªå‘¨æœŸå®Œæˆ
1046   5                          loc_hzflag=0;//æ ‡å¿—ä½å˜0
1047   5                      }
1048   4                  }
1049   3                  else{//å¦‚æœåœˆæ•°ä¸º0
1050   4                      fun_motors(mot_hz,0);//åœæ­¢ç”µæœº
1051   4                      loc_hzdelay=0xFFFF;//ä¸åšå›è½¬äº†
1052   4                      str_begin.hzfx=par_hzmodel;//å­˜å‚¨è¿è¡Œç»“æœ
1053   4                  }
1054   3              }
1055   2          }
1056   1      }//å‡é™å›è½¬åŒæ­¥è¿åŠ¨
1057          void fun_pysjhz(enum varENU_tra par_pymodel,enum varENU_tra par_sjmodel,enum varENU_dir par_hzmodel){
1058   1          ul loc_sjdelay=0;//å‡é™ä¸­é—´ä½å»¶æ—¶
1059   1          ul loc_hzdelay=0xFFFF;//å›è½¬å»¶æ—¶
1060   1          uc loc_sjcgq=0;//å‡é™ä¼ æ„Ÿå™¨æ£€æµ‹æ ‡å¿—ä½(0ä¸ºä¸åšå‡é™,1ä¸ºæœªåˆ°ä¼ æ„Ÿå™¨,2ä¸ºå·²åˆ°ä¼ æ„Ÿå
             -™¨)
1061   1          uc loc_hzcgq=0;//å›è½¬å‘¨æœŸæ ‡å¿—ä½(0ä¸ºä¸åš,1ä¸ºä¸€åœˆ,2ä¸ºä¸¤åœˆ)
1062   1          uc loc_hzflag=0;//å›è½¬ä¼ æ„Ÿå™¨æ ‡å¿—ä½
1063   1          idata bit loc_pyflag=0;//å¹³ç§»æ ‡å¿—ä½ä¸º0(æœªå®Œæˆ)
1064   1          if(par_hzmodel!=str_begin.hzfx){
1065   2              switch(par_hzmodel){
1066   3                  case dir_up://å›è½¬è‡³å‰æ–¹
1067   3                      switch(str_begin.hzfx){
1068   4                          case dir_down://ç°åœ¨åœ¨ä¸‹æ–¹
1069   4                              fun_motors(mot_hz,-100);//åè½¬
1070   4                              loc_hzcgq=2;//ä¿©å‘¨æœŸ
1071   4                              break;
1072   4                          case dir_left://ç°åœ¨åœ¨å·¦è¾¹
1073   4                              fun_motors(mot_hz,100);//æ­£è½¬
1074   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
1075   4                              break;
1076   4                          case dir_right://ç°åœ¨åœ¨å³è¾¹
1077   4                              fun_motors(mot_hz,-100);//åè½¬
1078   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
1079   4                              break;
1080   4                          default:
1081   4                              break;
1082   4                      }
1083   3                      break;
1084   3                  case dir_down://è¦å»ä¸‹é¢
1085   3                      switch(str_begin.hzfx){
1086   4                          case dir_up://ç°åœ¨åœ¨ä¸Šé¢
1087   4                              fun_motors(mot_hz,100);//æ­£è½¬
1088   4                              loc_hzcgq=2;//ä¿©å‘¨æœŸ
1089   4                              break;
1090   4                          case dir_left://ç°åœ¨åœ¨å·¦é¢
1091   4                              fun_motors(mot_hz,-100);//åè½¬
1092   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
1093   4                              break;
1094   4                          case dir_right://ç°åœ¨åœ¨å³é¢
1095   4                              fun_motors(mot_hz,100);//æ­£è½¬
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 19  

1096   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
1097   4                              break;
1098   4                          default:
1099   4                              break;
1100   4                      }
1101   3                      break;
1102   3                  case dir_left://è¦å»å·¦è¾¹
1103   3                      switch(str_begin.hzfx){
1104   4                          case dir_up://ç°åœ¨åœ¨ä¸Šé¢
1105   4                              fun_motors(mot_hz,-100);//åè½¬
1106   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
1107   4                              break;
1108   4                          case dir_down://ç°åœ¨åœ¨ä¸‹é¢
1109   4                              fun_motors(mot_hz,100);//æ­£è½¬
1110   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
1111   4                              break;
1112   4                          case dir_right://ç°åœ¨åœ¨å³é¢
1113   4                              fun_motors(mot_hz,-100);//åè½¬
1114   4                              loc_hzcgq=2;//ä¿©å‘¨æœŸ
1115   4                              break;
1116   4                          default:
1117   4                              break;
1118   4                      }
1119   3                      break;
1120   3                  case dir_right://è¦å»å³é¢
1121   3                      switch(str_begin.hzfx){
1122   4                          case dir_up://ç°åœ¨åœ¨å‰é¢
1123   4                              fun_motors(mot_hz,100);//æ­£è½¬
1124   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
1125   4                              break;
1126   4                          case dir_down://ç°åœ¨åœ¨ä¸‹é¢
1127   4                              fun_motors(mot_hz,-100);//åè½¬
1128   4                              loc_hzcgq=1;//ä¸€ä¸ªå‘¨æœŸ
1129   4                              break;
1130   4                          case dir_left://ç°åœ¨åœ¨å·¦é¢
1131   4                              fun_motors(mot_hz,100);//æ­£è½¬
1132   4                              loc_hzcgq=2;//ä¿©å‘¨æœŸ
1133   4                              break;
1134   4                          default:
1135   4                              break;
1136   4                      }
1137   3                      break;
1138   3                  default:
1139   3                      break;
1140   3              }//é€‰æ‹©éœ€è¦çš„è¿åŠ¨å‘¨æœŸ
1141   2              loc_hzdelay=var_timer+1000;//å›è½¬ä¼ æ„Ÿå™¨éš”1ç§’æ£€æµ‹
1142   2          }//å¯åŠ¨å›è½¬ç”µæœº
1143   1          if(par_sjmodel!=str_begin.sjwz){//å¦‚æœä¸åœ¨ä½
1144   2              fun_motors(mot_sj,par_sjmodel<str_begin.sjwz?100:-100);//é€šè¿‡é«˜åº¦è®¡ç®—å¹¶å¯åŠ¨æ­£åè½¬
1145   2              loc_sjcgq=1;//æ ‡å¿—ä½è®°å½•ä¸ºç­‰å¾…ä¼ æ„Ÿå™¨
1146   2          }//å¯åŠ¨å‡é™ç”µæœº
1147   1          while(str_begin.hzsd!=0||str_begin.sjsd!=0||loc_sjcgq!=0){//éé˜»å¡å‹Mainå‡½æ•°å¾ªç¯æ£€æµ‹
1148   2              switch(loc_sjcgq){
1149   3                  case 1://å¦‚æœè¿˜éœ€ç­‰å¾…ä¼ æ„Ÿå™¨
1150   3                      switch(par_sjmodel){
1151   4                          case sjp_1:
1152   4                              def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
1153   4                              fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1154   4                              if(in_wz1==0){//å¦‚æœç¬¬ä¸€ä¸ªä¼ æ„Ÿå™¨æœ‰ä¿¡å·
1155   5                                  loc_sjdelay=var_timer+str_cod.sj1bzw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡
             -ç®—æ ‡å‡†ä½å»¶æ—¶
1156   5                                  loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 20  

1157   5                              }
1158   4                              break;
1159   4                          case sjp_12:
1160   4                              def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
1161   4                              fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1162   4                              if(str_begin.sjwz==sjp_1||in_wz2==0){//å¦‚æœå¼€å§‹çš„æ—¶å€™æ—¶åœ¨ä½ç½®1æˆ–å·²ç»
             -åˆ°äº†ä½ç½®2
1163   5                                  loc_sjdelay=var_timer+str_cod.sj1zjw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡
             -ç®—ä¸­é—´ä½å»¶æ—¶
1164   5                                  loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1165   5                              }
1166   4                              break;
1167   4                          case sjp_2:
1168   4                              def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
1169   4                              fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1170   4                              if(in_wz2==0){//å¦‚æœç¬¬äºŒä¸ªä¼ æ„Ÿå™¨æœ‰ä¿¡å·
1171   5                                  loc_sjdelay=var_timer+str_cod.sj1bzw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡
             -ç®—æ ‡å‡†ä½å»¶æ—¶
1172   5                                  loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1173   5                              }
1174   4                              break;
1175   4                          case sjp_23:
1176   4                              def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
1177   4                              fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1178   4                              if(in_wz2==0||in_wz3==0){//å¦‚æœå·²ç»åˆ°äº†ä½ç½®2æˆ–å·²ç»åˆ°äº†ä½ç½®3
1179   5                                  loc_sjdelay=var_timer+str_cod.sj1zjw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡
             -ç®—ä¸­é—´ä½å»¶æ—¶
1180   5                                  loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1181   5                              }
1182   4                              break;
1183   4                          case sjp_3:
1184   4                              def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
1185   4                              fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1186   4                              if(in_wz3==0){//å¦‚æœç¬¬ä¸‰ä¸ªä¼ æ„Ÿå™¨æœ‰ä¿¡å·
1187   5                                  loc_sjdelay=var_timer+str_cod.sj1bzw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡
             -ç®—æ ‡å‡†ä½å»¶æ—¶
1188   5                                  loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1189   5                              }
1190   4                              break;
1191   4                          case sjp_34:
1192   4                              def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
1193   4                              fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1194   4                              if(in_wz3==0||in_wz4==0){//å¦‚æœå·²ç»åˆ°äº†ä½ç½®3æˆ–å·²ç»åˆ°äº†ä½ç½®4
1195   5                                  loc_sjdelay=var_timer+str_cod.sj1zjw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡
             -ç®—ä¸­é—´ä½å»¶æ—¶
1196   5                                  loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1197   5                              }
1198   4                              break;
1199   4                          case sjp_4:
1200   4                              def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
1201   4                              fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1202   4                              if(in_wz4==0){//å¦‚æœç¬¬å››ä¸ªä¼ æ„Ÿå™¨æœ‰ä¿¡å·
1203   5                                  loc_sjdelay=var_timer+str_cod.sj1bzw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡
             -ç®—æ ‡å‡†ä½å»¶æ—¶
1204   5                                  loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1205   5                              }
1206   4                              break;
1207   4                          case sjp_45:
1208   4                              def_select(sel_58);//ç‰‡é€‰58ä¼ æ„Ÿå™¨
1209   4                              fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1210   4                              if(in_wz4==0||str_begin.sjwz==sjp_5){//å¦‚æœå·²ç»åˆ°äº†ä½ç½®4æˆ–å¼€å§‹çš„æ—¶å€™
             -æ—¶åœ¨ä½ç½®5
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 21  

1211   5                                  loc_sjdelay=var_timer+str_cod.sj1zjw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡
             -ç®—ä¸­é—´ä½å»¶æ—¶
1212   5                                  loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1213   5                              }
1214   4                              break;
1215   4                          case sjp_5:
1216   4                              def_select(sel_912);//ç‰‡é€‰912ä¼ æ„Ÿå™¨
1217   4                              fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1218   4                              if(in_wz5==0){//å¦‚æœç¬¬äº”ä¸ªä¼ æ„Ÿå™¨æœ‰ä¿¡å·
1219   5                                  loc_sjdelay=var_timer+str_cod.sj1bzw;//é€šè¿‡å®šæ—¶å™¨å…¨å±€æ—¶é—´æ ‡å¿—ä½è®¡
             -ç®—æ ‡å‡†ä½å»¶æ—¶
1220   5                                  loc_sjcgq=2;//æ ‡å¿—ä½è®°å½•å·²åˆ°ä¼ æ„Ÿå™¨
1221   5                              }
1222   4                              break;
1223   4                          default:
1224   4                              break;
1225   4                      }
1226   3                      break;
1227   3                  case 2://å¦‚æœå»¶æ—¶æ—¶é—´åˆ°
1228   3                      if(loc_sjdelay<=var_timer){
1229   4                          fun_motors(mot_sj,0);//åœæ­¢ç”µæœº
1230   4                          loc_sjcgq=0;//ä¸åšå‡é™äº†
1231   4                          loc_sjcgq=3;//å‡†å¤‡å¯åŠ¨å¹³ç§»
1232   4                          str_begin.sjwz=par_sjmodel;//å­˜å‚¨è¿è¡Œç»“æœ
1233   4                      }
1234   3                      break;
1235   3                  case 3://å·²ç»åˆ°äº†ä¼ æ„Ÿå™¨éœ€è¦å¹³ç§»
1236   3                      if(par_pymodel==tra_h)
1237   3                          fun_motors(mot_py,-100);
1238   3                      else if(par_pymodel==tra_q)
1239   3                          fun_motors(mot_py,100);
1240   3                      loc_sjcgq=4;//å‡†å¤‡æ£€æµ‹å¹³ç§»
1241   3                      break;
1242   3                  case 4://å¯åŠ¨å¹³ç§»ç”µæœºå®Œæ¯•
1243   3                      if(par_pymodel==tra_h&&in_hpy==0){
1244   4                          loc_sjdelay=var_timer+str_cod.py1bz;
1245   4                          loc_sjcgq=5;//å‡†å¤‡æ£€æµ‹å¹³ç§»å»¶æ—¶
1246   4                      }
1247   3                      if(par_pymodel==tra_q&&in_qpy==0){
1248   4                          loc_sjdelay=var_timer+str_cod.py1bz;
1249   4                          loc_sjcgq=5;//å‡†å¤‡æ£€æµ‹å¹³ç§»å»¶æ—¶
1250   4                      }
1251   3                      break;
1252   3                  case 5:
1253   3                      if(loc_sjdelay<=var_timer){
1254   4                          fun_motors(mot_py,0);//åœæ­¢ç”µæœº
1255   4                          loc_sjcgq=0;//ä¸åšå‡é™å¹³ç§»äº†
1256   4                          str_begin.pywz=par_pymodel;//å­˜å‚¨è¿è¡Œç»“æœ
1257   4                      }
1258   3                      break;
1259   3                  default:
1260   3                      break;
1261   3              }
1262   2              if(loc_hzdelay<=var_timer){//å¦‚æœ1ç§’å»¶æ—¶å·²ç»è¿‡å»
1263   3                  if(loc_hzcgq!=0){//å¦‚æœä¸æ˜¯è½¬0åœˆ
1264   4                      def_select(sel_912);//ä¼ æ„Ÿå™¨ç‰‡é€‰
1265   4                      fun_delay(20,del_us);//å»¶æ—¶20us,ç»™ç‰‡é€‰èŠ¯ç‰‡ä¸€æ®µæ—¶é—´åˆ‡æ¢
1266   4                      if(in_hz==1){//å¦‚æœä¼ æ„Ÿå™¨æ²¡äº®
1267   5                          loc_hzflag=1;//æ ‡å¿—ä½å˜1
1268   5                      }
1269   4                      else if(loc_hzflag==1){//å¦‚æœæ ‡å¿—ä½ä¸º1ä¸”ä¼ æ„Ÿå™¨æœ‰ä¿¡å·
1270   5                          loc_hzcgq--;//ç®—ä¸€ä¸ªå‘¨æœŸå®Œæˆ
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 22  

1271   5                          loc_hzflag=0;//æ ‡å¿—ä½å˜0
1272   5                      }
1273   4                  }
1274   3                  else{//å¦‚æœåœˆæ•°ä¸º0
1275   4                      fun_motors(mot_hz,0);//åœæ­¢ç”µæœº
1276   4                      loc_hzdelay=0xFFFF;//ä¸åšå›è½¬äº†
1277   4                      str_begin.hzfx=par_hzmodel;//å­˜å‚¨è¿è¡Œç»“æœ
1278   4                  }
1279   3              }
1280   2          }
1281   1      }//å¹³ç§»å‡é™å›è½¬åŒæ­¥è¿åŠ¨(å…ˆå‡é™å›è½¬,å†å¹³ç§»å›è½¬)
1282          void fun_jtjp(){
1283   1          while(1){//å¾ªç¯çº å
1284   2              if((!in_ls1&&!in_ls2&&in_ls4&&in_ls5&&!in_ls7&&!in_ls8)&&((in_ls3&&in_ls6)||(!in_ls3&&!in_ls6))){/
             -/1278ä¸äº®,45äº®,36è¦ä¹ˆä¸€èµ·äº®è¦ä¹ˆä¸€èµ·ç­
1285   3                  fun_delay(10,del_ms);
1286   3                  fun_motors(mot_rl,0);
1287   3                  return;
1288   3              }
1289   2              if(!in_ls4){//4ä¸äº®
1290   3                  fun_motors(mot_l,12);
1291   3                  fun_motors(mot_r,-12);
1292   3              }
1293   2              else if(!in_ls5){//4äº®5ä¸äº®
1294   3                  fun_motors(mot_l,-12);
1295   3                  fun_motors(mot_r,12);
1296   3              }
1297   2              if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
1298   3                  fun_motors(mot_l,8);
1299   3                  fun_motors(mot_r,-8);
1300   3              }
1301   2              else if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
1302   3                  fun_motors(mot_l,-8);
1303   3                  fun_motors(mot_r,8);
1304   3              }
1305   2              if(in_ls2||in_ls1){//12äº®
1306   3                  fun_motors(mot_l,-16);
1307   3                  fun_motors(mot_r,16);
1308   3              }
1309   2              else if(in_ls7||in_ls8){//78äº®
1310   3                  fun_motors(mot_l,16);
1311   3                  fun_motors(mot_r,-16);
1312   3              }
1313   2              fun_delay(100,del_ms);
1314   2          }
1315   1      }//é™æ€çº å
1316          void fun_timermove(){
1317   1          static data uc loc_con=0;//éœ€è¦åˆ†æ­¥åšçš„åŠ¨ä½œéœ€è¦ç”¨åˆ°æ­¤é™æ€ç§æœ‰åˆ†æ­¥æ ‡å¿—ä½
1318   1          data int loc_sdl,loc_sdr;//å·¦è½®é€Ÿåº¦å’Œå³è½®é€Ÿåº¦çš„å±€éƒ¨å˜é‡
1319   1          switch(*str_tfl.run){//é€‰æ‹©è¿è¡Œæ–¹å¼
1320   2              case def_end://è¿è¡Œç»“æŸ
1321   2                  fun_motorsrl(mot_rl,0);//å†æ¬¡åœæ­¢ç”µæœºè¿åŠ¨
1322   2                  str_tfl.doing=tf_false;//ç§»åŠ¨ç»“æŸ
1323   2                  memset(str_tfl.step,0,sizeof(str_tfl.step));//æ¸…ç©ºstepæ•°ç»„
1324   2                  str_tfl.run=str_tfl.step;//æŒ‡é’ˆæŒ‡å‘stepçš„ç¬¬ä¸€ä¸ªå…ƒç´ 
1325   2                  break;
1326   2              case tfl_line://è¿è¡Œå·¡çº¿
1327   2                  if(*(str_tfl.run+1)){//å¦‚æœå‚æ•°ä¸ºé0æ•°
1328   3                      if((in_ls1||in_ls8)&&(in_ls2&&in_ls3&&in_ls4&&in_ls5&in_ls6&&in_ls7)){//å¦‚æœä¸­é—´6ä¸ªç
             -¯å…¨äº®,å·¦å³äº®ä»»æ„ä¸€ä¸ª
1329   4                          str_tfl.online=tf_ture;//æ ‡å¿—ä½è®°å½•åœ¨çº¿
1330   4                          fun_motorsrl(mot_rl,str_tfl.gospeed);//æŒ‰ç…§å¸¸è§„é€Ÿåº¦è¿‡çº¿
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 23  

1331   4                      }
1332   3                      else if(str_tfl.online==tf_ture){//å¦‚æœæ ‡å¿—ä½è®°å½•åœ¨çº¿,è€Œä¸”ä¸ç¬¦åˆåœ¨çº¿ç‰¹å¾
1333   4                          str_tfl.online=tf_false;//æ ‡å¿—ä½è®°å½•ä¸åœ¨çº¿
1334   4                          (*(str_tfl.run+1))--;//å‚æ•°å€¼å‡1,è®°å½•å·²ç»èµ°äº†ä¸€æ¡çº¿
1335   4                      }
1336   3                      else{
1337   4                          //ç¬¬ä¸‰ç‰ˆçº åç®—æ³•
1338   4                          loc_sdl=loc_sdr=str_tfl.gospeed;//å·¡çº¿é€Ÿåº¦ä¸ºstr_tfl.gospeed
1339   4                          if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
1340   5                              loc_sdl-=(loc_sdl+21)/10;
1341   5                              loc_sdr+=(99-loc_sdr)/10;
1342   5                          }//å‘å·¦è½¬
1343   4                          if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
1344   5                              loc_sdl+=(99-loc_sdl)/10;
1345   5                              loc_sdr-=(loc_sdr+21)/10;
1346   5                          }//å‘å³è½¬
1347   4                          if(in_ls2&&!in_ls7){//2äº®7ä¸äº®
1348   5                              loc_sdl-=(loc_sdl+21)*3/10;
1349   5                              loc_sdr+=(99-loc_sdr)*3/10;
1350   5                          }//å‘å·¦è½¬
1351   4                          if(in_ls7&&!in_ls2){//7äº®2ä¸äº®
1352   5                              loc_sdl+=(99-loc_sdl)*3/10;
1353   5                              loc_sdr-=(loc_sdr+21)*3/10;
1354   5                          }//å‘å³è½¬
1355   4                          if(in_ls1&&!in_ls8){//1äº®8ä¸äº®
1356   5                              loc_sdl-=(loc_sdl+21)*5/10;
1357   5                              loc_sdr+=(99-loc_sdr)*5/10;
1358   5                          }//å‘å·¦è½¬
1359   4                          if(in_ls8&&!in_ls1){//8äº®1ä¸äº®
1360   5                              loc_sdl+=(99-loc_sdl)*5/10;
1361   5                              loc_sdr-=(loc_sdr+21)*5/10;
1362   5                          }//å‘å³è½¬
1363   4                          fun_motorsrl(mot_r,loc_sdr);
1364   4                          fun_motorsrl(mot_l,loc_sdl);
1365   4                      }
1366   3                  }
1367   2                  else{//å¦‚æœçº¿èµ°å®Œäº†
1368   3                      str_tfl.run+=2;//æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ç»„è¿‡ç¨‹
1369   3                      fun_motorsrl(mot_rl,0);//åœæ­¢ç”µæœºè¿åŠ¨
1370   3                  }
1371   2                  break;
1372   2              case tfl_turn://è¿è¡Œè½¬å¼¯
1373   2                  switch(loc_con){//åˆ†æ­¥è¿è¡Œæ ‡å¿—ä½
1374   3                      case 0://ç¬¬ä¸€æ­¥
1375   3                          switch(*(str_tfl.run+1)){//è·å–å‚æ•°
1376   4                              case tur_r90://å³è½¬90
1377   4                                  fun_motorsrl(mot_l,str_tfl.turnspeed);//å·¦è½®å‘å‰
1378   4                                  fun_motorsrl(mot_r,-str_tfl.turnspeed);//å³è½®å‘å
1379   4                                  str_tfl.delay=var_timer+str_cod.timerturn90;//è®¡æ—¶
1380   4                                  break;
1381   4                              case tur_l90://å·¦è½¬90
1382   4                                  fun_motorsrl(mot_l,-str_tfl.turnspeed);//å·¦è½®å‘å
1383   4                                  fun_motorsrl(mot_r,str_tfl.turnspeed);//å³è½®å‘å‰
1384   4                                  str_tfl.delay=var_timer+str_cod.timerturn90;//è®¡æ—¶
1385   4                                  break;
1386   4                              case tur_r180://å³è½¬180
1387   4                                  fun_motorsrl(mot_l,str_tfl.turnspeed);//å·¦è½®å‘å‰
1388   4                                  fun_motorsrl(mot_r,-str_tfl.turnspeed);//å³è½®å‘å
1389   4                                  str_tfl.delay=var_timer+str_cod.timerturn180;//è®¡æ—¶
1390   4                                  break;
1391   4                              case tur_l180://å·¦è½¬180
1392   4                                  fun_motorsrl(mot_l,-str_tfl.turnspeed);//å·¦è½®å‘å
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 24  

1393   4                                  fun_motorsrl(mot_r,str_tfl.turnspeed);//å·¦è½®å‘å‰
1394   4                                  str_tfl.delay=var_timer+str_cod.timerturn180;//è®¡æ—¶
1395   4                                  break;
1396   4                          }
1397   3                          loc_con++;//æ‰§è¡Œä¸‹ä¸€æ­¥
1398   3                          break;
1399   3                      case 1://ç¬¬äºŒæ­¥
1400   3                          if(str_tfl.delay<=var_timer)//è®¡æ—¶æ—¶é—´åˆ°
1401   3                              loc_con++;//æ‰§è¡Œä¸‹ä¸€æ­¥
1402   3                          break;
1403   3                      case 2://ç¬¬ä¸‰æ­¥
1404   3                          if(in_ls3||in_ls6){//å¦‚æœ3äº®æˆ–6äº®
1405   4                              fun_motorsrl(mot_rl,0);//åœæ­¢ç”µæœº
1406   4                              str_tfl.run+=2;//æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ç»„è¿‡ç¨‹
1407   4                              str_tfl.delay=0;//å»¶æ—¶è®¡æ•°å™¨å½’é›¶
1408   4                              loc_con=0;//åˆ†æ­¥è¿è¡Œæ ‡å¿—ä½å½’é›¶
1409   4                          }
1410   3                          break;
1411   3                  }
1412   2                  break;
1413   2              case tfl_cache://è¿è¡Œå‰å†²
1414   2                  switch(loc_con){
1415   3                      case 0://ç¬¬ä¸€æ­¥
1416   3                          str_tfl.delay=var_timer+((*(str_tfl.run+1))*10);//å»¶æ—¶æ—¶é—´(æ¯«ç§’)ä¸ºå‚æ•°çš„10å€
             -
1417   3                          loc_con++;//æ‰§è¡Œä¸‹ä¸€æ­¥
1418   3                          break;
1419   3                      case 1://ç¬¬äºŒæ­¥
1420   3                          if(str_tfl.delay<=var_timer){//è®¡æ—¶æ—¶é—´åˆ°
1421   4                              fun_motorsrl(mot_rl,0);//åœæ­¢ç”µæœº
1422   4                              str_tfl.run+=2;//æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ç»„è¿‡ç¨‹
1423   4                              str_tfl.delay=0;//å»¶æ—¶è®¡æ•°å™¨å½’é›¶
1424   4                              loc_con=0;//åˆ†æ­¥è¿è¡Œæ ‡å¿—ä½å½’é›¶
1425   4                          }
1426   3                          else{
1427   4                              loc_sdl=loc_sdr=str_tfl.cachespeed;//å‰å†²é€Ÿåº¦ä¸ºstr_tfl.cachespeed
1428   4                              if(in_ls1&&!in_ls8){//1äº®8ä¸äº®
1429   5                                  loc_sdl*=0.7;//å·¦å‡é€Ÿ
1430   5                                  loc_sdr*=1.3;//å³åŠ é€Ÿ
1431   5                              }//å‘å·¦è½¬
1432   4                              if(in_ls8&&!in_ls1){//8äº®1ä¸äº®
1433   5                                  loc_sdl*=1.3;//å·¦åŠ é€Ÿ
1434   5                                  loc_sdr*=0.7;//å³å‡é€Ÿ
1435   5                              }//å‘å³è½¬
1436   4                              if(in_ls2&&!in_ls7){//2äº®7ä¸äº®
1437   5                                  loc_sdl*=0.8;//å·¦å‡é€Ÿ
1438   5                                  loc_sdr*=1.2;//å³åŠ é€Ÿ
1439   5                              }//å‘å·¦è½¬
1440   4                              if(in_ls7&&!in_ls2){//7äº®2ä¸äº®
1441   5                                  loc_sdl*=1.2;//å·¦åŠ é€Ÿ
1442   5                                  loc_sdr*=0.8;//å³å‡é€Ÿ
1443   5                              }//å‘å³è½¬
1444   4                              if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
1445   5                                  loc_sdl*=0.9;//å·¦å‡é€Ÿ
1446   5                                  loc_sdr*=1.1;//å³åŠ é€Ÿ
1447   5                              }//å‘å·¦è½¬
1448   4                              if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
1449   5                                  loc_sdl*=1.1;//å·¦åŠ é€Ÿ
1450   5                                  loc_sdr*=0.9;//å³å‡é€Ÿ
1451   5                              }//å‘å³è½¬
1452   4                              fun_motorsrl(mot_r,loc_sdr);
1453   4                              fun_motorsrl(mot_l,loc_sdl);
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 25  

1454   4                          }
1455   3                          break;
1456   3                  }
1457   2                  break;
1458   2              default:
1459   2                  break;
1460   2          }
1461   1      }//å®šæ—¶å™¨ç§»åŠ¨
1462          void fun_flsetting(char par_gospeed,char par_turnspeed,char par_cachespeed,...){
1463   1          va_list loc_argp;//ä¿å­˜å‚æ•°ç»“æ„
1464   1          uc loc_step=0;//å¾ªç¯stepæ•°ç»„ç”¨çš„ä¸œè¥¿
1465   1          uc loc_con;//å½“å‰å‚æ•°
1466   1          va_start(loc_argp,par_cachespeed);//loc_argpæŒ‡å‘ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå¯é€‰å‚æ•°,par_cachespeedæ˜¯æœ€å
             -ä¸€ä¸ªç¡®å®šçš„å‚æ•°
1467   1          loc_con=va_arg(loc_argp,char);//å–å‡ºç¬¬ä¸€ä¸ªå‚æ•°
1468   1          while(loc_con!=def_end){
1469   2              str_tfl.step[loc_step++]=loc_con;//æŠŠç»™stepæ•°ç»„,æ ‡å¿—ä½+1
1470   2              loc_con=va_arg(loc_argp,char);//å–å‡ºä¸‹ä¸€ä¸ªå‚æ•°
1471   2          }
1472   1          str_tfl.step[loc_step]=def_end;//stepæ•°ç»„ç»“æŸæ ‡å¿—ä½
1473   1          va_end(loc_argp);//ç»“æŸ
1474   1      
1475   1          str_tfl.online=tf_false;//ä¸åœ¨çº¿
1476   1          str_tfl.run=str_tfl.step;//æŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªæ•°ç»„
1477   1          str_tfl.gospeed=par_gospeed;//é»˜è®¤é€Ÿåº¦
1478   1          str_tfl.turnspeed=par_turnspeed;//æ‹å¼¯é€Ÿåº¦
1479   1          str_tfl.cachespeed=par_cachespeed;//å‰å†²é€Ÿåº¦
1480   1          str_tfl.doing=tf_ture;//å¼€å§‹åš
1481   1      }//ä¸»å‡½æ•°ç”¨å®šæ—¶å™¨å·¡çº¿è°ƒç”¨å‡½æ•°
1482          void fun_folline(uc par_con,uc par_speed){
1483   1          uc loc_con=par_con;//å·¡çº¿æ¡æ•°æ ‡å¿—ä½
1484   1          uc loc_sdr,loc_sdl;//å·¦å³è½®é€Ÿåº¦
1485   1          uc loc_online;//åœ¨çº¿æ ‡å¿—ä½
1486   1          while(loc_con){
1487   2              if((in_ls1||in_ls8)&&(in_ls2&&in_ls3&&in_ls4&&in_ls5&in_ls6&&in_ls7)){//å¦‚æœä¸­é—´6ä¸ªç¯å…¨äº®,
             -å·¦å³äº®ä»»æ„ä¸€ä¸ª
1488   3                  loc_online=tf_ture;//æ ‡å¿—ä½è®°å½•åœ¨çº¿
1489   3                  fun_motors(mot_rl,par_speed);//æŒ‰ç…§å¸¸è§„é€Ÿåº¦è¿‡çº¿
1490   3              }
1491   2              else if(loc_online==tf_ture){//å¦‚æœæ ‡å¿—ä½è®°å½•åœ¨çº¿,è€Œä¸”ä¸ç¬¦åˆåœ¨çº¿ç‰¹å¾
1492   3                  loc_online=tf_false;//æ ‡å¿—ä½è®°å½•ä¸åœ¨çº¿
1493   3                  loc_con--;//å‚æ•°å€¼å‡1,è®°å½•å·²ç»èµ°äº†ä¸€æ¡çº¿
1494   3              }
1495   2              else{
1496   3                  //ç¬¬äºŒç‰ˆçº åç®—æ³•
1497   3                  loc_sdr=loc_sdl=par_speed;
1498   3                  if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
1499   4                      loc_sdl-=loc_sdl/10;
1500   4                      loc_sdr+=(100-loc_sdr)/10;
1501   4                  }//å‘å·¦è½¬
1502   3                  if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
1503   4                      loc_sdl+=(100-loc_sdl)/10;
1504   4                      loc_sdr-=loc_sdr/10;
1505   4                  }//å‘å³è½¬
1506   3                  if(in_ls2&&!in_ls7){//2äº®7ä¸äº®
1507   4                      loc_sdl-=loc_sdl/10*3;
1508   4                      loc_sdr+=(100-loc_sdr)/10*3;
1509   4                  }//å‘å·¦è½¬
1510   3                  if(in_ls7&&!in_ls2){//7äº®2ä¸äº®
1511   4                      loc_sdl+=(100-loc_sdl)/10*3;
1512   4                      loc_sdr-=loc_sdr/10*3;
1513   4                  }//å‘å³è½¬
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 26  

1514   3                  if(in_ls1&&!in_ls8){//1äº®8ä¸äº®
1515   4                      loc_sdl-=loc_sdl/10*5;
1516   4                      loc_sdr+=(100-loc_sdr)/10*5;
1517   4                  }//å‘å·¦è½¬
1518   3                  if(in_ls8&&!in_ls1){//8äº®1ä¸äº®
1519   4                      loc_sdl+=(100-loc_sdl)/10*5;
1520   4                      loc_sdr-=loc_sdr/10*5;
1521   4                  }//å‘å³è½¬
1522   3                  fun_motors(mot_r,loc_sdr);
1523   3                  fun_motors(mot_l,loc_sdl);
1524   3                  fun_delay(1,del_ms);
1525   3              }
1526   2          }//å¦‚æœå·¡çº¿æ¡æ•°ä¸ä¸º0
1527   1          fun_qc(40,40);//å‰å†²
1528   1      }//ä¸»å‡½æ•°å·¡çº¿
1529          void fun_turn(enum varENU_tur par_model,uc par_speed){
1530   1          switch(par_model){//è·å–å‚æ•°
1531   2              case tur_r90://å³è½¬90
1532   2                  fun_motors(mot_l,par_speed);//å·¦è½®å‘å‰
1533   2                  fun_motors(mot_r,-par_speed);//å³è½®å‘å
1534   2                  fun_delay(str_cod.mainturn90,del_ms);//è®¡æ—¶
1535   2                  break;
1536   2              case tur_l90://å·¦è½¬90
1537   2                  fun_motors(mot_l,-par_speed);//å·¦è½®å‘å
1538   2                  fun_motors(mot_r,par_speed);//å³è½®å‘å‰
1539   2                  fun_delay(str_cod.mainturn90,del_ms);//è®¡æ—¶
1540   2                  break;
1541   2              case tur_r180://å³è½¬180
1542   2                  fun_motors(mot_l,par_speed);//å·¦è½®å‘å‰
1543   2                  fun_motors(mot_r,-par_speed);//å³è½®å‘å
1544   2                  fun_delay(str_cod.mainturn180,del_ms);//è®¡æ—¶
1545   2                  break;
1546   2              case tur_l180://å·¦è½¬180
1547   2                  fun_motors(mot_l,-par_speed);//å·¦è½®å‘å
1548   2                  fun_motors(mot_r,par_speed);//å·¦è½®å‘å‰
1549   2                  fun_delay(str_cod.mainturn180,del_ms);//è®¡æ—¶
1550   2                  break;
1551   2          }
1552   1          while(in_ls3||in_ls6);//3äº®æˆ–è€…6äº®
1553   1          fun_motors(mot_rl,0);//åœæ­¢ç”µæœº
1554   1      }//ä¸»å‡½æ•°è½¬å¼¯
1555          void fun_qc(uc par_time,uc par_speed){
1556   1          uc loc_sdr,loc_sdl;//å·¦å³è½®é€Ÿåº¦
1557   1          str_tfl.delay=var_timer+par_time*10;//å»¶æ—¶æ—¶é—´(æ¯«ç§’)ä¸ºå‚æ•°çš„10å€
1558   1          while(str_tfl.delay>var_timer){
1559   2              //ç¬¬ä¸€ç‰ˆçº åç®—æ³•
1560   2              loc_sdr=loc_sdl=par_speed;
1561   2              if(in_ls1&&!in_ls8){//1äº®8ä¸äº®
1562   3                  loc_sdl*=0.7;//å·¦å‡é€Ÿ
1563   3                  loc_sdr*=1.3;//å³åŠ é€Ÿ
1564   3              }//å‘å·¦è½¬
1565   2              if(in_ls8&&!in_ls1){//8äº®1ä¸äº®
1566   3                  loc_sdl*=1.3;//å·¦åŠ é€Ÿ
1567   3                  loc_sdr*=0.7;//å³å‡é€Ÿ
1568   3              }//å‘å³è½¬
1569   2              if(in_ls2&&!in_ls7){//2äº®7ä¸äº®
1570   3                  loc_sdl*=0.8;//å·¦å‡é€Ÿ
1571   3                  loc_sdr*=1.2;//å³åŠ é€Ÿ
1572   3              }//å‘å·¦è½¬
1573   2              if(in_ls7&&!in_ls2){//7äº®2ä¸äº®
1574   3                  loc_sdl*=1.2;//å·¦åŠ é€Ÿ
1575   3                  loc_sdr*=0.8;//å³å‡é€Ÿ
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 27  

1576   3              }//å‘å³è½¬
1577   2              if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
1578   3                  loc_sdl*=0.9;//å·¦å‡é€Ÿ
1579   3                  loc_sdr*=1.1;//å³åŠ é€Ÿ
1580   3              }//å‘å·¦è½¬
1581   2              if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
1582   3                  loc_sdl*=1.1;//å·¦åŠ é€Ÿ
1583   3                  loc_sdr*=0.9;//å³å‡é€Ÿ
1584   3              }//å‘å³è½¬
1585   2              fun_motors(mot_r,loc_sdr);
1586   2              fun_motors(mot_l,loc_sdl);
1587   2              fun_delay(1,del_ms);
1588   2          }
1589   1          fun_motors(mot_rl,0);//åœæ­¢ç”µæœº
1590   1      }//ä¸»å‡½æ•°å‰å†²
1591          void fun_stope2prom(){
1592   1          IAP_CONTR = 0;                  //å…³é—­IAPåŠŸèƒ½
1593   1          IAP_CMD = 0;                    //æ¸…é™¤å‘½ä»¤
1594   1          IAP_TRIG = 0;                   //æ¸…é™¤è§¦å‘å¯„å­˜å™¨
1595   1          IAP_ADDRH = 0x80;               //æ•°æ®æŒ‡é’ˆæŒ‡å‘éEEPROMåŒº
1596   1          IAP_ADDRL = 0;                  //æ¸…é™¤IAPåœ°å€
1597   1      }//å…³é—­EEPROMåŠŸèƒ½(IapIdle)
1598          uc fun_reade2prom(ui par_add){
1599   1          uc loc_dat;                     //æ•°æ®ç¼“å†²åŒº
1600   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
1601   1          IAP_CMD = 1;                    //è®¾ç½®EEPROMè¯»å‘½ä»¤
1602   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
1603   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
1604   1          IAP_TRIG = 0x5a;                //è§¦å‘
1605   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
1606   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
1607   1          loc_dat = IAP_DATA;             //è¯»å‡ºEEPROMä¸­çš„æ•°æ®
1608   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
1609   1          return loc_dat;                 //è¿”å›è¯»å–ç»“æœ
1610   1      }//è¯»å–EEPROMæ•°æ®
1611          void fun_writee2prom(ui par_add,uc par_dat){
1612   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
1613   1          IAP_CMD = 2;                    //è®¾ç½®EEPROMå†™å…¥å‘½ä»¤
1614   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
1615   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
1616   1          IAP_DATA = par_dat;             //å†™å…¥æ•°æ®
1617   1          IAP_TRIG = 0x5a;                //è§¦å‘
1618   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
1619   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
1620   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
1621   1      }//å†™EEPROMæ•°æ®
1622          void fun_cleane2prom(ui par_add){
1623   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
1624   1          IAP_CMD = 3;                    //è®¾ç½®EEPROMæ“¦é™¤å‘½ä»¤
1625   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
1626   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
1627   1          IAP_TRIG = 0x5a;                //è§¦å‘
1628   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
1629   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
1630   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
1631   1      }//æ¸…é™¤EEPROMæ•°æ®
1632          void fun_calibration(){
1633   1          // fun_sj(sjp_1);//å‡åˆ°æœ€ä¸Šä½
1634   1          ul loc_time;
1635   1          fun_py(tra_q);//ç§»åŠ¨åˆ°æœ€å‰ç«¯
1636   1          fun_py(tra_h);//ç§»åŠ¨åˆ°æœ€åç«¯
1637   1          loc_time=var_timer;
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 28  

1638   1          fun_py(tra_q);//ç§»åŠ¨åˆ°å‰ç«¯å¹¶è®¡æ—¶
1639   1          fun_py(tra_h);//ç§»åŠ¨åˆ°åç«¯
1640   1          loc_time=var_timer-loc_time;
1641   1          loc_time*=0.5;
1642   1          str_cod.py1zh=loc_time*0.5;//ä»ååˆ°ä¸­é—´
1643   1          str_cod.py1qz=loc_time*0.5;//ä»å‰åˆ°ä¸­é—´
1644   1          str_cod.py1qkh=loc_time*0.75;//ä»å‰åˆ°é å
1645   1          str_cod.py1kqh=loc_time*0.564;//ä»é å‰åˆ°å
1646   1          str_cod.py1qkq=loc_time*0.34;//ä»å‰åˆ°é å‰
1647   1          str_cod.py1khh=loc_time*0.2701;//ä»ååˆ°é å
1648   1          str_cod.py1kqz=loc_time*0.189;//ä»é å‰åˆ°ä¸­é—´
1649   1          str_cod.py1zkh=loc_time*0.20;//ä»é ååˆ°ä¸­é—´
1650   1          str_cod.py1kqkh=loc_time*0.5;//ä»é å‰åˆ°é å
1651   1          str_cod.py1khkq=loc_time*0.5;//ä»é ååˆ°é å‰
1652   1      }//è‡ªåŠ¨æ ¡å‡†å¹³ç§»å‚æ•°
1653          void fun_port(){
1654   1          //19200bps@12.000MHz
1655   1          PCON |= 0x80;       //ä½¿èƒ½æ³¢ç‰¹ç‡å€é€Ÿä½SMOD
1656   1          SCON = 0x50;        //8ä½æ•°æ®,å¯å˜æ³¢ç‰¹ç‡
1657   1          AUXR |= 0x04;       //ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨æ—¶é’Ÿä¸ºFosc,å³1T
1658   1          BRT = 0xD9;         //è®¾å®šç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨é‡è£…å€¼
1659   1          AUXR |= 0x01;       //ä¸²å£1é€‰æ‹©ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨ä¸ºæ³¢ç‰¹ç‡å‘ç”Ÿå™¨
1660   1          AUXR |= 0x10;       //å¯åŠ¨ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨
1661   1      }//ä¸²å£åˆå§‹åŒ–
1662          void fun_test(){
1663   1          fun_sz(han_j);
1664   1          fun_delay(1,del_s);
1665   1          fun_sz(han_s);
1666   1          fun_delay(1,del_s);
1667   1          fun_sz(han_j);
1668   1          fun_delay(1,del_s);
1669   1          fun_sz(han_s);
1670   1          fun_delay(1,del_s);
1671   1      
1672   1          str_begin.pywz=tra_h;
1673   1          fun_py(tra_q);
1674   1          fun_delay(1,del_s);
1675   1          fun_py(tra_h);
1676   1          fun_delay(1,del_s);
1677   1          fun_py(tra_q);
1678   1          fun_delay(1,del_s);
1679   1          fun_py(tra_h);
1680   1          fun_delay(1,del_s);
1681   1      
1682   1          fun_sj(sjp_1);
1683   1          fun_delay(1,del_s);
1684   1          fun_sj(sjp_2);
1685   1          fun_delay(1,del_s);
1686   1          fun_sj(sjp_3);
1687   1          fun_delay(1,del_s);
1688   1          fun_sj(sjp_4);
1689   1          fun_delay(1,del_s);
1690   1          fun_sj(sjp_5);
1691   1          fun_delay(1,del_s);
1692   1          fun_sj(sjp_4);
1693   1          fun_delay(1,del_s);
1694   1          fun_sj(sjp_3);
1695   1          fun_delay(1,del_s);
1696   1          fun_sj(sjp_2);
1697   1          fun_delay(1,del_s);
1698   1          fun_sj(sjp_1);
1699   1      
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 29  

1700   1          str_now.hzfx=str_begin.hzfx;
1701   1          str_begin.hzfx=dir_up;
1702   1          fun_hz(dir_right);
1703   1          fun_delay(1,del_s);
1704   1          fun_hz(dir_up);
1705   1          fun_delay(1,del_s);
1706   1          fun_hz(dir_right);
1707   1          fun_delay(1,del_s);
1708   1          fun_hz(dir_up);
1709   1          fun_delay(1,del_s);
1710   1          str_begin.hzfx=str_now.hzfx;
1711   1      
1712   1          fun_motors(mot_rl,60);
1713   1          fun_delay(1,del_s);
1714   1          fun_motors(mot_rl,0);
1715   1          fun_delay(1,del_s);
1716   1      
1717   1          fun_motors(mot_rl,-60);
1718   1          fun_delay(1,del_s);
1719   1          fun_motors(mot_rl,0);
1720   1          fun_delay(1,del_s);
1721   1      
1722   1          fun_motors(mot_r,40);
1723   1          fun_motors(mot_l,-40);
1724   1          fun_delay(1,del_s);
1725   1          fun_motors(mot_rl,0);
1726   1          fun_delay(1,del_s);
1727   1      
1728   1          fun_motors(mot_r,-40);
1729   1          fun_motors(mot_l,40);
1730   1          fun_delay(1,del_s);
1731   1          fun_motors(mot_rl,0);
1732   1      }//æµ‹è¯•ç¨‹åº
1733          uc fun_min(uc par_num,...){
1734   1          va_list loc_argp;//ä¿å­˜å‚æ•°ç»“æ„
1735   1          uc loc_min=par_num;//ç°åœ¨çš„æœ€å°å€¼å°±æ˜¯ç¬¬ä¸€ä¸ª
1736   1          uc loc_shu;//å½“å‰å‚æ•°
1737   1          va_start(loc_argp,par_num);//loc_argpæŒ‡å‘ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œpar_numæ˜¯æœ€åä¸€ä¸ªç¡®å
             -®šçš„å‚æ•°
1738   1          loc_shu=va_arg(loc_argp,uc);//å–å‡ºä¸‹ä¸€ä¸ªå‚æ•°
1739   1          while(loc_shu!=def_end){//å¦‚æœä¸æ˜¯æœ€åä¸€ä¸ª
1740   2              if(loc_shu<loc_min)//å¦‚æœå–å‡ºçš„å‚æ•°æ¯”ä¹‹å‰æœ€å°çš„æ•°å°
1741   2                  loc_min=loc_shu;//å°†æ­¤æ•°ä¿å­˜
1742   2              loc_shu=va_arg(loc_argp,uc);//å–å‡ºä¸‹ä¸€ä¸ªå‚æ•°
1743   2          }
1744   1          va_end(loc_argp);//ç»“æŸ
1745   1          return loc_min;//é€€å‡º
1746   1      }//æ±‚æœ€å°å€¼
1747          void fun_setxy(uc par_1x,uc par_1y,uc par_1value,enum varENU_dir par_1fx,enum varENU_dir par_1gw,
1748              par_2x,uc par_2y,uc par_2value,enum varENU_dir par_2fx,enum varENU_dir par_2gw,
1749              par_3x,uc par_3y,uc par_3value,enum varENU_dir par_3fx,enum varENU_dir par_3gw,
1750              par_4x,uc par_4y,uc par_4value,enum varENU_dir par_4fx,enum varENU_dir par_4gw,
1751              uc par_5value,uc par_5fx){
1752   1          //xä¸ºxè½´åæ ‡,yä¸ºyè½´åæ ‡,valueä¸ºå·¥ä½å·,fxä¸ºåˆ°è¾¾æ­¤åæ ‡æ—¶éœ€è¦çš„æœå‘,gwä¸ºå·¥ä½åœ
             -¨å°è½¦çš„å“ªä¸€ä¾§
1753   1      
1754   1          //è®¾ç½®åæ ‡çš„value
1755   1          str_zbfl.xy[par_1x][par_1y].value=par_1value;
1756   1          str_zbfl.xy[par_2x][par_2y].value=par_2value;
1757   1          str_zbfl.xy[par_3x][par_3y].value=par_3value;
1758   1          str_zbfl.xy[par_4x][par_4y].value=par_4value;
1759   1          str_zbfl.top.value=par_5value;
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 30  

1760   1      
1761   1          //è®¾ç½®åæ ‡çš„æ–¹å‘
1762   1          str_zbfl.xy[par_1x][par_1y].fx=par_1fx;
1763   1          str_zbfl.xy[par_2x][par_2y].fx=par_2fx;
1764   1          str_zbfl.xy[par_3x][par_3y].fx=par_3fx;
1765   1          str_zbfl.xy[par_4x][par_4y].fx=par_4fx;
1766   1          str_zbfl.top.fx=par_5fx;
1767   1      
1768   1          //å±è”½ç›¸å…³åæ ‡
1769   1          fun_pbxy(par_1x,par_1y,par_1fx,par_1gw);
1770   1          fun_pbxy(par_2x,par_2y,par_2fx,par_2gw);
1771   1          fun_pbxy(par_3x,par_3y,par_3fx,par_3gw);
1772   1          fun_pbxy(par_4x,par_4y,par_4fx,par_4gw);
1773   1      }//è®¾ç½®åˆå§‹åæ ‡
1774          void fun_pbxy(uc par_x,uc par_y,enum varENU_dir par_fx,enum varENU_dir par_gw){
1775   1          if(par_gw==dir_left){//å¦‚æœå·¥ä½åœ¨å°è½¦å·¦è¾¹
1776   2              if(par_fx==dir_down){//å¦‚æœéœ€è¦å‘ä¸‹åœ
1777   3                  str_zbfl.xy[par_x][par_y].enleft=tf_false;//ä¸å…è®¸å·¦è½¬
1778   3                  str_zbfl.xy[par_x][par_y-1].enleft=tf_false;//ä¸‹ä¸€ä¸ªæ ¼ä¹Ÿä¸å‡†å·¦è½¬
1779   3                  str_zbfl.xy[par_x-1][par_y].enright=tf_false;//å·¥ä½å·¦è¾¹çš„ä¸å…è®¸å³è½¬
1780   3                  str_zbfl.xy[par_x-1][par_y-1].enright=tf_false;//å·¥ä½å·¦è¾¹çš„ä¸‹ä¸€ä¸ªæ ¼ä¹Ÿä¸å‡†å³è½¬
1781   3              }else if(par_fx==dir_up){//å¦‚æœéœ€è¦å‘ä¸Šåœ
1782   3                  str_zbfl.xy[par_x][par_y].enleft=tf_false;//ä¸å…è®¸å·¦è½¬
1783   3                  str_zbfl.xy[par_x][par_y+1].enleft=tf_false;//ä¸Šä¸€ä¸ªæ ¼ä¹Ÿä¸å‡†å·¦è½¬
1784   3                  str_zbfl.xy[par_x-1][par_y].enright=tf_false;//å·¥ä½å·¦è¾¹çš„ä¹Ÿä¸å…è®¸å³è½¬
1785   3                  str_zbfl.xy[par_x-1][par_y+1].enright=tf_false;//å·¥ä½å·¦è¾¹çš„ä¸Šä¸€ä¸ªæ ¼ä¹Ÿä¸å‡†å³è½¬
1786   3              }
1787   2          }else if(par_gw==dir_right){//å¦‚æœå·¥ä½åœ¨å°è½¦å³è¾¹
1788   2              if(par_fx==dir_down){//å¦‚æœéœ€è¦å‘ä¸‹åœ
1789   3                  str_zbfl.xy[par_x][par_y].enright=tf_false;//ä¸å…è®¸å³è½¬
1790   3                  str_zbfl.xy[par_x][par_y-1].enright=tf_false;//ä¸‹ä¸€ä¸ªæ ¼ä¹Ÿä¸å‡†å³è½¬
1791   3                  str_zbfl.xy[par_x+1][par_y].enleft=tf_false;//å·¥ä½å³è¾¹çš„ä¸å…è®¸å·¦è½¬
1792   3                  str_zbfl.xy[par_x+1][par_y-1].enleft=tf_false;//å·¥ä½å³è¾¹çš„ä¸‹ä¸€ä¸ªæ ¼ä¹Ÿä¸å‡†å·¦è½¬
1793   3              }else if(par_fx==dir_up){//å¦‚æœéœ€è¦å‘ä¸Šåœ
1794   3                  str_zbfl.xy[par_x][par_y].enright=tf_false;//ä¸å…è®¸å³è½¬
1795   3                  str_zbfl.xy[par_x][par_y+1].enright=tf_false;//ä¸Šä¸€ä¸ªæ ¼ä¹Ÿä¸å‡†å³è½¬
1796   3                  str_zbfl.xy[par_x+1][par_y].enleft=tf_false;//å·¥ä½å³è¾¹çš„ä¸å…è®¸å·¦è½¬
1797   3                  str_zbfl.xy[par_x+1][par_y+1].enleft=tf_false;//å·¥ä½å³è¾¹çš„ä¸Šä¸€ä¸ªæ ¼ä¹Ÿä¸å‡†å·¦è½¬
1798   3              }
1799   2          }
1800   1      }//é€šè¿‡å·¥ä»¶çš„æœå‘å’Œå°è½¦çš„è½¦å¤´æ–¹å‘å±è”½åæ ‡
1801          void fun_getxy(char par_value){
1802   1          uc loc_xhx,loc_xhy;//ä¸¤ä¸ªå¾ªç¯å˜é‡
1803   1          str_now.x=str_begin.x;//å½“å‰çš„xè½´åæ ‡ç­‰äºèµ·å§‹çš„xè½´åæ ‡
1804   1          str_now.y=str_begin.y;//å½“å‰çš„yè½´åæ ‡ç­‰äºèµ·å§‹çš„yè½´åæ ‡
1805   1          str_now.ctfx=str_begin.ctfx;//å½“å‰çš„è½¦å¤´æ–¹å‘ç­‰äºèµ·å§‹çš„è½¦å¤´æ–¹å‘
1806   1          if(par_value==str_zbfl.top.value){//å¦‚æœæ˜¯å»æœ€é¡¶ä¸Šçš„å·¥ä½å°
1807   2              if(str_zbfl.top.fx==dir_right){
1808   3                  str_next.x=0;//xè½´åæ ‡èµ‹å€¼ä¸º0
1809   3                  str_next.y=12;//yè½´åæ ‡èµ‹å€¼ä¸º12
1810   3                  str_next.ctfx=dir_right;//è½¦å¤´æ–¹å‘èµ‹å€¼ä¸ºdir_right
1811   3              }else if(str_zbfl.top.fx==dir_left){
1812   3                  str_next.x=4;//xè½´åæ ‡èµ‹å€¼ä¸º4
1813   3                  str_next.y=12;//yè½´åæ ‡èµ‹å€¼ä¸º12
1814   3                  str_next.ctfx=dir_left;//è½¦å¤´æ–¹å‘èµ‹å€¼ä¸ºdir_left
1815   3              }
1816   2          }else{
1817   2              for(loc_xhx=0;loc_xhx<=4;loc_xhx++){//Xè½´å¾ªç¯,0-5
1818   3                  for(loc_xhy=0;loc_xhy<=12;loc_xhy++){//yè½´å¾ªç¯,0-12
1819   4                      if(str_zbfl.xy[loc_xhx][loc_xhy].value==par_value){//å¦‚æœæ‰¾åˆ°äº†è¿™ä¸ªä»¶
1820   5                          str_next.x=loc_xhx;//xè½´åæ ‡èµ‹å€¼ç»™str_next.x
1821   5                          str_next.y=loc_xhy;//yè½´åæ ‡èµ‹å€¼ç»™str_next.y
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 31  

1822   5                          str_next.ctfx=str_zbfl.xy[loc_xhx][loc_xhy].fx;//è½¦å¤´æ–¹å‘èµ‹å€¼ç»™str_next.ctfx
1823   5                          return;//é€€å‡ºå‡½æ•°
1824   5                      }
1825   4                  }
1826   3              }
1827   2          }
1828   1      }//é€šè¿‡æƒ³è¦å»çš„å·¥ä½å·è·å¾—XYåæ ‡å¹¶å‚¨å­˜åœ¨str_nextç»“æ„ä½“ä¸­,æŠŠç°åœ¨çš„å·¥ä½å·å­˜å‚¨å†
             -str_nowç»“æ„ä½“ä¸­
1829          void fun_xymove(enum varENU_tfl par_model,char par_value){
1830   1          if(*str_tfl.run==0){//å¦‚æœå½“å‰æ­¥éª¤æ²¡è¢«ç¼–è¾‘è¿‡
1831   2              if(par_model==tfl_cache){//å¦‚æœç¬¬ä¸€ä¸ªæ˜¯å‰å†²
1832   3                  return;//ä¸å…è®¸æ˜¯å‰å†²
1833   3              }
1834   2              (*str_tfl.run)=par_model;//é‚£å°±ç­‰äºç°åœ¨çš„æ¨¡å¼
1835   2          }else if(*str_tfl.run!=par_model){//å¦‚æœå½“å‰æ­¥éª¤å’Œä¼ å…¥çš„æ­¥éª¤ä¸ä¸€æ ·
1836   2              str_tfl.run+=2;//æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ç»„æ•°ç»„
1837   2              (*str_tfl.run)=par_model;//å­˜å…¥æ­¥éª¤
1838   2          }
1839   1          switch(*str_tfl.run){//é€‰æ‹©æ­£åœ¨ç¼–è¾‘çš„æ­¥éª¤
1840   2              case tfl_line://å¦‚æœæ­£åœ¨ç¼–è¾‘å·¡çº¿
1841   2                  *(str_tfl.run+1)+=par_value;//å·¡çº¿æ­¥éª¤çš„å‚æ•°åŠ ä¸Šéœ€è¦å¢åŠ çš„å‚æ•°(æ®è¯´å¯ä»¥å‡
             -å»)
1842   2                  break;
1843   2              case tfl_turn://å¦‚æœæ­£åœ¨ç¼–è¾‘è½¬å®Œ
1844   2                  switch(*(str_tfl.run+1)){//é€‰æ‹©æ­£åœ¨ç¼–è¾‘çš„æ­¥éª¤
1845   3                      case 0://å¦‚æœè¿˜æ²¡è¢«å†™å…¥å€¼
1846   3                          *(str_tfl.run+1)=par_value;//ç›´æ¥å†™è¿›å»
1847   3                          break;
1848   3                      case tur_l90://å¦‚æœç°åœ¨åœ¨å·¦è½¬
1849   3                          switch(par_value){//é€‰æ‹©ä¼ å…¥çš„å‚æ•°
1850   4                              case tur_l90://å¦‚æœéœ€è¦å·¦è½¬
1851   4                                  *(str_tfl.run+1)=tur_l180;//å·¦è½¬ä¸¤ä¸ª90Â°=å·¦è½¬180Â°
1852   4                                  break;
1853   4                              case tur_r90://å¦‚æœéœ€è¦å³è½¬
1854   4                                  #ifdef Debug
                                              printf("W: #fun_xymove -tur_l90+tur_r90\n");//å·¦è½¬+å³è½¬ä¸æˆç«‹,æŠ¥é”
             -™
                                          #endif
1857   4                                  break;
1858   4                              case tur_l180://å¦‚æœéœ€è¦å·¦è½¬180Â°
1859   4                                  *(str_tfl.run+1)=tur_r90;//å·¦è½¬90Â°+å·¦è½¬180Â°=å³è½¬90Â°
1860   4                                  break;
1861   4                              case tur_r180://å¦‚æœéœ€è¦å³è½¬180Â°
1862   4                                  *(str_tfl.run+1)=tur_r90;//å·¦è½¬90Â°+å³è½¬180Â°=å³è½¬90Â°
1863   4                                  break;
1864   4                              default:
1865   4                                  break;
1866   4                          }
1867   3                          break;
1868   3                      case tur_r90:
1869   3                          switch(par_value){
1870   4                              case tur_l90:
1871   4                                  #ifdef Debug
                                              printf("W: #fun_xymove -tur_r90+tur_l90\n");
                                          #endif
1874   4                                  break;
1875   4                              case tur_r90:
1876   4                                  *(str_tfl.run+1)=tur_r180;
1877   4                                  break;
1878   4                              case tur_l180:
1879   4                                  *(str_tfl.run+1)=tur_l90;
1880   4                                  break;
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 32  

1881   4                              case tur_r180:
1882   4                                  *(str_tfl.run+1)=tur_l90;
1883   4                                  break;
1884   4                              default:
1885   4                                  break;
1886   4                          }
1887   3                          break;
1888   3                      case tur_l180:
1889   3                          switch(par_value){
1890   4                              case tur_l90:
1891   4                                  *(str_tfl.run+1)=tur_r90;
1892   4                                  break;
1893   4                              case tur_r90:
1894   4                                  *(str_tfl.run+1)=tur_l90;
1895   4                                  break;
1896   4                              case tur_l180:
1897   4                                  #ifdef Debug
                                              printf("W: #fun_xymove -tur_l180+tur_l180\n");
                                          #endif
1900   4                                  break;
1901   4                              case tur_r180:
1902   4                                  #ifdef Debug
                                              printf("W: #fun_xymove -tur_l180+tur_r180\n");
                                          #endif
1905   4                                  break;
1906   4                              default:
1907   4                                  break;
1908   4                          }
1909   3                          break;
1910   3                      case tur_r180:
1911   3                          switch(par_value){
1912   4                              case tur_l90:
1913   4                                  *(str_tfl.run+1)=tur_r90;
1914   4                                  break;
1915   4                              case tur_r90:
1916   4                                  *(str_tfl.run+1)=tur_l90;
1917   4                                  break;
1918   4                              case tur_l180:
1919   4                                  #ifdef Debug
                                              printf("W: #fun_xymove -tur_r180+tur_l180\n");
                                          #endif
1922   4                                  break;
1923   4                              case tur_r180:
1924   4                                  #ifdef Debug
                                              printf("W: #fun_xymove -tur_r180+tur_l180\n");
                                          #endif
1927   4                                  break;
1928   4                              default:
1929   4                                  break;
1930   4                          }
1931   3                          break;
1932   3                      default:
1933   3                          break;
1934   3                  }
1935   2                  break;
1936   2              case tfl_cache://å¦‚æœæ­£åœ¨ç¼–è¾‘å‰å†²
1937   2                  *(str_tfl.run+1)+=par_value;
1938   2                  break;
1939   2              default:
1940   2                  break;
1941   2          }
1942   1      }//åæ ‡å·¡çº¿å•æ­¥ç´¯è®¡æ­¥éª¤ç”Ÿæˆ
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 33  

1943          void fun_coordinate(){
1944   1          ;
1945   1      }//è‡ªåŠ¨å·¡çº¿ä¹‹åæ ‡
1946          void fun_record(char par_x,char par_y,enum varENU_dir par_ctfx,char par_gospeed,char par_turnspeed,char pa
             -r_cachespeed){
1947   1          /*
1948   1              ä¼˜å…ˆå·¦å³èµ°,å…¶æ¬¡è€ƒè™‘è½¦å¤´æ–¹å‘,å†æ¬¡è€ƒè™‘å·¥ä»¶å°çš„ä½ç½®
1949   1          */
1950   1          str_tfl.run=str_tfl.step;//æŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªæ­¥éª¤
1951   1          while((str_now.x!=par_x)||(str_now.y!=par_y)||(str_now.ctfx!=par_ctfx)){//å¦‚æœxyè½´åˆ°è¾¾äº†,è½¦å¤´æ
             -–¹å‘ä¸€è‡´äº†
1952   2              switch(str_now.ctfx){//åˆ¤æ–­å½“å‰è½¦å¤´æ–¹å‘
1953   3                  case dir_up://ç°åœ¨è½¦å¤´æœä¸Š
1954   3                      if(par_x>str_now.x){//å¦‚æœè¦å»çš„xå€¼æ¯”ç°åœ¨çš„å¤§,å‘å³èµ°
1955   4                          fun_xymove(tfl_cache,40);
1956   4                          fun_xymove(tfl_turn,tur_r90);
1957   4                          str_now.ctfx=dir_right;
1958   4                          continue;
1959   4                      }
1960   3                      if(par_x<str_now.x){//å¦‚æœè¦å»çš„xå€¼æ¯”ç°åœ¨çš„å°,å‘å·¦èµ°
1961   4                          fun_xymove(tfl_cache,40);
1962   4                          fun_xymove(tfl_turn,tur_l90);
1963   4                          str_now.ctfx=dir_left;
1964   4                          continue;
1965   4                      }
1966   3                      if(par_y>str_now.y){//å¦‚æœè¦å»çš„Yå€¼æ¯”ç°åœ¨çš„å¤§,å‘ä¸Šèµ°
1967   4                          fun_xymove(tfl_line,1);
1968   4                          str_now.y+=1;
1969   4                          continue;
1970   4                      }
1971   3                      if(par_y<str_now.y){//å¦‚æœè¦å»çš„Yå€¼æ¯”ç°åœ¨çš„å°,å‘ä¸‹èµ°
1972   4                          fun_xymove(tfl_cache,40);
1973   4                          fun_xymove(tfl_turn,tur_r180);
1974   4                          str_now.ctfx=dir_down;
1975   4                          continue;
1976   4                      }
1977   3                      if(par_x==str_now.x&&par_y==str_now.y){//éœ€è¦åœ¨åŸåœ°è½¬ä¸ªå¼¯
1978   4                          fun_xymove(tfl_cache,40);
1979   4                          switch(par_ctfx){
1980   5                              case dir_left:
1981   5                                  fun_xymove(tfl_turn,tur_l90);
1982   5                                  break;
1983   5                              case dir_right:
1984   5                                  fun_xymove(tfl_turn,tur_r90);
1985   5                                  break;
1986   5                              case dir_down:
1987   5                                  fun_xymove(tfl_turn,tur_l180);
1988   5                                  break;
1989   5                              default:
1990   5                                  break;
1991   5                          }
1992   4                          str_now.ctfx=par_ctfx;
1993   4                          continue;
1994   4                      }
1995   3                      break;
1996   3                  case dir_down://ç°åœ¨è½¦å¤´æœä¸‹
1997   3                      if(par_x>str_now.x){//å¦‚æœè¦å»çš„xå€¼æ¯”ç°åœ¨çš„å¤§//å‘å³èµ°
1998   4                          fun_xymove(tfl_cache,40);
1999   4                          fun_xymove(tfl_turn,tur_l90);
2000   4                          str_now.ctfx=dir_right;
2001   4                          continue;
2002   4                      }
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 34  

2003   3                      if(par_x<str_now.x){//å¦‚æœè¦å»çš„xå€¼æ¯”ç°åœ¨çš„å°//å‘å·¦èµ°
2004   4                          fun_xymove(tfl_cache,40);
2005   4                          fun_xymove(tfl_turn,tur_r90);
2006   4                          str_now.ctfx=dir_left;
2007   4                          continue;
2008   4                      }
2009   3                      if(par_y<str_now.y){//å¦‚æœè¦å»çš„Yå€¼æ¯”ç°åœ¨çš„å°//å‘ä¸‹èµ°
2010   4                          fun_xymove(tfl_line,1);
2011   4                          str_now.y-=1;
2012   4                          continue;
2013   4                      }
2014   3                      if(par_y>str_now.y){//å¦‚æœè¦å»çš„Yå€¼æ¯”ç°åœ¨çš„å¤§//å‘ä¸Šèµ°
2015   4                          fun_xymove(tfl_cache,40);
2016   4                          fun_xymove(tfl_turn,tur_r180);
2017   4                          str_now.ctfx=dir_up;
2018   4                          continue;
2019   4                      }
2020   3                      if(par_x==str_now.x&&par_y==str_now.y){//éœ€è¦åœ¨åŸåœ°è½¬ä¸ªå¼¯
2021   4                          fun_xymove(tfl_cache,40);
2022   4                          switch(par_ctfx){
2023   5                              case dir_left:
2024   5                                  fun_xymove(tfl_turn,tur_r90);
2025   5                                  break;
2026   5                              case dir_right:
2027   5                                  fun_xymove(tfl_turn,tur_l90);
2028   5                                  break;
2029   5                              case dir_up:
2030   5                                  fun_xymove(tfl_turn,tur_l180);
2031   5                                  break;
2032   5                              default:
2033   5                                  break;
2034   5                          }
2035   4                          str_now.ctfx=par_ctfx;
2036   4                          continue;
2037   4                      }
2038   3                      break;
2039   3                  case dir_right://ç°åœ¨è½¦å¤´æœå³
2040   3                      if(par_x>str_now.x){//å¦‚æœè¦å»çš„xå€¼æ¯”ç°åœ¨çš„å¤§,å‘å³èµ°
2041   4                          fun_xymove(tfl_line,1);
2042   4                          str_now.x+=1;
2043   4                          continue;
2044   4                      }
2045   3                      if(par_x<str_now.x){//å¦‚æœè¦å»çš„xå€¼æ¯”ç°åœ¨çš„å°,å‘å·¦èµ°
2046   4                          fun_xymove(tfl_cache,40);
2047   4                          fun_xymove(tfl_turn,tur_l180);
2048   4                          str_now.ctfx=dir_left;
2049   4                          continue;
2050   4                      }
2051   3                      if(par_y>str_now.y){//å¦‚æœè¦å»çš„Yå€¼æ¯”ç°åœ¨çš„å¤§,å‘ä¸Šèµ°
2052   4                          fun_xymove(tfl_cache,40);
2053   4                          fun_xymove(tfl_turn,tur_l90);
2054   4                          str_now.ctfx=dir_up;
2055   4                          continue;
2056   4                      }
2057   3                      if(par_y<str_now.y){//å¦‚æœè¦å»çš„Yå€¼æ¯”ç°åœ¨çš„å°,å‘ä¸‹èµ°
2058   4                          fun_xymove(tfl_cache,40);
2059   4                          fun_xymove(tfl_turn,tur_r90);
2060   4                          str_now.ctfx=dir_down;
2061   4                          continue;
2062   4                      }
2063   3                      if(par_x==str_now.x&&par_y==str_now.y){//éœ€è¦åœ¨åŸåœ°è½¬ä¸ªå¼¯
2064   4                          fun_xymove(tfl_cache,40);
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 35  

2065   4                          switch(par_ctfx){
2066   5                              case dir_left:
2067   5                                  fun_xymove(tfl_turn,tur_l180);
2068   5                                  break;
2069   5                              case dir_down:
2070   5                                  fun_xymove(tfl_turn,tur_r90);
2071   5                                  break;
2072   5                              case dir_up:
2073   5                                  fun_xymove(tfl_turn,tur_l90);
2074   5                                  break;
2075   5                              default:
2076   5                                  break;
2077   5                          }
2078   4                          str_now.ctfx=par_ctfx;
2079   4                          continue;
2080   4                      }
2081   3                      break;
2082   3                  case dir_left://ç°åœ¨è½¦å¤´æœå·¦
2083   3                      if(par_x<str_now.x){//å¦‚æœè¦å»çš„xå€¼æ¯”ç°åœ¨çš„å°,å‘å·¦èµ°
2084   4                          fun_xymove(tfl_line,1);
2085   4                          str_now.x-=1;
2086   4                          continue;
2087   4                      }
2088   3                      if(par_x>str_now.x){//å¦‚æœè¦å»çš„xå€¼æ¯”ç°åœ¨çš„å¤§,å‘å³èµ°
2089   4                          fun_xymove(tfl_cache,40);
2090   4                          fun_xymove(tfl_turn,tur_l180);
2091   4                          str_now.ctfx=dir_right;
2092   4                          continue;
2093   4                      }
2094   3                      if(par_y>str_now.y){//å¦‚æœè¦å»çš„Yå€¼æ¯”ç°åœ¨çš„å¤§,å‘ä¸Šèµ°
2095   4                          fun_xymove(tfl_cache,40);
2096   4                          fun_xymove(tfl_turn,tur_r90);
2097   4                          str_now.ctfx=dir_up;
2098   4                          continue;
2099   4                      }
2100   3                      if(par_y<str_now.y){//å¦‚æœè¦å»çš„Yå€¼æ¯”ç°åœ¨çš„å°,å‘ä¸‹èµ°
2101   4                          fun_xymove(tfl_cache,40);
2102   4                          fun_xymove(tfl_turn,tur_l90);
2103   4                          str_now.ctfx=dir_down;
2104   4                          continue;
2105   4                      }
2106   3                      if(par_x==str_now.x&&par_y==str_now.y){//éœ€è¦åœ¨åŸåœ°è½¬ä¸ªå¼¯
2107   4                          fun_xymove(tfl_cache,40);
2108   4                          switch(par_ctfx){
2109   5                              case dir_right:
2110   5                                  fun_xymove(tfl_turn,tur_l180);
2111   5                                  break;
2112   5                              case dir_down:
2113   5                                  fun_xymove(tfl_turn,tur_l90);
2114   5                                  break;
2115   5                              case dir_up:
2116   5                                  fun_xymove(tfl_turn,tur_r90);
2117   5                                  break;
2118   5                              default:
2119   5                                  break;
2120   5                          }
2121   4                          str_now.ctfx=par_ctfx;
2122   4                          continue;
2123   4                      }
2124   3                      break;
2125   3                  default:
2126   3                      break;
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 36  

2127   3              }
2128   2          }
2129   1          fun_xymove(tfl_line,1);//è¿›å…¥å·¥ä½å°
2130   1          fun_xymove(tfl_cache,40);//å‰å†²
2131   1          str_tfl.run+=2;//æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ç»„æ•°ç»„
2132   1          (*str_tfl.run)=def_end;//å­˜å…¥æ­¥éª¤
2133   1      
2134   1          str_tfl.online=tf_false;//ä¸åœ¨çº¿
2135   1          str_tfl.run=str_tfl.step;//æŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªæ•°ç»„
2136   1          str_tfl.gospeed=par_gospeed;//é»˜è®¤é€Ÿåº¦
2137   1          str_tfl.turnspeed=par_turnspeed;//æ‹å¼¯é€Ÿåº¦
2138   1          str_tfl.cachespeed=par_cachespeed;//å‰å†²é€Ÿåº¦
2139   1          str_tfl.doing=tf_ture;//å¼€å§‹åš
2140   1      }//å®šæ—¶å™¨åæ ‡å·¡çº¿æ­¥éª¤ç”Ÿæˆ
2141          void fun_go(char par_gw){
2142   1          fun_getxy(par_gw);
2143   1          if(str_next.ctfx==dir_up){
2144   2              fun_record(str_next.x,str_next.y-1,str_next.ctfx,56,45,50);
2145   2          }
2146   1          else if(str_next.ctfx==dir_down){
2147   2              fun_record(str_next.x,str_next.y+1,str_next.ctfx,56,45,50);
2148   2          }
2149   1          while(str_tfl.doing==tf_ture)
2150   1              fun_delay(50,del_ms);
2151   1      }//å®šæ—¶å™¨åæ ‡å·¡çº¿æœ€ç»ˆè°ƒç”¨å½¢å¼
2152          void fun_zdzj(ul par_04,ul par_37){//ulå‹æ•°æ®,ä¸€æ¬¡è¾“å…¥æ‰€æœ‰ç»“æœ,æ— éœ€ç­‰å¾…
2153   1          struct str_zdzj str_pass,str_end;//str_zdzj(è‡ªåŠ¨æŠ“ä»¶)çš„ç»“æ„ä½“:ç°åœ¨çš„æ•°æ®å’Œç»“æŸæ—¶å¾—åˆ
             -°çš„ç»“æœ
2154   1          char loc_high[8];         //æ¯æ‘å·¥ä»¶çš„é«˜åº¦
2155   1          uc loc_xh1;             //ç¬¬ä¸€ä¸ªå¾ªç¯
2156   1      
2157   1          memset(str_pass.jx,0,sizeof(str_pass.jx));//æ¸…ç©ºç°åœ¨ä»¶åº
2158   1          memset(str_end.jx,0,sizeof(str_end.jx)); //æ¸…ç©ºæƒ³è¦çš„ä»¶åº
2159   1          memset(loc_high,5,sizeof(loc_high));     //æ¯ç»„é«˜åº¦ç½®5(æ²¡æœ‰ä»¶)
2160   1      
2161   1          //èµ·å§‹åŒºä»¶å·
2162   1          str_pass.jx[0][1]=(par_04/10000000)%10;  //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬1å·ä»¶ä»¶å·(æœ€é«˜ä½)
2163   1          str_pass.jx[0][2]=(par_04/1000000)%10;   //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬2å·ä»¶ä»¶å·
2164   1          str_pass.jx[0][3]=(par_04/100000)%10;    //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬3å·ä»¶ä»¶å·
2165   1          str_pass.jx[0][4]=(par_04/10000)%10;     //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬4å·ä»¶ä»¶å·(æœ€ä½ä½)
2166   1          str_pass.jx[4][1]=(par_04/1000)%10;      //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬1å·ä»¶ä»¶å·(æœ€é«˜ä½)
2167   1          str_pass.jx[4][2]=(par_04/100)%10;       //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬2å·ä»¶ä»¶å·
2168   1          str_pass.jx[4][3]=(par_04/10)%10;        //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬3å·ä»¶ä»¶å·
2169   1          str_pass.jx[4][4]=par_04%10;             //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬4å·ä»¶ä»¶å·(æœ€ä½ä½)
2170   1          //ç›®çš„åŒºä»¶å·
2171   1          str_pass.jx[3][1]=(par_37/10000000)%10;  //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬1å·ä»¶ä»¶å·(æœ€é«˜ä½)
2172   1          str_pass.jx[3][2]=(par_37/1000000)%10;   //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬2å·ä»¶ä»¶å·
2173   1          str_pass.jx[3][3]=(par_37/100000)%10;    //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬3å·ä»¶ä»¶å·
2174   1          str_pass.jx[3][4]=(par_37/10000)%10;     //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº0çš„ç¬¬4å·ä»¶ä»¶å·(æœ€ä½ä½)
2175   1          str_pass.jx[7][1]=(par_37/1000)%10;      //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬1å·ä»¶ä»¶å·(æœ€é«˜ä½)
2176   1          str_pass.jx[7][2]=(par_37/100)%10;       //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬2å·ä»¶ä»¶å·
2177   1          str_pass.jx[7][3]=(par_37/10)%10;        //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬3å·ä»¶ä»¶å·
2178   1          str_pass.jx[7][4]=par_37%10;             //ä¼ å…¥ç°åœ¨ä»¶åº:åŒº4çš„ç¬¬4å·ä»¶ä»¶å·(æœ€ä½ä½)
2179   1          //ç›®çš„æ¬¡åº
2180   1          str_end.jx[3][1]=1;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº3çš„ç¬¬1å·ç›®çš„æ¬¡åºå·(æœ€é«˜ä½)
2181   1          str_end.jx[3][2]=2;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº3çš„ç¬¬2å·ç›®çš„æ¬¡åºå·
2182   1          str_end.jx[3][3]=3;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº3çš„ç¬¬3å·ç›®çš„æ¬¡åºå·
2183   1          str_end.jx[3][4]=4;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº3çš„ç¬¬4å·ç›®çš„æ¬¡åºå·(æœ€ä½ä½)
2184   1          str_end.jx[7][1]=5;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº7çš„ç¬¬1å·ç›®çš„æ¬¡åºå·(æœ€é«˜ä½)
2185   1          str_end.jx[7][2]=6;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº7çš„ç¬¬2å·ç›®çš„æ¬¡åºå·
2186   1          str_end.jx[7][3]=7;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº7çš„ç¬¬3å·ç›®çš„æ¬¡åºå·
2187   1          str_end.jx[7][4]=8;                      //æ ‡å‡†ç›®æ ‡æ¬¡åº:åŒº7çš„ç¬¬4å·ç›®çš„æ¬¡åºå·(æœ€ä½ä½)
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 37  

2188   1      
2189   1          for(loc_xh1=1;loc_xh1<=4;loc_xh1++){
2190   2              if((str_pass.jx[0][loc_xh1]==str_pass.jx[3][1])&&(str_pass.jx[0][loc_xh1]!=0))
2191   2                  str_end.jx[0][loc_xh1]=str_end.jx[3][1];
2192   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[3][2])&&(str_pass.jx[0][loc_xh1]!=0))
2193   2                  str_end.jx[0][loc_xh1]=str_end.jx[3][2];
2194   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[3][3])&&(str_pass.jx[0][loc_xh1]!=0))
2195   2                  str_end.jx[0][loc_xh1]=str_end.jx[3][3];
2196   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[3][4])&&(str_pass.jx[0][loc_xh1]!=0))
2197   2                  str_end.jx[0][loc_xh1]=str_end.jx[3][4];
2198   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[7][1])&&(str_pass.jx[0][loc_xh1]!=0))
2199   2                  str_end.jx[0][loc_xh1]=str_end.jx[7][1];
2200   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[7][2])&&(str_pass.jx[0][loc_xh1]!=0))
2201   2                  str_end.jx[0][loc_xh1]=str_end.jx[7][2];
2202   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[7][3])&&(str_pass.jx[0][loc_xh1]!=0))
2203   2                  str_end.jx[0][loc_xh1]=str_end.jx[7][3];
2204   2              else if((str_pass.jx[0][loc_xh1]==str_pass.jx[7][4])&&(str_pass.jx[0][loc_xh1]!=0))
2205   2                  str_end.jx[0][loc_xh1]=str_end.jx[7][4];
2206   2      
2207   2              if((str_pass.jx[4][loc_xh1]==str_pass.jx[3][1])&&(str_pass.jx[4][loc_xh1]!=0))
2208   2                  str_end.jx[4][loc_xh1]=str_end.jx[3][1];
2209   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[3][2])&&(str_pass.jx[4][loc_xh1]!=0))
2210   2                  str_end.jx[4][loc_xh1]=str_end.jx[3][2];
2211   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[3][3])&&(str_pass.jx[4][loc_xh1]!=0))
2212   2                  str_end.jx[4][loc_xh1]=str_end.jx[3][3];
2213   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[3][4])&&(str_pass.jx[4][loc_xh1]!=0))
2214   2                  str_end.jx[4][loc_xh1]=str_end.jx[3][4];
2215   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[7][1])&&(str_pass.jx[4][loc_xh1]!=0))
2216   2                  str_end.jx[4][loc_xh1]=str_end.jx[7][1];
2217   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[7][2])&&(str_pass.jx[4][loc_xh1]!=0))
2218   2                  str_end.jx[4][loc_xh1]=str_end.jx[7][2];
2219   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[7][3])&&(str_pass.jx[4][loc_xh1]!=0))
2220   2                  str_end.jx[4][loc_xh1]=str_end.jx[7][3];
2221   2              else if((str_pass.jx[4][loc_xh1]==str_pass.jx[7][4])&&(str_pass.jx[4][loc_xh1]!=0))
2222   2                  str_end.jx[4][loc_xh1]=str_end.jx[7][4];
2223   2          }//é€šè¿‡å®é™…ä»¶åºè·å¾—ç¼–å·
2224   1      
2225   1          memset(str_pass.jx,0,sizeof(str_pass.jx));//æ¸…ç©ºç°åœ¨å®é™…ä»¶åº
2226   1          for(loc_xh1=1;loc_xh1<=4;loc_xh1++){
2227   2              str_pass.jx[0][loc_xh1]=str_end.jx[0][loc_xh1];
2228   2              str_pass.jx[4][loc_xh1]=str_end.jx[4][loc_xh1];
2229   2          }//å°†ç°åœ¨çš„ä»¶åºä»str_end.jxä¸­æ‹¿åˆ°str_pass.jx
2230   1          for(loc_xh1=1;loc_xh1<=4;loc_xh1++){
2231   2              str_end.jx[0][loc_xh1]=0;
2232   2              str_end.jx[4][loc_xh1]=0;
2233   2          }//åˆ é™¤str_end.jxä¸­ç°åœ¨çš„ä»¶åº
2234   1          loc_high[0]=loc_high[4]=1;//åªæœ‰0å·å’Œ4å·æ”¾æ»¡äº†ä»¶
2235   1          loc_xh1=0;//å¾ªç¯æ ‡å¿—ä½å½’é›¶
2236   1      
2237   1          /*
2238   1              åˆ°ç›®å‰ä¸ºæ­¢å‡†å¤‡å·¥ä½œç»“æŸ,ç°åœ¨çš„æ•°ç»„ä¸­æ²¡æœ‰å®é™…ä»¶åº,
2239   1              ç°åœ¨çš„ç¼–å·åœ¨str_pass.jxä¸­,
2240   1              æƒ³è¦å¾—åˆ°çš„ç»“æœä»¶åºç¼–å·åœ¨str_end.jxä¸­
2241   1          */
2242   1          while(1){
2243   2              //é€€å‡ºæ¡ä»¶
2244   2              if((str_pass.jx[3][1]==str_end.jx[3][1])&&
2245   2              (str_pass.jx[3][2]==str_end.jx[3][2])&&
2246   2              (str_pass.jx[3][3]==str_end.jx[3][3])&&
2247   2              (str_pass.jx[3][4]==str_end.jx[3][4])&&
2248   2              (str_pass.jx[7][1]==str_end.jx[7][1])&&
2249   2              (str_pass.jx[7][2]==str_end.jx[7][2])&&
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 38  

2250   2              (str_pass.jx[7][3]==str_end.jx[7][3])&&
2251   2              (str_pass.jx[7][4]==str_end.jx[7][4])){
2252   3                  if(str_begin.hzfx==dir_left){
2253   4                      fun_sz(han_s);                 //æ‰‹æŠ“æ¾
2254   4                      fun_sj(sjp_1);                 //å‡é™åˆ°æœ€é«˜ä½
2255   4                      fun_zjzt(mot_pyhz,7);           //å¹³é¢ä½ç½®7
2256   4                      fun_zjzt(mot_sj,loc_high[7]);   //å‡é™åˆ°7çš„æœ€é«˜ä½
2257   4                      fun_sz(han_j);                 //æ‰‹æŠ“ç´§
2258   4                  }//å¦‚æœåœåœ¨å·¦è¾¹
2259   3                  return;
2260   3              }//å¦‚æœå°è½¦ä¸€æ–¹çš„å®é™…ä»¶åºå’Œæƒ³è¦è¾¾åˆ°çš„ä»¶åºç›¸ç­‰
2261   2              if(str_begin.hzfx==dir_left){
2262   3                  //è½¬å‘æ¡ä»¶
2263   3                  loc_xh1++;//æ ‡å¿—ä½+1
2264   3                  if(loc_xh1>=100){
2265   4                      loc_xh1=0;
2266   4                      fun_zjzt(mot_sj,fun_min(loc_high[0],loc_high[1],loc_high[2],loc_high[3],loc_high[4],loc_hi
             -gh[5],loc_high[6],loc_high[7],def_end)-1);
2267   4                      fun_hz(dir_right);
2268   4                  }
2269   3                  //å¯ä»¥ä¸€æ¬¡æ‹¿èµ°,ä¸éœ€è¦ä¸­é—´ä½çš„
2270   3                  if(loc_high[1]<5){
2271   4                      if(str_pass.jx[1][loc_high[1]]==str_end.jx[3][loc_high[3]-1]){
2272   5                          fun_najian(1,3,loc_high,str_pass.jx);//1-->3
2273   5                          continue;
2274   5                      }
2275   4                  }//å¦‚æœåŒº1æœ‰ä»¶
2276   3                  if(loc_high[2]<5){
2277   4                      if(str_pass.jx[2][loc_high[2]]==str_end.jx[3][loc_high[3]-1]){
2278   5                          fun_najian(2,3,loc_high,str_pass.jx);//2-->3
2279   5                          continue;
2280   5                      }
2281   4                  }//å¦‚æœåŒº2æœ‰ä»¶
2282   3                  if(loc_high[0]<5){
2283   4                      if(str_pass.jx[0][loc_high[0]]==str_end.jx[3][loc_high[3]-1]){
2284   5                          fun_najian(0,3,loc_high,str_pass.jx);//0-->3
2285   5                          continue;
2286   5                      }
2287   4                      if(str_pass.jx[0][loc_high[0]]==str_end.jx[7][loc_high[7]-1]){
2288   5                          fun_najian(0,7,loc_high,str_pass.jx);//0-->7
2289   5                          continue;
2290   5                      }
2291   4                  }//å¦‚æœåŒº0æœ‰ä»¶
2292   3      
2293   3                  //ä¸å¯ä»¥ä¸€æ¬¡æ‹¿èµ°,éœ€è¦ä¸­é—´ä½çš„
2294   3                  if(loc_high[0]<5){
2295   4                      if((str_pass.jx[0][loc_high[0]]==str_end.jx[3][1])||
2296   4                      (str_pass.jx[0][loc_high[0]]==str_end.jx[3][2])||
2297   4                      (str_pass.jx[0][loc_high[0]]==str_end.jx[3][3])||
2298   4                      (str_pass.jx[0][loc_high[0]]==str_end.jx[3][4])){
2299   5                          if(((loc_high[1]==5)||//å¦‚æœ1åŒºæ²¡æ”¾ä¸œè¥¿æˆ–è€…
2300   5                          (str_pass.jx[0][loc_high[0]]>str_pass.jx[1][loc_high[1]]))&&//0åŒºçš„ä»¶ç¼–å·å¤§äº1å
             -Œºçš„ç¼–å·å¹¶ä¸”
2301   5                          (loc_high[1]>2)){//1åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
2302   6                              fun_najian(0,1,loc_high,str_pass.jx);//0-->1
2303   6                              continue;
2304   6                          }
2305   5                          if(((loc_high[2]==5)||//å¦‚æœ2åŒºæ²¡æ”¾ä¸œè¥¿æˆ–è€…
2306   5                          (str_pass.jx[0][loc_high[0]]>str_pass.jx[2][loc_high[2]]))&&//0åŒºçš„ä»¶ç¼–å·å¤§äº2å
             -Œºçš„ç¼–å·å¹¶ä¸”
2307   5                          (loc_high[2]>2)){//2åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
2308   6                              fun_najian(0,2,loc_high,str_pass.jx);//0-->2
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 39  

2309   6                              continue;
2310   6                          }
2311   5                      }//å¦‚æœè¦æ”¾åœ¨3ä¸Š,ä½†ç›®å‰ä¸èƒ½æ”¾
2312   4                      if((str_pass.jx[0][loc_high[0]]==str_end.jx[7][1])||
2313   4                      (str_pass.jx[0][loc_high[0]]==str_end.jx[7][2])||
2314   4                      (str_pass.jx[0][loc_high[0]]==str_end.jx[7][3])||
2315   4                      (str_pass.jx[0][loc_high[0]]==str_end.jx[7][4])){
2316   5                          if(((loc_high[5]==5)||//å¦‚æœ5åŒºæ²¡ä¸œè¥¿æ”¾æˆ–è€…
2317   5                          (str_pass.jx[0][loc_high[0]]>str_pass.jx[5][loc_high[5]]))&&//0åŒºçš„ä»¶ç¼–å·å¤§äº5å
             -Œºçš„ç¼–å·å¹¶ä¸”
2318   5                          (loc_high[5]>2)){//5åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
2319   6                              fun_najian(0,5,loc_high,str_pass.jx);//0-->5
2320   6                              continue;
2321   6                          }
2322   5                          if(((loc_high[6]==5)||//å¦‚æœ6åŒºæ²¡ä¸œè¥¿æ”¾æˆ–è€…
2323   5                          (str_pass.jx[0][loc_high[0]]>str_pass.jx[6][loc_high[6]]))&&//0åŒºçš„ä»¶ç¼–å·å¤§äº6å
             -Œºçš„ç¼–å·å¹¶ä¸”
2324   5                          (loc_high[6]>2)){//6åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
2325   6                              fun_najian(0,6,loc_high,str_pass.jx);//0-->6
2326   6                              continue;
2327   6                          }
2328   5                      }//å¦‚æœè¦æ”¾åœ¨7ä¸Š,ä½†ç›®å‰ä¸èƒ½æ”¾
2329   4                  }//å¦‚æœåŒº0æœ‰ä»¶
2330   3      
2331   3                  //ä¸­é—´ä¸¤ä¸ªä½ç½®ä¹Ÿä¸èƒ½ä¸€æ¬¡æå®šçš„
2332   3                  if((loc_high[1]<5)&&(loc_high[2]<5)){
2333   4                      if((str_pass.jx[1][loc_high[1]]>str_pass.jx[2][loc_high[2]])&&(loc_high[2]>1)){
2334   5                          fun_najian(1,2,loc_high,str_pass.jx);//1-->2
2335   5                          continue;
2336   5                      }//1çš„ä»¶æ¯”2çš„ä»¶å¤§ä¸”åŒº2æ”¾äº†ä¸åˆ°3ä¸ªä»¶
2337   4                      if((str_pass.jx[2][loc_high[2]]>str_pass.jx[1][loc_high[1]])&&(loc_high[1]>1)){
2338   5                          fun_najian(2,1,loc_high,str_pass.jx);//2-->1
2339   5                          continue;
2340   5                      }//2çš„ä»¶æ¯”1çš„ä»¶å¤§ä¸”åŒº1æ”¾äº†ä¸åˆ°3ä¸ªä»¶
2341   4                  }//å¦‚æœåŒº1å’ŒåŒº2éƒ½æœ‰ä»¶
2342   3      
2343   3                  //ä¸­é—´ä¸¤ä¸ªä½ç½®æ€ä¹ˆä¹Ÿæä¸å®šçš„
2344   3                  if((loc_high[1]<5)&&(loc_high[2]<5)){
2345   4                      if((loc_high[0]>1)&&(str_pass.jx[1][loc_high[1]]>str_pass.jx[0][loc_high[0]])){
2346   5                          fun_najian(1,0,loc_high,str_pass.jx);//1-->0
2347   5                          continue;
2348   5                      }//1åŒºçš„ä»¶æ¯”0åŒºçš„å¤§ä¸”0åŒºæ”¾äº†ä¸åˆ°3ä¸ªä»¶
2349   4                      if((loc_high[0]>1)&&(str_pass.jx[2][loc_high[2]]>str_pass.jx[0][loc_high[0]])){
2350   5                          fun_najian(2,0,loc_high,str_pass.jx);//2-->0
2351   5                          continue;
2352   5                      }//2åŒºçš„ä»¶æ¯”0åŒºçš„å¤§ä¸”0åŒºæ”¾äº†ä¸åˆ°3ä¸ªä»¶
2353   4                  }
2354   3              }//å¦‚æœå›è½¬åœ¨å·¦è¾¹ 
2355   2              if(str_begin.hzfx==dir_right){
2356   3                  //è½¬å‘æ¡ä»¶
2357   3                  loc_xh1++;//æ ‡å¿—ä½+1
2358   3                  if(loc_xh1>=100){
2359   4                      loc_xh1=0;
2360   4                      fun_zjzt(mot_sj,fun_min(loc_high[0],loc_high[1],loc_high[2],loc_high[3],loc_high[4],loc_hi
             -gh[5],loc_high[6],loc_high[7],def_end)-1);
2361   4                      fun_hz(dir_left);
2362   4                  }
2363   3                  //å¯ä»¥ä¸€æ¬¡æ‹¿èµ°,ä¸éœ€è¦ä¸­é—´ä½çš„
2364   3                  if(loc_high[5]<5){
2365   4                      if(str_pass.jx[5][loc_high[5]]==str_end.jx[7][loc_high[7]-1]){
2366   5                          fun_najian(5,7,loc_high,str_pass.jx);//5-->7
2367   5                          continue;
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 40  

2368   5                      }//5-->7
2369   4                  }//å¦‚æœåŒº5æœ‰ä»¶
2370   3                  if(loc_high[6]<5){
2371   4                      if(str_pass.jx[6][loc_high[6]]==str_end.jx[7][loc_high[7]-1]){
2372   5                          fun_najian(6,7,loc_high,str_pass.jx);//6-->7
2373   5                          continue;
2374   5                      }//6-->7
2375   4                  }//å¦‚æœåŒº6æœ‰ä»¶
2376   3                  if(loc_high[4]<5){
2377   4                      if(str_pass.jx[4][loc_high[4]]==str_end.jx[7][loc_high[7]-1]){
2378   5                          fun_najian(4,7,loc_high,str_pass.jx);//4-->7
2379   5                          continue;
2380   5                      }//4-->7
2381   4                      if(str_pass.jx[4][loc_high[4]]==str_end.jx[3][loc_high[3]-1]){
2382   5                          fun_najian(4,3,loc_high,str_pass.jx);//4-->3
2383   5                          continue;
2384   5                      }//4-->3
2385   4                  }//å¦‚æœåŒº4æœ‰ä»¶
2386   3      
2387   3                  //ä¸å¯ä»¥ä¸€æ¬¡æ‹¿èµ°,éœ€è¦ä¸­é—´ä½çš„
2388   3                  if(loc_high[4]<5){
2389   4                      if((str_pass.jx[4][loc_high[4]]==str_end.jx[7][1])||
2390   4                      (str_pass.jx[4][loc_high[4]]==str_end.jx[7][2])||
2391   4                      (str_pass.jx[4][loc_high[4]]==str_end.jx[7][3])||
2392   4                      (str_pass.jx[4][loc_high[4]]==str_end.jx[7][4])){
2393   5                          if(((loc_high[5]==5)||//å¦‚æœ5åŒºæ²¡ä¸œè¥¿æ”¾æˆ–è€…
2394   5                          (str_pass.jx[4][loc_high[4]]>str_pass.jx[5][loc_high[5]]))&&//4åŒºçš„ä»¶ç¼–å·å¤§äº5å
             -Œºçš„ç¼–å·å¹¶ä¸”
2395   5                          (loc_high[5]>2)){//5åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
2396   6                              fun_najian(4,5,loc_high,str_pass.jx);//4-->5
2397   6                              continue;
2398   6                          }
2399   5                          if(((loc_high[6]==5)||//å¦‚æœ6åŒºæ²¡ä¸œè¥¿æ”¾æˆ–è€…
2400   5                          (str_pass.jx[4][loc_high[4]]>str_pass.jx[6][loc_high[6]]))&&//4åŒºçš„ä»¶ç¼–å·å¤§äº6å
             -Œºçš„ç¼–å·å¹¶ä¸”
2401   5                          (loc_high[6]>2)){//6åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
2402   6                              fun_najian(4,6,loc_high,str_pass.jx);//4-->6
2403   6                              continue;
2404   6                          }
2405   5                      }//å¦‚æœè¦æ”¾åœ¨7ä¸Š,ä½†ç›®å‰ä¸èƒ½æ”¾
2406   4                      if((str_pass.jx[4][loc_high[4]]==str_end.jx[3][1])||
2407   4                      (str_pass.jx[4][loc_high[4]]==str_end.jx[3][2])||
2408   4                      (str_pass.jx[4][loc_high[4]]==str_end.jx[3][3])||
2409   4                      (str_pass.jx[4][loc_high[4]]==str_end.jx[3][4])){
2410   5                          if(((loc_high[1]==5)||//å¦‚æœ1åŒºæ²¡æ”¾ä¸œè¥¿æˆ–è€…
2411   5                          (str_pass.jx[4][loc_high[4]]>str_pass.jx[1][loc_high[1]]))&&//4åŒºçš„ä»¶ç¼–å·å¤§äº1å
             -Œºçš„ç¼–å·å¹¶ä¸”
2412   5                          (loc_high[1]>2)){//1åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
2413   6                              fun_najian(4,1,loc_high,str_pass.jx);//4-->1
2414   6                              continue;
2415   6                          }
2416   5                          if(((loc_high[2]==5)||//å¦‚æœ2åŒºæ²¡æ”¾ä¸œè¥¿æˆ–è€…
2417   5                              (str_pass.jx[4][loc_high[4]]>str_pass.jx[2][loc_high[2]]))&&//4åŒºçš„ä»¶ç¼–å·å¤§ä
             -º2åŒºçš„ç¼–å·å¹¶ä¸”
2418   5                              (loc_high[2]>2)){//2åŒºä¸èƒ½æ”¾è¶…è¿‡2ä¸ªä»¶
2419   6                              fun_najian(4,2,loc_high,str_pass.jx);//4-->2
2420   6                              continue;
2421   6                          }
2422   5                      }//å¦‚æœè¦æ”¾åœ¨3ä¸Š,ä½†ç›®å‰ä¸èƒ½æ”¾
2423   4                  }//å¦‚æœåŒº4æœ‰ä»¶
2424   3      
2425   3                  //ä¸­é—´ä¸¤ä¸ªä½ç½®ä¹Ÿä¸èƒ½ä¸€æ¬¡æå®šçš„
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 41  

2426   3                  if((loc_high[5]<5)&&(loc_high[6]<5)){
2427   4                      if((str_pass.jx[5][loc_high[5]]>str_pass.jx[6][loc_high[6]])&&(loc_high[6]>1)){
2428   5                          fun_najian(5,6,loc_high,str_pass.jx);//5-->6
2429   5                          continue;
2430   5                      }//5çš„ä»¶æ¯”6çš„ä»¶å¤§ä¸”åŒº6æ”¾äº†ä¸åˆ°3ä¸ªä»¶
2431   4                      if((str_pass.jx[6][loc_high[6]]>str_pass.jx[5][loc_high[5]])&&(loc_high[5]>1)){
2432   5                          fun_najian(6,5,loc_high,str_pass.jx);//6-->5
2433   5                          continue;
2434   5                      }//6çš„ä»¶æ¯”5çš„ä»¶å¤§ä¸”åŒº5æ”¾äº†ä¸åˆ°3ä¸ªä»¶
2435   4                  }//å¦‚æœåŒº5å’ŒåŒº6éƒ½æœ‰ä»¶
2436   3      
2437   3                  //ä¸­é—´ä¸¤ä¸ªä½ç½®æ€ä¹ˆä¹Ÿæä¸å®šçš„
2438   3                  if((loc_high[5]<5)&&(loc_high[6]<5)){
2439   4                      if((loc_high[4]>1)&&(str_pass.jx[5][loc_high[5]]>str_pass.jx[4][loc_high[4]])){
2440   5                          fun_najian(5,4,loc_high,str_pass.jx);//5-->4
2441   5                          continue;
2442   5                      }//5åŒºçš„ä»¶æ¯”4åŒºçš„å¤§ä¸”4åŒºæ”¾äº†ä¸åˆ°3ä¸ªä»¶
2443   4                      if((loc_high[4]>1)&&(str_pass.jx[6][loc_high[6]]>str_pass.jx[4][loc_high[4]])){
2444   5                          fun_najian(6,4,loc_high,str_pass.jx);//6-->4
2445   5                          continue;
2446   5                      }//6åŒºçš„ä»¶æ¯”4åŒºçš„å¤§ä¸”4åŒºæ”¾äº†ä¸åˆ°3ä¸ªä»¶
2447   4                  }
2448   3              }//å¦‚æœå›è½¬åœ¨å³è¾¹
2449   2          }    
2450   1      }//è‡ªåŠ¨æŠ“ä»¶
2451          void fun_zjzt(uc par_motor,char par_model){
2452   1          if(par_motor==mot_pyhz){
2453   2              switch(par_model){
2454   3                  case 0:
2455   3                      if((str_begin.pywz==tra_h)&&(str_begin.hzfx==dir_left))
2456   3                          break;
2457   3                      if(str_begin.hzfx==dir_right)
2458   3                          fun_pyhz(tra_z,dir_left);
2459   3                      fun_py(tra_h);
2460   3                      break;
2461   3                  case 1:
2462   3                      if((str_begin.pywz==tra_kh)&&(str_begin.hzfx==dir_left))
2463   3                          break;
2464   3                      if(str_begin.hzfx==dir_right)
2465   3                          fun_pyhz(tra_z,dir_left);
2466   3                      fun_py(tra_kh);
2467   3                      break;
2468   3                  case 2:
2469   3                      if((str_begin.pywz==tra_kq)&&(str_begin.hzfx==dir_left))
2470   3                          break;
2471   3                      if(str_begin.hzfx==dir_right)
2472   3                          fun_pyhz(tra_z,dir_left);
2473   3                      fun_py(tra_kq);
2474   3                      break;
2475   3                  case 3:
2476   3                      if((str_begin.pywz==tra_q)&&(str_begin.hzfx==dir_left))
2477   3                          break;
2478   3                      if(str_begin.hzfx==dir_right)
2479   3                          fun_pyhz(tra_z,dir_left);
2480   3                      fun_py(tra_q);
2481   3                      break;
2482   3                  case 4:
2483   3                      if((str_begin.pywz==tra_q)&&(str_begin.hzfx==dir_right))
2484   3                          break;
2485   3                      if(str_begin.hzfx==dir_left)
2486   3                          fun_pyhz(tra_z,dir_right);
2487   3                      fun_py(tra_q);
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 42  

2488   3                      break;
2489   3                  case 5:
2490   3                      if((str_begin.pywz==tra_kq)&&(str_begin.hzfx==dir_right))
2491   3                          break;
2492   3                      if(str_begin.hzfx==dir_left)
2493   3                          fun_pyhz(tra_z,dir_right);
2494   3                      fun_py(tra_kq);
2495   3                      break;
2496   3                  case 6:
2497   3                      if((str_begin.pywz==tra_kh)&&(str_begin.hzfx==dir_right))
2498   3                          break;
2499   3                      if(str_begin.hzfx==dir_left)
2500   3                          fun_pyhz(tra_z,dir_right);
2501   3                      fun_py(tra_kh);
2502   3                      break;
2503   3                  case 7:
2504   3                      if((str_begin.pywz==tra_h)&&(str_begin.hzfx==dir_right))
2505   3                          break;
2506   3                      if(str_begin.hzfx==dir_left)
2507   3                          fun_pyhz(tra_z,dir_right);
2508   3                      fun_py(tra_h);
2509   3                      break;
2510   3                  default:
2511   3                      break;
2512   3              }
2513   2          }
2514   1          else if(par_motor==mot_sj){
2515   2              switch(par_model){
2516   3                  case 0:
2517   3                      fun_sj(sjp_1);
2518   3                      break;
2519   3                  case 1:
2520   3                      fun_sj(sjp_2);
2521   3                      break;
2522   3                  case 2:
2523   3                      fun_sj(sjp_3);
2524   3                      break;
2525   3                  case 3:
2526   3                      fun_sj(sjp_4);
2527   3                      break;
2528   3                  case 4:
2529   3                      fun_sj(sjp_5);
2530   3                      break;
2531   3                  default:
2532   3                      if(par_model<0)
2533   3                          fun_sj(sjp_1);
2534   3                      else if(par_model>5)
2535   3                          fun_sj(sjp_5);
2536   3                      break;
2537   3              }
2538   2          }
2539   1      }//æŠ“ä»¶çŠ¶æ€,0ä¸ºå·¦ä¸Šä½,3ä¸ºå·¦ä¸‹ä½,4ä¸ºå³ä¸Šä½,7ä¸ºå³ä¸‹ä½
2540          void fun_najian(uc par_now,uc par_next,char par_high[8],uc par_data[8][5]){
2541   1          #ifdef Debug
                      printf("%d --> %d\n",(ui)par_now,(ui)par_next);
                  #else
2544   1              //å–å„ä½ç½®çš„æœ€é«˜ä½
2545   1              uc loc_high=fun_min(par_high[0],par_high[1],par_high[2],par_high[3],par_high[4],par_high[5],par_hi
             -gh[6],par_high[7],def_end);
2546   1              //å‡èµ·
2547   1              if(par_now==0||par_now==1||par_now==2||par_now==3){
2548   2                  if(str_begin.hzfx==dir_left)
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 43  

2549   2                      fun_zjzt(mot_sj,fun_min(par_high[0],par_high[1],par_high[2],par_high[3],def_end)-1);
2550   2                  else if(str_begin.hzfx==dir_right)
2551   2                      fun_zjzt(mot_sj,fun_min(par_high[0],par_high[1],par_high[2],par_high[3],par_high[4],par_hi
             -gh[5],par_high[6],par_high[7],def_end)-1);            
2552   2              }
2553   1              else if(par_now==4||par_now==5||par_now==6||par_now==7){
2554   2                  if(str_begin.hzfx==dir_right)
2555   2                      fun_zjzt(mot_sj,fun_min(par_high[4],par_high[5],par_high[6],par_high[7],def_end)-1);
2556   2                  else if(str_begin.hzfx==dir_left)
2557   2                      fun_zjzt(mot_sj,fun_min(par_high[0],par_high[1],par_high[2],par_high[3],par_high[4],par_hi
             -gh[5],par_high[6],par_high[7],def_end)-1);            
2558   2              }
2559   1              //å¹³ç§»å›è½¬åˆ°éœ€è¦çš„åœ°æ–¹
2560   1              fun_zjzt(mot_pyhz,par_now);
2561   1              //ä¸‹é™åˆ°å·¥ä»¶çš„ä½ç½®
2562   1              fun_zjzt(mot_sj,par_high[par_now]);
2563   1              //æŠ“ç´§å·¥ä»¶
2564   1              fun_sz(han_j);
2565   1              //ä¸Šå‡åˆ°æ­£ç¡®çš„æœ€é«˜ä½
2566   1              switch(par_now){
2567   2                  case 0:
2568   2                      switch(par_next){
2569   3                          case 1:
2570   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
2571   3                              break;
2572   3                          case 2:
2573   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[1],par_high[par_ne
             -xt],def_end)-2);
2574   3                              break;
2575   3                          case 3:
2576   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[1],par_high[2],par
             -_high[par_next],def_end)-2);
2577   3                              break;
2578   3                          case 4:
2579   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[1],par_high[5],par
             -_high[par_next],def_end)-2);
2580   3                              break;
2581   3                          case 5:
2582   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[1],par_high[par_ne
             -xt],def_end)-2);
2583   3                              break;
2584   3                          case 6:
2585   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[1],par_high[par_ne
             -xt],def_end)-2);
2586   3                              break;
2587   3                          case 7:
2588   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[1],par_high[6],par
             -_high[par_next],def_end)-2);
2589   3                              break;
2590   3                          default:
2591   3                              break;
2592   3                      }
2593   2                      break;
2594   2                  case 1:
2595   2                      switch(par_next){
2596   3                          case 0:
2597   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
2598   3                              break;
2599   3                          case 2:
2600   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 44  

             --2);
2601   3                              break;
2602   3                          case 3:
2603   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[2],par_high[par_ne
             -xt],def_end)-2);
2604   3                              break;
2605   3                          case 4:
2606   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[5],par_high[par_ne
             -xt],def_end)-2);
2607   3                              break;
2608   3                          case 5:
2609   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
2610   3                              break;
2611   3                          case 6:
2612   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
2613   3                              break;
2614   3                          case 7:
2615   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[6],par_high[par_ne
             -xt],def_end)-2);
2616   3                              break;
2617   3                          default:
2618   3                              break;
2619   3                      }
2620   2                      break;
2621   2                  case 2:
2622   2                      switch(par_next){
2623   3                          case 0:
2624   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[1],par_high[par_ne
             -xt],def_end)-2);
2625   3                              break;
2626   3                          case 1:
2627   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
2628   3                              break;
2629   3                          case 3:
2630   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
2631   3                              break;
2632   3                          case 4:
2633   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[5],par_high[par_ne
             -xt],def_end)-2);
2634   3                              break;
2635   3                          case 5:
2636   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
2637   3                              break;
2638   3                          case 6:
2639   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
2640   3                              break;
2641   3                          case 7:
2642   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[6],par_high[par_ne
             -xt],def_end)-2);
2643   3                              break;
2644   3                          default:
2645   3                              break;
2646   3                      }
2647   2                      break;
2648   2                  case 3:
2649   2                      switch(par_next){
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 45  

2650   3                          case 0:
2651   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[2],par_high[1],par
             -_high[par_next],def_end)-2);
2652   3                              break;
2653   3                          case 1:
2654   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[2],par_high[par_ne
             -xt],def_end)-2);
2655   3                              break;
2656   3                          case 2:
2657   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
2658   3                              break;
2659   3                          case 4:
2660   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[2],par_high[5],par
             -_high[par_next],def_end)-2);
2661   3                              break;
2662   3                          case 5:
2663   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[2],par_high[par_ne
             -xt],def_end)-2);
2664   3                              break;
2665   3                          case 6:
2666   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[2],par_high[par_ne
             -xt],def_end)-2);
2667   3                              break;
2668   3                          case 7:
2669   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[2],par_high[6],par
             -_high[par_next],def_end)-2);
2670   3                              break;
2671   3                          default:
2672   3                              break;
2673   3                      }
2674   2                      break;
2675   2                  case 4:
2676   2                      switch(par_next){
2677   3                          case 0:
2678   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[5],par_high[1],par
             -_high[par_next],def_end)-2);
2679   3                              break;
2680   3                          case 1:
2681   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[5],par_high[par_ne
             -xt],def_end)-2);
2682   3                              break;
2683   3                          case 2:
2684   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[5],par_high[par_ne
             -xt],def_end)-2);
2685   3                              break;
2686   3                          case 3:
2687   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[5],par_high[2],par
             -_high[par_next],def_end)-2);
2688   3                              break;
2689   3                          case 5:
2690   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
2691   3                              break;
2692   3                          case 6:
2693   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[5],par_high[par_ne
             -xt],def_end)-2);
2694   3                              break;
2695   3                          case 7:
2696   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[5],par_high[6],par
             -_high[par_next],def_end)-2);
2697   3                              break;
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 46  

2698   3                          default:
2699   3                              break;
2700   3                      }
2701   2                      break;
2702   2                  case 5:
2703   2                      switch(par_next){
2704   3                          case 0:
2705   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[1],par_high[par_ne
             -xt],def_end)-2);
2706   3                              break;
2707   3                          case 1:
2708   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
2709   3                              break;
2710   3                          case 2:
2711   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
2712   3                              break;
2713   3                          case 3:
2714   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[2],par_high[par_ne
             -xt],def_end)-2);
2715   3                              break;
2716   3                          case 4:
2717   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
2718   3                              break;
2719   3                          case 6:
2720   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
2721   3                              break;
2722   3                          case 7:
2723   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[6],par_high[par_ne
             -xt],def_end)-2);
2724   3                              break;
2725   3                          default:
2726   3                              break;
2727   3                      }
2728   2                      break;
2729   2                  case 6:
2730   2                      switch(par_next){
2731   3                          case 0:
2732   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[1],par_high[par_ne
             -xt],def_end)-2);
2733   3                              break;
2734   3                          case 1:
2735   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
2736   3                              break;
2737   3                          case 2:
2738   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
2739   3                              break;
2740   3                          case 3:
2741   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[2],par_high[par_ne
             -xt],def_end)-2);
2742   3                              break;
2743   3                          case 4:
2744   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[5],par_high[par_ne
             -xt],def_end)-2);
2745   3                              break;
2746   3                          case 5:
2747   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 47  

             --2);
2748   3                              break;
2749   3                          case 7:
2750   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
2751   3                              break;
2752   3                          default:
2753   3                              break;
2754   3                      }
2755   2                      break;
2756   2                  case 7:
2757   2                      switch(par_next){
2758   3                          case 0:
2759   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[6],par_high[1],par
             -_high[par_next],def_end)-2);
2760   3                              break;
2761   3                          case 1:
2762   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[6],par_high[par_ne
             -xt],def_end)-2);
2763   3                              break;
2764   3                          case 2:
2765   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[6],par_high[par_ne
             -xt],def_end)-2);
2766   3                              break;
2767   3                          case 3:
2768   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[6],par_high[2],par
             -_high[par_next],def_end)-2);
2769   3                              break;
2770   3                          case 4:
2771   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[5],par_high[6],par
             -_high[par_next],def_end)-2);
2772   3                              break;
2773   3                          case 5:
2774   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[6],par_high[par_ne
             -xt],def_end)-2);
2775   3                              break;
2776   3                          case 6:
2777   3                              fun_zjzt(mot_sj,fun_min(loc_high+2,par_high[par_now]+1,par_high[par_next],def_end)
             --2);
2778   3                              break;
2779   3                          default:
2780   3                              break;
2781   3                      }
2782   2                      break;
2783   2                  default:
2784   2                      break;
2785   2              }
2786   1              //å¹³ç§»å›è½¬è‡³æ”¾ä»¶å¤„
2787   1              fun_zjzt(mot_pyhz,par_next);
2788   1              //ä¸‹é™åˆ°è¦æ”¾ä¸‹çš„ä½ç½®
2789   1              fun_zjzt(mot_sj,par_high[par_next]-1);
2790   1              //æ¾å¼€æ‰‹æŠ“
2791   1              fun_sz(han_s);
2792   1          #endif
2793   1      
2794   1          //æ›´æ–°å‚æ•°
2795   1          par_data[par_next][par_high[par_next]-1]=par_data[par_now][par_high[par_now]];
2796   1          par_data[par_now][par_high[par_now]]=0;
2797   1          par_high[par_now]++;
2798   1          par_high[par_next]--;
2799   1      }//æ‹¿ä»¶(é…åˆè‡ªåŠ¨æŠ“ä»¶ä½¿ç”¨)
2800          void fun_zhuajian(){
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 48  

2801   1          fun_sz(han_s);                 //æ‰‹æŠ“æ¾
2802   1          fun_sj(sjp_1);                 //ä¸Šå‡åˆ°æœ€é«˜ä½
2803   1          fun_py(tra_q);                 //å¹³ç§»åˆ°å‰ç«¯
2804   1          if(str_begin.hzfx!=dir_right)  //å¦‚æœä¸åœ¨å³è¾¹
2805   1              fun_hz(dir_right);         //å°±å¹³ç§»åˆ°å³è¾¹
2806   1      
2807   1          fun_folline(2,60);
2808   1          fun_turn(tur_l90,40);
2809   1          fun_folline(1,60);
2810   1          fun_qc(100,40);
2811   1          while((!in_ls4||!in_ls5)||(in_ls1||in_ls2||in_ls3||in_ls6||in_ls7||in_ls8)){
2812   2              if(in_ls1||in_ls2||in_ls3||!in_ls5){
2813   3                  fun_motors(mot_rl,-30);
2814   3                  fun_delay(300,del_ms);
2815   3                  fun_motors(mot_r,-20);
2816   3                  fun_motors(mot_l,-30);
2817   3                  fun_delay(300,del_ms);
2818   3                  fun_motors(mot_rl,-30);
2819   3                  fun_delay(300,del_ms);
2820   3              }//3äº®æˆ–5ä¸äº®
2821   2              else if(in_ls6||in_ls7||in_ls8||!in_ls4){
2822   3                  fun_motors(mot_rl,-30);
2823   3                  fun_delay(300,del_ms);
2824   3                  fun_motors(mot_r,-30);
2825   3                  fun_motors(mot_l,-29);
2826   3                  fun_delay(300,del_ms);
2827   3                  fun_motors(mot_rl,-30);
2828   3                  fun_delay(300,del_ms);
2829   3              }//6äº®æˆ–4ä¸äº®
2830   2              fun_qc(200,40);//é‡æ–°è¿›è¡Œå‰å†²
2831   2          }
2832   1          fun_motors(mot_rl,0);
2833   1      }//ä»èµ·å§‹åŒºèµ°åˆ°æŠ“ä»¶åŒº
2834          void fun_back(){
2835   1          fun_motors(mot_rl,-25);
2836   1          fun_delay(1,del_s);
2837   1      
2838   1          fun_motors(mot_r,-48);
2839   1          fun_motors(mot_l,-20);
2840   1          fun_delay(3,del_s);    
2841   1      
2842   1          fun_motors(mot_rl,-35);
2843   1          fun_delay(1,del_s);
2844   1          fun_motors(mot_rl,0);
2845   1      }//ä»æŠ“ä»¶åŒºå›åˆ°èµ·å§‹åŒº
2846          void fun_start(char par_x,char par_y,enum varENU_dir par_ctfx,
2847              enum varENU_han par_szzt,enum varENU_sjp par_sjwz,enum varENU_tra par_pywz,enum varENU_dir par_hzfx){
2848   1          CLK_DIV=0x00;             //ä¸åˆ†é¢‘
2849   1          P0M1=0xff;                //P0ç”¨äºè¾“å…¥
2850   1          P0M0=0x00;                //P0ä¸èƒ½è¾“å‡º
2851   1          P1M1=0x00;                //P1å£0-1åŒå‘
2852   1          P1M0=0xfc;                //P1å£2-7è¾“å‡º
2853   1          P2M1=0xf0;                //P2å£4-7è¾“å…¥
2854   1          P2M0=0x0f;                //P2å£0-3è¾“å‡º
2855   1      
2856   1          out_en1=1;                //ç”µæœº1/3ä½¿èƒ½
2857   1          out_en2=1;                //ç”µæœº2/4ä½¿èƒ½
2858   1          CR=0;                     //PACè®¡æ•°å™¨å½’é›¶
2859   1          out_motorselect=0;        //ç”µæœºç‰‡é€‰ä¸º0
2860   1      
2861   1          fun_port();               //åˆå§‹åŒ–ä¸²å£
2862   1          TI=1;                     //æ‰“å¼€ä¸²å£ä¼ è¾“åŠŸèƒ½
C51 COMPILER V9.54   8023                                                                  10/26/2015 17:20:13 PAGE 49  

2863   1      
2864   1          fun_pwminit();            //PWMçš„åˆå§‹åŒ–
2865   1      
2866   1          fun_timer0init();         //åˆå§‹åŒ–å®šæ—¶å™¨0
2867   1          fun_timer1init();         //åˆå§‹åŒ–å®šæ—¶å™¨1
2868   1          TR0=1;                    //æ‰“å¼€å®šæ—¶å™¨0
2869   1          TR1=1;                    //æ‰“å¼€å®šæ—¶å™¨1
2870   1          var_timer=0;              //å®šæ—¶å™¨å®šæ—¶æ ‡å¿—ä½å½’é›¶,é€šç”µæ—¶å¼€å§‹è®¡æ—¶
2871   1      
2872   1          memset(str_tfl.step,0,sizeof(str_tfl.step));//æ¸…é›¶å·¡çº¿ç”¨æ­¥éª¤æ•°ç»„
2873   1          memset(str_zbfl.xy,0,sizeof(str_zbfl.xy));//æ¸…ç©ºåæ ‡
2874   1          str_zbfl.top.value=0;//é¡¶ä¸Šçš„å·¥ä½å·
2875   1          str_zbfl.top.fx=dir_up;//é¡¶ä¸Šçš„æ–¹å‘
2876   1      
2877   1          str_begin.x=par_x;        //Xåæ ‡
2878   1          str_begin.y=par_y;        //Yåæ ‡
2879   1          str_begin.ctfx=par_ctfx;  //è½¦å¤´æ–¹å‘
2880   1          str_begin.szzt=par_szzt;  //æ‰‹æŠ“çŠ¶æ€
2881   1          str_begin.sjwz=par_sjwz;  //å‡é™ä½ç½®
2882   1          str_begin.pywz=par_pywz;  //å¹³ç§»ä½ç½®
2883   1          str_begin.hzfx=par_hzfx;  //å›è½¬æ–¹å‘
2884   1      
2885   1          str_tfl.gospeed=0;        //é€Ÿåº¦å½’é›¶
2886   1          fun_motors(mot_sz,0);     //æ‰‹æŠ“é€Ÿåº¦å½’é›¶
2887   1          fun_motors(mot_py,0);     //å¹³ç§»é€Ÿåº¦å½’é›¶
2888   1          fun_motors(mot_sj,0);     //æ‰‹æŠ“é€Ÿåº¦å½’é›¶
2889   1          fun_motors(mot_hz,0);     //æ‰‹æŠ“é€Ÿåº¦å½’é›¶
2890   1          fun_motors(mot_rl,0);     //å·¦å³é€Ÿåº¦å½’é›¶
2891   1      
2892   1          #ifdef Debug              //å¦‚æœå¼€å¯è°ƒè¯•æ¨¡å¼
                      fun_delay(5,del_s);
                      MSG("Ready!")         //è¾“å‡ºReady!
                  #else
2896   1              fun_wait();           //ç­‰å¾…æŒ‰é”®
2897   1          #endif
2898   1      }//åˆå§‹åŒ–å‡½æ•°
2899          void fun_stop(){
2900   1          EA=0;                   //å…³æ€»ä¸­æ–­
2901   1          str_tfl.gospeed=0;      //é€Ÿåº¦å½’é›¶
2902   1          fun_motors(mot_sz,0);   //æ‰‹æŠ“é€Ÿåº¦å½’é›¶
2903   1          fun_motors(mot_py,0);   //å¹³ç§»é€Ÿåº¦å½’é›¶
2904   1          fun_motors(mot_sj,0);   //æ‰‹æŠ“é€Ÿåº¦å½’é›¶
2905   1          fun_motors(mot_hz,0);   //æ‰‹æŠ“é€Ÿåº¦å½’é›¶
2906   1          fun_motors(mot_rl,0);   //å·¦å³é€Ÿåº¦å½’é›¶
2907   1          MSG("End!")             //è¾“å‡ºEnd!
2908   1          while(1);               //æ­»å¾ªç¯
2909   1      }//ç»“æŸå‡½æ•°


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =  19213    ----
   CONSTANT SIZE    =      9    ----
   XDATA SIZE       =    550     291
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5      12
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
