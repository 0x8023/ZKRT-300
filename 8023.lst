C51 COMPILER V9.54   8023                                                                  09/13/2015 15:13:32 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE 8023
OBJECT MODULE PLACED IN .\output\8023.obj
COMPILER INVOKED BY: D:\MyProgram\keil\C51\BIN\C51.EXE program\8023.c OPTIMIZE(8,SPEED) DEBUG OBJECTEXTEND PRINT(.\8023.
                    -lst) OBJECT(.\output\8023.obj)

line level    source

   1          #include "./output/8023.h"
   2          xdata struct str_state str_begin,str_now,str_next;//åˆ†åˆ«ä¸º:èµ·å§‹çŠ¶æ€/å½“å‰çŠ¶æ€/ç›®æ ‡çŠ¶æ€
   3          xdata struct str_parameter str_cod={
   4              /*ui str_cod.mlinerqd*/25000,//é»˜è®¤ä¸»å‡½æ•°å·¡çº¿è½¯èµ·åŠ¨è·¯ç¨‹ä¸º25000
   5              /*ui str_cod.mlineqc*/200,   //é»˜è®¤ä¸»å‡½æ•°å·¡çº¿å‰å†²æ—¶é—´ä¸º500æ¯«ç§’
   6          
   7              /*ui str_cod.sj1bzw*/58,     //å‡é™æ ‡å‡†ä½å»¶æ—¶
   8              /*ui str_cod.sj1zjw*/800,    //å‡é™ä¸­é—´ä½å»¶æ—¶
   9          
  10              /*ui str_cod.py1bz*/20,      //fun_py1æ ‡å‡†ä½å»¶æ—¶
  11              /*ui str_cod.py1qkq*/666,    //fun_py1å‰åˆ°é å‰å»¶æ—¶å‚æ•°
  12              /*ui str_cod.py1kqz*/684,    //fun_py1é å‰åˆ°ä¸­é—´å»¶æ—¶
  13              /*ui str_cod.py1zkh*/684,    //fun_py1ä¸­é—´åˆ°é åå»¶æ—¶
  14              /*ui str_cod.py1khh*/666,    //fun_py1é ååˆ°åå»¶æ—¶
  15              /*ui str_cod.py1qz*/500,     //fun_py1å‰åˆ°ä¸­é—´å»¶æ—¶
  16              /*ui str_cod.py1zh*/500,     //fun_py1ä¸­é—´åˆ°åå»¶æ—¶
  17              /*ui str_cod.py1kqkh*/1480,  //fun_py1é å‰åˆ°é åå»¶æ—¶
  18              /*ui str_cod.py1qkh*/2122,   //fun_py1å‰åˆ°é åå»¶æ—¶
  19              /*ui str_cod.py1kqh*/2122,   //fun_py1é å‰åˆ°åå»¶æ—¶
  20          
  21              /*ui str_cod.hz1bz*/20,      //fun_hz1æ ‡å‡†ä½å»¶æ—¶
  22          
  23              /*ui turn90;*/500,           //90åº¦è½¬å¼¯å±è”½å»¶æ—¶
  24              /*ui turn180;*/2000          //180åº¦è½¬å¼¯å±è”½å»¶æ—¶
  25          };
  26          xdata struct str_timerfolline str_tfl;
  27          ul var_timer=0;
  28          void fun_delay(ui par_value,enum varENU_del par_model){
  29   1          ui loc_con=par_value;
  30   1          switch(par_model){
  31   2              case del_us://å¾®ç§’çº§å»¶æ—¶
  32   2                  while(loc_con-->0){
  33   3                      _nop_();
  34   3                      _nop_();
  35   3                  }
  36   2                  return;
  37   2              case del_ms://æ¯«ç§’çº§å»¶æ—¶
  38   2                  while(loc_con-->0){
  39   3                      uc loc_i, loc_j;
  40   3                      _nop_();
  41   3                      _nop_();
  42   3                      loc_i=12;
  43   3                      loc_j=168;
  44   3                      do{
  45   4                          while(--loc_j);
  46   4                      }while(--loc_i);
  47   3                  }
  48   2                  return;
  49   2              case del_s://ç§’çº§å»¶æ—¶
  50   2                  while(loc_con-->0){
  51   3                      uc loc_i, loc_j, loc_k;
  52   3                      loc_i=46;
  53   3                      loc_j=153;
  54   3                      loc_k=245;
C51 COMPILER V9.54   8023                                                                  09/13/2015 15:13:32 PAGE 2   

  55   3                      do{
  56   4                          do{
  57   5                              while(--loc_k);
  58   5                          }while(--loc_j);
  59   4                      }while(--loc_i);
  60   3                  }
  61   2                  return;
  62   2              default:return;
  63   2          }
  64   1      }//å»¶æ—¶
  65          void fun_timer0init(){
  66   1          AUXR|=0x80;   //å®šæ—¶å™¨æ—¶é’Ÿ1Tæ¨¡å¼
  67   1          TMOD&=0xF0;   //å®šæ—¶å™¨æ¨¡å¼:16ä½
  68   1          TMOD|=0x01;   //å®šæ—¶å™¨æ¨¡å¼:16ä½
  69   1          TL0=0x20;     //å®šæ—¶åˆå€¼:1ms
  70   1          TH0=0xD1;     //å®šæ—¶åˆå€¼:1ms
  71   1          TF0=0;        //æ¸…é™¤TF0æ ‡å¿—
  72   1          ET0=1;
  73   1          EA=1;         //å¼€å¯æ€»ä¸­æ–­
  74   1      }//1æ¯«ç§’å®šæ—¶å™¨0åˆå§‹åŒ–
  75          void fun_timer1init(){
  76   1          AUXR&=0xBF;     //å®šæ—¶å™¨æ—¶é’Ÿ12Tæ¨¡å¼
  77   1          TMOD&=0x0F;     //å®šæ—¶å™¨æ¨¡å¼:16ä½
  78   1          TMOD|=0x10;     //å®šæ—¶å™¨æ¨¡å¼:16ä½
  79   1          TL1=0xE0;       //å®šæ—¶åˆå€¼:20ms
  80   1          TH1=0xB1;       //å®šæ—¶åˆå€¼:20ms
  81   1          TF1=0;          //æ¸…é™¤TF1æ ‡å¿—
  82   1          ET1=1;
  83   1          EA=1;           //å¼€å¯æ€»ä¸­æ–­
  84   1      }//20æ¯«ç§’å®šæ—¶å™¨1åˆå§‹åŒ–
  85          void fun_timer0(){
  86   1          TL0=0x20;
  87   1          TH0=0xD1;//å®šæ—¶å™¨åˆå€¼æ¢å¤è‡³1ms
  88   1          var_timer++;//å…¨å±€è®¡æ—¶å™¨å¼€å§‹è®¡æ—¶
  89   1          if(str_tfl.doing==tf_ture)//å¦‚æœæ­£åœ¨ç§»åŠ¨
  90   1              fun_timermove();//å®šæ—¶å™¨ç§»åŠ¨
  91   1      }//1æ¯«ç§’å®šæ—¶å™¨0å¤„ç†å‡½æ•°
  92          void fun_timer1(){
  93   1          TL1=0xE0;
  94   1          TH1=0xB1;
  95   1      }//20æ¯«ç§’å®šæ—¶å™¨1å¤„ç†å‡½æ•°
  96          void fun_wait(){
  97   1          while(in_start==1);
  98   1          fun_delay(20,del_ms);
  99   1          while(in_start==0);
 100   1          fun_delay(256,del_ms);
 101   1      }//ç­‰å¾…æŒ‰é”®
 102          void fun_pwminit(){
 103   1          CCON=0x00;//PACå¯„å­˜æ§åˆ¶å™¨
 104   1          CH=0;//é‡ç½®PACè®¡æ—¶å™¨
 105   1          CL=0;
 106   1          CMOD=0x08;//ä¸åˆ†é¢‘
 107   1      }//PWMåˆå§‹åŒ–
 108          void fun_pwmr(uc par_value){
 109   1          CCAP0H=CCAP0L=par_value*25/10;//æ§åˆ¶è¾“å‡ºçš„å ç©ºæ¯”
 110   1          CCAPM0=0X42;//8ä½PWMè¾“å‡ºï¼Œæ— ä¸­æ–­
 111   1          PCA_PWM0=0x00;
 112   1      }//å³è·¯PWMè¾“å‡º
 113          void fun_pwml(uc par_value){
 114   1          CCAP1H=CCAP1L=par_value*25/10;//æ§åˆ¶è¾“å‡ºçš„å ç©ºæ¯”
 115   1          CCAPM1=0X42;//8ä½PWMè¾“å‡ºï¼Œæ— ä¸­æ–­
 116   1          PCA_PWM1=0x00;
C51 COMPILER V9.54   8023                                                                  09/13/2015 15:13:32 PAGE 3   

 117   1      }//å·¦è·¯PWMè¾“å‡º
 118          void fun_motors(enum varENU_mot par_model,char par_speed){
 119   1          if(par_speed>100)
 120   1              par_speed=100;
 121   1          else if(par_speed<-100)
 122   1              par_speed=-100;//é€Ÿåº¦æœ€å¤š100,æœ€å°‘-100
 123   1          switch(par_model){
 124   2              case mot_l://å·¦è½®ç”µæœº
 125   2                  if(str_begin.leftsd==par_speed)
 126   2                      return;
 127   2                  else
 128   2                      str_begin.leftsd=par_speed;
 129   2                  if(par_speed==0){
 130   3                      fun_pwml(0);out_pwml=0;
 131   3                  }
 132   2                  else if(par_speed>0){
 133   3                      CR=1;fun_pwml(par_speed);out_pwml=0;
 134   3                  }
 135   2                  else if(par_speed<0){
 136   3                      CR=1;fun_pwml(cabs(par_speed));out_pwml=1;
 137   3                  }
 138   2                  break;
 139   2              case mot_r://å³è½®ç”µæœº
 140   2                  if(str_begin.rightsd==par_speed)
 141   2                      return;
 142   2                  else
 143   2                      str_begin.rightsd=par_speed;
 144   2                  if(par_speed==0){
 145   3                      fun_pwmr(0);out_pwmr=0;
 146   3                  }
 147   2                  else if(par_speed>0){
 148   3                      CR=1;fun_pwmr(par_speed);out_pwmr=0;
 149   3                  }
 150   2                  else if(par_speed<0){
 151   3                      CR=1;fun_pwmr(cabs(par_speed));out_pwmr=1;
 152   3                  }
 153   2                  break;
 154   2              case mot_rl://å·¦å³è½®åŒæ­¥
 155   2                  if((str_begin.leftsd==par_speed)&&(str_begin.rightsd==par_speed))
 156   2                      return;
 157   2                  else
 158   2                      str_begin.leftsd=str_begin.rightsd=par_speed;
 159   2                  if(par_speed==0){
 160   3                      CR=0;
 161   3                      fun_pwmr(0);out_pwmr=0;
 162   3                      fun_pwml(0);out_pwml=0;
 163   3                  }
 164   2                  else if(par_speed>0){
 165   3                      CR=1;
 166   3                      fun_pwml(par_speed);out_pwml=0;
 167   3                      fun_pwmr(par_speed);out_pwmr=0;
 168   3                  }
 169   2                  else if(par_speed<0){
 170   3                      CR=1;
 171   3                      fun_pwml(cabs(par_speed));out_pwml=1;
 172   3                      fun_pwmr(cabs(par_speed));out_pwmr=1;
 173   3                  }
 174   2                  break;
 175   2              case mot_sz://æ­£è½¬ä¸ºæŠ“ç´§ï¼Œåè½¬ä¸ºæ¾å¼€
 176   2                  if(str_begin.szsd==par_speed)
 177   2                      return;
 178   2                  else
C51 COMPILER V9.54   8023                                                                  09/13/2015 15:13:32 PAGE 4   

 179   2                      str_begin.szsd=par_speed;
 180   2                  if(par_speed==0){
 181   3                      out_motorselect=1;out_dir1=0;out_en1=1;
 182   3                  }
 183   2                  else if(par_speed>0){
 184   3                      out_motorselect=1;out_dir1=1;out_en1=0;
 185   3                  }
 186   2                  else if(par_speed<0){
 187   3                      out_motorselect=1;out_dir1=0;out_en1=0;
 188   3                  }
 189   2                  break;
 190   2              case mot_py://æ­£è½¬æ˜¯å‘æ— ç”µæœºä¸€æ–¹è½¬,åè½¬ä¸ºå‘æœ‰ç”µæœºä¸€æ–¹è½¬
 191   2                  if(str_begin.pysd==par_speed)
 192   2                      return;
 193   2                  else
 194   2                      str_begin.pysd=par_speed;
 195   2                  if(par_speed==0){
 196   3                      out_motorselect=1;out_dir2=0;out_en2=1;
 197   3                  }
 198   2                  else if(par_speed>0){
 199   3                      out_motorselect=1;out_dir2=1;out_en2=0;
 200   3                  }
 201   2                  else if(par_speed<0){
 202   3                      out_motorselect=1;out_dir2=0;out_en2=0;
 203   3                  }
 204   2                  break;
 205   2              case mot_sj://å‘ä¸Šä¸ºæ­£è½¬,å‘ä¸‹ä¸ºåè½¬
 206   2                  if(str_begin.sjsd==par_speed)
 207   2                      return;
 208   2                  else
 209   2                      str_begin.sjsd=par_speed;
 210   2                  if(par_speed==0){
 211   3                      out_motorselect=0;out_dir1=0;out_en1=1;
 212   3                  }
 213   2                  else if(par_speed>0){
 214   3                      out_motorselect=0;out_dir1=0;out_en1=0;
 215   3                  }
 216   2                  else if(par_speed<0){
 217   3                      out_motorselect=0;out_dir1=1;out_en1=0;
 218   3                  }
 219   2                  break;
 220   2              case mot_hz://é¡ºæ—¶é’ˆä¸ºæ­£è½¬,é€†æ—¶é’ˆä¸ºåè½¬
 221   2                  if(str_begin.hzsd==par_speed)
 222   2                      return;
 223   2                  else
 224   2                      str_begin.hzsd=par_speed;
 225   2                  if(par_speed==0){
 226   3                      out_motorselect=0;out_dir2=0;out_en2=1;
 227   3                  }
 228   2                  else if(par_speed>0){
 229   3                      out_motorselect=0;out_dir2=0;out_en2=0;
 230   3                  }
 231   2                  else if(par_speed<0){
 232   3                      out_motorselect=0;out_dir2=1;out_en2=0;
 233   3                  }
 234   2                  break;
 235   2              default:
 236   2                  break;
 237   2          }
 238   1      }//ä¸»å‡½æ•°æ“ä½œç”µæœº
 239          void fun_motorsrl(enum varENU_mot par_model,char par_speed){
 240   1          if(par_speed>100)
C51 COMPILER V9.54   8023                                                                  09/13/2015 15:13:32 PAGE 5   

 241   1              par_speed=100;
 242   1          else if(par_speed<-100)
 243   1              par_speed=-100;//é€Ÿåº¦æœ€å¤š100,æœ€å°‘-100
 244   1          switch(par_model){
 245   2              case mot_l://å·¦è½®ç”µæœº
 246   2                  if(str_begin.leftsd==par_speed)
 247   2                      return;
 248   2                  else
 249   2                      str_begin.leftsd=par_speed;
 250   2                  if(par_speed==0){
 251   3                      fun_pwml(0);out_pwml=0;
 252   3                  }
 253   2                  else if(par_speed>0){
 254   3                      CR=1;fun_pwml(par_speed);out_pwml=0;
 255   3                  }
 256   2                  else if(par_speed<0){
 257   3                      CR=1;fun_pwml(cabs(par_speed));out_pwml=1;
 258   3                  }
 259   2                  break;
 260   2              case mot_r://å³è½®ç”µæœº
 261   2                  if(str_begin.rightsd==par_speed)
 262   2                      return;
 263   2                  else
 264   2                      str_begin.rightsd=par_speed;
 265   2                  if(par_speed==0){
 266   3                      fun_pwmr(0);out_pwmr=0;
 267   3                  }
 268   2                  else if(par_speed>0){
 269   3                      CR=1;fun_pwmr(par_speed);out_pwmr=0;
 270   3                  }
 271   2                  else if(par_speed<0){
 272   3                      CR=1;fun_pwmr(cabs(par_speed));out_pwmr=1;
 273   3                  }
 274   2                  break;
 275   2              case mot_rl://å·¦å³è½®åŒæ­¥
 276   2                  if((str_begin.leftsd==par_speed)&&(str_begin.rightsd==par_speed))
 277   2                      return;
 278   2                  else
 279   2                      str_begin.leftsd=str_begin.rightsd=par_speed;
 280   2                  if(par_speed==0){
 281   3                      CR=0;
 282   3                      fun_pwmr(0);out_pwmr=0;
 283   3                      fun_pwml(0);out_pwml=0;
 284   3                  }
 285   2                  else if(par_speed>0){
 286   3                      CR=1;
 287   3                      fun_pwml(par_speed);out_pwml=0;
 288   3                      fun_pwmr(par_speed);out_pwmr=0;
 289   3                  }
 290   2                  else if(par_speed<0){
 291   3                      CR=1;
 292   3                      fun_pwml(cabs(par_speed));out_pwml=1;
 293   3                      fun_pwmr(cabs(par_speed));out_pwmr=1;
 294   3                  }
 295   2                  break;
 296   2              default:
 297   2                  break;
 298   2          }
 299   1      }//å®šæ—¶å™¨æ“ä½œå·¦å³è½®
 300          void fun_sz1(enum varENU_han par_model){
 301   1          if(str_begin.szzt==par_model)
 302   1              return;
C51 COMPILER V9.54   8023                                                                  09/13/2015 15:13:32 PAGE 6   

 303   1          if(par_model==han_s){//æ‰‹æŠ“æ¾
 304   2              fun_motors(mot_sz,-100);
 305   2              while(in_s==1);
 306   2          }
 307   1          else{//æ‰‹æŠ“ç´§
 308   2              fun_motors(mot_sz,100);
 309   2              while(in_j==1);
 310   2          }
 311   1          fun_delay(20,del_ms);
 312   1          fun_motors(mot_sz,0);
 313   1          str_begin.szzt=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 314   1      }//æ‰‹æŠ“å•æ­¥è¿åŠ¨
 315          void fun_py1(enum varENU_tra par_model){
 316   1          if(str_begin.pywz==par_model)
 317   1              return;
 318   1          switch(par_model){
 319   2              case tra_q://å‰å¹³ç§»(æ²¡æœ‰ç”µæœºçš„å‘¢ä¸ªæ–¹å‘)
 320   2                  fun_motors(mot_py,100);
 321   2                  while(in_qpy==1);
 322   2                  fun_delay(str_cod.py1bz,del_ms);
 323   2                  break;
 324   2              case tra_kq:
 325   2                  switch(str_begin.pywz){
 326   3                      case tra_q:
 327   3                          fun_motors(mot_py,-100);
 328   3                          fun_delay(str_cod.py1qkq,del_ms);
 329   3                          break;
 330   3                      case tra_z:
 331   3                          fun_motors(mot_py,100);
 332   3                          fun_delay(str_cod.py1kqz,del_ms);
 333   3                          break;
 334   3                      case tra_kh:
 335   3                          fun_motors(mot_py,100);
 336   3                          fun_delay(str_cod.py1kqkh,del_ms);
 337   3                          break;
 338   3                      case tra_h:
 339   3                          fun_motors(mot_py,100);
 340   3                          fun_delay(str_cod.py1kqh,del_ms);
 341   3                          break;
 342   3                  }
 343   2                  break;
 344   2              case tra_z:
 345   2                  switch(str_begin.pywz){
 346   3                      case tra_q:
 347   3                          fun_motors(mot_py,-100);
 348   3                          fun_delay(str_cod.py1qz,del_ms);
 349   3                          break;
 350   3                      case tra_kq:
 351   3                          fun_motors(mot_py,-100);
 352   3                          fun_delay(str_cod.py1kqz,del_ms);
 353   3                          break;
 354   3                      case tra_kh:
 355   3                          fun_motors(mot_py,100);
 356   3                          fun_delay(str_cod.py1zkh,del_ms);
 357   3                          break;
 358   3                      case tra_h:
 359   3                          fun_motors(mot_py,100);
 360   3                          fun_delay(str_cod.py1zh,del_ms);
 361   3                          break;
 362   3                  }
 363   2                  break;
 364   2              case tra_kh:
C51 COMPILER V9.54   8023                                                                  09/13/2015 15:13:32 PAGE 7   

 365   2                  switch(str_begin.pywz){
 366   3                      case tra_q:
 367   3                          fun_motors(mot_py,-100);
 368   3                          fun_delay(str_cod.py1qkh,del_ms);
 369   3                          break;
 370   3                      case tra_kq:
 371   3                          fun_motors(mot_py,-100);
 372   3                          fun_delay(str_cod.py1kqkh,del_ms);
 373   3                          break;
 374   3                      case tra_z:
 375   3                          fun_motors(mot_py,-100);
 376   3                          fun_delay(str_cod.py1zkh,del_ms);
 377   3                          break;
 378   3                      case tra_h:
 379   3                          fun_motors(mot_py,100);
 380   3                          fun_delay(str_cod.py1khh,del_ms);
 381   3                          break;
 382   3                  }
 383   2                  break;
 384   2              case tra_h://åå¹³ç§»(æœ‰ç”µæœºçš„å‘¢ä¸ªæ–¹å‘)
 385   2                  fun_motors(mot_py,-100);
 386   2                  while(in_hpy==1);
 387   2                  fun_delay(str_cod.py1bz,del_ms);
 388   2                  break;
 389   2              default:
 390   2                  break;
 391   2          }
 392   1          fun_motors(mot_py,0);
 393   1          str_begin.pywz=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 394   1      }//å¹³ç§»å•æ­¥è¿åŠ¨
 395          void fun_sj1(enum varENU_sjp par_model){
 396   1          if(str_begin.sjwz==par_model)
 397   1             return;
 398   1          switch(par_model){
 399   2              case sjp_1://å‡é™ä½ç½®1(æœ€ä¸Šä½)
 400   2                  fun_motors(mot_sj,100);
 401   2                  def_select(sel_58);
 402   2                  while(in_wz1==1);
 403   2                  fun_delay(str_cod.sj1bzw,del_ms);
 404   2                  break;
 405   2              case sjp_12:
 406   2                  if(par_model>str_begin.sjwz){
 407   3                      fun_motors(mot_sj,-100);
 408   3                      fun_delay(str_cod.sj1zjw,del_ms);
 409   3                  }
 410   2                  else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 411   3                      fun_sj1(sjp_2);
 412   3                      fun_motors(mot_sj,100);
 413   3                      fun_delay(str_cod.sj1zjw,del_ms);
 414   3                  }
 415   2                  break;
 416   2              case sjp_2://å‡é™ä½ç½®2
 417   2                  fun_motors(mot_sj,par_model<str_begin.sjwz?100:-100);
 418   2                  def_select(sel_58);
 419   2                  while(in_wz2==1);
 420   2                  fun_delay(str_cod.sj1bzw,del_ms);
 421   2                  break;
 422   2              case sjp_23:
 423   2                  if(par_model>str_begin.sjwz){
 424   3                      fun_sj1(sjp_2);
 425   3                      fun_motors(mot_sj,-100);
 426   3                      fun_delay(str_cod.sj1zjw,del_ms);
C51 COMPILER V9.54   8023                                                                  09/13/2015 15:13:32 PAGE 8   

 427   3                  }
 428   2                  else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 429   3                      fun_sj1(sjp_3);
 430   3                      fun_motors(mot_sj,100);
 431   3                      fun_delay(str_cod.sj1zjw,del_ms);
 432   3                  }
 433   2                  break;
 434   2              case sjp_3://å‡é™ä½ç½®3
 435   2                  fun_motors(mot_sj,par_model<str_begin.sjwz?100:-100);
 436   2                  def_select(sel_58);
 437   2                  while(in_wz3==1);
 438   2                  fun_delay(str_cod.sj1bzw,del_ms);
 439   2                  break;
 440   2              case sjp_34:
 441   2                  if(par_model>str_begin.sjwz){
 442   3                      fun_sj1(sjp_3);
 443   3                      fun_motors(mot_sj,-100);
 444   3                      fun_delay(str_cod.sj1zjw,del_ms);
 445   3                  }
 446   2                  else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 447   3                      fun_sj1(sjp_4);
 448   3                      fun_motors(mot_sj,100);
 449   3                      fun_delay(str_cod.sj1zjw,del_ms);
 450   3                  }
 451   2                  break;
 452   2              case sjp_4://å‡é™ä½ç½®4
 453   2                  fun_motors(mot_sj,par_model<str_begin.sjwz?100:-100);
 454   2                  def_select(sel_58);
 455   2                  while(in_wz4==1);
 456   2                  fun_delay(str_cod.sj1bzw,del_ms);
 457   2                  break;
 458   2              case sjp_45:
 459   2                  if(par_model>str_begin.sjwz){
 460   3                      fun_sj1(sjp_4);
 461   3                      fun_motors(mot_sj,-100);
 462   3                      fun_delay(str_cod.sj1zjw,del_ms);
 463   3                  }
 464   2                  else{//è¦å»çš„åœ°æ–¹åœ¨ä¸Šé¢ï¼Œå‘ä¸Šèµ°
 465   3                      fun_motors(mot_sj,100);
 466   3                      fun_delay(str_cod.sj1zjw,del_ms);
 467   3                  }
 468   2                  break;
 469   2              case sjp_5://å‡é™ä½ç½®5
 470   2                  fun_motors(mot_sj,-100);
 471   2                  def_select(sel_912);
 472   2                  while(in_wz5==1);
 473   2                  fun_delay(str_cod.sj1bzw,del_ms);
 474   2                  break;
 475   2              default:
 476   2                  break;
 477   2          }
 478   1          fun_motors(mot_sj,0);
 479   1          str_begin.sjwz=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 480   1      }//å‡é™å•æ­¥è¿åŠ¨
 481          void fun_hz1(enum varENU_dir par_model){
 482   1          if(str_begin.hzfx==par_model)
 483   1              return;
 484   1          def_select(sel_912);
 485   1          switch(par_model){
 486   2              case dir_up://å›è½¬è‡³å‰æ–¹
 487   2                  switch(str_begin.hzfx){
 488   3                      case dir_down://ç°åœ¨åœ¨ä¸‹æ–¹
C51 COMPILER V9.54   8023                                                                  09/13/2015 15:13:32 PAGE 9   

 489   3                          fun_motors(mot_hz,-100);
 490   3                          fun_delay(1,del_s);
 491   3                          while(in_hz==1);
 492   3                          while(in_hz==0);
 493   3                          while(in_hz==1);
 494   3                          fun_delay(str_cod.hz1bz,del_ms);
 495   3                          break;
 496   3                      case dir_left://ç°åœ¨åœ¨å·¦è¾¹
 497   3                          fun_motors(mot_hz,100);
 498   3                          fun_delay(1,del_s);
 499   3                          while(in_hz==1);
 500   3                          fun_delay(str_cod.hz1bz,del_ms);
 501   3                          break;
 502   3                      case dir_right://ç°åœ¨åœ¨å³è¾¹
 503   3                          fun_motors(mot_hz,-100);
 504   3                          fun_delay(1,del_s);
 505   3                          while(in_hz==1);
 506   3                          fun_delay(str_cod.hz1bz,del_ms);
 507   3                          break;
 508   3                      default:
 509   3                          break;
 510   3                  }
 511   2                  break;
 512   2              case dir_down://è¦å»ä¸‹é¢
 513   2                  switch(str_begin.hzfx){
 514   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 515   3                          fun_motors(mot_hz,100);
 516   3                          fun_delay(1,del_s);
 517   3                          while(in_hz==1);
 518   3                          while(in_hz==0);
 519   3                          while(in_hz==1);
 520   3                          fun_delay(str_cod.hz1bz,del_ms);
 521   3                          break;
 522   3                      case dir_left://ç°åœ¨åœ¨å·¦é¢
 523   3                          fun_motors(mot_hz,-100);
 524   3                          fun_delay(1,del_s);
 525   3                          while(in_hz==1);
 526   3                          fun_delay(str_cod.hz1bz,del_ms);
 527   3                          break;
 528   3                          break;
 529   3                      case dir_right://ç°åœ¨åœ¨å³é¢
 530   3                          fun_motors(mot_hz,100);
 531   3                          fun_delay(1,del_s);
 532   3                          while(in_hz==1);
 533   3                          fun_delay(str_cod.hz1bz,del_ms);
 534   3                          break;
 535   3                      default:
 536   3                          break;
 537   3                  }
 538   2                  break;
 539   2              case dir_left://è¦å»å·¦è¾¹
 540   2                  switch(str_begin.hzfx){
 541   3                      case dir_up://ç°åœ¨åœ¨ä¸Šé¢
 542   3                          fun_motors(mot_hz,-100);
 543   3                          fun_delay(1,del_s);
 544   3                          while(in_hz==1);
 545   3                          fun_delay(str_cod.hz1bz,del_ms);
 546   3                          break;
 547   3                          break;
 548   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 549   3                          fun_motors(mot_hz,100);
 550   3                          fun_delay(1,del_s);
C51 COMPILER V9.54   8023                                                                  09/13/2015 15:13:32 PAGE 10  

 551   3                          while(in_hz==1);
 552   3                          fun_delay(str_cod.hz1bz,del_ms);
 553   3                          break;
 554   3                          break;
 555   3                      case dir_right://ç°åœ¨åœ¨å³é¢
 556   3                          fun_motors(mot_hz,-100);
 557   3                          fun_delay(1,del_s);
 558   3                          while(in_hz==1);
 559   3                          while(in_hz==0);
 560   3                          while(in_hz==1);
 561   3                          fun_delay(str_cod.hz1bz,del_ms);
 562   3                          break;
 563   3                      default:
 564   3                          break;
 565   3                  }
 566   2                  break;
 567   2              case dir_right://è¦å»å³é¢
 568   2                  switch(str_begin.hzfx){
 569   3                      case dir_up://ç°åœ¨åœ¨å‰é¢
 570   3                          fun_motors(mot_hz,100);
 571   3                          fun_delay(1,del_s);
 572   3                          while(in_hz==1);
 573   3                          fun_delay(str_cod.hz1bz,del_ms);
 574   3                          break;
 575   3                      case dir_down://ç°åœ¨åœ¨ä¸‹é¢
 576   3                          fun_motors(mot_hz,-100);
 577   3                          fun_delay(1,del_s);
 578   3                          while(in_hz==1);
 579   3                          fun_delay(str_cod.hz1bz,del_ms);
 580   3                          break;
 581   3                      case dir_left://ç°åœ¨åœ¨å·¦é¢
 582   3                          fun_motors(mot_hz,100);
 583   3                          fun_delay(1,del_s);
 584   3                          while(in_hz==1);
 585   3                          while(in_hz==0);
 586   3                          while(in_hz==1);
 587   3                          fun_delay(str_cod.hz1bz,del_ms);
 588   3                          break;
 589   3                      default:
 590   3                          break;
 591   3                  }
 592   2                  break;
 593   2              default:
 594   2                  break;
 595   2          }
 596   1          fun_motors(mot_hz,0);
 597   1          str_begin.hzfx=par_model;//å­˜å‚¨è¿è¡Œç»“æœ
 598   1      }//å›è½¬å•æ­¥è¿åŠ¨
 599          
 600          //void fun_pyhz2(enum varENU_tra par_pymodel,enum varENU_dir par_hzmodel){//å¹³ç§»å›è½¬åŒæ­¥è¿åŠ¨
 601          //    switch(){
 602          //        ;
 603          //    }
 604          //}
 605          
 606          void fun_jtjp(){
 607   1          while(1){
 608   2              if((!in_ls1&&!in_ls2&&in_ls4&&in_ls5&&!in_ls7&&!in_ls8)&&((in_ls3&&in_ls6)||(!in_ls3&&!in_ls6))){
 609   3                  fun_delay(10,del_ms);
 610   3                  fun_motors(mot_rl,0);
 611   3                  return;
 612   3              }
C51 COMPILER V9.54   8023                                                                  09/13/2015 15:13:32 PAGE 11  

 613   2              if(in_ls2||in_ls1){
 614   3                  fun_motors(mot_l,16);
 615   3                  fun_motors(mot_r,-16);
 616   3              }
 617   2              else if(in_ls7||in_ls8){
 618   3                  fun_motors(mot_l,-16);
 619   3                  fun_motors(mot_r,16);
 620   3              }
 621   2              else{
 622   3                  if(!in_ls4){
 623   4                      fun_motors(mot_l,-12);
 624   4                      fun_motors(mot_r,12);
 625   4                  }
 626   3                  else if(!in_ls5){
 627   4                      fun_motors(mot_l,12);
 628   4                      fun_motors(mot_r,-12);
 629   4                  }
 630   3                  else{
 631   4                      if(in_ls6&&!in_ls3){
 632   5                          fun_motors(mot_l,-8);
 633   5                          fun_motors(mot_r,8);
 634   5                      }
 635   4                      if(in_ls3&&!in_ls6){
 636   5                          fun_motors(mot_l,8);
 637   5                          fun_motors(mot_r,-8);
 638   5                      }
 639   4                  }
 640   3              }
 641   2          }
 642   1      }//é™æ€çº å
 643          void fun_timermove(){
 644   1          static uc loc_con=0;//éœ€è¦åˆ†æ­¥åšçš„åŠ¨ä½œéœ€è¦ç”¨åˆ°æ­¤é™æ€ç§æœ‰åˆ†æ­¥æ ‡å¿—ä½
 645   1          uc loc_sdl=str_tfl.gospeed,loc_sdr=str_tfl.gospeed;
 646   1          switch(*str_tfl.run){//é€‰æ‹©è¿è¡Œæ–¹å¼
 647   2              case def_end://è¿è¡Œç»“æŸ
 648   2                  fun_motorsrl(mot_rl,0);//å†æ¬¡åœæ­¢ç”µæœºè¿åŠ¨
 649   2                  str_tfl.doing=tf_false;//ç§»åŠ¨ç»“æŸ
 650   2                  memset(str_tfl.step,0,sizeof(str_tfl.step));//æ¸…ç©ºstepæ•°ç»„
 651   2                  str_tfl.run=str_tfl.step;//æŒ‡é’ˆæŒ‡å‘stepçš„ç¬¬ä¸€ä¸ªå…ƒç´ 
 652   2                  break;
 653   2              case tfl_line://è¿è¡Œå·¡çº¿
 654   2                  if(*(str_tfl.run+1)){//å¦‚æœå‚æ•°ä¸ºé0æ•°
 655   3                      if((in_ls1||in_ls8)&&(in_ls2&&in_ls3&&in_ls4&&in_ls5&in_ls6&&in_ls7)){//å¦‚æœä¸­é—´6ä¸ªç
             -¯å…¨äº®,å·¦å³äº®ä»»æ„ä¸€ä¸ª
 656   4                          str_tfl.online=tf_ture;//æ ‡å¿—ä½è®°å½•åœ¨çº¿
 657   4                          fun_motorsrl(mot_rl,str_tfl.gospeed);//æŒ‰ç…§å¸¸è§„é€Ÿåº¦è¿‡çº¿
 658   4                      }
 659   3                      else if(str_tfl.online==tf_ture){//å¦‚æœæ ‡å¿—ä½è®°å½•åœ¨çº¿,è€Œä¸”ä¸ç¬¦åˆåœ¨çº¿ç‰¹å¾
 660   4                          str_tfl.online=tf_false;//æ ‡å¿—ä½è®°å½•ä¸åœ¨çº¿
 661   4                          (*(str_tfl.run+1))--;//å‚æ•°å€¼å‡1,è®°å½•å·²ç»èµ°äº†ä¸€æ¡çº¿
 662   4                      }
 663   3                      else{
 664   4                          if(in_ls1&&!in_ls8){//1äº®8ä¸äº®
 665   5                              loc_sdl*=0.5;//å·¦å‡é€Ÿ
 666   5                              loc_sdr*=1.5;//å³åŠ é€Ÿ
 667   5                          }//å‘å·¦è½¬
 668   4                          if(in_ls8&&!in_ls1){//8äº®1ä¸äº®
 669   5                              loc_sdl*=1.5;//å·¦åŠ é€Ÿ
 670   5                              loc_sdr*=0.5;//å³å‡é€Ÿ
 671   5                          }//å‘å³è½¬
 672   4                          if(in_ls2&&!in_ls7){//2äº®7ä¸äº®
 673   5                              loc_sdl*=0.7;//å·¦å‡é€Ÿ
C51 COMPILER V9.54   8023                                                                  09/13/2015 15:13:32 PAGE 12  

 674   5                              loc_sdr*=1.3;//å³åŠ é€Ÿ
 675   5                          }//å‘å·¦è½¬
 676   4                          if(in_ls7&&!in_ls2){//7äº®2ä¸äº®
 677   5                              loc_sdl*=1.3;//å·¦åŠ é€Ÿ
 678   5                              loc_sdr*=0.7;//å³å‡é€Ÿ
 679   5                          }//å‘å³è½¬
 680   4                          if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
 681   5                              loc_sdl*=0.9;//å·¦å‡é€Ÿ
 682   5                              loc_sdr*=1.1;//å³åŠ é€Ÿ
 683   5                          }//å‘å·¦è½¬
 684   4                          if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
 685   5                              loc_sdl*=1.1;//å·¦åŠ é€Ÿ
 686   5                              loc_sdr*=0.9;//å³å‡é€Ÿ
 687   5                          }//å‘å³è½¬
 688   4                          fun_motorsrl(mot_r,loc_sdr);
 689   4                          fun_motorsrl(mot_l,loc_sdl);
 690   4                      }
 691   3                  }
 692   2                  else{//å¦‚æœçº¿èµ°å®Œäº†
 693   3                      str_tfl.run+=2;//æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ç»„è¿‡ç¨‹
 694   3                      fun_motorsrl(mot_rl,0);//åœæ­¢ç”µæœºè¿åŠ¨
 695   3                  }
 696   2                  break;
 697   2              case tfl_turn://è¿è¡Œè½¬å¼¯
 698   2                  switch(loc_con){//åˆ†æ­¥è¿è¡Œæ ‡å¿—ä½
 699   3                      case 0://ç¬¬ä¸€æ­¥
 700   3                          switch(*(str_tfl.run+1)){//è·å–å‚æ•°
 701   4                              case tur_r90://å³è½¬90
 702   4                                  fun_motorsrl(mot_l,str_tfl.turnspeed);//å·¦è½®å‘å‰
 703   4                                  fun_motorsrl(mot_r,-str_tfl.turnspeed);//å³è½®å‘å
 704   4                                  str_tfl.delay=var_timer+str_cod.turn90;//è®¡æ—¶
 705   4                                  break;
 706   4                              case tur_l90://å·¦è½¬90
 707   4                                  fun_motorsrl(mot_l,-str_tfl.turnspeed);//å·¦è½®å‘å
 708   4                                  fun_motorsrl(mot_r,str_tfl.turnspeed);//å³è½®å‘å‰
 709   4                                  str_tfl.delay=var_timer+str_cod.turn90;//è®¡æ—¶
 710   4                                  break;
 711   4                              case tur_r180://å³è½¬180
 712   4                                  fun_motorsrl(mot_l,str_tfl.turnspeed);//å·¦è½®å‘å‰
 713   4                                  fun_motorsrl(mot_r,-str_tfl.turnspeed);//å³è½®å‘å
 714   4                                  str_tfl.delay=var_timer+str_cod.turn180;//è®¡æ—¶
 715   4                                  break;
 716   4                              case tur_l180://å·¦è½¬180
 717   4                                  fun_motorsrl(mot_l,-str_tfl.turnspeed);//å·¦è½®å‘å
 718   4                                  fun_motorsrl(mot_r,str_tfl.turnspeed);//å·¦è½®å‘å‰
 719   4                                  str_tfl.delay=var_timer+str_cod.turn180;//è®¡æ—¶
 720   4                                  break;
 721   4                          }
 722   3                          loc_con++;//æ‰§è¡Œä¸‹ä¸€æ­¥
 723   3                          break;
 724   3                      case 1://ç¬¬äºŒæ­¥
 725   3                          if(str_tfl.delay<=var_timer)//è®¡æ—¶æ—¶é—´åˆ°
 726   3                              loc_con++;//æ‰§è¡Œä¸‹ä¸€æ­¥
 727   3                          break;
 728   3                      case 2://ç¬¬ä¸‰æ­¥
 729   3                          if(in_ls4&&in_ls5){//å¦‚æœä¸­é—´ä¸¤ä¸ªç¯äº®
 730   4                              fun_motorsrl(mot_rl,0);//åœæ­¢ç”µæœº
 731   4                              str_tfl.run+=2;//æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ç»„è¿‡ç¨‹
 732   4                              str_tfl.delay=0;//å»¶æ—¶è®¡æ•°å™¨å½’é›¶
 733   4                              loc_con=0;//åˆ†æ­¥è¿è¡Œæ ‡å¿—ä½å½’é›¶
 734   4                          }
 735   3                          break;
C51 COMPILER V9.54   8023                                                                  09/13/2015 15:13:32 PAGE 13  

 736   3                  }
 737   2                  break;
 738   2              case tfl_cache://è¿è¡Œå‰å†²
 739   2                  switch(loc_con){
 740   3                      case 0://ç¬¬ä¸€æ­¥
 741   3                          str_tfl.delay=var_timer+((*(str_tfl.run+1))*10);//å»¶æ—¶æ—¶é—´(æ¯«ç§’)ä¸ºå‚æ•°çš„10å€
             -
 742   3                          loc_con++;//æ‰§è¡Œä¸‹ä¸€æ­¥
 743   3                          break;
 744   3                      case 1://ç¬¬äºŒæ­¥
 745   3                          if(str_tfl.delay<=var_timer){//è®¡æ—¶æ—¶é—´åˆ°
 746   4                              fun_motorsrl(mot_rl,0);//åœæ­¢ç”µæœº
 747   4                              str_tfl.run+=2;//æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ç»„è¿‡ç¨‹
 748   4                              str_tfl.delay=0;//å»¶æ—¶è®¡æ•°å™¨å½’é›¶
 749   4                              loc_con=0;//åˆ†æ­¥è¿è¡Œæ ‡å¿—ä½å½’é›¶
 750   4                          }
 751   3                          else{
 752   4                              if(in_ls1&&!in_ls8){//1äº®8ä¸äº®
 753   5                                  loc_sdl*=0.5;//å·¦å‡é€Ÿ
 754   5                                  loc_sdr*=1.5;//å³åŠ é€Ÿ
 755   5                              }//å‘å·¦è½¬
 756   4                              if(in_ls8&&!in_ls1){//8äº®1ä¸äº®
 757   5                                  loc_sdl*=1.5;//å·¦åŠ é€Ÿ
 758   5                                  loc_sdr*=0.5;//å³å‡é€Ÿ
 759   5                              }//å‘å³è½¬
 760   4                              if(in_ls2&&!in_ls7){//2äº®7ä¸äº®
 761   5                                  loc_sdl*=0.7;//å·¦å‡é€Ÿ
 762   5                                  loc_sdr*=1.3;//å³åŠ é€Ÿ
 763   5                              }//å‘å·¦è½¬
 764   4                              if(in_ls7&&!in_ls2){//7äº®2ä¸äº®
 765   5                                  loc_sdl*=1.3;//å·¦åŠ é€Ÿ
 766   5                                  loc_sdr*=0.7;//å³å‡é€Ÿ
 767   5                              }//å‘å³è½¬
 768   4                              if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
 769   5                                  loc_sdl*=0.9;//å·¦å‡é€Ÿ
 770   5                                  loc_sdr*=1.1;//å³åŠ é€Ÿ
 771   5                              }//å‘å·¦è½¬
 772   4                              if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
 773   5                                  loc_sdl*=1.1;//å·¦åŠ é€Ÿ
 774   5                                  loc_sdr*=0.9;//å³å‡é€Ÿ
 775   5                              }//å‘å³è½¬
 776   4                              fun_motorsrl(mot_r,loc_sdr);
 777   4                              fun_motorsrl(mot_l,loc_sdl);
 778   4                          }
 779   3                          break;
 780   3                  }
 781   2                  break;
 782   2              case tfl_start://è¿è¡Œå¸¦åŠ é€Ÿçš„å‰å†²
 783   2      
 784   2                  break;
 785   2              case tfl_end://è¿è¡Œå¸¦å‡é€Ÿçš„å‰å†²
 786   2      
 787   2                  break;
 788   2          }
 789   1      }//å®šæ—¶å™¨ç§»åŠ¨
 790          void fun_folline(uc par_con,uc par_speed){
 791   1          uc loc_con=par_con;//å·¡çº¿æ¡æ•°æ ‡å¿—ä½
 792   1          uc loc_sdr,loc_sdl;//å·¦å³è½®é€Ÿåº¦
 793   1          uc loc_online;//åœ¨çº¿æ ‡å¿—ä½
 794   1          while(loc_con){
 795   2              if((in_ls1||in_ls8)&&(in_ls2&&in_ls3&&in_ls4&&in_ls5&in_ls6&&in_ls7)){//å¦‚æœä¸­é—´6ä¸ªç¯å…¨äº®,
             -å·¦å³äº®ä»»æ„ä¸€ä¸ª
C51 COMPILER V9.54   8023                                                                  09/13/2015 15:13:32 PAGE 14  

 796   3                  loc_online=tf_ture;//æ ‡å¿—ä½è®°å½•åœ¨çº¿
 797   3                  fun_motors(mot_rl,par_speed);//æŒ‰ç…§å¸¸è§„é€Ÿåº¦è¿‡çº¿
 798   3              }
 799   2              else if(loc_online==tf_ture){//å¦‚æœæ ‡å¿—ä½è®°å½•åœ¨çº¿,è€Œä¸”ä¸ç¬¦åˆåœ¨çº¿ç‰¹å¾
 800   3                  loc_online=tf_false;//æ ‡å¿—ä½è®°å½•ä¸åœ¨çº¿
 801   3                  loc_con--;//å‚æ•°å€¼å‡1,è®°å½•å·²ç»èµ°äº†ä¸€æ¡çº¿
 802   3              }
 803   2              else{
 804   3                  loc_sdr=loc_sdl=par_speed;
 805   3                  if(in_ls1&&!in_ls8){//1äº®8ä¸äº®
 806   4                      loc_sdl*=0.5;//å·¦å‡é€Ÿ
 807   4                      loc_sdr*=1.5;//å³åŠ é€Ÿ
 808   4                  }//å‘å·¦è½¬
 809   3                  if(in_ls8&&!in_ls1){//8äº®1ä¸äº®
 810   4                      loc_sdl*=1.5;//å·¦åŠ é€Ÿ
 811   4                      loc_sdr*=0.5;//å³å‡é€Ÿ
 812   4                  }//å‘å³è½¬
 813   3                  if(in_ls2&&!in_ls7){//2äº®7ä¸äº®
 814   4                      loc_sdl*=0.7;//å·¦å‡é€Ÿ
 815   4                      loc_sdr*=1.3;//å³åŠ é€Ÿ
 816   4                  }//å‘å·¦è½¬
 817   3                  if(in_ls7&&!in_ls2){//7äº®2ä¸äº®
 818   4                      loc_sdl*=1.3;//å·¦åŠ é€Ÿ
 819   4                      loc_sdr*=0.7;//å³å‡é€Ÿ
 820   4                  }//å‘å³è½¬
 821   3                  if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
 822   4                      loc_sdl*=0.9;//å·¦å‡é€Ÿ
 823   4                      loc_sdr*=1.1;//å³åŠ é€Ÿ
 824   4                  }//å‘å·¦è½¬
 825   3                  if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
 826   4                      loc_sdl*=1.1;//å·¦åŠ é€Ÿ
 827   4                      loc_sdr*=0.9;//å³å‡é€Ÿ
 828   4                  }//å‘å³è½¬
 829   3                  fun_motors(mot_r,loc_sdr);
 830   3                  fun_motors(mot_l,loc_sdl);
 831   3                  fun_delay(1,del_ms);
 832   3              }
 833   2          }//å¦‚æœå·¡çº¿æ¡æ•°ä¸ä¸º0
 834   1          fun_qc(65,40);
 835   1      }//ä¸»å‡½æ•°å·¡çº¿
 836          void fun_turn(enum varENU_tur par_model,uc par_speed){
 837   1          switch(par_model){//è·å–å‚æ•°
 838   2              case tur_r90://å³è½¬90
 839   2                  fun_motors(mot_l,par_speed);//å·¦è½®å‘å‰
 840   2                  fun_motors(mot_r,-par_speed);//å³è½®å‘å
 841   2                  fun_delay(str_cod.turn90,del_ms);//è®¡æ—¶
 842   2                  break;
 843   2              case tur_l90://å·¦è½¬90
 844   2                  fun_motors(mot_l,-par_speed);//å·¦è½®å‘å
 845   2                  fun_motors(mot_r,par_speed);//å³è½®å‘å‰
 846   2                  fun_delay(str_cod.turn90,del_ms);//è®¡æ—¶
 847   2                  break;
 848   2              case tur_r180://å³è½¬180
 849   2                  fun_motors(mot_l,par_speed);//å·¦è½®å‘å‰
 850   2                  fun_motors(mot_r,-par_speed);//å³è½®å‘å
 851   2                  fun_delay(str_cod.turn180,del_ms);//è®¡æ—¶
 852   2                  break;
 853   2              case tur_l180://å·¦è½¬180
 854   2                  fun_motors(mot_l,-par_speed);//å·¦è½®å‘å
 855   2                  fun_motors(mot_r,par_speed);//å·¦è½®å‘å‰
 856   2                  fun_delay(str_cod.turn180,del_ms);//è®¡æ—¶
 857   2                  break;
C51 COMPILER V9.54   8023                                                                  09/13/2015 15:13:32 PAGE 15  

 858   2          }
 859   1          while(!in_ls4||!in_ls5);
 860   1          fun_motors(mot_rl,0);//åœæ­¢ç”µæœº
 861   1      }//ä¸»å‡½æ•°è½¬å¼¯
 862          void fun_qc(uc par_time,uc par_speed){
 863   1          uc loc_sdr,loc_sdl;//å·¦å³è½®é€Ÿåº¦
 864   1          str_tfl.delay=var_timer+par_time*10;//å»¶æ—¶æ—¶é—´(æ¯«ç§’)ä¸ºå‚æ•°çš„10å€
 865   1          while(str_tfl.delay>var_timer){
 866   2              loc_sdr=loc_sdl=par_speed;
 867   2              if(in_ls1&&!in_ls8){//1äº®8ä¸äº®
 868   3                  loc_sdl*=0.5;//å·¦å‡é€Ÿ
 869   3                  loc_sdr*=1.5;//å³åŠ é€Ÿ
 870   3              }//å‘å·¦è½¬
 871   2              if(in_ls8&&!in_ls1){//8äº®1ä¸äº®
 872   3                  loc_sdl*=1.5;//å·¦åŠ é€Ÿ
 873   3                  loc_sdr*=0.5;//å³å‡é€Ÿ
 874   3              }//å‘å³è½¬
 875   2              if(in_ls2&&!in_ls7){//2äº®7ä¸äº®
 876   3                  loc_sdl*=0.7;//å·¦å‡é€Ÿ
 877   3                  loc_sdr*=1.3;//å³åŠ é€Ÿ
 878   3              }//å‘å·¦è½¬
 879   2              if(in_ls7&&!in_ls2){//7äº®2ä¸äº®
 880   3                  loc_sdl*=1.3;//å·¦åŠ é€Ÿ
 881   3                  loc_sdr*=0.7;//å³å‡é€Ÿ
 882   3              }//å‘å³è½¬
 883   2              if(in_ls3&&!in_ls6){//3äº®6ä¸äº®
 884   3                  loc_sdl*=0.9;//å·¦å‡é€Ÿ
 885   3                  loc_sdr*=1.1;//å³åŠ é€Ÿ
 886   3              }//å‘å·¦è½¬
 887   2              if(in_ls6&&!in_ls3){//6äº®3ä¸äº®
 888   3                  loc_sdl*=1.1;//å·¦åŠ é€Ÿ
 889   3                  loc_sdr*=0.9;//å³å‡é€Ÿ
 890   3              }//å‘å³è½¬
 891   2              fun_motors(mot_r,loc_sdr);
 892   2              fun_motors(mot_l,loc_sdl);
 893   2              fun_delay(1,del_ms);
 894   2          }
 895   1          fun_motors(mot_rl,0);//åœæ­¢ç”µæœº
 896   1      }//ä¸»å‡½æ•°å‰å†²
 897          void fun_stope2prom(){
 898   1          IAP_CONTR = 0;                  //å…³é—­IAPåŠŸèƒ½
 899   1          IAP_CMD = 0;                    //æ¸…é™¤å‘½ä»¤
 900   1          IAP_TRIG = 0;                   //æ¸…é™¤è§¦å‘å¯„å­˜å™¨
 901   1          IAP_ADDRH = 0x80;               //æ•°æ®æŒ‡é’ˆæŒ‡å‘éEEPROMåŒº
 902   1          IAP_ADDRL = 0;                  //æ¸…é™¤IAPåœ°å€
 903   1      }//å…³é—­EEPROMåŠŸèƒ½(IapIdle)
 904          uc fun_reade2prom(ui par_add){
 905   1          uc loc_dat;                     //æ•°æ®ç¼“å†²åŒº
 906   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
 907   1          IAP_CMD = 1;                    //è®¾ç½®EEPROMè¯»å‘½ä»¤
 908   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
 909   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
 910   1          IAP_TRIG = 0x5a;                //è§¦å‘
 911   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
 912   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
 913   1          loc_dat = IAP_DATA;             //è¯»å‡ºEEPROMä¸­çš„æ•°æ®
 914   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
 915   1          return loc_dat;                 //è¿”å›è¯»å–ç»“æœ
 916   1      }//è¯»å–EEPROMæ•°æ®
 917          void fun_writee2prom(ui par_add,uc par_dat){
 918   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
 919   1          IAP_CMD = 2;                    //è®¾ç½®EEPROMå†™å…¥å‘½ä»¤
C51 COMPILER V9.54   8023                                                                  09/13/2015 15:13:32 PAGE 16  

 920   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
 921   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
 922   1          IAP_DATA = par_dat;             //å†™å…¥æ•°æ®
 923   1          IAP_TRIG = 0x5a;                //è§¦å‘
 924   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
 925   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
 926   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
 927   1      }//å†™EEPROMæ•°æ®
 928          void fun_cleane2prom(ui par_add){
 929   1          IAP_CONTR = 0x83;               //æ‰“å¼€EEPROMåŠŸèƒ½,è®¾ç½®ç­‰å¾…æ—¶é—´
 930   1          IAP_CMD = 3;                    //è®¾ç½®EEPROMæ“¦é™¤å‘½ä»¤
 931   1          IAP_ADDRL = par_add;            //è®¾ç½®EEPROMåœ°å€ä½å…«ä½
 932   1          IAP_ADDRH = par_add >> 8;       //è®¾ç½®EEPROMåœ°å€é«˜å…«ä½
 933   1          IAP_TRIG = 0x5a;                //è§¦å‘
 934   1          IAP_TRIG = 0xa5;                //å†æ¬¡è§¦å‘
 935   1          fun_delay(10,del_us);           //ç¨ç­‰ä¸€ä¼šå„¿
 936   1          fun_stope2prom();               //å…³é—­EEPROMåŠŸèƒ½
 937   1      }//æ¸…é™¤EEPROMæ•°æ®
 938          void fun_calibration(){
 939   1          // fun_sj1(sjp_1);//å‡åˆ°æœ€ä¸Šä½
 940   1          ul loc_time;
 941   1          fun_py1(tra_q);//ç§»åŠ¨åˆ°æœ€å‰ç«¯
 942   1          fun_py1(tra_h);//ç§»åŠ¨åˆ°æœ€åç«¯
 943   1          loc_time=var_timer;
 944   1          fun_py1(tra_q);//ç§»åŠ¨åˆ°å‰ç«¯å¹¶è®¡æ—¶
 945   1          fun_py1(tra_h);//ç§»åŠ¨åˆ°åç«¯
 946   1          loc_time=var_timer-loc_time;
 947   1          loc_time*=0.5;
 948   1          str_cod.py1zh=loc_time*0.5;//ä»ååˆ°ä¸­é—´
 949   1          str_cod.py1qz=loc_time*0.5;//ä»å‰åˆ°ä¸­é—´
 950   1          str_cod.py1qkh=loc_time*0.75;//ä»å‰åˆ°é å
 951   1          str_cod.py1kqh=loc_time*0.564;//ä»é å‰åˆ°å
 952   1          str_cod.py1qkq=loc_time*0.34;//ä»å‰åˆ°é å‰
 953   1          str_cod.py1khh=loc_time*0.2701;//ä»ååˆ°é å
 954   1          str_cod.py1kqz=loc_time*0.189;//ä»é å‰åˆ°ä¸­é—´
 955   1          str_cod.py1zkh=loc_time*0.20;//ä»é ååˆ°ä¸­é—´.
 956   1          str_cod.py1kqkh=loc_time*0.5;//ä»é å‰åˆ°é å
 957   1      }//è‡ªåŠ¨æ ¡å‡†å¹³ç§»å‚æ•°
 958          void fun_port(){
 959   1          /*
 960   1          PCON|=0x80;     //ä½¿èƒ½æ³¢ç‰¹ç‡å€é€Ÿä½SMOD
 961   1          SCON=0x50;      //8ä½æ•°æ®,å¯å˜æ³¢ç‰¹ç‡
 962   1          AUXR|=0x04;     //ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨æ—¶é’Ÿä¸ºFosc,å³1T
 963   1          BRT=0xD9;       //è®¾å®šç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨é‡è£…å€¼
 964   1          AUXR|=0x01;     //ä¸²å£1é€‰æ‹©ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨ä¸ºæ³¢ç‰¹ç‡å‘ç”Ÿå™¨
 965   1          AUXR|=0x10;     //å¯åŠ¨ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨
 966   1          TI=1;           //æ‰“å¼€ä¸²å£ä¼ è¾“åŠŸèƒ½
 967   1          */
 968   1          //38400bps@30.000MHz
 969   1          PCON |= 0x80;       //ä½¿èƒ½æ³¢ç‰¹ç‡å€é€Ÿä½SMOD
 970   1          SCON = 0x50;        //8ä½æ•°æ®,å¯å˜æ³¢ç‰¹ç‡
 971   1          AUXR |= 0x04;       //ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨æ—¶é’Ÿä¸ºFosc,å³1T
 972   1          BRT = 0xCF;     //è®¾å®šç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨é‡è£…å€¼
 973   1          AUXR |= 0x01;       //ä¸²å£1é€‰æ‹©ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨ä¸ºæ³¢ç‰¹ç‡å‘ç”Ÿå™¨
 974   1          AUXR |= 0x10;       //å¯åŠ¨ç‹¬ç«‹æ³¢ç‰¹ç‡å‘ç”Ÿå™¨
 975   1          TI=1;           //æ‰“å¼€ä¸²å£ä¼ è¾“åŠŸèƒ½
 976   1      }//ä¸²å£åˆå§‹åŒ–
 977          void fun_test(){
 978   1          fun_sz1(han_j);
 979   1          fun_delay(1,del_s);
 980   1          fun_sz1(han_s);
 981   1          fun_delay(1,del_s);
C51 COMPILER V9.54   8023                                                                  09/13/2015 15:13:32 PAGE 17  

 982   1          fun_sz1(han_j);
 983   1          fun_delay(1,del_s);
 984   1          fun_sz1(han_s);
 985   1          fun_delay(1,del_s);
 986   1      
 987   1          str_begin.pywz=tra_h;
 988   1          fun_py1(tra_q);
 989   1          fun_delay(1,del_s);
 990   1          fun_py1(tra_h);
 991   1          fun_delay(1,del_s);
 992   1          fun_py1(tra_q);
 993   1          fun_delay(1,del_s);
 994   1          fun_py1(tra_h);
 995   1          fun_delay(1,del_s);
 996   1      
 997   1          fun_sj1(sjp_1);
 998   1          fun_delay(1,del_s);
 999   1          fun_sj1(sjp_2);
1000   1          fun_delay(1,del_s);
1001   1          fun_sj1(sjp_3);
1002   1          fun_delay(1,del_s);
1003   1          fun_sj1(sjp_4);
1004   1          fun_delay(1,del_s);
1005   1          fun_sj1(sjp_5);
1006   1          fun_delay(1,del_s);
1007   1          fun_sj1(sjp_4);
1008   1          fun_delay(1,del_s);
1009   1          fun_sj1(sjp_3);
1010   1          fun_delay(1,del_s);
1011   1          fun_sj1(sjp_2);
1012   1          fun_delay(1,del_s);
1013   1          fun_sj1(sjp_1);
1014   1      
1015   1          str_now.hzfx=str_begin.hzfx;
1016   1          str_begin.hzfx=dir_up;
1017   1          fun_hz1(dir_right);
1018   1          fun_delay(1,del_s);
1019   1          fun_hz1(dir_up);
1020   1          fun_delay(1,del_s);
1021   1          fun_hz1(dir_right);
1022   1          fun_delay(1,del_s);
1023   1          fun_hz1(dir_up);
1024   1          fun_delay(1,del_s);
1025   1          str_begin.hzfx=str_now.hzfx;
1026   1      
1027   1          fun_motors(mot_rl,60);
1028   1          fun_delay(1,del_s);
1029   1          fun_motors(mot_rl,0);
1030   1          fun_delay(1,del_s);
1031   1      
1032   1          fun_motors(mot_rl,-60);
1033   1          fun_delay(1,del_s);
1034   1          fun_motors(mot_rl,0);
1035   1          fun_delay(1,del_s);
1036   1      
1037   1          fun_motors(mot_r,40);
1038   1          fun_motors(mot_l,-40);
1039   1          fun_delay(1,del_s);
1040   1          fun_motors(mot_rl,0);
1041   1          fun_delay(1,del_s);
1042   1      
1043   1          fun_motors(mot_r,-40);
C51 COMPILER V9.54   8023                                                                  09/13/2015 15:13:32 PAGE 18  

1044   1          fun_motors(mot_l,40);
1045   1          fun_delay(1,del_s);
1046   1          fun_motors(mot_rl,0);
1047   1      }//æµ‹è¯•ç¨‹åº
1048          uc fun_min(uc par_num,...){
1049   1          va_list loc_argp;//ä¿å­˜å‚æ•°ç»“æ„
1050   1          uc loc_min=par_num;//ç°åœ¨çš„æœ€å°å€¼å°±æ˜¯ç¬¬ä¸€ä¸ª
1051   1          uc loc_shu;//å½“å‰å‚æ•°
1052   1          va_start(loc_argp,par_num);//loc_argpæŒ‡å‘ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œpar_numæ˜¯æœ€åä¸€ä¸ªç¡®å
             -®šçš„å‚æ•°
1053   1          loc_shu=va_arg(loc_argp,uc);//å–å‡ºä¸‹ä¸€ä¸ªå‚æ•°
1054   1          do{
1055   2              if(loc_shu<loc_min)
1056   2                  loc_min=loc_shu;
1057   2              loc_shu=va_arg(loc_argp,uc);//å–å‡ºä¸‹ä¸€ä¸ªå‚æ•°
1058   2          }while(loc_shu!=def_end);
1059   1          va_end(loc_argp);//ç»“æŸ
1060   1          return loc_min;//é€€å‡º
1061   1      }//æ±‚æœ€å°å€¼
1062          void fun_coordinate(){
1063   1          
1064   1      }//è‡ªåŠ¨å·¡çº¿ä¹‹åæ ‡
1065          void fun_zdzj(ul par_04,ul par_37){//ulå‹æ•°æ®,ä¸€æ¬¡è¾“å…¥æ‰€æœ‰ç»“æœ,æ— éœ€ç­‰å¾…
1066   1          xdata uc loc_data[8][5];
1067   1          //å°†å‚æ•°åˆ‡ç‰‡ä¼ é€’ç»™æ•°ç»„çš„å„ä¸ªå…ƒç´ 
1068   1          loc_data[3][2]=(par_37/10000000)%10;
1069   1          loc_data[3][3]=(par_37/1000000)%10;
1070   1          loc_data[3][4]=(par_37/100000)%10;
1071   1          loc_data[3][5]=(par_37/10000)%10;
1072   1          loc_data[7][2]=(par_37/1000)%10;
1073   1          loc_data[7][3]=(par_37/100)%10;
1074   1          loc_data[7][4]=(par_37/10)%10;
1075   1          loc_data[7][5]=par_37%10;
1076   1      
1077   1          loc_data[0][2]=(par_04/10000000)%10;
1078   1          loc_data[0][3]=(par_04/1000000)%10;
1079   1          loc_data[0][4]=(par_04/100000)%10;
1080   1          loc_data[0][5]=(par_04/10000)%10;
1081   1          loc_data[4][2]=(par_04/1000)%10;
1082   1          loc_data[4][3]=(par_04/100)%10;
1083   1          loc_data[4][4]=(par_04/10)%10;
1084   1          loc_data[4][5]=par_04%10;
1085   1      
1086   1          if(str_begin.hzfx==dir_up||str_begin.hzfx==dir_down)//å¦‚æœå›è½¬æ–¹å‘åœ¨ä¸Šä¸‹
1087   1              fun_hz1(dir_right);//é‚£ä¹ˆå°±ç§»åˆ°å³è¾¹
1088   1          while(0){
1089   2              if(str_begin.hzfx==dir_right){
1090   3                  ;
1091   3              }//å¦‚æœåœ¨å³è¾¹
1092   2              else{
1093   3                  ;
1094   3              }//å¦‚æœåœ¨å·¦è¾¹
1095   2          }
1096   1      
1097   1      }//è‡ªåŠ¨æŠ“ä»¶
1098          void fun_zhuajian(){
1099   1          fun_folline(2,70);
1100   1          fun_turn(tur_l90,40);
1101   1          fun_folline(1,40);
1102   1      }//ä»èµ·å§‹åŒºèµ°åˆ°æŠ“ä»¶åŒº
1103          void fun_back(){
1104   1          fun_motors(mot_rl,-20);
C51 COMPILER V9.54   8023                                                                  09/13/2015 15:13:32 PAGE 19  

1105   1          fun_delay(1,del_s);
1106   1      
1107   1          fun_motors(mot_rl,-50);
1108   1          fun_delay(1,del_s);
1109   1      
1110   1          fun_motors(mot_r,-50);
1111   1          fun_motors(mot_l,-20);
1112   1          fun_delay(1,del_s);
1113   1      }//ä»æŠ“ä»¶åŒºå›åˆ°èµ·å§‹åŒº
*** WARNING C294 IN LINE 1089 OF program\8023.c: unreachable code


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   5642    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    147      40
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5      51
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
